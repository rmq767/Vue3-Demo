import{c as G,a as O,b as Y,d as X,e as ee}from"./element-plus-DRy_UtcF.js";import{s as W,r as B,d as F,c as Z,o as A,a as h,R as u,J as S,u as E,e as q,al as te,I as ae,P as j,O as J,n as ne,w as oe}from"./@vue-DtXbQ2UY.js";import{e as se,Q as le,R as ie,S as re,B as ce,A as ue,T as de,U as me,t as pe}from"./@element-plus-dWmgPpBK.js";import{_ as H}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./lodash-es-CVJ_Bk8S.js";import"./@vueuse-ZySg_D90.js";import"./@sxzz-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B7BNuc5J.js";import"./@turf-n0MF4LHv.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-D0iZPv2f.js";var P=(e=>(e.Point="point",e.Polyline="polyline",e.Polygon="polygon",e))(P||{}),K=(e=>(e[e.Plan=0]="Plan",e[e.Block=1]="Block",e[e.Platform=2]="Platform",e[e.Well=3]="Well",e[e.Pipeline=4]="Pipeline",e[e.Device=5]="Device",e))(K||{});const fe=e=>{const t=W(),r=W(),o=B(!1),n={lookAt:[108.341768,22.804393,1e7],max:1e7,min:100,flyHeight:1e3,pitch:-.5,...e};let d,i=null;const m=async()=>{t.value=new Cesium.Viewer("cesium",{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),t.value.scene.screenSpaceCameraController.minimumZoomDistance=n.min,t.value.scene.screenSpaceCameraController.maximumZoomDistance=n.max,t.value.cesiumWidget.creditContainer.style.display="none",t.value.resolutionScale=window.devicePixelRatio,t.value.scene.postProcessStages.fxaa.enabled=!0,t.value.camera.setView({destination:Cesium.Cartesian3.fromDegrees(n.lookAt[0],n.lookAt[1],n.lookAt[2]),orientation:{heading:0,pitch:-Cesium.Math.PI/180*80,roll:0}}),t.value.screenSpaceEventHandler.setInputAction(()=>{g("zoomIn")},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},g=(f,C=1e4)=>{var s,l;f==="zoomIn"?(s=t.value)==null||s.camera.zoomIn(C):(l=t.value)==null||l.camera.zoomOut(C)};return{viewer:t,zoomFn:g,adjustNorthUp:()=>{var f,C,s,l,a,c;if(i)(f=t.value)==null||f.camera.flyToBoundingSphere(i,{offset:new Cesium.HeadingPitchRange(0,-Cesium.Math.PI/2,0)});else{const b=-Cesium.Math.PI/2,y=Cesium.Math.PI*2;if(((C=t.value)==null?void 0:C.scene.camera.heading)===y&&((s=t.value)==null?void 0:s.scene.camera.pitch)===b&&((l=t.value)==null?void 0:l.scene.camera.roll)===0)return;const x=t.value.camera.pickEllipsoid(new Cesium.Cartesian2(t.value.canvas.clientWidth/2,t.value.canvas.clientHeight/2))||((a=t.value)==null?void 0:a.camera.position),k=Cesium.Ellipsoid.WGS84.cartesianToCartographic(x),M=k.longitude*180/Math.PI,_=k.latitude*180/Math.PI;(c=t.value)==null||c.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(M,_,n.flyHeight),orientation:{heading:0,pitch:b,roll:0},duration:2})}},loadRoadNetwork:()=>{var f;o.value?((f=t.value)==null||f.imageryLayers.remove(r.value,!0),o.value=!1):(r.value=t.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),o.value=!0)},flyTo:(f,C,s=n.flyHeight)=>{var a;const l=z([f,C]);i=new Cesium.BoundingSphere(l,s),(a=t.value)==null||a.camera.flyToBoundingSphere(i,{offset:new Cesium.HeadingPitchRange(0,n.pitch,0),complete:()=>{var y;const c=(y=t.value)==null?void 0:y.camera.positionCartographic,b=c==null?void 0:c.height;b&&(n.flyHeight=b)}})},destroyed:()=>{var f,C;(f=t.value)==null||f.entities.removeAll(),(C=t.value)==null||C.destroy(),t.value=void 0},init:m,orbitTickFunction:(f,C)=>{var s,l,a,c;(s=t.value)==null||s.camera.lookAtTransform(d),(l=t.value)==null||l.camera.rotateLeft(f),(a=t.value)==null||a.camera.rotateUp(C),(c=t.value)==null||c.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)},getFrame:()=>{let f=new Cesium.Cartesian3;const C=t.value.camera,s=t.value.scene,l=new Cesium.Ray;l.origin=C.positionWC,l.direction=C.directionWC,f=s.globe.pick(l,s,f)||t.value.camera.position,f=C.worldToCameraCoordinatesPoint(f,f);const a=new Cesium.Matrix4;d=Cesium.Transforms.eastNorthUpToFixedFrame(f,s.globe.ellipsoid,a)}}},ve=(e,t)=>{const r=B([]),o=B(0),n=W(),d=.5;let i=[];const m=new Cesium.Entity({name:"polygon",isStatic:!1,polyline:{positions:new Cesium.CallbackProperty(function(){let s=[];return i.length>=3?s=[...i,i[0]]:s=[...i],s},!1),width:4,clampToGround:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED.withAlpha(1),dashLength:20})}});let g=[];const D=new Cesium.Entity({name:"polyline",isStatic:!1,polyline:{positions:new Cesium.CallbackProperty(function(){return g},!1),width:20,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.WHITE)}}),R=s=>{if(e.value){if(s===P.Polyline&&e.value.entities.add(D),s===P.Polygon){const l=e.value.entities.add(m);t&&t.value===K.Platform&&(l.polyline.material=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.BLUE.withAlpha(1),dashLength:20}))}e.value.screenSpaceEventHandler.setInputAction(l=>{var c,b,y,x;const a=(c=e.value)==null?void 0:c.scene.pick(l.position);if(!a||a.id.isStatic){const k=(y=e.value)==null?void 0:y.camera.pickEllipsoid(l.position,(b=e.value)==null?void 0:b.scene.globe.ellipsoid),M=Cesium.Cartographic.fromCartesian(k),_=Number(Cesium.Math.toDegrees(M.longitude).toFixed(6)),p=Number(Cesium.Math.toDegrees(M.latitude).toFixed(6));s===P.Point?(o.value=0,r.value=[{degrees:[_,p],index:o.value}],C(),I([_,p],o.value,16),(x=e.value)==null||x.scene.requestRender()):(r.value.push({degrees:[_,p],index:o.value}),I([_,p],o.value)),s===P.Polyline&&g.push(k.clone()),s===P.Polygon&&i.push(k.clone()),o.value+=1}},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.value.screenSpaceEventHandler.setInputAction(l=>{var c;const a=(c=e.value)==null?void 0:c.scene.pick(l.position);a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0?(n.value=a.id,e.value.scene.screenSpaceCameraController.enableRotate=!1,e.value.scene.screenSpaceCameraController.enableTranslate=!1,e.value.scene.screenSpaceCameraController.enableZoom=!1):n.value=void 0},Cesium.ScreenSpaceEventType.LEFT_DOWN),e.value.screenSpaceEventHandler.setInputAction(()=>{var l;n.value=void 0,e.value.scene.screenSpaceCameraController.enableRotate=!0,e.value.scene.screenSpaceCameraController.enableTranslate=!0,e.value.scene.screenSpaceCameraController.enableZoom=!0,(l=e.value)==null||l.scene.requestRender()},Cesium.ScreenSpaceEventType.LEFT_UP),e.value.screenSpaceEventHandler.setInputAction(l=>{var c,b;const a=(c=e.value)==null?void 0:c.scene.pick(l.endPosition);if(a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0)e.value._container.style.cursor="pointer",a.id.data&&ge(l.endPosition.x,l.endPosition.y,a.id.data);else{e.value._container.style.cursor="default";const y=document.getElementById("cesium-tips");y&&(y.style.display="none")}if(n.value){const y=Number(n.value.id),x=w(l.endPosition),k=Ce(x);r.value[y].degrees=k;const M=e.value.entities.getById(String(y));M.position=z(k,10),M.label.text=`点${y+1}--[${k[0]},${k[1]}]`,s===P.Polyline&&(g[y]=x),s===P.Polygon&&(i[y]=x),(b=e.value)==null||b.scene.requestRender()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},I=(s,l,a=6,c)=>{var b;(b=e.value)==null||b.entities.add({id:String(l),name:"point",data:c,position:Cesium.Cartesian3.fromDegrees(s[0],s[1],10),isStatic:!1,point:{pixelSize:a,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:`点${l+1}--[${s[0]},${s[1]}]`,font:"12px sans-serif",pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:Cesium.Color.RED,backgroundColor:Cesium.Color.WHITE.withAlpha(d),showBackground:!0}})},w=s=>e.value.camera.pickEllipsoid(s,e.value.scene.globe.ellipsoid),$=(s,l)=>{L(),s.forEach((a,c)=>{l===P.Point&&I(a.degrees,c,16,a.data),l===P.Polyline&&(I(a.degrees,c,6,a.data),g.push(z(a.degrees,10))),l===P.Polygon&&(I(a.degrees,c,6,a.data),i.push(z(a.degrees,10)))}),r.value=s,o.value=s.length},L=()=>{r.value=[],o.value=0,g=[],i=[]},f=()=>{var l;const s=(l=e.value)==null?void 0:l.entities.values.filter(a=>a.isStatic);s==null||s.forEach(a=>{var c;(c=e.value)==null||c.entities.remove(a)})},C=()=>{var l;const s=(l=e.value)==null?void 0:l.entities.values.filter(a=>!a.isStatic);s==null||s.forEach(a=>{var c;(c=e.value)==null||c.entities.remove(a)})};return{data:r,initEvent:R,reDraw:$,removeStaticEntites:f,removeNonStaticEntites:C,reset:L}},ge=(e,t,r)=>{if(r.data&&r.data.content){const o=document.getElementById("cesium-tips");if(o)o.style.display="block",o.style.left=e+20+"px",o.style.top=t+"px",o.innerHTML=`<div>${r.data.content}</div>`;else{const n=document.createElement("div");n.id="cesium-tips",n.style.position="absolute",n.style.backgroundColor="rgba(0,0,0,0.8)",n.style.color="white",n.style.zIndex="999",n.style.maxWidth="250px",n.style.fontSize="14px",n.style.lineHeight="20px",n.style.padding="8px",n.style.borderRadius="5px",document.getElementById("cesium-container").appendChild(n),n.style.left=e+20+"px",n.style.top=t+"px"}}},Ce=e=>{const t=Cesium.Cartographic.fromCartesian(e),r=Number(Cesium.Math.toDegrees(t.longitude).toFixed(6)),o=Number(Cesium.Math.toDegrees(t.latitude).toFixed(6));return[r,o]},z=(e,t)=>Cesium.Cartesian3.fromDegrees(e[0],e[1],t),ye=e=>{let t=Cesium.Cartesian3.ZERO;const r=e.length;e.forEach(i=>{t=Cesium.Cartesian3.add(t,i,new Cesium.Cartesian3)}),t=Cesium.Cartesian3.divideByScalar(t,r,new Cesium.Cartesian3);const o=Cesium.Cartographic.fromCartesian(t),n=Number(Cesium.Math.toDegrees(o.longitude).toFixed(6)),d=Number(Cesium.Math.toDegrees(o.latitude).toFixed(6));return[n,d]},_e=e=>{let t=0,r,o;for(let n=0;n<e.length;n++)for(let d=n+1;d<e.length;d++){const i=Cesium.Cartesian3.distance(e[n],e[d]);i>t&&(t=i,r=e[n],o=e[d])}return{maxDistance:t,farthestPoint1:r,farthestPoint2:o}},he={class:"inner"},be=F({__name:"cameraControl",emits:["moveCamera","mouse-down","mouse-up"],setup(e,{emit:t}){const r=t;let o=null;const n=i=>{r("mouse-down"),o=setInterval(()=>{r("moveCamera",i)},10)},d=()=>{clearInterval(o),r("mouse-up")};return(i,m)=>{const g=G;return A(),Z("div",he,[h("div",{class:"outer",onMousedown:m[0]||(m[0]=D=>n("top")),onMouseup:d},[u(g,null,{default:S(()=>[u(E(se))]),_:1})],32),h("div",{class:"outer",onMousedown:m[1]||(m[1]=D=>n("right")),onMouseup:d},[u(g,null,{default:S(()=>[u(E(le))]),_:1})],32),h("div",{class:"outer",onMousedown:m[2]||(m[2]=D=>n("bottom")),onMouseup:d},[u(g,null,{default:S(()=>[u(E(ie))]),_:1})],32),h("div",{class:"outer",onMousedown:m[3]||(m[3]=D=>n("left")),onMouseup:d},[u(g,null,{default:S(()=>[u(E(re))]),_:1})],32),m[4]||(m[4]=h("div",{class:"inner-circle"},null,-1))])}}}),Pe=H(be,[["__scopeId","data-v-20f4bba5"]]),Ee={class:"btn-group-zoom"},Se={name:"GisZoom"},ke=F({...Se,emits:["zoom"],setup(e,{emit:t}){const r=t,o=n=>{r("zoom",n)};return(n,d)=>{const i=O;return A(),Z("div",Ee,[u(i,{type:"primary",size:"small",icon:E(ce),onClick:d[0]||(d[0]=m=>o("zoomIn"))},null,8,["icon"]),u(i,{type:"primary",size:"small",icon:E(ue),onClick:d[1]||(d[1]=m=>o("zoomOut"))},null,8,["icon"])])}}}),xe=H(ke,[["__scopeId","data-v-32e30e9e"]]),De={id:"cesium-container"},Ie={class:"shortcut-keys"},Me={class:"btn-group"},Te={class:"btn-content"},we={class:"btn-content"},Re={class:"btn-content"},Le={name:"Cesium"},Ne=F({...Le,emits:["save"],setup(e,{expose:t,emit:r}){const o=q({checked:["1","2","3","4","5","直井","水平井","定向井"],visible:!1,drawType:P.Point,isFull:!1,filterType:void 0,filterName:"",filterId:""}),n=B();let{viewer:d,zoomFn:i,loadRoadNetwork:m,destroyed:g,init:D,adjustNorthUp:R,flyTo:I,orbitTickFunction:w,getFrame:$}=fe();const{data:L,initEvent:f,reDraw:C,reset:s}=ve(d,n),l=r,a=()=>{var _=document.fullscreenElement;if(_)document.exitFullscreen(),o.isFull=!1;else{const p=document.getElementById("cesium-container");p.requestFullscreen&&(p.requestFullscreen(),o.isFull=!0)}},c=()=>{$()},b=_=>{var v;const p=((v=d.value)==null?void 0:v.camera.pitch)||Number((-Cesium.Math.PI/2).toFixed(15));switch(_){case"top":p<=Cesium.Math.toRadians(-10)&&w(0,.01);break;case"bottom":p>Cesium.Math.toRadians(-90)&&w(0,-.01);break;case"left":w(.01,0);break;case"right":w(-.01,0);break}},y=()=>{l("save",L.value),x()},x=()=>{s(),g(),L.value=[],o.visible=!1},k=_=>{if(!_.length)return;const p=_.map((T,Q)=>({degrees:[T.lon,T.lat],index:Q,data:T.flag}));C(p,o.drawType);const v=_.map(T=>z([T.lon,T.lat])),[N,U]=ye(v),{maxDistance:V}=_e(v);I(N,U,V)};return t({open:(_,p,v)=>{o.drawType=_,n.value=v==null?void 0:v.editType,o.filterType=v==null?void 0:v.filterType,o.filterId=v==null?void 0:v.filterId,o.filterName=v==null?void 0:v.filterName,o.visible=!0,ne(()=>{D(),f(o.drawType),p&&d.value&&k(p)})}}),(_,p)=>{const v=G,N=O,U=te("LengendDialog"),V=Y;return A(),ae(V,{title:"地图标点",modelValue:o.visible,"onUpdate:modelValue":p[0]||(p[0]=T=>o.visible=T),center:"",fullscreen:!0,onClose:x,class:"gis-dialog","destroy-on-close":"","append-to-body":!0},{default:S(()=>[h("div",De,[p[4]||(p[4]=h("div",{id:"cesium"},null,-1)),h("div",Ie,[h("div",Me,[u(N,{title:"路网地名",onClick:E(m)},{default:S(()=>[h("div",Te,[u(v,null,{default:S(()=>[u(E(de))]),_:1}),p[1]||(p[1]=h("span",null,"路网地名",-1))])]),_:1},8,["onClick"]),u(N,{title:"正向俯视",onClick:E(R)},{default:S(()=>[h("div",we,[u(v,null,{default:S(()=>[u(E(me))]),_:1}),p[2]||(p[2]=h("span",null,"正向俯视",-1))])]),_:1},8,["onClick"]),u(N,{title:"全屏控制",onClick:a},{default:S(()=>[h("div",Re,[u(v,null,{default:S(()=>[u(E(pe))]),_:1}),h("span",null,j(o.isFull?"退出全屏":"全屏"),1)])]),_:1}),u(xe,{onZoom:E(i),class:"zoom-control"},null,8,["onZoom"])])]),u(N,{type:"primary",class:"save",onClick:y},{default:S(()=>[...p[3]||(p[3]=[J("保存",-1)])]),_:1})]),u(Pe,{class:"camera-control",onMoveCamera:b,onMouseDown:c}),u(U,{ref:"lengendDialogRef"},null,512)]),_:1},8,["modelValue"])}}}),ze=H(Ne,[["__scopeId","data-v-4344db19"]]),Be={class:"gis-getdata"},$e={class:"code"},Fe={class:"handle"},Ae={name:"getData"},He=F({...Ae,setup(e){const t=q({drawType:P.Point,formData:{pointData:[]},code:""});oe(()=>t.formData.pointData,(i,m)=>{const g=JSON.stringify(i);t.code=g},{deep:!0,immediate:!0});const r=B(),o=()=>{var i;(i=r.value)==null||i.open(t.drawType,t.formData.pointData)},n=i=>{i&&(t.formData.pointData=i.map(m=>({lon:m.degrees[0],lat:m.degrees[1]})))},d=()=>{t.formData.pointData=[]};return(i,m)=>{const g=ee,D=X,R=O;return A(),Z("div",Be,[h("div",$e,j(t.code),1),h("div",Fe,[u(D,{modelValue:t.drawType,"onUpdate:modelValue":m[0]||(m[0]=I=>t.drawType=I),onChange:d},{default:S(()=>[u(g,{label:"画点",value:E(P).Point},null,8,["value"]),u(g,{label:"画线",value:E(P).Polyline},null,8,["value"]),u(g,{label:"画面",value:E(P).Polygon},null,8,["value"])]),_:1},8,["modelValue"]),u(R,{type:"primary",onClick:o},{default:S(()=>[...m[1]||(m[1]=[J("标点",-1)])]),_:1})]),u(ze,{ref_key:"gisSignRef",ref:r,onSave:n},null,512)])}}}),tt=H(He,[["__scopeId","data-v-3971aae3"]]);export{tt as default};
