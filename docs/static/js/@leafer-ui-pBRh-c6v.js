import{d as y,a as k,s as gt,o as We,v as ze,b as He,m as Ne,e as Ue,p as it,c as p,f as ye,r as Ht,g as ve,n as je,h as Ve,i as D,j as Y,k as B,l as Ke,q as S,L as Nt,t as O,u as me,w as we,M as xe,x as rt,P as Mt,y as $e,z as Ge,A as Et,U as Xe,B as v,C as _t,D as bt,I as Rt,E as A,F as P,G as De,W as ot,H as R,J as H,K as Ut,R as Ee,N as Ye,O as Jt,Q as xt,S as tt,T as Ze,V as Re,X as jt,Y as Pe,Z as Je,_ as qe,$ as ft,a0 as M,a1 as lt,a2 as Ct,a3 as E,a4 as Qe,a5 as ti,a6 as It,a7 as ei,a8 as Ft,a9 as ii,aa as G,ab as $,ac as si,ad as ri,ae as Te,af as oi}from"./@leafer-dMhI7V6q.js";function n(i,t,e,s){var r=arguments.length,o=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,s);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o}function yt(i){return me(i,t=>Pe({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function vt(i){return me(i,t=>Pe({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function ni(){return(i,t)=>{const e="_"+t;we(i,t,{set(s){this.isLeafer&&(this[e]=s)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[e]||this:this.leafer&&this.leafer.zoomLayer}})}}const ai={},Ds={},qt={number(i,t){return typeof i=="object"?i.type==="percent"?i.value*t:i.value:i}},be={},f={},Qt={},Es={},te={},ee={},ie={setStyleName(i,t,e){return Et("state")},set(i,t){return Et("state")}},{parse:hi,objectToCanvasData:_i}=Mt,se={},re=ft.get("UIData");class F extends Je{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const s=this.__leaf;let{scaleX:r}=s.__nowWorld||s.__world;return r<0&&(r=-r),r>1?t/r:t}else return t}get __hasStroke(){return this.stroke&&this.strokeWidth}get __hasMultiPaint(){const t=this;return t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect?!0:t.fill&&this.__hasStroke}get __clipAfterFill(){return this.cornerRadius||this.__pathInputed}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,re.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,re.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),typeof t=="string"||!t?(this.__isFills&&(this.__removeInput("fill"),Qt.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t):typeof t=="object"&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=se))}setStroke(t){typeof t=="string"||!t?(this.__isStrokes&&(this.__removeInput("stroke"),Qt.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t):typeof t=="object"&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=se))}setPath(t){const e=typeof t=="string";e||t&&typeof t[0]=="object"?(this.__setInput("path",t),this._path=e?hi(t):_i(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some(e=>e.visible===!1)&&(t=t.filter(e=>e.visible!==!1)),this._shadow=t.length?t:null):this._shadow=t&&t.visible!==!1?[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some(e=>e.visible===!1)&&(t=t.filter(e=>e.visible!==!1)),this._innerShadow=t.length?t:null):this._innerShadow=t&&t.visible!==!1?[t]:null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&f.compute("fill",this.__leaf),e&&f.compute("stroke",this.__leaf),this.__needComputePaint=!1}}class St extends F{}class Ce extends St{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.overflow==="hide"&&this.__clipAfterFill&&this.__leaf.children.length}get __clipAfterFill(){return this.__leaf.isOverflow||super.__clipAfterFill}}class li extends St{__getInputData(t,e){const s=super.__getInputData(t,e);return H.forEach(r=>delete s[r]),s}}class di extends Ce{}class ui extends F{}class Vt extends F{get __boxStroke(){return!this.__pathInputed}}class ci extends F{get __boxStroke(){return!this.__pathInputed}}class pi extends F{}class gi extends F{}class fi extends F{get __pathInputed(){return 2}}class yi extends St{}const vi={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class mi extends F{get __useNaturalRatio(){return!1}setFontWeight(t){typeof t=="string"?(this.__setInput("fontWeight",t),this._fontWeight=vi[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}}class wi extends Vt{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(t,e){const s=super.__getInputData(t,e);return delete s.fill,s}}class xi extends Vt{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const s=super.__getInputData(t,e);return s.url=this.__leaf.canvas.toDataURL("image/png"),s}}const Di={__updateStrokeSpread(){let i=0,t=0;const e=this.__,{strokeAlign:s,strokeWidth:r}=e;if((e.stroke||e.hitStroke==="all")&&r&&s!=="inside"&&(t=i=s==="center"?r/2:r,!e.__boxStroke)){const o=e.__isLinePath?0:10*i,a=e.strokeCap==="none"?0:r;i+=Math.max(o,a)}return e.__useArrow&&(i+=r*5),this.__layout.strokeBoxSpread=t,i},__updateRenderSpread(){let i=0;const{shadow:t,innerShadow:e,blur:s,backgroundBlur:r}=this.__;t&&t.forEach(a=>i=Math.max(i,Math.max(Math.abs(a.y),Math.abs(a.x))+(a.spread>0?a.spread:0)+a.blur*1.5)),s&&(i=Math.max(i,s));let o=i=Math.ceil(i);return e&&e.forEach(a=>o=Math.max(o,Math.max(Math.abs(a.y),Math.abs(a.x))+(a.spread<0?-a.spread:0)+a.blur*1.5)),r&&(o=Math.max(o,r)),this.__layout.renderShapeSpread=o,i+(this.__layout.strokeSpread||0)}},Ei={__updateChange(){const i=this.__;if(i.__useEffect){const{shadow:e,innerShadow:s,blur:r,backgroundBlur:o}=this.__;i.__useEffect=!!(e||s||r||o)}i.__checkSingle(),i.__isFills||i.__isStrokes||i.cornerRadius||i.__useEffect?i.__complex=!0:i.__complex&&(i.__complex=!1)},__drawFast(i,t){oe(this,i,t)},__draw(i,t){const e=this.__;if(e.__complex){e.__needComputePaint&&e.__computePaint();const{fill:s,stroke:r,__drawAfterFill:o}=e;if(this.__drawRenderPath(i),e.__useEffect){const a=f.shape(this,i,t);this.__nowWorld=this.__getNowWorld(t);const{shadow:l,innerShadow:h}=e;l&&te.shadow(this,i,a),s&&(e.__isFills?f.fills(s,this,i):f.fill(s,this,i)),o&&this.__drawAfterFill(i,t),h&&te.innerShadow(this,i,a),r&&(e.__isStrokes?f.strokes(r,this,i):f.stroke(r,this,i)),a.worldCanvas&&a.worldCanvas.recycle(),a.canvas.recycle()}else s&&(e.__isFills?f.fills(s,this,i):f.fill(s,this,i)),o&&this.__drawAfterFill(i,t),r&&(e.__isStrokes?f.strokes(r,this,i):f.stroke(r,this,i))}else e.__pathInputed?oe(this,i,t):this.__drawFast(i,t)},__renderShape(i,t,e,s){if(this.__worldOpacity){i.setWorld(this.__nowWorld=this.__getNowWorld(t));const{fill:r,stroke:o}=this.__;this.__drawRenderPath(i),r&&!e&&(this.__.__pixelFill?f.fills(r,this,i):f.fill("#000000",this,i)),this.__.__isCanvas&&this.__drawAfterFill(i,t),o&&!s&&(this.__.__pixelStroke?f.strokes(o,this,i):f.stroke("#000000",this,i))}},__drawAfterFill(i,t){this.__.__clipAfterFill?(i.save(),this.windingRule?i.clip(this.windingRule):i.clip(),this.__drawContent(i,t),i.restore()):this.__drawContent(i,t)}};function oe(i,t,e){const{fill:s,stroke:r,__drawAfterFill:o}=i.__;i.__drawRenderPath(t),s&&f.fill(s,i,t),o&&i.__drawAfterFill(t,e),r&&f.stroke(r,i,t)}const Ri={__drawFast(i,t){let{width:e,height:s,fill:r,stroke:o,__drawAfterFill:a}=this.__;if(r&&(i.fillStyle=r,i.fillRect(0,0,e,s)),a&&this.__drawAfterFill(i,t),o){const{strokeAlign:l,__strokeWidth:h}=this.__;if(!h)return;i.setStroke(o,h,this.__);const u=h/2;switch(l){case"center":i.strokeRect(0,0,e,s);break;case"inside":e-=h,s-=h,e<0||s<0?(i.save(),this.__clip(i,t),i.strokeRect(u,u,e,s),i.restore()):i.strokeRect(u,u,e,s);break;case"outside":i.strokeRect(-u,-u,e+h,s+h);break}}}};var Wt;let _=Wt=class extends Nt{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){xe.assignScale(this,t)}get scale(){return this.__.scale}get pen(){const{path:t}=this.__;return rt.set(this.path=t||[]),t||this.__drawPathByBox(rt),rt}get editConfig(){}get editOuter(){return""}get editInner(){return""}constructor(t){super(t)}reset(t){}set(t,e){e?(this.lockNormalStyle=!0,Object.assign(this,t),this.lockNormalStyle=!1):Object.assign(this,t)}get(t){return typeof t=="string"?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let s=e?this.__.__pathForRender:this.__.path;return s||(rt.set(s=[]),this.__drawPathByBox(rt)),t?Mt.toCanvasData(s,!0):s}getPathString(t,e,s){return Mt.stringify(this.getPath(t,e),s)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;t.lazy&&!this.__inLazyBounds&&!ee.running?t.__needComputePaint=!0:t.__computePaint()}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?$e.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&be.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?Ge.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:s,width:r,height:o}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:a}=this.__;t.roundRect(e,s,r,o,typeof a=="number"?[a]:a)}else t.rect(e,s,r,o)}animate(t,e,s,r){return Et("animate")}killAnimate(t){}export(t,e){return ee.export(this,t,e)}clone(t){const e=this.toJSON();return t&&Object.assign(e,t),Wt.one(e)}static one(t,e,s,r,o){return Xe.get(t.tag||this.prototype.__tag,t,e,s,r,o)}static registerUI(){v()(this)}static registerData(t){y(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};n([y(F)],_.prototype,"__",void 0);n([ni()],_.prototype,"zoomLayer",void 0);n([k("")],_.prototype,"id",void 0);n([k("")],_.prototype,"name",void 0);n([k("")],_.prototype,"className",void 0);n([gt("pass-through")],_.prototype,"blendMode",void 0);n([We(1)],_.prototype,"opacity",void 0);n([ze(!0)],_.prototype,"visible",void 0);n([gt(!1)],_.prototype,"locked",void 0);n([He(0)],_.prototype,"zIndex",void 0);n([Ne(!1)],_.prototype,"mask",void 0);n([Ue(!1)],_.prototype,"eraser",void 0);n([it(0,!0)],_.prototype,"x",void 0);n([it(0,!0)],_.prototype,"y",void 0);n([p(100,!0)],_.prototype,"width",void 0);n([p(100,!0)],_.prototype,"height",void 0);n([ye(1,!0)],_.prototype,"scaleX",void 0);n([ye(1,!0)],_.prototype,"scaleY",void 0);n([Ht(0,!0)],_.prototype,"rotation",void 0);n([Ht(0,!0)],_.prototype,"skewX",void 0);n([Ht(0,!0)],_.prototype,"skewY",void 0);n([it(0,!0)],_.prototype,"offsetX",void 0);n([it(0,!0)],_.prototype,"offsetY",void 0);n([it(0,!0)],_.prototype,"scrollX",void 0);n([it(0,!0)],_.prototype,"scrollY",void 0);n([ve()],_.prototype,"origin",void 0);n([ve()],_.prototype,"around",void 0);n([k(!1)],_.prototype,"lazy",void 0);n([je(1)],_.prototype,"pixelRatio",void 0);n([Ve()],_.prototype,"path",void 0);n([D()],_.prototype,"windingRule",void 0);n([D(!0)],_.prototype,"closed",void 0);n([p(0)],_.prototype,"padding",void 0);n([p(!1)],_.prototype,"lockRatio",void 0);n([p()],_.prototype,"widthRange",void 0);n([p()],_.prototype,"heightRange",void 0);n([k(!1)],_.prototype,"draggable",void 0);n([k()],_.prototype,"dragBounds",void 0);n([k(!1)],_.prototype,"editable",void 0);n([Y(!0)],_.prototype,"hittable",void 0);n([Y("path")],_.prototype,"hitFill",void 0);n([B("path")],_.prototype,"hitStroke",void 0);n([Y(!1)],_.prototype,"hitBox",void 0);n([Y(!0)],_.prototype,"hitChildren",void 0);n([Y(!0)],_.prototype,"hitSelf",void 0);n([Y()],_.prototype,"hitRadius",void 0);n([Ke("")],_.prototype,"cursor",void 0);n([gt()],_.prototype,"fill",void 0);n([B()],_.prototype,"stroke",void 0);n([B("inside")],_.prototype,"strokeAlign",void 0);n([B(1)],_.prototype,"strokeWidth",void 0);n([B(!1)],_.prototype,"strokeWidthFixed",void 0);n([B("none")],_.prototype,"strokeCap",void 0);n([B("miter")],_.prototype,"strokeJoin",void 0);n([B()],_.prototype,"dashPattern",void 0);n([B()],_.prototype,"dashOffset",void 0);n([B(10)],_.prototype,"miterLimit",void 0);n([D(0)],_.prototype,"cornerRadius",void 0);n([D()],_.prototype,"cornerSmoothing",void 0);n([yt()],_.prototype,"shadow",void 0);n([yt()],_.prototype,"innerShadow",void 0);n([yt()],_.prototype,"blur",void 0);n([yt()],_.prototype,"backgroundBlur",void 0);n([yt()],_.prototype,"grayscale",void 0);n([k({})],_.prototype,"data",void 0);n([S(Nt.prototype.reset)],_.prototype,"reset",null);_=Wt=n([_t(Di),_t(Ei),bt()],_);let U=class extends _{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t.children){const{children:s}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),s.forEach(r=>this.add(r)),t.children=s}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map(s=>s.toJSON(t)),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}};n([y(St)],U.prototype,"__",void 0);U=n([_t(qe),v()],U);var Dt;const ne=ft.get("Leafer");let j=Dt=class extends U{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Rt.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Dt.list.add(this)}init(t,e){if(this.canvas)return;this.__setLeafer(this),t&&A.assign(this.config,t);let s;const{config:r}=this;this.initType(r.type);const o=this.canvas=P.canvas(r);this.__controllers.push(this.renderer=P.renderer(this,o,r),this.watcher=P.watcher(this,r),this.layouter=P.layouter(this,r)),this.isApp&&this.__setApp(),this.__checkAutoLayout(r,e),this.view=o.view,e?(this.__bindApp(e),s=e.running):(this.selector=P.selector(this),this.interaction=P.interaction(this,o,this.selector,r),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=P.hitCanvasManager()),this.canvasManager=new De,s=r.start),this.hittable=r.hittable,this.fill=r.fill,this.canvasManager.add(o),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),ot.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit(()=>{super.set(t)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(R.RESTART):this.emitLeafer(R.START),this.__controllers.forEach(t=>t.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(t=>t.stop()),this.running=!1,this.emitLeafer(R.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=A.copyAttrs({},t,H);Object.keys(e).forEach(s=>this[s]=e[s])}forceRender(t){this.renderer.addBlock(t?new Ut(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const s=A.copyAttrs({},this.canvas,H);e.resize(t),this.updateLazyBounds(),this.__onResize(new Ee(t,s))}__onResize(t){this.emitEvent(t),A.copyAttrs(this.__,t,H),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||((!t.width||!t.height)&&(this.autoLayout=new Ye(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(H.includes(t)?(e||ne.warn(t+" is 0"),this.__changeCanvasSize(t,e)):t==="fill"?this.__changeFill(e):t==="hittable"?this.parent||(this.canvas.hittable=e):t==="zIndex"&&(this.canvas.zIndex=e,setTimeout(()=>this.parent&&this.parent.__updateSortChildren()))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&H.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const s=A.copyAttrs({},this.canvas,H);s[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(s)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(R.BEFORE_READY),this.emitLeafer(R.READY),this.emitLeafer(R.AFTER_READY),ot.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(R.VIEW_READY),ot.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){ot.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender(()=>{this.imageReady&&(t&&this.emitLeafer(R.VIEW_COMPLETED),ot.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,s){e&&(t=t.bind(e));const r=this.__nextRenderWait;if(s){for(let o=0;o<r.length;o++)if(r[o]===t){r.splice(o,1);break}}else r.push(t)}zoom(t,e,s){return Et("view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new R(t,this))}__listenEvents(){const t=Jt.start("FirstCreate "+this.innerName);this.once(R.START,()=>Jt.end(t)),this.once(xt.START,()=>this.updateLazyBounds()),this.once(xt.END,()=>this.__onReady()),this.once(tt.START,()=>this.__onCreated()),this.once(tt.END,()=>this.__onViewReady()),this.__eventIds.push(this.on_(Ze.DATA,this.__onWatchData,this),this.on_(tt.NEXT,this.__onNextRender,this),this.on_(xt.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){Dt.list.remove(this);try{this.stop(),this.emitEvent(new R(R.END,this)),this.__removeListenEvents(),this.__controllers.forEach(s=>!(this.parent&&s===this.interaction)&&s.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{Rt.clearRecycled()},100)}catch(s){ne.error(s)}}};t?e():setTimeout(e)}};j.list=new O;n([y(li)],j.prototype,"__",void 0);n([p()],j.prototype,"pixelRatio",void 0);j=Dt=n([v()],j);let X=class extends _{get __tag(){return"Rect"}constructor(t){super(t)}};n([y(Vt)],X.prototype,"__",void 0);X=n([_t(Ri),bt(),v()],X);const{copy:Pi,add:Ti,includes:bi}=M,Z=X.prototype,Ci=U.prototype,Ot={};let x=class extends U{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){const e=this.__;if(this.children.length)if(e.__autoSide){super.__updateBoxBounds();const{boxBounds:s}=this.__layout;e.__autoSize||(e.__autoWidth?(s.width+=s.x,s.x=0,s.height=e.height,s.y=0):(s.height+=s.y,s.y=0,s.width=e.width,s.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds();else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),Pi(Ot,e),this.__updateRectRenderBounds(),t=!bi(e,Ot),t&&this.__.overflow!=="hide"&&Ti(e,Ot)):this.__updateRectRenderBounds(),!this.isOverflow!=!t&&(this.isOverflow=t)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawContent(t,e){this.__renderGroup(t,e),this.__.__hasStroke&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};n([y(Ce)],x.prototype,"__",void 0);n([k(!1)],x.prototype,"resizeChildren",void 0);n([Re("show")],x.prototype,"overflow",void 0);n([S(Z.__updateStrokeSpread)],x.prototype,"__updateStrokeSpread",null);n([S(Z.__updateRenderSpread)],x.prototype,"__updateRectRenderSpread",null);n([S(Z.__updateBoxBounds)],x.prototype,"__updateRectBoxBounds",null);n([S(Z.__updateStrokeBounds)],x.prototype,"__updateStrokeBounds",null);n([S(Z.__updateRenderBounds)],x.prototype,"__updateRectRenderBounds",null);n([S(Z.__updateChange)],x.prototype,"__updateRectChange",null);n([S(Z.__render)],x.prototype,"__renderRect",null);n([S(Ci.__render)],x.prototype,"__renderGroup",null);x=n([bt(),v()],x);let dt=class extends x{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}};n([y(di)],dt.prototype,"__",void 0);n([gt("#FFFFFF")],dt.prototype,"fill",void 0);n([Re("hide")],dt.prototype,"overflow",void 0);dt=n([v()],dt);const{moveTo:ae,closePath:he,ellipse:Q}=Ct;let et=class extends _{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,innerRadius:s,startAngle:r,endAngle:o}=this.__,a=t/2,l=e/2,h=this.__.path=[];s?(r||o?(s<1&&Q(h,a,l,a*s,l*s,0,r,o,!1),Q(h,a,l,a,l,0,o,r,!0),s<1&&he(h)):(s<1&&(Q(h,a,l,a*s,l*s),ae(h,t,l)),Q(h,a,l,a,l,0,360,0,!0)),lt.ellipseToCurve&&(this.__.path=this.getPath(!0))):r||o?(ae(h,a,l),Q(h,a,l,a,l,0,r,o,!1),he(h)):Q(h,a,l,a,l)}};n([y(ci)],et.prototype,"__",void 0);n([D(0)],et.prototype,"innerRadius",void 0);n([D(0)],et.prototype,"startAngle",void 0);n([D(0)],et.prototype,"endAngle",void 0);et=n([v()],et);const{moveTo:Si,lineTo:Li,drawPoints:_e}=Ct,{rotate:Oi,getAngle:ki,getDistance:Bi,defaultPoint:le}=E,{toBounds:Ai}=Qe;let I=class extends _{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,s=ti();return t&&(s.x=t),e&&Oi(s,e),s}set toPoint(t){this.width=Bi(le,t),this.rotation=ki(le,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?_e(e,t.points,!1,t.closed):(Si(e,0,0),Li(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(_e(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&be.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?Ai(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}};n([y(ui)],I.prototype,"__",void 0);n([jt("center")],I.prototype,"strokeAlign",void 0);n([p(0)],I.prototype,"height",void 0);n([D()],I.prototype,"points",void 0);n([D(0)],I.prototype,"curve",void 0);n([D(!1)],I.prototype,"closed",void 0);I=n([v()],I);const{sin:Mi,cos:Ii,PI:de}=Math,{moveTo:Fi,lineTo:Wi,closePath:zi,drawPoints:Hi}=Ct,Se=I.prototype;let V=class extends _{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)Hi(t,this.__.points,!1,!0);else{const{width:e,height:s,sides:r}=this.__,o=e/2,a=s/2;Fi(t,o,0);for(let l=1;l<r;l++)Wi(t,o+o*Mi(l*2*de/r),a-a*Ii(l*2*de/r))}zi(t)}__updateRenderPath(){}__updateBoxBounds(){}};n([y(pi)],V.prototype,"__",void 0);n([D(3)],V.prototype,"sides",void 0);n([D()],V.prototype,"points",void 0);n([D(0)],V.prototype,"curve",void 0);n([S(Se.__updateRenderPath)],V.prototype,"__updateRenderPath",null);n([S(Se.__updateBoxBounds)],V.prototype,"__updateBoxBounds",null);V=n([bt(),v()],V);const{sin:Ni,cos:Ui,PI:ue}=Math,{moveTo:ji,lineTo:Vi,closePath:Ki}=Ct;let ut=class extends _{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:s,innerRadius:r}=this.__,o=t/2,a=e/2,l=this.__.path=[];ji(l,o,0);for(let h=1;h<s*2;h++)Vi(l,o+(h%2===0?o:o*r)*Ni(h*ue/s),a-(h%2===0?a:a*r)*Ui(h*ue/s));Ki(l)}};n([y(gi)],ut.prototype,"__",void 0);n([D(5)],ut.prototype,"corners",void 0);n([D(.382)],ut.prototype,"innerRadius",void 0);ut=n([v()],ut);let Pt=class extends X{get __tag(){return"Image"}get ready(){return this.image?this.image.ready:!1}constructor(t){super(t),this.on(It.LOADED,e=>{e.attrName==="fill"&&e.attrValue.url===this.url&&(this.image=e.image)})}destroy(){this.image=null,super.destroy()}};n([y(wi)],Pt.prototype,"__",void 0);n([p("")],Pt.prototype,"url",void 0);Pt=n([v()],Pt);let K=class extends X{get __tag(){return"Canvas"}get ready(){return!this.url}constructor(t){super(t),this.canvas=P.canvas(this.__),this.context=this.canvas.context,t&&t.url&&this.drawImage(t.url)}drawImage(t){new ei({url:t}).load(e=>{this.context.drawImage(e.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new It(It.LOADED,{image:e}))})}draw(t,e,s,r){const o=new Ft(t.worldTransform).invert(),a=new Ft;e&&a.translate(e.x,e.y),s&&(typeof s=="number"?a.scale(s):a.scale(s.x,s.y)),r&&a.rotate(r),o.multiplyParent(a),t.__render(this.canvas,{matrix:o.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:s,height:r}=this.__,{view:o}=this.canvas;t.drawImage(o,0,0,o.width,o.height,0,0,s,r)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}};n([y(xi)],K.prototype,"__",void 0);n([vt(100)],K.prototype,"width",void 0);n([vt(100)],K.prototype,"height",void 0);n([vt(1)],K.prototype,"pixelRatio",void 0);n([vt(!0)],K.prototype,"smooth",void 0);n([vt()],K.prototype,"contextSettings",void 0);K=n([v()],K);const{copyAndSpread:$i,includes:Gi,isSame:Xi,spread:Yi,setList:Zi}=M;let g=class extends _{get __tag(){return"Text"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,fontSize:s,__baseLine:r,__textDrawData:o}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):o.rows.forEach(a=>t.rect(a.x,a.y-r,a.width,e<s?s:e))}__drawPathByData(t,e){const{x:s,y:r,width:o,height:a}=this.__layout.boxBounds;t.rect(s,r,o,a)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:s,fontFamily:r,fontSize:o,fontWeight:a,italic:l,textCase:h,textOverflow:u,padding:m}=t;t.__lineHeight=qt.number(e,o),t.__letterSpacing=qt.number(s,o),t.__padding=m?xe.fourNumber(m):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-o*.7)/2,t.__font=`${l?"italic ":""}${h==="small-caps"?"small-caps ":""}${a!=="normal"?a+" ":""}${o}px ${r}`,t.__clipText=u!=="show"&&!t.__autoSize,t.__textDrawData=ai.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:s,italic:r,padding:o,__autoWidth:a,__autoHeight:l}=t;this.__updateTextDrawData();const{bounds:h}=t.__textDrawData,u=e.boxBounds;if(t.__lineHeight<s&&Yi(h,s/2),a||l){if(u.x=a?h.x:0,u.y=l?h.y:0,u.width=a?h.width:t.width,u.height=l?h.height:t.height,o){const[J,z,q,st]=t.__padding;a&&(u.x-=st,u.width+=z+st),l&&(u.y-=J,u.height+=q+J)}this.__updateNaturalSize()}else super.__updateBoxBounds();r&&(u.width+=s*.16);const m=Gi(u,h)?u:h;Xi(m,e.contentBounds)?t.__textBoxBounds=m:(e.contentBounds=m,e.renderChanged=!0,Zi(t.__textBoxBounds={},[u,h]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){$i(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}};n([y(mi)],g.prototype,"__",void 0);n([p(0)],g.prototype,"width",void 0);n([p(0)],g.prototype,"height",void 0);n([k(!1)],g.prototype,"resizeFontSize",void 0);n([gt("#000000")],g.prototype,"fill",void 0);n([jt("outside")],g.prototype,"strokeAlign",void 0);n([Y("all")],g.prototype,"hitFill",void 0);n([p("")],g.prototype,"text",void 0);n([p("L")],g.prototype,"fontFamily",void 0);n([p(12)],g.prototype,"fontSize",void 0);n([p("normal")],g.prototype,"fontWeight",void 0);n([p(!1)],g.prototype,"italic",void 0);n([p("none")],g.prototype,"textCase",void 0);n([p("none")],g.prototype,"textDecoration",void 0);n([p(0)],g.prototype,"letterSpacing",void 0);n([p({type:"percent",value:1.5})],g.prototype,"lineHeight",void 0);n([p(0)],g.prototype,"paraIndent",void 0);n([p(0)],g.prototype,"paraSpacing",void 0);n([p("left")],g.prototype,"textAlign",void 0);n([p("top")],g.prototype,"verticalAlign",void 0);n([p(!0)],g.prototype,"autoSizeAlign",void 0);n([p("normal")],g.prototype,"textWrap",void 0);n([p("show")],g.prototype,"textOverflow",void 0);g=n([v()],g);let ct=class extends _{get __tag(){return"Path"}constructor(t){super(t)}};n([y(fi)],ct.prototype,"__",void 0);n([jt("center")],ct.prototype,"strokeAlign",void 0);ct=n([v()],ct);let Tt=class extends U{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(t){const e=this.pathElement=new ct(t);return this.pathStyle=t,this.__path=e.path||(e.path=[]),this.add(e),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,s,r,o,a){return this}quadraticCurveTo(t,e,s,r){return this}closePath(){return this}rect(t,e,s,r){return this}roundRect(t,e,s,r,o){return this}ellipse(t,e,s,r,o,a,l,h){return this}arc(t,e,s,r,o,a){return this}arcTo(t,e,s,r,o){return this}drawEllipse(t,e,s,r,o,a,l,h){return this}drawArc(t,e,s,r,o,a){return this}drawPoints(t,e,s){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};n([y(yi)],Tt.prototype,"__",void 0);n([Ji()],Tt.prototype,"path",void 0);Tt=n([_t(ii,["set","path","paint"]),v()],Tt);function Ji(){return(i,t)=>{we(i,t,{get(){return this.__path}})}}function W(i,t,e,s){var r=arguments.length,o=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,s);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o}let ce=class extends j{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:s,tree:r,sky:o,editor:a}=t;s&&(this.ground=this.addLeafer(s)),(r||a)&&(this.tree=this.addLeafer(r)),(o||a)&&(this.sky=this.addLeafer(o||{type:"draw",usePartRender:!1})),a&&this.sky.add(this.editor=P.editor(a))}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:s}=this.config;e||s===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(si.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach(t=>t.start())}stop(){this.children.forEach(t=>t.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.children.forEach(t=>t.unlockLayout())}lockLayout(){super.lockLayout(),this.children.forEach(t=>t.lockLayout())}forceRender(t){this.children.forEach(e=>e.forceRender(t))}addLeafer(t){const e=new j(t);return this.add(e),e}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds){setTimeout(()=>this.add(t,e),10);return}t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),e!==void 0&&(t.canvas.childIndex=e),this.__listenChildEvents(t)}__onPropertyChange(){ft.showHitView&&this.children.forEach(t=>t.forceUpdate("surface"))}__onCreated(){this.created=this.children.every(t=>t.created)}__onReady(){this.children.every(t=>t.ready)&&super.__onReady()}__onViewReady(){this.children.every(t=>t.viewReady)&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){if(t.context){const s=e.matrix;s&&t.setTransform(s.a,s.b,s.c,s.d,s.e,s.f),this.children.forEach(r=>t.copyWorld(r.canvas))}}__onResize(t){this.children.forEach(e=>e.resize(t)),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach(t=>t.__layout.update())}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&A.assign(e,t),this.autoLayout&&A.copyAttrs(e,this,H),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(xt.END,()=>this.__onReady()),t.once(tt.START,()=>this.__onCreated()),t.once(tt.END,()=>this.__onViewReady()),this.realCanvas&&this.__eventIds.push(t.on_(tt.END,this.__onChildRenderEnd,this))}};ce=W([v()],ce);const wt={},ht={isHoldSpaceKey(){return ht.isHold("Space")},isHold(i){return wt[i]},setDownCode(i){wt[i]||(wt[i]=!0)},setUpCode(i){wt[i]=!1}},T={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(i){i.buttons||(i.buttons=1)},left(i){return i.buttons===1},right(i){return i.buttons===2},middle(i){return i.buttons===4}};class Lt extends ri{get spaceKey(){return ht.isHoldSpaceKey()}get left(){return T.left(this)}get right(){return T.right(this)}get middle(){return T.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,e){Te.changeName(t,e)}}let d=class extends Lt{};d.POINTER="pointer";d.BEFORE_DOWN="pointer.before_down";d.BEFORE_MOVE="pointer.before_move";d.BEFORE_UP="pointer.before_up";d.DOWN="pointer.down";d.MOVE="pointer.move";d.UP="pointer.up";d.OVER="pointer.over";d.OUT="pointer.out";d.ENTER="pointer.enter";d.LEAVE="pointer.leave";d.TAP="tap";d.DOUBLE_TAP="double_tap";d.CLICK="click";d.DOUBLE_CLICK="double_click";d.LONG_PRESS="long_press";d.LONG_TAP="long_tap";d.MENU="pointer.menu";d.MENU_TAP="pointer.menu_tap";d=W([$()],d);const nt={};let c=class extends d{static setList(t){this.list=t instanceof O?t:new O(t)}static setData(t){this.data=t}static getValidMove(t,e,s){const{draggable:r,dragBounds:o,x:a,y:l}=t,h=t.getLocalPoint(s,null,!0);return h.x+=e.x-a,h.y+=e.y-l,o&&this.getMoveInDragBounds(t.__local,o==="parent"?t.parent.boxBounds:o,h,!0),r==="x"&&(h.y=0),r==="y"&&(h.x=0),h}static getMoveInDragBounds(t,e,s,r){const o=t.x+s.x,a=t.y+s.y,l=o+t.width,h=a+t.height,u=e.x+e.width,m=e.y+e.height;return r||(s=Object.assign({},s)),M.includes(t,e)?(o>e.x?s.x+=e.x-o:l<u&&(s.x+=u-l),a>e.y?s.y+=e.y-a:h<m&&(s.y+=m-h)):(o<e.x?s.x+=e.x-o:l>u&&(s.x+=u-l),a<e.y?s.y+=e.y-a:h>m&&(s.y+=m-h)),s}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(nt,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(nt,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(nt,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),s={};return M.set(s,e.x-t.x,e.y-t.y,t.x,t.y),M.unsign(s),s}assignMove(t){nt.x=t?this.totalX:this.moveX,nt.y=t?this.totalY:this.moveY}};c.BEFORE_DRAG="drag.before_drag";c.START="drag.start";c.DRAG="drag";c.END="drag.end";c.OVER="drag.over";c.OUT="drag.out";c.ENTER="drag.enter";c.LEAVE="drag.leave";c=W([$()],c);let pt=class extends d{static setList(t){c.setList(t)}static setData(t){c.setData(t)}};pt.DROP="drop";pt=W([$()],pt);let w=class extends c{};w.BEFORE_MOVE="move.before_move";w.START="move.start";w.MOVE="move";w.END="move.end";w=W([$()],w);let L=class extends Lt{};L.BEFORE_ROTATE="rotate.before_rotate";L.START="rotate.start";L.ROTATE="rotate";L.END="rotate.end";L=W([$()],L);let b=class extends c{};b.SWIPE="swipe";b.LEFT="swipe.left";b.RIGHT="swipe.right";b.UP="swipe.up";b.DOWN="swipe.down";b=W([$()],b);let C=class extends Lt{};C.BEFORE_ZOOM="zoom.before_zoom";C.START="zoom.start";C.ZOOM="zoom";C.END="zoom.end";C=W([$()],C);let N=class extends Lt{};N.DOWN="key.down";N.HOLD="key.hold";N.UP="key.up";N=W([$()],N);function Le(i){i.isApp||i.__eventIds.push(i.on_(w.BEFORE_MOVE,t=>{i.zoomLayer.move(i.getValidMove(t.moveX,t.moveY))}),i.on_(C.BEFORE_ZOOM,t=>{const{zoomLayer:e}=i,s=i.getValidScale(t.scale);s!==1&&(E.scaleOf(e,t,s),e.scale=e.__.scaleX*s)}))}function qi(i){Le(i);const{move:t,zoom:e}=i.config;t.scroll="limit",e.min=1}function Qi(i){const{config:t}=i;(t.wheel||(t.wheel={})).preventDefault=!1,(t.touch||(t.touch={})).preventDefault="auto"}const ts=ft.get("LeaferTypeCreator"),Oe={list:{},register(i,t){kt[i]&&ts.repeat(i),kt[i]=t},run(i,t){const e=kt[i];e&&e(t)}},{list:kt,register:Kt}=Oe;Kt("design",Le);Kt("document",qi);Kt("block",Qi);const $t=j.prototype;$t.initType=function(i){Oe.run(i,this)};$t.getValidMove=function(i,t){const{scroll:e,disabled:s}=this.app.config.move;if(e&&(Math.abs(i)>Math.abs(t)?t=0:i=0,e==="limit")){const{x:r,y:o,width:a,height:l}=new Ut(this.__world).addPoint(this.zoomLayer),h=r+a-this.width,u=o+l-this.height;r>=0&&h<=0?i=0:i>0?r+i>0&&(i=-r):i<0&&h+i<0&&(i=-h),o>=0&&u<=0?t=0:t>0?o+t>0&&(t=-o):t<0&&u+t<0&&(t=-u)}return{x:s?0:i,y:s?0:t}};$t.getValidScale=function(i){const{scaleX:t}=this.zoomLayer.__,{min:e,max:s,disabled:r}=this.app.config.zoom,o=Math.abs(t*i);return o<e?i=e/t:o>s&&(i=s/t),r?1:i};class es{get transforming(){return!!(this.moveData||this.zoomData||this.rotateData)}constructor(t){this.interaction=t}move(t){const{interaction:e}=this;if(t.moveType||(t.moveType="move"),!this.moveData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.moveData=Object.assign(Object.assign({},t),{moveX:0,moveY:0}),e.cancelHover(),e.emit(w.START,this.moveData)}t.path=this.moveData.path,e.emit(w.BEFORE_MOVE,t),e.emit(w.MOVE,t),this.transformEndWait()}zoom(t){const{interaction:e}=this;if(!this.zoomData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.zoomData=Object.assign(Object.assign({},t),{scale:1}),e.cancelHover(),e.emit(C.START,this.zoomData)}t.path=this.zoomData.path,e.emit(C.BEFORE_ZOOM,t),e.emit(C.ZOOM,t),this.transformEndWait()}rotate(t){const{interaction:e}=this;if(!this.rotateData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.rotateData=Object.assign(Object.assign({},t),{rotation:0}),e.cancelHover(),e.emit(L.START,this.rotateData)}t.path=this.rotateData.path,e.emit(L.BEFORE_ROTATE,t),e.emit(L.ROTATE,t),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout(()=>{this.transformEnd()},this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd()}moveEnd(){this.moveData&&(this.interaction.emit(w.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(C.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(L.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const Gt={getMoveEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,moveX:t.x,moveY:t.y})},getRotateEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,rotation:t})},getZoomEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,scale:t})},getDragEventData(i,t,e){return Object.assign(Object.assign({},e),{x:e.x,y:e.y,moveX:e.x-t.x,moveY:e.y-t.y,totalX:e.x-i.x,totalY:e.y-i.y})},getDropEventData(i,t,e){return Object.assign(Object.assign({},i),{list:t,data:e})},getSwipeDirection(i){return i<-45&&i>-135?b.UP:i>45&&i<135?b.DOWN:i<=45&&i>=-45?b.RIGHT:b.LEFT},getSwipeEventData(i,t,e){return Object.assign(Object.assign({},e),{moveX:t.moveX,moveY:t.moveY,totalX:e.x-i.x,totalY:e.y-i.y,type:is.getSwipeDirection(E.getAngle(i,e))})},getBase(i){const t=i.button===1?4:i.button;return{altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey,buttons:i.buttons===void 0?1:i.buttons===0?t:i.buttons,origin:i}},pathHasEventType(i,t){const{list:e}=i;for(let s=0,r=e.length;s<r;s++)if(e[s].hasEvent(t))return!0;return!1},filterPathByEventType(i,t){const e=new O,{list:s}=i;for(let r=0,o=s.length;r<o;r++)s[r].hasEvent(t)&&e.add(s[r]);return e},pathCanDrag(i){return i&&i.list.some(t=>t.draggable||t.editable||!t.isLeafer&&t.hasEvent(c.DRAG))},pathHasOutside(i){return i&&i.list.some(t=>t.isOutside)}},is=Gt,pe=new O,{getDragEventData:Bt,getDropEventData:ss,getSwipeEventData:rs}=Gt;class os{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Bt(t,t,t),this.canAnimate=this.canDragOut=!0}getList(t,e){const{proxy:s}=this.interaction.selector,r=s&&s.list.length,o=c.list||this.draggableList||pe;return this.dragging&&(r?t?pe:new O(e?[...s.list,...s.dragHoverExclude]:s.list):o)}checkDrag(t,e){const{interaction:s}=this;if(this.moving&&t.buttons<1){this.canAnimate=!1,s.pointerCancel();return}!this.moving&&e&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(w.START,this.dragData)),this.moving||this.dragStart(t,e),this.drag(t)}dragStart(t,e){this.dragging||(this.dragging=e&&T.left(t),this.dragging&&(this.interaction.emit(c.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(e=>this.dragStartPoints[e.innerId]={x:e.x,y:e.y})}getDraggableList(t){let e;for(let s=0,r=t.length;s<r;s++)if(e=t.list[s],(e.draggable||e.editable)&&e.hitSelf&&!e.locked){this.draggableList=new O(e);break}}drag(t){const{interaction:e,dragData:s,downData:r}=this,{path:o,throughPath:a}=r;this.dragData=Bt(r,s,t),a&&(this.dragData.throughPath=a),this.dragData.path=o,this.moving?(this.dragData.moveType="drag",e.emit(w.BEFORE_MOVE,this.dragData),e.emit(w.MOVE,this.dragData)):this.dragging&&(this.dragReal(),e.emit(c.BEFORE_DRAG,this.dragData),e.emit(c.DRAG,this.dragData))}dragReal(){const{running:t}=this.interaction,e=this.realDraggableList;if(e.length&&t){const{totalX:s,totalY:r}=this.dragData;e.forEach(o=>o.draggable&&o.move(c.getValidMove(o,this.dragStartPoints[o.innerId],{x:s,y:r})))}}dragOverOrOut(t){const{interaction:e}=this,{dragOverPath:s}=this,{path:r}=t;this.dragOverPath=r,s?r.indexAt(0)!==s.indexAt(0)&&(e.emit(c.OUT,t,s),e.emit(c.OVER,t,r)):e.emit(c.OVER,t,r)}dragEnterOrLeave(t){const{interaction:e}=this,{dragEnterPath:s}=this,{path:r}=t;e.emit(c.LEAVE,t,s,r),e.emit(c.ENTER,t,r,s),this.dragEnterPath=r}dragEnd(t,e){if(!this.dragging&&!this.moving)return;const{moveX:s,moveY:r}=this.dragData;this.interaction.config.move.dragAnimate&&this.canAnimate&&this.moving&&(Math.abs(s)>1||Math.abs(r)>1)?(t=Object.assign({},t),e=(e||(t.pointerType==="touch"?2:1))*.9,E.move(t,s*e,r*e),this.drag(t),this.animate(()=>{this.dragEnd(t,1)})):this.dragEndReal(t)}dragEndReal(t){const{interaction:e,downData:s,dragData:r}=this;t||(t=r);const{path:o,throughPath:a}=s,l=Bt(s,t,t);if(a&&(l.throughPath=a),l.path=o,this.moving&&(this.moving=!1,l.moveType="drag",e.emit(w.END,l)),this.dragging){const h=this.getList();this.dragging=!1,e.emit(c.END,l),this.swipe(t,s,r,l),this.drop(t,h,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}animate(t,e){const s=t||this.animateWait;s&&this.interaction.target.nextRender(s,null,e),this.animateWait=t}swipe(t,e,s,r){const{interaction:o}=this;if(E.getDistance(e,t)>o.config.pointer.swipeDistance){const a=rs(e,s,r);this.interaction.emit(a.type,a)}}drop(t,e,s){const r=ss(t,e,c.data);r.path=s,this.interaction.emit(pt.DROP,r),this.interaction.emit(c.LEAVE,t,s)}dragReset(){c.list=c.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e,downData:s,canDragOut:r}=this,{autoDistance:o,dragOut:a}=e.config.move;if(!a||!r||!o)return;const l=e.shrinkCanvasBounds,{x:h,y:u}=l,m=M.maxX(l),J=M.maxY(l),z=t.x<h?o:m<t.x?-o:0,q=t.y<u?o:J<t.y?-o:0;let st=0,Zt=0;this.autoMoveTimer=setInterval(()=>{st+=z,Zt+=q,E.move(s,z,q),E.move(this.dragData,z,q),e.move(Object.assign(Object.assign({},t),{moveX:z,moveY:q,totalX:st,totalY:Zt,moveType:"drag"})),e.pointerMoveReal(t)},10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const ns=ft.get("emit");function as(i,t,e,s){if(!e&&!t.path)return;let r;t.type=i,e?t=Object.assign(Object.assign({},t),{path:e}):e=t.path,t.target=e.indexAt(0);try{for(let o=e.length-1;o>-1;o--){if(r=e.list[o],zt(r,i,t,!0,s))return;r.isApp&&ge(r,i,t,!0,s)}for(let o=0,a=e.length;o<a;o++)if(r=e.list[o],r.isApp&&ge(r,i,t,!1,s),zt(r,i,t,!1,s))return}catch(o){ns.error(o)}}const hs=["move","zoom","rotate","key"];function ge(i,t,e,s,r){if(hs.some(o=>t.startsWith(o))&&i.__.hitChildren&&!ke(i,r)){let o;for(let a=0,l=i.children.length;a<l;a++)o=i.children[a],!e.path.has(o)&&o.__.hittable&&zt(o,t,e,s,r)}}function zt(i,t,e,s,r){if(i.destroyed)return!1;if(i.__.hitSelf&&!ke(i,r)&&(ie.updateEventStyle&&!s&&ie.updateEventStyle(i,t),i.hasEvent(t,s))){e.phase=s?1:i===e.target?2:3;const o=Te.get(t,e);if(i.emitEvent(o,s),o.isStop)return!0}return!1}function ke(i,t){return t&&t.has(i)}const _s={getData(i){const t=i[0],e=i[1],s=E.getCenter(t.from,e.from),r=E.getCenter(t.to,e.to),o={x:r.x-s.x,y:r.y-s.y},a=E.getDistance(t.from,e.from),h=E.getDistance(t.to,e.to)/a,u=E.getRotation(t.from,e.from,t.to,e.to);return{move:o,scale:h,angle:u,center:r}}},ls={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:80/4,y:8},preventDefault:!0},pointer:{hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20,preventDefaultMenu:!0},touch:{preventDefault:!0},multiTouch:{},cursor:!0,keyEvent:!0},{pathHasEventType:At,getMoveEventData:ds,getZoomEventData:us,getRotateEventData:cs,pathCanDrag:ps,pathHasOutside:fe}=Gt;class Xs{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&T.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&T.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&ht.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,e,s,r){this.config=A.clone(ls),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=s,this.defaultPath=new O(t),this.transformer=new es(this),this.dragger=new os(this),r&&(this.config=A.default(r,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,e){t||(t=this.hoverData),t&&(T.defaultLeft(t),this.updateDownData(t),this.checkPath(t,e),this.downTime=Date.now(),this.emit(d.BEFORE_DOWN,t),this.emit(d.DOWN,t),T.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitRightTap=T.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&T.defaultLeft(t),(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(t){const{dragHover:e,dragDistance:s}=this.p;if(this.emit(d.BEFORE_MOVE,t,this.defaultPath),this.downData){const r=E.getDistance(this.downData,t)>s;r&&(this.waitTap&&this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(t,r)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(d.MOVE,t),this.dragging&&!e||this.pointerHover(t),this.dragger.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:e}=this;if(t||(t=e),!e)return;T.defaultLeft(t),t.multiTouch=e.multiTouch,this.findPath(t);const s=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(e.path.list),this.checkPath(t),this.downData=null,this.emit(d.BEFORE_UP,t),this.emit(d.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}multiTouch(t,e){if(this.config.multiTouch.disabled)return;const{move:s,angle:r,scale:o,center:a}=_s.getData(e);this.rotate(cs(a,r,t)),this.zoom(us(a,o,t)),this.move(ds(a,s,t))}menu(t){this.findPath(t),this.emit(d.MENU,t),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(t)}menuTap(t){this.waitRightTap&&this.waitMenuTap&&(this.emit(d.MENU_TAP,t),this.waitRightTap=this.waitMenuTap=!1)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]||(this.downKeyMap[e]=!0,ht.setDownCode(e),this.emit(N.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(N.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]=!1,ht.setUpCode(e),this.emit(N.UP,t,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover(t){this.canHover&&(this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:e}=t,{overPath:s}=this;this.overPath=e,s?e.indexAt(0)!==s.indexAt(0)&&(this.emit(d.OUT,t,s),this.emit(d.OVER,t,e)):this.emit(d.OVER,t,e)}pointerEnterOrLeave(t){let{path:e}=t;this.downData&&!this.moveMode&&(e=e.clone(),this.downData.path.forEach(r=>e.add(r)));const{enterPath:s}=this;this.enterPath=e,this.emit(d.LEAVE,t,s,e),this.emit(d.ENTER,t,e,s)}touchLeave(t){t.pointerType==="touch"&&this.enterPath&&(this.emit(d.LEAVE,t),this.dragger.dragging&&this.emit(pt.LEAVE,t))}tap(t){const{pointer:e}=this.config,s=this.longTap(t);if(!e.tapMore&&s||!this.waitTap)return;e.tapMore&&this.emitTap(t);const r=Date.now()-this.downTime,o=[d.DOUBLE_TAP,d.DOUBLE_CLICK].some(a=>At(t.path,a));r<e.tapTime+50&&o?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{e.tapMore||(this.tapWaitCancel(),this.emitTap(t))},e.tapTime))):e.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,e){const{hitRadius:s,through:r}=this.p,{bottomList:o}=this,a=this.selector.getByPoint(t,s,Object.assign({bottomList:o,name:t.type},e||{through:r}));return a.throughPath&&(t.throughPath=a.throughPath),t.path=a.path,a.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!e||!e.isApp?!1:e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer}checkPath(t,e){(e||this.moveMode&&!fe(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||this.m.drag==="auto"&&!ps(t.path))&&!fe(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,s){const{downData:r}=this;!t&&r&&(t=r),t&&(this.findPath(t,e),s&&r&&t.path.addList(r.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(!1,!0),name:d.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,s;const{path:r}=t;for(let o=0,a=r.length;o<a&&(e=r.list[o],s=e.syncEventer&&e.syncEventer.cursor||e.cursor,!s);o++);this.setCursor(s)}setCursor(t){this.cursor=t}getLocal(t,e){const s=this.canvas.getClientBounds(e);return{x:t.clientX-s.x,y:t.clientY-s.y}}emitTap(t){this.emit(d.TAP,t),this.emit(d.CLICK,t)}emitDoubleTap(t){this.emit(d.DOUBLE_TAP,t),this.emit(d.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(d.LONG_PRESS,t)},this.p.longPressTime)}longTap(t){let e;return this.longPressed&&(this.emit(d.LONG_TAP,t),(At(t.path,d.LONG_TAP)||At(t.path,d.LONG_PRESS))&&(e=!0)),this.longPressWaitCancel(),e}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new Ut(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Ee.RESIZE,this.__onResize,this)],t.once(R.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,s,r){this.running&&as(t,e,s,r)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class gs{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}gs.custom={};class Ys extends De{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new O,this.pixelList=new O}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),P.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),P.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(e=>{e.__hitCanvas&&(e.__hitCanvas.destroy(),e.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}const{toInnerRadiusPointOf:fs,copy:ys,setRadius:vs}=E,at={},mt=Nt.prototype;mt.__hitWorld=function(i){if(!this.__.hitSelf)return!1;this.__.hitRadius&&(ys(at,i),i=at,vs(i,this.__.hitRadius)),fs(i,this.__world,at);const{width:t,height:e}=this.__world,s=t<10&&e<10;if(this.__.hitBox||s){if(M.hitRadiusPoint(this.__layout.boxBounds,at))return!0;if(s)return!1}return(this.__layout.hitCanvasChanged||!this.__hitCanvas)&&(this.__updateHitCanvas(),this.__layout.boundsChanged||(this.__layout.hitCanvasChanged=!1)),this.__hit(at)};mt.__hitFill=function(i){var t;return(t=this.__hitCanvas)===null||t===void 0?void 0:t.hitFill(i,this.__.windingRule)};mt.__hitStroke=function(i,t){var e;return(e=this.__hitCanvas)===null||e===void 0?void 0:e.hitStroke(i,t)};mt.__hitPixel=function(i){var t;return(t=this.__hitCanvas)===null||t===void 0?void 0:t.hitPixel(i,this.__layout.renderBounds,this.__hitCanvas.hitScale)};mt.__drawHitPath=function(i){i&&this.__drawRenderPath(i)};const ms=new Ft,Be=_.prototype;Be.__updateHitCanvas=function(){const i=this.__,{hitCanvasManager:t}=this.leafer,e=(i.__pixelFill||i.__isCanvas)&&i.hitFill==="pixel",s=i.__pixelStroke&&i.hitStroke==="pixel",r=e||s;this.__hitCanvas||(this.__hitCanvas=r?t.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):t.getPathType(this));const o=this.__hitCanvas;if(r){const{renderBounds:a}=this.__layout,l=lt.image.hitCanvasSize,h=o.hitScale=G.set(0,0,l,l).getFitMatrix(a).a,{x:u,y:m,width:J,height:z}=G.set(a).scale(h);o.resize({width:J,height:z,pixelRatio:1}),o.clear(),Rt.patternLocked=!0,this.__renderShape(o,{matrix:ms.setWith(this.__world).scaleWith(1/h).invertWith().translate(-u,-m)},!e,!s),Rt.patternLocked=!1,o.resetTransform(),i.__isHitPixel=!0}else i.__isHitPixel&&(i.__isHitPixel=!1);this.__drawHitPath(o),o.setStrokeOptions(i)};Be.__hit=function(i){lt.name==="miniapp"&&this.__drawHitPath(this.__hitCanvas);const t=this.__;if(t.__isHitPixel&&this.__hitPixel(i))return!0;const{hitFill:e}=t,s=(t.fill||t.__isCanvas)&&(e==="path"||e==="pixel"&&!(t.__pixelFill||t.__isCanvas))||e==="all";if(s&&this.__hitFill(i))return!0;const{hitStroke:r,__strokeWidth:o}=t,a=t.stroke&&(r==="path"||r==="pixel"&&!t.__pixelStroke)||r==="all";if(!s&&!a)return!1;const l=i.radiusX*2;let h=l;if(a)switch(t.strokeAlign){case"inside":if(h+=o*2,!s&&this.__hitFill(i)&&this.__hitStroke(i,h))return!0;h=l;break;case"center":h+=o;break;case"outside":if(h+=o*2,!s){if(!this.__hitFill(i)&&this.__hitStroke(i,h))return!0;h=l}break}return h?this.__hitStroke(i,h):!1};const Ae=_.prototype,Me=X.prototype,Ie=x.prototype;Me.__updateHitCanvas=Ie.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?Ae.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)};Me.__hitFill=Ie.__hitFill=function(i){return this.__hitCanvas?Ae.__hitFill.call(this,i):M.hitRadiusPoint(this.__layout.boxBounds,i)};const Fe=_.prototype,ws=U.prototype;function Xt(i){return i.leafer?i.leafer.selector:lt.selector||(lt.selector=P.selector())}Fe.find=function(i,t){return Xt(this).getBy(i,this,!1,t)};Fe.findOne=function(i,t){return Xt(this).getBy(i,this,!0,t)};ws.pick=function(i,t){return this.__layout.update(),t||(t={}),Xt(this).getByPoint(i,t.hitRadius||0,Object.assign(Object.assign({},t),{target:this}))};const Yt=oi.prototype;Yt.hitFill=function(i,t){return t?this.context.isPointInPath(i.x,i.y,t):this.context.isPointInPath(i.x,i.y)};Yt.hitStroke=function(i,t){return this.strokeWidth=t,this.context.isPointInStroke(i.x,i.y)};Yt.hitPixel=function(i,t,e=1){let{x:s,y:r,radiusX:o,radiusY:a}=i;t&&(s-=t.x,r-=t.y),G.set(s-o,r-a,o*2,a*2).scale(e).ceil();const{data:l}=this.context.getImageData(G.x,G.y,G.width||1,G.height||1);for(let h=0,u=l.length;h<u;h+=4)if(l[h+3]>0)return!0;return l[3]>0};export{Ds as C,te as E,U as G,Ys as H,Xs as I,j as L,f as P,X as R,ai as T,Qt as a,Es as b,ee as c,Gt as d,gs as e,V as f,I as g,Pt as h,g as i};
