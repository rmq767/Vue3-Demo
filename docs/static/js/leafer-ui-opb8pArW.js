import{ag as Ne,F as tt,a7 as Mi,a1 as f,w as Li,K as S,af as Ke,E as et,J as ki,R as qe,t as O,S as A,ah as kt,T as dt,ac as Qe,ai as Ri,Q as b,O as j,aj as Je,ak as wt,I as it,$ as G,M as Pt,al as Ze,am as ct,an as Ti,ao as Si,ap as Ci,a6 as Ot,a0 as yt,aq as Ft,ar as re,a3 as ti,as as Ai,a8 as Wi,at as Pi}from"./@leafer-dMhI7V6q.js";import{G as Oi,T as Fi,C as N,P as Di,a as mt,b as Rt,E as Ii,c as Tt,H as zi,I as Hi,d as $,e as Yi}from"./@leafer-ui-pBRh-c6v.js";const ge=G.get("LeaferCanvas");class ei extends Ke{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const n=i.children[t];n?(this.setAbsolute(n),i.insertBefore(e,n)):i.appendChild(n)}}init(){const{config:t}=this,e=t.view||t.canvas;e?this.__createViewFrom(e):this.__createView();const{style:i}=this.view;if(i.display||(i.display="block"),this.parentView=this.view.parentElement,this.parentView){const n=this.parentView.style;n.webkitUserSelect=n.userSelect="none"}f.syncDomFont&&!this.parentView&&(i.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=typeof t=="string"?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let i=e;if(e===window||e===document){const o=document.createElement("div"),{style:r}=o;r.position="absolute",r.top=r.bottom=r.left=r.right="0px",document.body.appendChild(o),i=o}this.__createView();const n=this.view;i.hasChildNodes()&&(this.setAbsolute(n),i.style.position||(i.style.position="relative")),i.appendChild(n)}else ge.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:n}=this.view;n.width=t+"px",n.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(t,e){if(this.resizeListener=e,t){this.autoBounds=t;try{this.resizeObserver=new ResizeObserver(n=>{this.updateClientBounds();for(const o of n)this.checkAutoBounds(o.contentRect)});const i=this.parentView;i?(this.resizeObserver.observe(i),this.checkAutoBounds(i.getBoundingClientRect())):(this.checkAutoBounds(this.view),ge.warn("no parent"))}catch{this.imitateResizeObserver()}}else window.addEventListener("resize",()=>{const i=f.devicePixelRatio;if(this.pixelRatio!==i){const{width:n,height:o}=this;this.emitResize({width:n,height:o,pixelRatio:i})}})}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),f.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const e=this.view,{x:i,y:n,width:o,height:r}=this.autoBounds.getBoundsFrom(t),a={width:o,height:r,pixelRatio:f.devicePixelRatio};if(!this.isSameSize(a)){const{style:h}=e;h.marginLeft=i+"px",h.marginTop=n+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}emitResize(t){const e={};et.copyAttrs(e,this,ki),this.resize(t),this.resizeListener&&this.width!==void 0&&this.resizeListener(new qe(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}Ne(CanvasRenderingContext2D.prototype);Ne(Path2D.prototype);const{mineType:Yt,fileType:ji}=ct;Object.assign(tt,{canvas:(s,t)=>new ei(s,t),image:s=>new Mi(s)});function Gi(s,t){f.origin={createCanvas(e,i){const n=document.createElement("canvas");return n.width=e,n.height=i,n},canvasToDataURL:(e,i,n)=>e.toDataURL(Yt(i),n),canvasToBolb:(e,i,n)=>new Promise(o=>e.toBlob(o,Yt(i),n)),canvasSaveAs:(e,i,n)=>{const o=e.toDataURL(Yt(ji(i)),n);return f.origin.download(o,i)},download(e,i){return new Promise(n=>{let o=document.createElement("a");o.href=e,o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),n()})},loadImage(e){return new Promise((i,n)=>{const o=new Image,{crossOrigin:r}=f.image;r&&(o.setAttribute("crossOrigin",r),o.crossOrigin=r),o.onload=()=>{i(o)},o.onerror=a=>{n(a)},o.src=f.image.getRealURL(e)})}},f.event={stopDefault(e){e.preventDefault()},stopNow(e){e.stopImmediatePropagation()},stop(e){e.stopPropagation()}},f.canvas=tt.canvas(),f.conicGradientSupport=!!f.canvas.context.createConicGradient}f.name="web";f.isMobile="ontouchstart"in window;f.requestRender=function(s){window.requestAnimationFrame(s)};Li(f,"devicePixelRatio",{get(){return Math.max(1,devicePixelRatio)}});const{userAgent:J}=navigator;J.indexOf("Firefox")>-1?(f.conicGradientRotate90=!0,f.intWheelDeltaY=!0,f.syncDomFont=!0):J.indexOf("Safari")>-1&&J.indexOf("Chrome")===-1&&(f.fullImageShadow=!0);J.indexOf("Windows")>-1?(f.os="Windows",f.intWheelDeltaY=!0):J.indexOf("Mac")>-1?f.os="Mac":J.indexOf("Linux")>-1&&(f.os="Linux");class $i{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new O;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}else return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new O,this.target=t,e&&(this.config=et.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(A.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===kt.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let i=0,n=e.length;i<n;i++)this.__pushChild(e[i])}__onRquestData(){this.target.emitEvent(new dt(dt.DATA,{updatedList:this.updatedList})),this.__updatedList=new O,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Qe.CHANGE,this.__onAttrChange,this),t.on_([kt.ADD,kt.REMOVE],this.__onChildEvent,this),t.on_(dt.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllMatrix:Ui,updateBounds:pe,updateAllWorldOpacity:Vi}=wt,{pushAllChildBranch:Xi,pushAllParent:_e}=Je;function Ni(s,t){let e;s.list.forEach(i=>{e=i.__layout,t.without(i)&&!e.proxyZoom&&(e.matrixChanged?(Ui(i,!0),t.add(i),i.isBranch&&Xi(i,t),_e(i,t)):e.boundsChanged&&(t.add(i),i.isBranch&&(i.__tempNumber=0),_e(i,t)))})}function Ki(s){let t,e,i;s.sort(!0),s.levels.forEach(n=>{t=s.levelMap[n];for(let o=0,r=t.length;o<r;o++){if(e=t[o],e.isBranch&&e.__tempNumber){i=e.children;for(let a=0,h=i.length;a<h;a++)i[a].isBranch||pe(i[a])}pe(e)}})}function qi(s){let t;s.list.forEach(e=>{t=e.__layout,t.opacityChanged&&Vi(e),t.stateStyleChanged&&setTimeout(()=>t.stateStyleChanged&&e.updateState()),e.__updateChange()})}const{worldBounds:we}=Ze,Qi={x:0,y:0,width:1e5,height:1e5};class ye{constructor(t){this.updatedBounds=new S,this.beforeBounds=new S,this.afterBounds=new S,t instanceof Array&&(t=new O(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,we)}setAfter(){const{list:t}=this.updatedList;t.some(e=>e.noBounds)?this.afterBounds.set(Qi):this.afterBounds.setListWithFn(t,we),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Ji,updateAllChange:Zi}=wt,jt=G.get("Layouter");class Dt{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new Ri,this.target=t,e&&(this.config=et.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(b.START),this.layoutOnce(),t.emitEvent(new b(b.END,this.layoutedBlocks,this.times))}catch(e){jt.error(e)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){if(this.layouting)return jt.warn("layouting");if(this.times>3)return jt.warn("layout max times");this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(dt.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())}partLayout(){var t;if(!(!((t=this.__updatedList)===null||t===void 0)&&t.length))return;const e=j.start("PartLayout"),{target:i,__updatedList:n}=this,{BEFORE:o,LAYOUT:r,AFTER:a}=b,h=this.getBlocks(n);h.forEach(l=>l.setBefore()),i.emitEvent(new b(o,h,this.times)),this.extraBlock=null,n.sort(),Ni(n,this.__levelList),Ki(this.__levelList),qi(n),this.extraBlock&&h.push(this.extraBlock),h.forEach(l=>l.setAfter()),i.emitEvent(new b(r,h,this.times)),i.emitEvent(new b(a,h,this.times)),this.addBlocks(h),this.__levelList.reset(),this.__updatedList=null,j.end(e)}fullLayout(){const t=j.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:n,AFTER:o}=b,r=this.getBlocks(new O(e));e.emitEvent(new b(i,r,this.times)),Dt.fullLayout(e),r.forEach(a=>{a.setAfter()}),e.emitEvent(new b(n,r,this.times)),e.emitEvent(new b(o,r,this.times)),this.addBlocks(r),j.end(t)}static fullLayout(t){Ji(t,!0),t.isBranch?Je.updateBounds(t):wt.updateBounds(t),Zi(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new ye([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new ye(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(b.REQUEST,this.layout,this),t.on_(b.AGAIN,this.layoutAgain,this),t.on_(dt.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const U=G.get("Renderer");class ts{get needFill(){return!!(!this.canvas.allowBackgroundColor&&this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,i&&(this.config=et.default(i,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(b.REQUEST)}render(t){if(!(this.running&&this.canvas.view)){this.changed=!0;return}const{target:e}=this;this.times=0,this.totalBounds=new S,U.log(e.innerName,"--->");try{e.isApp||e.app.emit(A.CHILD_START,e),this.emitRender(A.START),this.renderOnce(t),this.emitRender(A.END,this.totalBounds),it.clearRecycled()}catch(i){this.rendering=!1,U.error(i)}U.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return U.warn("rendering");if(this.times>3)return U.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new S,this.renderOptions={},t)this.emitRender(A.BEFORE),t();else{if(this.requestLayout(),this.ignore){this.ignore=this.rendering=!1;return}this.emitRender(A.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(A.RENDER,this.renderBounds,this.renderOptions),this.emitRender(A.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return U.warn("PartRender: need update attr");this.mergeBlocks(),e.forEach(i=>{t.bounds.hit(i)&&!i.isEmpty()&&this.clipRender(i)})}clipRender(t){const e=j.start("PartRender"),{canvas:i}=this,n=t.getIntersect(i.bounds),o=t.includes(this.target.__world),r=new S(n);i.save(),o&&!G.showRepaint?i.clear():(n.spread(10+1/this.canvas.pixelRatio).ceil(),i.clearWorld(n,!0),i.clipWorld(n,!0)),this.__render(n,o,r),i.restore(),j.end(e)}fullRender(){const t=j.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds,!0),e.restore(),j.end(t)}__render(t,e,i){const n=t.includes(this.target.__world)?{includes:e}:{bounds:t,includes:e};this.needFill&&this.canvas.fillWorld(t,this.config.fill),G.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,n),this.renderBounds=i=i||t,this.renderOptions=n,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),G.showHitView&&this.renderHitView(n),G.showBoundsView&&this.renderBoundsView(n),this.canvas.updateRender(i)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new S;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=Date.now();f.requestRender(()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.running&&(this.changed&&this.canvas.view&&this.render(),this.target.emit(A.NEXT)),this.target&&this.__requestRender()})}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new S(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio){this.addBlock(this.canvas.bounds),this.target.forceUpdate("surface");return}}this.addBlock(new S(0,0,1,1)),this.changed=!0}}__onLayoutEnd(t){t.data&&t.data.map(e=>{let i;e.updatedList&&e.updatedList.list.some(n=>(i=!n.__world.width||!n.__world.height,i&&(n.isLeafer||U.tip(n.innerName,": empty"),i=!n.isBranch||n.isBranchLeaf),i)),this.addBlock(i?this.canvas.bounds:e.updatedBounds)})}emitRender(t,e,i){this.target.emitEvent(new A(t,this.times,e,i))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(A.REQUEST,this.update,this),t.on_(b.END,this.__onLayoutEnd,this),t.on_(A.AGAIN,this.renderAgain,this),t.on_(qe.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.canvas=this.config=null)}}const{hitRadiusPoint:es}=yt;class is{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const n=i.through||!1,o=i.ignoreHittable||!1,r=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new O(i.findList),i.findList||this.hitBranch(r);const{list:a}=this.findList,h=this.getBestMatchLeaf(a,i.bottomList,o),l=o?this.getPath(h):this.getHitablePath(h);return this.clear(),n?{path:l,target:h,throughPath:a.length?this.getThroughPath(a):l}:{path:l,target:h}}getBestMatchLeaf(t,e,i){if(t.length){let n;this.findList=new O;const{x:o,y:r}=this.point,a={x:o,y:r,radiusX:0,radiusY:0};for(let h=0,l=t.length;h<l;h++)if(n=t[h],(i||wt.worldHittable(n))&&(this.hitChild(n,a),this.findList.length))return this.findList.list[0]}if(e){for(let n=0,o=e.length;n<o;n++)if(this.hitChild(e[n].target,this.point,e[n].proxy),this.findList.length)return this.findList.list[0]}return t[0]}getPath(t){const e=new O;for(;t;)e.add(t),t=t.parent;return this.target&&e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,n=new O;for(let o=e.list.length-1;o>-1&&(i=e.list[o],!(!i.__.hittable||(n.addAt(i,0),!i.__.hitChildren)));o--);return n}getThroughPath(t){const e=new O,i=[];for(let a=t.length-1;a>-1;a--)i.push(this.getPath(t[a]));let n,o,r;for(let a=0,h=i.length;a<h;a++){n=i[a],o=i[a+1];for(let l=0,c=n.length;l<c&&(r=n.list[l],!(o&&o.has(r)));l++)e.add(r)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,n;const{point:o}=this,r=t.length;for(let a=r-1;a>-1;a--)i=t[a],!(!i.__.visible||e&&!i.__.mask)&&(n=i.__.hitRadius?!0:es(i.__world,o),i.isBranch?(n||i.__ignoreHitWorld)&&(this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,o)):n&&this.hitChild(i,o))}hitChild(t,e,i){if(!(this.exclude&&this.exclude.has(t))&&t.__hitWorld(e)){const{parent:n}=t;if(n&&n.__hasMask&&!t.__.mask&&!n.children.some(o=>o.__.mask&&o.__hitWorld(e)))return;this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}const{Yes:ss,NoAndSkip:ns,YesAndSkip:os}=Si,me={},ve={},xe={};class rs{constructor(t,e){this.config={},this.innerIdMap={},this.idMap={},this.methods={id:(i,n)=>i.id===n?(this.target&&(this.idMap[n]=i),1):0,innerId:(i,n)=>i.innerId===n?(this.target&&(this.innerIdMap[n]=i),1):0,className:(i,n)=>i.className===n?1:0,tag:(i,n)=>i.__tag===n?1:0,tags:(i,n)=>n[i.__tag]?1:0},this.target=t,e&&(this.config=et.default(e,this.config)),this.picker=new is(t,this),t&&this.__listenEvents()}getBy(t,e,i,n){switch(typeof t){case"number":const o=this.getByInnerId(t,e);return i?o:o?[o]:[];case"string":switch(t[0]){case"#":me.id=t.substring(1),t=me;break;case".":ve.className=t.substring(1),t=ve;break;default:xe.tag=t,t=xe}case"object":if(t.id!==void 0){const r=this.getById(t.id,e);return i?r:r?[r]:[]}else if(t.tag){const{tag:r}=t,a=r instanceof Array;return this.getByMethod(a?this.methods.tags:this.methods.tag,e,i,a?et.toMap(r):r)}else return this.getByMethod(this.methods.className,e,i,t.className);case"function":return this.getByMethod(t,e,i,n)}}getByPoint(t,e,i){return f.name==="node"&&this.target&&this.target.emit(b.CHECK_UPDATE),this.picker.getByPoint(t,e,i)}getByInnerId(t,e){const i=this.innerIdMap[t];return i||(this.eachFind(this.toChildren(e),this.methods.innerId,null,t),this.findLeaf)}getById(t,e){const i=this.idMap[t];return i&&wt.hasParent(i,e||this.target)?i:(this.eachFind(this.toChildren(e),this.methods.id,null,t),this.findLeaf)}getByClassName(t,e){return this.getByMethod(this.methods.className,e,!1,t)}getByTag(t,e){return this.getByMethod(this.methods.tag,e,!1,t)}getByMethod(t,e,i,n){const o=i?null:[];return this.eachFind(this.toChildren(e),t,o,n),o||this.findLeaf}eachFind(t,e,i,n){let o,r;for(let a=0,h=t.length;a<h;a++){if(o=t[a],r=e(o,n),r===ss||r===os)if(i)i.push(o);else{this.findLeaf=o;return}o.isBranch&&r<ns&&this.eachFind(o.children,e,i,n)}}toChildren(t){return this.findLeaf=null,[t||this.target]}__onRemoveChild(t){const{id:e,innerId:i}=t.child;this.idMap[e]&&delete this.idMap[e],this.innerIdMap[i]&&delete this.innerIdMap[i]}__checkIdChange(t){if(t.attrName==="id"){const e=t.oldValue;this.idMap[e]&&delete this.idMap[e]}}__listenEvents(){this.__eventIds=[this.target.on_(kt.REMOVE,this.__onRemoveChild,this),this.target.on_(Qe.CHANGE,this.__checkIdChange,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.picker.destroy(),this.findLeaf=null,this.innerIdMap={},this.idMap={})}}Object.assign(tt,{watcher:(s,t)=>new $i(s,t),layouter:(s,t)=>new Dt(s,t),renderer:(s,t,e)=>new ts(s,t,e),selector:(s,t)=>new rs(s,t)});f.layout=Dt.fullLayout;const R={convert(s,t){const e=$.getBase(s),i=Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:s.width,height:s.height,pointerType:s.pointerType,pressure:s.pressure});return i.pointerType==="pen"&&(i.tangentialPressure=s.tangentialPressure,i.tiltX=s.tiltX,i.tiltY=s.tiltY,i.twist=s.twist),i},convertMouse(s,t){const e=$.getBase(s);return Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(s,t){const e=R.getTouch(s),i=$.getBase(s);return Object.assign(Object.assign({},i),{x:t.x,y:t.y,width:1,height:1,pointerType:"touch",multiTouch:s.touches.length>1,pressure:e.force})},getTouch(s){return s.targetTouches[0]||s.changedTouches[0]}},Be={getMove(s,t){let{moveSpeed:e}=t,{deltaX:i,deltaY:n}=s;return s.shiftKey&&!i&&(i=n,n=0),i>50&&(i=Math.max(50,i/3)),n>50&&(n=Math.max(50,n/3)),{x:-i*e*2,y:-n*e*2}},getScale(s,t){let e,i=1,{zoomMode:n,zoomSpeed:o}=t;const r=s.deltaY||s.deltaX;if(n?(e=n==="mouse"?!0:!s.deltaX&&(f.intWheelDeltaY?Math.abs(r)>17:Math.ceil(r)!==r),(s.shiftKey||s.metaKey||s.ctrlKey)&&(e=!0)):e=!s.shiftKey&&(s.metaKey||s.ctrlKey),e){o=Pt.within(o,0,1);const a=s.deltaY?t.delta.y:t.delta.x;i=1-r/(a*4)*o,i<.5&&(i=.5),i>=1.5&&(i=1.5)}return i}},be={convert(s){const t=$.getBase(s);return Object.assign(Object.assign({},t),{code:s.code,key:s.key})}},{getMoveEventData:as,getZoomEventData:Ee,getRotateEventData:hs,pathCanDrag:ls}=$;class ds extends Hi{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let n in e)e[n]=e[n].bind(this),t.addEventListener(n,e[n]);for(let n in i)i[n]=i[n].bind(this),window.addEventListener(n,i[n])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let i in t)this.view.removeEventListener(i,t[i]),this.viewEvents={};for(let i in e)window.removeEventListener(i,e[i]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,n=t.length;i<n;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(be.convert(t))}onKeyUp(t){this.keyUp(be.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(R.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),!(this.config.pointer.touch||this.useMultiTouch)&&(this.usePointer||(this.usePointer=!0),this.pointerDown(R.convert(t,this.getLocal(t))))}onPointerMove(t){this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||(this.usePointer||(this.usePointer=!0),this.pointerMove(R.convert(t,this.getLocal(t,!0))))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),!(this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t))&&this.pointerUp(R.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),!(this.useTouch||this.usePointer)&&this.pointerDown(R.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(R.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),!(this.useTouch||this.usePointer||this.preventWindowPointer(t))&&this.pointerUp(R.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){const e=R.getTouch(t),i=this.getLocal(e,!0),{preventDefault:n}=this.config.touch;(n===!0||n==="auto"&&ls(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),!this.usePointer&&(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(R.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=R.getTouch(t);this.pointerMove(R.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=R.getTouch(t);this.pointerUp(R.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch($.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const n=[];return t.forEach(o=>{i=e.find(r=>r.identifier===o.identifier),i&&n.push({from:this.getLocal(o),to:this.getLocal(i)})}),n}getLocalTouchs(t){return t.map(e=>this.getLocal(e))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config;if(e.disabled)return;const i=e.getScale?e.getScale(t,e):Be.getScale(t,e),n=this.getLocal(t),o=$.getBase(t);i!==1?this.zoom(Ee(n,i,o)):this.move(as(n,e.getMove?e.getMove(t,e):Be.getMove(t,e),o))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=this.getLocal(t),i=$.getBase(t),n=t.scale/this.lastGestureScale,o=t.rotation-this.lastGestureRotation;let{rotateSpeed:r}=this.config.wheel;r=Pt.within(r,0,1),this.zoom(Ee(e,n*n,i)),this.rotate(hs(e,o/Math.PI*180*(r/4+.1),i)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),typeof e[e.length-1]=="object"&&e.push("default"),this.canvas.view.style.cursor=e.map(i=>typeof i=="object"?`url(${i.url}) ${i.x||0} ${i.y||0}`:i).join(",")}eachCursor(t,e,i=0){if(i++,t instanceof Array)t.forEach(n=>this.eachCursor(n,e,i));else{const n=typeof t=="string"&&Yi.get(t);n&&i<2?this.eachCursor(n,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Z(s,t){let e;const{rows:i,decorationY:n,decorationHeight:o}=s.__.__textDrawData;for(let r=0,a=i.length;r<a;r++)e=i[r],e.text?t.fillText(e.text,e.x,e.y):e.data&&e.data.forEach(h=>{t.fillText(h.char,h.x,e.y)}),n&&t.fillRect(e.x,e.y+n,e.width,o)}function cs(s,t,e){e.fillStyle=s,t.__.__font?Z(t,e):t.__.windingRule?e.fill(t.__.windingRule):e.fill()}function us(s,t,e){let i;const{windingRule:n,__font:o}=t.__;for(let r=0,a=s.length;r<a;r++)i=s[r],!(i.image&&mt.checkImage(t,e,i,!o))&&i.style&&(e.fillStyle=i.style,i.transform?(e.save(),e.transform(i.transform),i.blendMode&&(e.blendMode=i.blendMode),o?Z(t,e):n?e.fill(n):e.fill(),e.restore()):i.blendMode?(e.saveBlendMode(i.blendMode),o?Z(t,e):n?e.fill(n):e.fill(),e.restoreBlendMode()):o?Z(t,e):n?e.fill(n):e.fill())}function ae(s,t,e){const{strokeAlign:i}=t.__,n=typeof s!="string";switch(i){case"center":e.setStroke(n?void 0:s,t.__.strokeWidth,t.__),n?ut(s,!0,t,e):gt(t,e);break;case"inside":Me("inside",s,n,t,e);break;case"outside":Me("outside",s,n,t,e);break}}function Me(s,t,e,i,n){const{__strokeWidth:o,__font:r}=i.__,a=n.getSameCanvas(!0,!0);a.setStroke(e?void 0:t,o*2,i.__),a.font=r,e?ut(t,!0,i,a):gt(i,a),a.blendMode=s==="outside"?"destination-out":"destination-in",Z(i,a),a.blendMode="normal",i.__worldFlipped?n.copyWorldByReset(a,i.__nowWorld):n.copyWorldToInner(a,i.__nowWorld,i.__layout.renderBounds),a.recycle(i.__nowWorld)}function gt(s,t){let e;const{rows:i,decorationY:n,decorationHeight:o}=s.__.__textDrawData;for(let r=0,a=i.length;r<a;r++)e=i[r],e.text?t.strokeText(e.text,e.x,e.y):e.data&&e.data.forEach(h=>{t.strokeText(h.char,h.x,e.y)}),n&&t.strokeRect(e.x,e.y+n,e.width,o)}function ut(s,t,e,i){let n;for(let o=0,r=s.length;o<r;o++)n=s[o],!(n.image&&mt.checkImage(e,i,n,!1))&&n.style&&(i.strokeStyle=n.style,n.blendMode?(i.saveBlendMode(n.blendMode),t?gt(e,i):i.stroke(),i.restoreBlendMode()):t?gt(e,i):i.stroke())}function fs(s,t,e){const i=t.__,{__strokeWidth:n,strokeAlign:o,__font:r}=i;if(n)if(r)ae(s,t,e);else switch(o){case"center":e.setStroke(s,n,i),e.stroke();break;case"inside":e.save(),e.setStroke(s,n*2,i),i.windingRule?e.clip(i.windingRule):e.clip(),e.stroke(),e.restore();break;case"outside":const a=e.getSameCanvas(!0,!0);a.setStroke(s,n*2,i),t.__drawRenderPath(a),a.stroke(),i.windingRule?a.clip(i.windingRule):a.clip(),a.clearWorld(t.__layout.renderBounds),t.__worldFlipped?e.copyWorldByReset(a,t.__nowWorld):e.copyWorldToInner(a,t.__nowWorld,t.__layout.renderBounds),a.recycle(t.__nowWorld);break}}function gs(s,t,e){const i=t.__,{__strokeWidth:n,strokeAlign:o,__font:r}=i;if(n)if(r)ae(s,t,e);else switch(o){case"center":e.setStroke(void 0,n,i),ut(s,!1,t,e);break;case"inside":e.save(),e.setStroke(void 0,n*2,i),i.windingRule?e.clip(i.windingRule):e.clip(),ut(s,!1,t,e),e.restore();break;case"outside":const{renderBounds:a}=t.__layout,h=e.getSameCanvas(!0,!0);t.__drawRenderPath(h),h.setStroke(void 0,n*2,i),ut(s,!1,t,h),i.windingRule?h.clip(i.windingRule):h.clip(),h.clearWorld(a),t.__worldFlipped?e.copyWorldByReset(h,t.__nowWorld):e.copyWorldToInner(h,t.__nowWorld,a),h.recycle(t.__nowWorld);break}}const{getSpread:ps,getOuterOf:_s,getByMove:ws,getIntersectData:ys}=yt;function ms(s,t,e){const i=t.getSameCanvas(),n=s.__nowWorld;let o,r,a,h,{scaleX:l,scaleY:c}=n;if(l<0&&(l=-l),c<0&&(c=-c),t.bounds.includes(n))h=i,o=a=n;else{const{renderShapeSpread:g}=s.__layout,p=ys(g?ps(t.bounds,l===c?g*l:[g*c,g*l]):t.bounds,n);r=t.bounds.getFitMatrix(p);let{a:d,d:u}=r;if(r.a<1&&(h=t.getSameCanvas(),s.__renderShape(h,e),l*=d,c*=u),a=_s(n,r),o=ws(a,-r.e,-r.f),e.matrix){const{matrix:_}=e;r.multiply(_),d*=_.scaleX,u*=_.scaleY}e=Object.assign(Object.assign({},e),{matrix:r.withScale(d,u)})}return s.__renderShape(i,e),{canvas:i,matrix:r,bounds:o,worldCanvas:h,shapeBounds:a,scaleX:l,scaleY:c}}let se;function vs(s,t){const e=t.__,i=[];let n=e.__input[s],o;n instanceof Array||(n=[n]),se=mt.recycleImage(s,e);for(let r=0,a=n.length,h;r<a;r++)h=xs(s,n[r],t),h&&i.push(h);e["_"+s]=i.length?i:void 0,i.length&&i[0].image&&(o=i[0].image.hasOpacityPixel),s==="fill"?e.__pixelFill=o:e.__pixelStroke=o}function xs(s,t,e){if(typeof t!="object"||t.visible===!1||t.opacity===0)return;const{boxBounds:i}=e.__layout;switch(t.type){case"solid":let{type:n,blendMode:o,color:r,opacity:a}=t;return{type:n,blendMode:o,style:N.string(r,a)};case"image":return mt.image(e,s,t,i,!se||!se[t.url]);case"linear":return Rt.linearGradient(t,i);case"radial":return Rt.radialGradient(t,i);case"angular":return Rt.conicGradient(t,i);default:return t.r!==void 0?{type:"solid",style:N.string(t)}:void 0}}const Bs={compute:vs,fill:cs,fills:us,fillText:Z,stroke:fs,strokes:gs,strokeText:ae,drawTextStroke:gt,shape:ms};let ot={};const{get:he,rotateOfOuter:ii,translate:q,scaleOfOuter:bs,scale:si,rotate:ni}=Ft;function oi(s,t,e,i,n,o,r){const a=he();q(a,t.x+e,t.y+i),si(a,n,o),r&&ii(a,{x:t.x+t.width/2,y:t.y+t.height/2},r),s.transform=a}function ri(s,t,e,i,n,o,r){const a=he();q(a,t.x+e,t.y+i),n&&si(a,n,o),r&&ni(a,r),s.transform=a}function ai(s,t,e,i,n,o,r,a,h,l){const c=he();if(h)if(l==="center")ii(c,{x:e/2,y:i/2},h);else switch(ni(c,h),h){case 90:q(c,i,0);break;case 180:q(c,e,i);break;case 270:q(c,0,e);break}ot.x=t.x+n,ot.y=t.y+o,q(c,ot.x,ot.y),r&&bs(c,ot,r,a),s.transform=c}const{get:Es,translate:Ms}=Ft,Ls=new S,Gt={},$t={};function hi(s,t,e,i){const{blendMode:n,sync:o}=e;n&&(s.blendMode=n),o&&(s.sync=o),s.data=li(e,i,t)}function li(s,t,e){let{width:i,height:n}=e;s.padding&&(t=Ls.set(t).shrink(s.padding)),s.mode==="strench"&&(s.mode="stretch");const{opacity:o,mode:r,align:a,offset:h,scale:l,size:c,rotation:g,repeat:p}=s,d=t.width===i&&t.height===n,u={mode:r},_=a!=="center"&&(g||0)%180===90,m=_?n:i,L=_?i:n;let w=0,v=0,y,x;if(!r||r==="cover"||r==="fit"){if(!d||g){const E=t.width/m,F=t.height/L;y=x=r==="fit"?Math.min(E,F):Math.max(E,F),w+=(t.width-i*y)/2,v+=(t.height-n*x)/2}}else(l||c)&&(Pt.getScaleData(l,c,e,$t),y=$t.scaleX,x=$t.scaleY);if(a){const E={x:w,y:v,width:m,height:L};y&&(E.width*=y,E.height*=x),Ci.toPoint(a,E,t,Gt,!0),w+=Gt.x,v+=Gt.y}switch(h&&(w+=h.x,v+=h.y),r){case"stretch":d||(i=t.width,n=t.height);break;case"normal":case"clip":(w||v||y||g)&&ri(u,t,w,v,y,x,g);break;case"repeat":(!d||y||g)&&ai(u,t,i,n,w,v,y,x,g,a),p||(u.repeat="repeat");break;case"fit":case"cover":default:y&&oi(u,t,w,v,y,x,g)}return u.transform||(t.x||t.y)&&(u.transform=Es(),Ms(u.transform,t.x,t.y)),y&&r!=="stretch"&&(u.scaleX=y,u.scaleY=x),u.width=i,u.height=n,o&&(u.opacity=o),p&&(u.repeat=typeof p=="string"?p==="x"?"repeat-x":"repeat-y":"repeat"),u}let rt,ks=new S;const{isSame:Rs}=yt;function Ts(s,t,e,i,n){let o,r;const a=it.get(e);return rt&&e===rt.paint&&Rs(i,rt.boxBounds)?o=rt.leafPaint:(o={type:e.type,image:a},rt=a.use>1?{leafPaint:o,paint:e,boxBounds:ks.set(i)}:null),(n||a.loading)&&(r={image:a,attrName:t,attrValue:e}),a.ready?(Le(s,t,e,a,o,i),n&&(ke(s,r),Re(s,r))):a.error?n&&Te(s,r,a.error):(n&&(Ut(s,!0),ke(s,r)),o.loadId=a.load(()=>{Ut(s,!1),s.destroyed||(Le(s,t,e,a,o,i)&&(a.hasOpacityPixel&&(s.__layout.hitCanvasChanged=!0),s.forceUpdate("surface")),Re(s,r)),o.loadId=null},h=>{Ut(s,!1),Te(s,r,h),o.loadId=null})),o}function Le(s,t,e,i,n,o){if(t==="fill"&&!s.__.__naturalWidth){const r=s.__;if(r.__naturalWidth=i.width/r.pixelRatio,r.__naturalHeight=i.height/r.pixelRatio,r.__autoSide)return s.forceUpdate("width"),s.__proxyData&&(s.setProxyAttr("width",r.width),s.setProxyAttr("height",r.height)),!1}return n.data||hi(n,i,e,o),!0}function ke(s,t){le(s,Ot.LOAD,t)}function Re(s,t){le(s,Ot.LOADED,t)}function Te(s,t,e){t.error=e,s.forceUpdate("surface"),le(s,Ot.ERROR,t)}function le(s,t,e){s.hasEvent(t)&&s.emitEvent(new Ot(t,e))}function Ut(s,t){const{leafer:e}=s;e&&e.viewReady&&(e.renderer.ignore=t)}const{get:Se,scale:Ce,copy:Ae}=Ft,{ceil:We,abs:Pe}=Math;function ne(s,t,e){let{scaleX:i,scaleY:n}=it.patternLocked?s.__world:s.__nowWorld;const o=i+"-"+n+"-"+e;if(t.patternId!==o&&!s.destroyed){i=Pe(i),n=Pe(n);const{image:r,data:a}=t;let h,l,{width:c,height:g,scaleX:p,scaleY:d,opacity:u,transform:_,repeat:m}=a;p&&(l=Se(),Ae(l,_),Ce(l,1/p,1/d),i*=p,n*=d),i*=e,n*=e,c*=i,g*=n;const L=c*g;if(!m&&L>f.image.maxCacheSize)return!1;let w=f.image.maxPatternSize;if(!r.isSVG){const x=r.width*r.height;w>x&&(w=x)}L>w&&(h=Math.sqrt(L/w)),h&&(i/=h,n/=h,c/=h,g/=h),p&&(i/=p,n/=d),(_||i!==1||n!==1)&&(l||(l=Se(),_&&Ae(l,_)),Ce(l,1/i,1/n));const v=r.getCanvas(We(c)||1,We(g)||1,u),y=r.getPattern(v,m||f.origin.noRepeat||"no-repeat",l,t);return t.style=y,t.patternId=o,!0}else return!1}function de(s,t,e,i){function n(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(c){try{l(i.next(c))}catch(g){r(g)}}function h(c){try{l(i.throw(c))}catch(g){r(g)}}function l(c){c.done?o(c.value):n(c.value).then(a,h)}l((i=i.apply(s,t||[])).next())})}const{abs:Oe}=Math;function Ss(s,t,e,i){const{scaleX:n,scaleY:o}=it.patternLocked?s.__world:s.__nowWorld,{pixelRatio:r}=t;if(!e.data||e.patternId===n+"-"+o+"-"+r&&!Tt.running)return!1;{const{data:a}=e;if(i)if(a.repeat)i=!1;else{let{width:h,height:l}=a;h*=Oe(n)*r,l*=Oe(o)*r,a.scaleX&&(h*=a.scaleX,l*=a.scaleY),i=h*l>f.image.maxCacheSize||Tt.running}return i?(t.save(),s.windingRule?t.clip(s.windingRule):t.clip(),e.blendMode&&(t.blendMode=e.blendMode),a.opacity&&(t.opacity*=a.opacity),a.transform&&t.transform(a.transform),t.drawImage(e.image.view,0,0,a.width,a.height),t.restore(),!0):(!e.style||e.sync||Tt.running?ne(s,e,r):e.patternTask||(e.patternTask=it.patternTasker.add(()=>de(this,void 0,void 0,function*(){e.patternTask=null,t.bounds.hit(s.__nowWorld)&&ne(s,e,r),s.forceUpdate("surface")}),300)),!1)}}function Cs(s,t){const e=t["_"+s];if(e instanceof Array){let i,n,o,r;for(let a=0,h=e.length;a<h;a++)i=e[a].image,r=i&&i.url,r&&(n||(n={}),n[r]=!0,it.recycle(i),i.loading&&(o||(o=t.__input&&t.__input[s]||[],o instanceof Array||(o=[o])),i.unload(e[a].loadId,!o.some(l=>l.url===r))));return n}return null}const As={image:Ts,checkImage:Ss,createPattern:ne,recycleImage:Cs,createData:hi,getPatternData:li,fillOrFitMode:oi,clipMode:ri,repeatMode:ai},{toPoint:Fe}=re,Vt={},Xt={};function Ws(s,t){let{from:e,to:i,type:n,blendMode:o,opacity:r}=s;Fe(e||"top",t,Vt),Fe(i||"bottom",t,Xt);const a=f.canvas.createLinearGradient(Vt.x,Vt.y,Xt.x,Xt.y);ce(a,s.stops,r);const h={type:n,style:a};return o&&(h.blendMode=o),h}function ce(s,t,e){if(t){let i;for(let n=0,o=t.length;n<o;n++)i=t[n],typeof i=="string"?s.addColorStop(n/(o-1),N.string(i,e)):s.addColorStop(i.offset,N.string(i.color,e))}}const{getAngle:Ps,getDistance:Os}=ti,{get:Fs,rotateOfOuter:De,scaleOfOuter:Ie}=Ft,{toPoint:ze}=re,V={},Nt={};function Ds(s,t){let{from:e,to:i,type:n,opacity:o,blendMode:r,stretch:a}=s;ze(e||"center",t,V),ze(i||"bottom",t,Nt);const h=f.canvas.createRadialGradient(V.x,V.y,0,V.x,V.y,Os(V,Nt));ce(h,s.stops,o);const l={type:n,style:h},c=ue(t,V,Nt,a,!0);return c&&(l.transform=c),r&&(l.blendMode=r),l}function ue(s,t,e,i,n){let o;const{width:r,height:a}=s;if(r!==a||i){const h=Ps(t,e);o=Fs(),n?(Ie(o,t,r/a*(i||1),1),De(o,t,h+90)):(Ie(o,t,1,r/a*(i||1)),De(o,t,h))}return o}const{getDistance:Is}=ti,{toPoint:He}=re,z={},Kt={};function zs(s,t){let{from:e,to:i,type:n,opacity:o,blendMode:r,stretch:a}=s;He(e||"center",t,z),He(i||"bottom",t,Kt);const h=f.conicGradientSupport?f.canvas.createConicGradient(0,z.x,z.y):f.canvas.createRadialGradient(z.x,z.y,0,z.x,z.y,Is(z,Kt));ce(h,s.stops,o);const l={type:n,style:h},c=ue(t,z,Kt,a||1,f.conicGradientRotate90);return c&&(l.transform=c),r&&(l.blendMode=r),l}const Hs={linearGradient:Ws,radialGradient:Ds,conicGradient:zs,getTransform:ue},{copy:Ye,toOffsetOutBounds:Ys}=yt,k={},Et={};function js(s,t,e){let i,n;const{__nowWorld:o,__layout:r}=s,{shadow:a}=s.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:g,scaleY:p}=e,d=t.getSameCanvas(),u=a.length-1;Ys(l,Et),a.forEach((_,m)=>{d.setWorldShadow(Et.offsetX+_.x*g,Et.offsetY+_.y*p,_.blur*g,_.color),n=_.spread?1+_.spread*2/(r.boxBounds.width+(r.strokeBoxSpread||0)*2):0,di(d,Et,n,e),i=l,_.box&&(d.restore(),d.save(),h&&(d.copyWorld(d,l,o,"copy"),i=o),h?d.copyWorld(h,o,o,"destination-out"):d.copyWorld(e.canvas,c,l,"destination-out")),s.__worldFlipped?t.copyWorldByReset(d,i,o,_.blendMode):t.copyWorldToInner(d,i,r.renderBounds,_.blendMode),u&&m<u&&d.clearWorld(i,!0)}),d.recycle(i)}function di(s,t,e,i){const{bounds:n,shapeBounds:o}=i;if(f.fullImageShadow){if(Ye(k,s.bounds),k.x+=t.x-o.x,k.y+=t.y-o.y,e){const{matrix:r}=i;k.x-=(n.x+(r?r.e:0)+n.width/2)*(e-1),k.y-=(n.y+(r?r.f:0)+n.height/2)*(e-1),k.width*=e,k.height*=e}s.copyWorld(i.canvas,s.bounds,k)}else e&&(Ye(k,t),k.x-=t.width/2*(e-1),k.y-=t.height/2*(e-1),k.width*=e,k.height*=e),s.copyWorld(i.canvas,o,e?k:t)}const{toOffsetOutBounds:Gs}=yt,Mt={};function $s(s,t,e){let i,n;const{__nowWorld:o,__layout:r}=s,{innerShadow:a}=s.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:g,scaleY:p}=e,d=t.getSameCanvas(),u=a.length-1;Gs(l,Mt),a.forEach((_,m)=>{d.save(),d.setWorldShadow(Mt.offsetX+_.x*g,Mt.offsetY+_.y*p,_.blur*g),n=_.spread?1-_.spread*2/(r.boxBounds.width+(r.strokeBoxSpread||0)*2):0,di(d,Mt,n,e),d.restore(),h?(d.copyWorld(d,l,o,"copy"),d.copyWorld(h,o,o,"source-out"),i=o):(d.copyWorld(e.canvas,c,l,"source-out"),i=l),d.fillWorld(i,_.color,"source-in"),s.__worldFlipped?t.copyWorldByReset(d,i,o,_.blendMode):t.copyWorldToInner(d,i,r.renderBounds,_.blendMode),u&&m<u&&d.clearWorld(i,!0)}),d.recycle(i)}function Us(s,t,e){const{blur:i}=s.__;e.setWorldBlur(i*s.__nowWorld.a),e.copyWorldToInner(t,s.__nowWorld,s.__layout.renderBounds),e.filter="none"}function Vs(s,t,e){}const Xs={shadow:js,innerShadow:$s,blur:Us,backgroundBlur:Vs},{excludeRenderBounds:Ns}=Ze;Oi.prototype.__renderMask=function(s,t){let e,i,n,o,r,a;const{children:h}=this;for(let l=0,c=h.length;l<c;l++)e=h[l],a=e.__.mask,!(a&&(r&&(je(this,r,s,n,i,o),i=n=null),a==="path"||a==="clipping-path"?(e.opacity<1?(r="opacity-path",o=e.opacity,n||(n=qt(s))):(r="path",s.save()),e.__clip(n||s,t)):(r=a==="grayscale"?"grayscale":"alpha",i||(i=qt(s)),n||(n=qt(s)),e.__render(i,t)),!(a==="clipping"||a==="clipping-path")))&&(Ns(e,t)||e.__render(n||s,t));je(this,r,s,n,i,o)};function je(s,t,e,i,n,o){switch(t){case"grayscale":n.useGrayscaleAlpha(s.__nowWorld);case"alpha":Ks(s,e,i,n);break;case"opacity-path":ci(s,e,i,o);break;case"path":e.restore()}}function qt(s){return s.getSameCanvas(!1,!0)}function Ks(s,t,e,i){const n=s.__nowWorld;e.resetTransform(),e.opacity=1,e.useMask(i,n),i.recycle(n),ci(s,t,e,1)}function ci(s,t,e,i){const n=s.__nowWorld;t.resetTransform(),t.opacity=i,t.copyWorld(e,n),e.recycle(n)}const qs="¥￥＄€£￡¢￠",Qs="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",Js="《（「〈『〖【〔｛┌＜‘“＝"+qs,Zs="》）」〉』〗】〕｝┐＞’”！？，、。：；‰",tn="≮≯≈≠＝…",en="—／～｜┆·",sn=`{[(<'"`+Js,ui=`>)]}%!?,.:;'"`+Zs,nn=ui+"_#~&*+\\=|"+tn,on="- "+en,rn=[[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]],an=new RegExp(rn.map(([s,t])=>`[\\u${s.toString(16)}-\\u${t.toString(16)}]`).join("|"));function vt(s){const t={};return s.split("").forEach(e=>t[e]=!0),t}const hn=vt(Qs),ln=vt(sn),dn=vt(ui),cn=vt(nn),un=vt(on);var Wt;(function(s){s[s.Letter=0]="Letter",s[s.Single=1]="Single",s[s.Before=2]="Before",s[s.After=3]="After",s[s.Symbol=4]="Symbol",s[s.Break=5]="Break"})(Wt||(Wt={}));const{Letter:Ge,Single:fn,Before:gn,After:pn,Symbol:_n,Break:wn}=Wt;function yn(s){return hn[s]?Ge:un[s]?wn:ln[s]?gn:dn[s]?pn:cn[s]?_n:an.test(s)?fn:Ge}const mn={trimRight(s){const{words:t}=s;let e=0,i=t.length,n;for(let o=i-1;o>-1&&(n=t[o].data[0],n.char===" ");o--)e++,s.width-=n.width;e&&t.splice(i-e,e)}};function vn(s,t,e){switch(t){case"title":return e?s.toUpperCase():s;case"upper":return s.toUpperCase();case"lower":return s.toLowerCase();default:return s}}const{trimRight:xn}=mn,{Letter:Qt,Single:at,Before:$e,After:Jt,Symbol:Bn,Break:Ue}=Wt;let ft,P,M,T,Zt,W,H,pt,st,C,Y,te,ht,Q,_t,K=[],St,oe;function bn(s,t,e){_t=s,K=s.rows,St=s.bounds,oe=!St.width&&!e.autoSizeAlign;const{__letterSpacing:i,paraIndent:n,textCase:o}=e,{canvas:r}=f,{width:a,height:h}=St;if(a||h||i||o!=="none"){const c=e.textWrap!=="none",g=e.textWrap==="break";Q=!0,Y=null,pt=H=st=M=T=0,ft={data:[]},P={words:[]};for(let p=0,d=t.length;p<d;p++)W=t[p],W===`
`?(M&&X(),P.paraEnd=!0,lt(),Q=!0):(C=yn(W),C===Qt&&o!=="none"&&(W=vn(W,o,!M)),H=r.measureText(W).width,i&&(i<0&&(st=H),H+=i),te=C===at&&(Y===at||Y===Qt)||Y===at&&C!==Jt,ht=(C===$e||C===at)&&(Y===Bn||Y===Jt),Zt=Q&&n?a-n:a,c&&a&&T+M+H>Zt&&(g?(M&&X(),T&&lt()):(ht||(ht=C===Qt&&Y==Jt),(te||ht||C===Ue||C===$e||C===at||M+H>Zt)&&M&&X(),T&&lt())),W===" "&&Q!==!0&&T+M===0||(C===Ue?(W===" "&&M&&X(),ee(W,H),X()):((te||ht)&&M&&X(),ee(W,H))),Y=C);M&&X(),T&&lt(),K.length>0&&(K[K.length-1].paraEnd=!0)}else t.split(`
`).forEach(c=>{_t.paraNumber++,T=r.measureText(c).width,K.push({x:n||0,text:c,width:T,paraStart:!0}),oe&&fi()})}function ee(s,t){st&&!pt&&(pt=st),ft.data.push({char:s,width:t}),M+=t}function X(){T+=M,ft.width=M,P.words.push(ft),ft={data:[]},M=0}function lt(){Q&&(_t.paraNumber++,P.paraStart=!0,Q=!1),st&&(P.startCharSize=pt,P.endCharSize=st,pt=0),P.width=T,St.width?xn(P):oe&&fi(),K.push(P),P={words:[]},T=0}function fi(){T>(_t.maxWidth||0)&&(_t.maxWidth=T)}const En=0,Ve=1,Xe=2;function Mn(s,t,e,i){const{rows:n}=s,{textAlign:o,paraIndent:r,letterSpacing:a}=t;let h,l,c,g,p;n.forEach(d=>{d.words&&(c=r&&d.paraStart?r:0,l=e&&o==="justify"&&d.words.length>1?(e-d.width-c)/(d.words.length-1):0,g=a||d.isOverflow?En:l>.01?Ve:Xe,d.isOverflow&&!a&&(d.textMode=!0),g===Xe?(d.x+=c,Ln(d)):(d.x+=c,h=d.x,d.data=[],d.words.forEach(u=>{g===Ve?(p={char:"",x:h},h=kn(u.data,h,p),(d.isOverflow||p.char!==" ")&&d.data.push(p)):h=Rn(u.data,h,d.data,d.isOverflow),!d.paraEnd&&l&&(h+=l,d.width+=l)})),d.words=null)})}function Ln(s){s.text="",s.words.forEach(t=>{t.data.forEach(e=>{s.text+=e.char})})}function kn(s,t,e){return s.forEach(i=>{e.char+=i.char,t+=i.width}),t}function Rn(s,t,e,i){return s.forEach(n=>{(i||n.char!==" ")&&(n.x=t,e.push(n)),t+=n.width}),t}function Tn(s,t){const{rows:e,bounds:i}=s,{__lineHeight:n,__baseLine:o,__letterSpacing:r,__clipText:a,textAlign:h,verticalAlign:l,paraSpacing:c,autoSizeAlign:g}=t;let{x:p,y:d,width:u,height:_}=i,m=n*e.length+(c?c*(s.paraNumber-1):0),L=o;if(a&&m>_)m=Math.max(_,n),s.overflow=e.length;else if(_||g)switch(l){case"middle":d+=(_-m)/2;break;case"bottom":d+=_-m}L+=d;let w,v,y,x=u||g?u:s.maxWidth;for(let E=0,F=e.length;E<F;E++){if(w=e[E],w.x=p,w.width<u||w.width>u&&!a)switch(h){case"center":w.x+=(x-w.width)/2;break;case"right":w.x+=x-w.width}w.paraStart&&c&&E>0&&(L+=c),w.y=L,L+=n,s.overflow>E&&L>m&&(w.isOverflow=!0,s.overflow=E+1),v=w.x,y=w.width,r<0&&(w.width<0?(y=-w.width+t.fontSize+r,v-=y,y+=t.fontSize):y-=r),v<i.x&&(i.x=v),y>i.width&&(i.width=y),a&&u&&u<y&&(w.isOverflow=!0,s.overflow||(s.overflow=e.length))}i.y=d,i.height=m}function Sn(s,t,e,i){if(!i)return;const{rows:n,overflow:o}=s;let{textOverflow:r}=t;if(n.splice(o),r&&r!=="show"){r==="hide"?r="":r==="ellipsis"&&(r="...");let a,h;const l=r?f.canvas.measureText(r).width:0,c=e+i-l;(t.textWrap==="none"?n:[n[o-1]]).forEach(p=>{if(p.isOverflow&&p.data){let d=p.data.length-1;for(let u=d;u>-1&&(a=p.data[u],h=a.x+a.width,!(u===d&&h<c));u--){if(h<c&&a.char!==" "){p.data.splice(u+1),p.width-=a.width;break}p.width-=a.width}p.width+=l,p.data.push({char:r,x:h}),p.textMode&&Cn(p)}})}}function Cn(s){s.text="",s.data.forEach(t=>{s.text+=t.char}),s.data=null}function An(s,t){const{fontSize:e}=t;switch(s.decorationHeight=e/11,t.textDecoration){case"under":s.decorationY=e*.15;break;case"delete":s.decorationY=-e*.35}}const{top:Ct,right:gi,bottom:pi,left:At}=Ai;function Wn(s,t){typeof s!="string"&&(s=String(s));let e=0,i=0,n=t.__getInput("width")||0,o=t.__getInput("height")||0;const{textDecoration:r,__font:a,__padding:h}=t;h&&(n?(e=h[At],n-=h[gi]+h[At]):t.autoSizeAlign||(e=h[At]),o?(i=h[Ct],o-=h[Ct]+h[pi]):t.autoSizeAlign||(i=h[Ct]));const l={bounds:{x:e,y:i,width:n,height:o},rows:[],paraNumber:0,font:f.canvas.font=a};return bn(l,s,t),h&&Pn(h,l,t,n,o),Tn(l,t),Mn(l,t,n),l.overflow&&Sn(l,t,e,n),r!=="none"&&An(l,t),l}function Pn(s,t,e,i,n){if(!i&&e.autoSizeAlign)switch(e.textAlign){case"left":Lt(t,"x",s[At]);break;case"right":Lt(t,"x",-s[gi])}if(!n&&e.autoSizeAlign)switch(e.verticalAlign){case"top":Lt(t,"y",s[Ct]);break;case"bottom":Lt(t,"y",-s[pi])}}function Lt(s,t,e){const{bounds:i,rows:n}=s;i[t]+=e;for(let o=0;o<n.length;o++)n[o][t]+=e}const On={getDrawData:Wn};function Fn(s,t){const e=typeof t=="number"&&t!==1;if(typeof s=="string")if(e&&N.object)s=N.object(s);else return s;let i=s.a===void 0?1:s.a;e&&(i*=t);const n=s.r+","+s.g+","+s.b;return i===1?"rgb("+n+")":"rgba("+n+","+i+")"}const Dn={string:Fn},{setPoint:In,addPoint:zn,toBounds:Hn}=Pi;function Yn(s){const{width:t,height:e}=s.view,{data:i}=s.context.getImageData(0,0,t,e);let n,o,r,a=0;for(let l=0;l<i.length;l+=4)i[l+3]!==0&&(n=a%t,o=(a-n)/t,r?zn(r,n,o):In(r={},n,o)),a++;const h=new S;return Hn(r,h),h.scale(1/s.pixelRatio).ceil()}const jn={export(s,t,e){this.running=!0;const i=ct.fileType(t),n=t.includes(".");return e=ct.getExportOptions(e),Gn(o=>new Promise(r=>{const a=g=>{o(g),r(),this.running=!1},{toURL:h}=f,{download:l}=f.origin;if(i==="json")return n&&l(h(JSON.stringify(s.toJSON(e.json)),"text"),t),a({data:n?!0:s.toJSON(e.json)});if(i==="svg")return n&&l(h(s.toSVG(),"svg"),t),a({data:n?!0:s.toSVG()});const{leafer:c}=s;c?(_i(s),c.waitViewCompleted(()=>de(this,void 0,void 0,function*(){let g,p,d=1,u=1;const{worldTransform:_,isLeafer:m,isFrame:L}=s,{slice:w,trim:v,onCanvas:y}=e,x=e.smooth===void 0?c.config.smooth:e.smooth,E=e.contextSettings||c.config.contextSettings,F=e.screenshot||s.isApp,zt=m&&F&&e.fill===void 0?s.fill:e.fill,yi=ct.isOpaqueImage(t)||zt,xt=new Wi;if(F)g=F===!0?m?c.canvas.bounds:s.worldRenderBounds:F;else{let I=e.relative||(m?"inner":"local");switch(d=_.scaleX,u=_.scaleY,I){case"inner":xt.set(_);break;case"local":xt.set(_).divide(s.localTransform),d/=s.scaleX,u/=s.scaleY;break;case"world":d=1,u=1;break;case"page":I=s.leafer;default:xt.set(_).divide(s.getTransform(I));const bt=I.worldTransform;d/=d/bt.scaleX,u/=u/bt.scaleY}g=s.getBounds("render",I)}const D={scaleX:1,scaleY:1};Pt.getScaleData(e.scale,e.size,g,D);let nt=e.pixelRatio||1;s.isApp&&(D.scaleX*=nt,D.scaleY*=nt,nt=s.app.pixelRatio);const{x:mi,y:vi,width:xi,height:Bi}=new S(g).scale(D.scaleX,D.scaleY),Ht={matrix:xt.scale(1/D.scaleX,1/D.scaleY).invert().translate(-mi,-vi).withScale(1/d*D.scaleX,1/u*D.scaleY)};let B=tt.canvas({width:Math.round(xi),height:Math.round(Bi),pixelRatio:nt,smooth:x,contextSettings:E}),Bt;if(w&&(Bt=s,Bt.__worldOpacity=0,s=c,Ht.bounds=B.bounds),B.save(),L&&zt!==void 0){const I=s.get("fill");s.fill="",s.__render(B,Ht),s.fill=I}else s.__render(B,Ht);if(B.restore(),Bt&&Bt.__updateWorldOpacity(),v){p=Yn(B);const I=B,{width:bt,height:Ei}=p,fe={x:0,y:0,width:bt,height:Ei,pixelRatio:nt};B=tt.canvas(fe),B.copyWorld(I,p,fe)}yi&&B.fillWorld(B.bounds,zt||"#FFFFFF","destination-over"),y&&y(B);const bi=t==="canvas"?B:yield B.export(t,e);a({data:bi,width:B.pixelWidth,height:B.pixelHeight,renderBounds:g,trimBounds:p})}))):a({data:!1})}))}};let ie;function Gn(s){return ie||(ie=new Ti),new Promise(t=>{ie.add(()=>de(this,void 0,void 0,function*(){return yield s(t)}),{parallel:!1})})}function _i(s){s.__.__needComputePaint&&s.__.__computePaint(),s.isBranch&&s.children.forEach(t=>_i(t))}const It=Ke.prototype,wi=G.get("@leafer-ui/export");It.export=function(s,t){const{quality:e,blob:i}=ct.getExportOptions(t);return s.includes(".")?this.saveAs(s,e):i?this.toBlob(s,e):this.toDataURL(s,e)};It.toBlob=function(s,t){return new Promise(e=>{f.origin.canvasToBolb(this.view,s,t).then(i=>{e(i)}).catch(i=>{wi.error(i),e(null)})})};It.toDataURL=function(s,t){return f.origin.canvasToDataURL(this.view,s,t)};It.saveAs=function(s,t){return new Promise(e=>{f.origin.canvasSaveAs(this.view,s,t).then(()=>{e(!0)}).catch(i=>{wi.error(i),e(!1)})})};Object.assign(Fi,On);Object.assign(N,Dn);Object.assign(Di,Bs);Object.assign(mt,As);Object.assign(Rt,Hs);Object.assign(Ii,Xs);Object.assign(Tt,jn);Object.assign(tt,{interaction:(s,t,e,i)=>new ds(s,t,e,i),hitCanvas:(s,t)=>new ei(s,t),hitCanvasManager:()=>new zi});Gi();
