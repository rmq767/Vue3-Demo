import{q as k,c as F}from"./element-plus-CU5GJTiG.js";import{s as O,X as H,d as U,e as V,r as K,w as q,k as G,n as S,c as M,a as w,L as R,P as $,R as z,J,E as X,o as D,K as B,u as N,S as A}from"./@vue-AhIeOBdH.js";import{l as p}from"./leaflet-BJ9rajuP.js";import"./leaflet.chinatmsproviders-DrehvF96.js";import{p as Y,q as j}from"./@element-plus-BPC4xHUH.js";import{_ as Q}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./lodash-es-CVJ_Bk8S.js";import"./@vueuse-CAc1CHwG.js";import"./@sxzz-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BkBTkyCe.js";import"./@turf-Bfw5sV2K.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-D0iZPv2f.js";const W=""+new URL("../png/image-FCEh8Txt.png",import.meta.url).href,ee=(E,u)=>{const e=O(null),d=p.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),C=p.layerGroup([d]);let m=[],f=[];const I=()=>{const t=p.latLng(-90,-180),a=p.latLng(90,180),o=p.latLngBounds(t,a),n=p.canvas();e.value=new p.Map(E,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[C],maxBounds:o,renderer:n,crs:p.CRS.EPSG3857,zoomControl:!1,doubleClickZoom:!1}),e.value.createPane("labelPane").style.zIndex="400",e.value.createPane("circlePane").style.zIndex="401"},b=t=>{var a;if(t!=null&&t.length){g(t);const o=_(t),n=p.latLngBounds(o);(a=e.value)==null||a.fitBounds(n,{padding:[5,5]})}},_=t=>{const a=[];return t.forEach(o=>{var l;a.push({lng:o.pointData[0].lon,lat:o.pointData[0].lat});const n=p.circleMarker({lat:o.pointData[0].lat,lng:o.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:8,data:{name:o.name,id:o.businessId,checked:(l=u.value)==null?void 0:l.includes(o.businessId)},pane:"circlePane"}).addTo(e.value);m.push(n),n.on("click",s)}),a},g=t=>{t.forEach(a=>{var l,c;const o=p.divIcon({html:`<div class='tooltip-content'>${a.name}</div>`,className:(l=u.value)!=null&&l.includes(a.businessId)?"tooltip":""}),n=p.marker([a.pointData[0].lat,a.pointData[0].lon],{icon:o,data:{name:a.name,id:a.businessId,checked:(c=u.value)==null?void 0:c.includes(a.businessId)},pane:"labelPane"}).addTo(e.value);f.push(n),n.on("click",s)})},s=t=>{const a=t.target.options.data,{id:o}=a,n=f.find(v=>v.options.data.id===o),l=m.find(v=>v.options.data.id===o),c=!a.checked;if(c&&u.value.length+1>3){k.warning("最多只能选择3口井");return}if(!c&&u.value.length-1===0){k.warning("最少选择1口井");return}n.options.data.checked=c,l.options.data.checked=c,c?i(n,a,!0):i(n,a,!1)},i=(t,a,o=!1)=>{const{id:n}=a,l=t.options.icon;if(o)l.options.className="tooltip",u.value.push(n);else{l.options.className="";const c=u.value.indexOf(n);c>-1&&u.value.splice(c,1)}t.setIcon(l)},r=()=>{e.value&&(m.forEach(t=>{t.off("click",s)}),f.forEach(t=>{t.off("click",s)}),m=[],f=[],e.value.remove())};return H(()=>{r()}),{map:e,checked:u,drawPoint:b,initMap:I,destroyMap:r}},te=(E,u)=>{const e=O(),d={max:1e7,min:100},C=()=>{var s;e.value=new Cesium.Viewer(E,{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),e.value.scene.screenSpaceCameraController.minimumZoomDistance=d.min,e.value.scene.screenSpaceCameraController.maximumZoomDistance=d.max,e.value.cesiumWidget.creditContainer.style.display="none",e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),e.value.resolutionScale=window.devicePixelRatio,e.value.scene.postProcessStages.fxaa.enabled=!0,e.value.screenSpaceEventHandler.setInputAction(()=>{},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.value.screenSpaceEventHandler.setInputAction(i=>{var t;const r=(t=e.value)==null?void 0:t.scene.pick(i.endPosition);r&&r.id?e.value._container.style.cursor="pointer":e.value._container.style.cursor="default"},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.value.screenSpaceEventHandler.setInputAction(i=>{var t,a;const r=(t=e.value)==null?void 0:t.scene.pick(i.position);if(r&&r.id){const o=r.id,n=o.properties.checked.valueOf(),l=o.id;if(n&&u.value.length-1===0){k.warning("最少选择1口井");return}if(!n&&u.value.length+1>3){k.warning("最多只能选择3口井");return}n?(u.value.splice(u.value.indexOf(l),1),o.properties.checked=!1,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.BLACK),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.WHITE.withAlpha(.8))):(u.value.push(l),o.properties.checked=!0,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.WHITE),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.fromCssColorString("#409eff").withAlpha(.8))),(a=e.value)==null||a.scene.requestRender()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),((s=e.value)==null?void 0:s.scene.screenSpaceCameraController).zoomEventTypes=[],document.addEventListener("wheel",g,{passive:!1})},m=s=>{var t;const i=s.map(a=>({lon:a.pointData[0].lon,lat:a.pointData[0].lat})),r=f(i);(t=e.value)==null||t.camera.setView({destination:r})},f=s=>{let i=Cesium.Math.toRadians(1/0),r=Cesium.Math.toRadians(-1/0),t=Cesium.Math.toRadians(1/0),a=Cesium.Math.toRadians(-1/0);return s.forEach(n=>{const l=Cesium.Math.toRadians(n.lon),c=Cesium.Math.toRadians(n.lat);l<i&&(i=l),l>r&&(r=l),c<t&&(t=c),c>a&&(a=c)}),new Cesium.Rectangle(i-.055,t-.055,r+.055,a+.055)},I=s=>{const i=Cesium.Cartesian3.fromDegrees(s.pointData[0].lon,s.pointData[0].lat),r=u.value.includes(s.businessId)?Cesium.Color.WHITE:Cesium.Color.BLACK,t=u.value.includes(s.businessId)?Cesium.Color.fromCssColorString("#409eff").withAlpha(.8):Cesium.Color.WHITE.withAlpha(.8);e.value.entities.add({position:i,name:s.name,id:s.businessId,properties:{checked:u.value.includes(s.businessId)},point:{pixelSize:12,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:s.name,font:"12px",scale:.8,pixelOffset:new Cesium.Cartesian2(0,-18),fillColor:r,backgroundColor:t,showBackground:!0,outlineWidth:0}})},b=s=>{s.forEach(i=>{I(i)})},_=()=>{var s,i;document.removeEventListener("wheel",g),(s=e.value)==null||s.entities.removeAll(),(i=e.value)==null||i.destroy(),e.value=void 0},g=s=>{var t,a,o,n;s.preventDefault();const i=Math.sign(s.deltaY),r=5;i>0?(a=e.value)==null||a.camera.zoomOut(((t=e.value)==null?void 0:t.camera.positionCartographic.height)/r):(n=e.value)==null||n.camera.zoomIn(((o=e.value)==null?void 0:o.camera.positionCartographic.height)/r)};return H(()=>{_()}),{viewer:e,init:C,setCameraPosition:m,drawCesiumPoint:b}},ae={class:"map"},oe={key:0,id:"map",class:"h-full w-full"},ne={key:1,id:"cesium",class:"h-full w-full"},se={class:"action"},ie={class:"trigger"},le={name:""},re=U({...le,props:{data:{type:Array,default:()=>[]}},emits:["checked"],setup(E,{emit:u}){const e=E,d=V({isCollpased:!1,type:"2d"}),C=K(["1676779130877161474"]),{drawPoint:m,initMap:f,destroyMap:I}=ee("map",C),{init:b,setCameraPosition:_,drawCesiumPoint:g}=te("cesium",C),s=u;q(()=>C.value,t=>{i(t)},{deep:!0});const i=t=>{const a=[];t.forEach(o=>{let n=0,l=0,c=0,v=0;const y=e.data.find(P=>P.businessId===o);if(y){const P=y.info.map((h,x)=>{if(x===0)return c=h.size,v=h.size,{...h,width:0,height:0};{c=Math.max(h.size,y.info[x-1].size,c),v=Math.min(h.size,y.info[x-1].size,v);const T=h.tvd-y.info[x-1].tvd,L=h.md-y.info[x-1].md;n+=L;const Z=Number((L*L-T*T).toFixed(2));return l+=Z,{...h,width:l,height:n}}});a.push({...y,info:P,length:Number(l.toFixed(2)),distance:Number(n.toFixed(2)),maxSize:c,minSize:v})}}),s("checked",a)},r=()=>{d.type==="3d"?(d.type="2d",I(),S(()=>{f(),m(e.data)})):(d.type="3d",S(()=>{b(),_(e.data),g(e.data)}))};return G(()=>{d.type==="3d"?S(()=>{b(),_(e.data),g(e.data)}):(f(),m(e.data)),i(C.value)}),(t,a)=>{const o=F;return D(),M("div",{class:X(["leaflet-container",{collpased:d.isCollpased}])},[w("div",ae,[d.type==="2d"?(D(),M("div",oe)):R("",!0),d.type==="3d"?(D(),M("div",ne)):R("",!0)]),w("div",se,[a[1]||(a[1]=w("div",{class:"direction"},[w("span",null,"北"),w("img",{src:W,alt:""})],-1)),w("div",{class:"type",onClick:r},$(d.type==="2d"?"3D":"2D"),1)]),w("div",ie,[z(o,{class:"trigger-icon",onClick:a[0]||(a[0]=n=>d.isCollpased=!d.isCollpased)},{default:J(()=>[B(z(N(Y),null,null,512),[[A,!d.isCollpased]]),B(z(N(j),null,null,512),[[A,d.isCollpased]])]),_:1})])],2)}}}),xe=Q(re,[["__scopeId","data-v-c50f9740"]]);export{xe as default};
