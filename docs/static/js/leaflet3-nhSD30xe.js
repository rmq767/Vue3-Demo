import{l as x,c as Z}from"./element-plus-gomRs06A.js";import{s as O,B as H,d as U,e as F,r as K,w as q,l as G,n as M,c as P,a as w,S as B,T as Q,V as z,Q as X,K as Y,aw as $,ax as j,o as D,X as R,W as N,u as A}from"./@vue-1pEateLc.js";import{l as p}from"./leaflet-dgfGk-q1.js";import"./leaflet.chinatmsproviders-MeioCgZa.js";import{p as J,q as W}from"./@element-plus-GFHZwatb.js";import{_ as ee}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const te=""+new URL("../png/image-BQhIfE8b.png",import.meta.url).href,oe=(m,l)=>{const e=O(null),c=p.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),f=p.layerGroup([c]),v=[],_=()=>{const t=p.latLng(-90,-180),o=p.latLng(90,180),a=p.latLngBounds(t,o),s=p.canvas();e.value=new p.Map(m,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[f],maxBounds:a,renderer:s,crs:p.CRS.EPSG3857,zoomControl:!1,doubleClickZoom:!1})},b=t=>{var o;if(t!=null&&t.length){const a=[];t.forEach(n=>{var r,d;a.push({lng:n.pointData[0].lon,lat:n.pointData[0].lat});const u=p.circleMarker({lat:n.pointData[0].lat,lng:n.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:10,data:{name:n.name,id:n.businessId,checked:(r=l.value)==null?void 0:r.includes(n.businessId)}}).bindTooltip(n.name,{permanent:!0,direction:"top",className:(d=l.value)!=null&&d.includes(n.businessId)?"tooltip":"",offset:[0,-5],opacity:.8}).addTo(e.value);v.push(u),u.on("click",h)});const s=p.latLngBounds(a);(o=e.value)==null||o.fitBounds(s,{padding:[10,10]})}},h=t=>{const o=t.target,a=o.options.data,s=!a.checked;if(s&&l.value.length+1>3){x.warning("最多只能选择3口井");return}if(!s&&l.value.length-1===0){x.warning("最少选择1口井");return}o.setStyle({data:{...a,checked:s}}),s?g(o,a.name,!0):g(o,a.name,!1)},g=(t,o,a=!1)=>{const s={permanent:!0,direction:"top",className:"",offset:[0,-5],opacity:.8};if(a)s.className="tooltip",t.bindTooltip(o,s),l.value.push(t.options.data.id);else{t.bindTooltip(o,s);const n=l.value.indexOf(t.options.data.id);n>-1&&l.value.splice(n,1)}},i=()=>{e.value&&(v.forEach(t=>{t.off("click",h)}),e.value.remove())};return H(()=>{i()}),{map:e,checked:l,drawPoint:b,initMap:_,destroyMap:i}},ae=(m,l)=>{const e=O(),c={max:1e7,min:100},f=()=>{var i;e.value=new Cesium.Viewer(m,{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),e.value.scene.screenSpaceCameraController.minimumZoomDistance=c.min,e.value.scene.screenSpaceCameraController.maximumZoomDistance=c.max,e.value.cesiumWidget.creditContainer.style.display="none",e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),e.value.resolutionScale=window.devicePixelRatio,e.value.scene.postProcessStages.fxaa.enabled=!0,e.value.screenSpaceEventHandler.setInputAction(()=>{},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.value.screenSpaceEventHandler.setInputAction(t=>{var a;const o=(a=e.value)==null?void 0:a.scene.pick(t.endPosition);o&&o.id?e.value._container.style.cursor="pointer":e.value._container.style.cursor="default"},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.value.screenSpaceEventHandler.setInputAction(t=>{var a,s;const o=(a=e.value)==null?void 0:a.scene.pick(t.position);if(o&&o.id){const n=o.id,u=n.properties.checked.valueOf(),r=n.id;if(u&&l.value.length-1===0){x.warning("最少选择1口井");return}if(!u&&l.value.length+1>3){x.warning("最多只能选择3口井");return}u?(l.value.splice(l.value.indexOf(r),1),n.properties.checked=!1,n.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.BLACK),n.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.WHITE.withAlpha(.8))):(l.value.push(r),n.properties.checked=!0,n.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.WHITE),n.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.fromCssColorString("#409eff").withAlpha(.8))),(s=e.value)==null||s.scene.requestRender()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),((i=e.value)==null?void 0:i.scene.screenSpaceCameraController).zoomEventTypes=[],document.addEventListener("wheel",function(t){var s,n,u,r;t.preventDefault();const o=Math.sign(t.deltaY),a=5;o>0?(n=e.value)==null||n.camera.zoomOut(((s=e.value)==null?void 0:s.camera.positionCartographic.height)/a):(r=e.value)==null||r.camera.zoomIn(((u=e.value)==null?void 0:u.camera.positionCartographic.height)/a)})},v=i=>{var a;const t=i.map(s=>({lon:s.pointData[0].lon,lat:s.pointData[0].lat})),o=_(t);(a=e.value)==null||a.camera.setView({destination:o})},_=i=>{let t=Cesium.Math.toRadians(1/0),o=Cesium.Math.toRadians(-1/0),a=Cesium.Math.toRadians(1/0),s=Cesium.Math.toRadians(-1/0);return i.forEach(u=>{const r=Cesium.Math.toRadians(u.lon),d=Cesium.Math.toRadians(u.lat);r<t&&(t=r),r>o&&(o=r),d<a&&(a=d),d>s&&(s=d)}),new Cesium.Rectangle(t-.05,a-.05,o+.05,s+.05)},b=i=>{const t=Cesium.Cartesian3.fromDegrees(i.pointData[0].lon,i.pointData[0].lat),o=l.value.includes(i.businessId)?Cesium.Color.WHITE:Cesium.Color.BLACK,a=l.value.includes(i.businessId)?Cesium.Color.fromCssColorString("#409eff").withAlpha(.8):Cesium.Color.WHITE.withAlpha(.8);e.value.entities.add({position:t,name:i.name,id:i.businessId,properties:{checked:l.value.includes(i.businessId)},point:{pixelSize:12,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:i.name,font:"10px",scale:.7,pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:o,backgroundColor:a,showBackground:!0,outlineWidth:0,backgroundPadding:new Cesium.Cartesian2(8,10)}})},h=i=>{i.forEach(t=>{b(t)})},g=()=>{var i,t;(i=e.value)==null||i.entities.removeAll(),(t=e.value)==null||t.destroy(),e.value=void 0};return H(()=>{g()}),{viewer:e,init:f,setCameraPosition:v,drawCesiumPoint:h}},ne=m=>($("data-v-5214672b"),m=m(),j(),m),se={class:"map"},ie={key:0,id:"map",class:"h-full w-full"},le={key:1,id:"cesium",class:"h-full w-full"},re={class:"action"},ce=ne(()=>w("div",{class:"direction"},[w("span",null,"北"),w("img",{src:te,alt:""})],-1)),ue={class:"trigger"},de={name:""},pe=U({...de,props:{data:{type:Array,default:()=>[]}},emits:["checked"],setup(m,{emit:l}){const e=m,c=F({isCollpased:!1,type:"2d"}),f=K(["1676779130877161474"]),{drawPoint:v,initMap:_,destroyMap:b}=oe("map",f),{init:h,setCameraPosition:g,drawCesiumPoint:i}=ae("cesium",f),t=l;q(()=>f.value,s=>{o(s)},{deep:!0});const o=s=>{const n=[];s.forEach(u=>{let r=0,d=0,S=0,E=0;const y=e.data.find(k=>k.businessId===u);if(y){const k=y.info.map((C,I)=>{if(I===0)return S=C.size,E=C.size,{...C,width:0,height:0};{S=Math.max(C.size,y.info[I-1].size,S),E=Math.min(C.size,y.info[I-1].size,E);const T=C.tvd-y.info[I-1].tvd,L=C.md-y.info[I-1].md;r+=L;const V=Number((L*L-T*T).toFixed(2));return d+=V,{...C,width:d,height:r}}});n.push({...y,info:k,length:Number(d.toFixed(2)),distance:Number(r.toFixed(2)),maxSize:S,minSize:E})}}),t("checked",n)},a=()=>{c.type==="3d"?(c.type="2d",b(),M(()=>{_(),v(e.data)})):(c.type="3d",M(()=>{h(),g(e.data),i(e.data)}))};return G(()=>{c.type==="3d"?M(()=>{h(),g(e.data),i(e.data)}):(_(),v(e.data)),o(f.value)}),(s,n)=>{const u=Z;return D(),P("div",{class:Y(["leaflet-container",{collpased:c.isCollpased}])},[w("div",se,[c.type==="2d"?(D(),P("div",ie)):B("",!0),c.type==="3d"?(D(),P("div",le)):B("",!0)]),w("div",re,[ce,w("div",{class:"type",onClick:a},Q(c.type==="2d"?"3D":"2D"),1)]),w("div",ue,[z(u,{class:"trigger-icon",onClick:n[0]||(n[0]=r=>c.isCollpased=!c.isCollpased)},{default:X(()=>[R(z(A(J),null,null,512),[[N,!c.isCollpased]]),R(z(A(W),null,null,512),[[N,c.isCollpased]])]),_:1})])],2)}}}),Me=ee(pe,[["__scopeId","data-v-5214672b"]]);export{Me as default};
