import{w,q as S,d as A,u as $e,c as je,f as Ye,g as Xe,y as Ge,Q as wt,t as c,$ as Qt,K as At,J as te,Z as ee,e as qe,l as jt,r as Je,n as R,m as Y,h as B,x as Ze,O as b,F as Yt,a as L,B as kt,k as dt,b as ot,U as z,W as It,i as Qe,N as ti,j as bt,o as P,V as Ce,R as x,p as Te,H as Le,I as ei,T as Be,s as D,v as Ae,z as _t,A as E,C as V,E as Oe,S as Fe,M as ii,D as ie,L as zt,G as nt,P as si,X as ai,Y as J,_ as Ct,a0 as Ht,a1 as Xt,a2 as Z,a3 as Et,a4 as Tt,a5 as Me,a6 as mt,a7 as Lt,a8 as ri,a9 as Gt,aa as oi,ab as ni,ac as qt,ad as U,ae as hi,af as se,ag as Nt,ah as X,ai as di,aj as We,ak as Vt,al as K,am as _i,an as li}from"./@leafer-Dgei2GiV.js";function r(e,t,i,s){var a,o=arguments.length,n=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(o<3?a(n):o>3?a(t,i,n):a(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n}function Q(e){return Le(e,t=>Me({set(i){this.__setAttr(t,i),i&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function lt(e){return Le(e,t=>Me({set(i){this.__setAttr(t,i),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function pi(){return(e,t)=>{const i="_"+t;Te(e,t,{set(s){this.isLeafer&&(this[i]=s)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}const ui={},Ie={hasTransparent:function(e){if(!e||e.length===7||e.length===4)return!1;if(e==="transparent")return!0;const t=e[0];if(t==="#")switch(e.length){case 5:return e[4]!=="f"&&e[4]!=="F";case 9:return e[7]!=="f"&&e[7]!=="F"||e[8]!=="f"&&e[8]!=="F"}else if((t==="r"||t==="h")&&e[3]==="a"){const i=e.lastIndexOf(",");if(i>-1)return parseFloat(e.slice(i+1))<1}return!1}},ae={number:(e,t)=>Et(e)?e.type==="percent"?e.value*t:e.value:e},ci={},y={},gi={},fs={},re={},ze={apply(){z.need("filter")}},vi={},oe={setStyleName:()=>z.need("state"),set:()=>z.need("state")},{parse:yi,objectToCanvasData:fi}=It,{stintSet:pt}=P,{hasTransparent:ne}=Ie,he={},de=Xt.get("UIData");class $ extends ni{get scale(){const{scaleX:t,scaleY:i}=this;return t!==i?{x:t,y:i}:t}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const t=this;return t.__hasMultiStrokeStyle?Math.max(t.__hasMultiStrokeStyle,t.strokeWidth):t.strokeWidth}get __hasMultiPaint(){const t=this;return t.fill&&this.__useStroke||t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect}get __clipAfterFill(){const t=this;return t.cornerRadius||t.innerShadow||t.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:i}=this.__leaf;i&&(i.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,de.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,de.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),ot(t)||!t?(pt(this,"__isTransparentFill",ne(t)),this.__isFills&&this.__removePaint("fill",!0),this._fill=t):Et(t)&&this.__setPaint("fill",t)}setStroke(t){ot(t)||!t?(pt(this,"__isTransparentStroke",ne(t)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=t):Et(t)&&this.__setPaint("stroke",t)}setPath(t){const i=ot(t);i||t&&Et(t[0])?(this.__setInput("path",t),this._path=i?yi(t):fi(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){Ot(this,"shadow",t)}setInnerShadow(t){Ot(this,"innerShadow",t)}setFilter(t){Ot(this,"filter",t)}__computePaint(){const{fill:t,stroke:i}=this.__input;t&&y.compute("fill",this.__leaf),i&&y.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(t){let{strokeWidth:i,strokeWidthFixed:s}=this;if(t&&(t.strokeWidth&&(i=t.strokeWidth),qt(t.strokeWidthFixed)||(s=t.strokeWidthFixed)),s){const a=this.__leaf.getClampRenderScale();return a>1?i/a:i}return i}__setPaint(t,i){this.__setInput(t,i);const s=this.__leaf.__layout;s.boxChanged||s.boxChange(),Tt(i)&&!i.length?this.__removePaint(t):t==="fill"?(this.__isFills=!0,this._fill||(this._fill=he)):(this.__isStrokes=!0,this._stroke||(this._stroke=he))}__removePaint(t,i){i&&this.__removeInput(t),gi.recycleImage(t,this),t==="fill"?(pt(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(pt(this,"__isAlphaPixelStroke",void 0),pt(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}}function Ot(e,t,i){e.__setInput(t,i),Tt(i)?(i.some(s=>s.visible===!1)&&(i=i.filter(s=>s.visible!==!1)),i.length||(i=void 0)):i=i&&i.visible!==!1?[i]:void 0,e["_"+t]=i}class Bt extends ${}class He extends Bt{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const t=this;return t.overflow!=="show"&&t.__leaf.children.length&&(t.__leaf.isOverflow||super.__clipAfterFill)}}class mi extends Bt{__getInputData(t,i){const s=super.__getInputData(t,i);return V.forEach(a=>delete s[a]),s}}class wi extends He{}class Ne extends ${get __usePathBox(){return this.points||this.__pathInputed}}class Jt extends ${get __boxStroke(){return!this.__pathInputed}}class xi extends ${get __boxStroke(){return!this.__pathInputed}}class Ri extends Ne{}class Pi extends ${}class Si extends ${get __pathInputed(){return 2}}class Ei extends Bt{}const Di={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class ki extends ${get __useNaturalRatio(){return!1}setFontWeight(t){ot(t)?(this.__setInput("fontWeight",t),t=Di[t]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t}setBoxStyle(t){let i=this.__leaf,s=i.__box;if(t){const{boxStyle:a}=this;if(s)for(let h in a)s[h]=void 0;else s=i.__box=Ce.get("Rect",0);const o=i.__layout,n=s.__layout;a||(s.parent=i,s.__world=i.__world,n.boxBounds=o.boxBounds),s.set(t),n.strokeChanged&&o.strokeChange(),n.renderChanged&&o.renderChange(),s.__updateChange()}else s&&(i.__box=s.parent=null,s.destroy());this._boxStyle=t}}class bi extends Jt{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(t,i){const s=super.__getInputData(t,i);return delete s.fill,s}}class Ci extends Jt{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,i){const s=super.__getInputData(t,i);return s.url=this.__leaf.canvas.toDataURL("image/png"),s}}const Ti={__updateStrokeSpread(){let e=0,t=0;const i=this.__,{strokeAlign:s,__maxStrokeWidth:a}=i,o=this.__box;if((i.stroke||i.hitStroke==="all")&&a&&s!=="inside"&&(t=e=s==="center"?a/2:a,!i.__boxStroke)){const n=i.__isLinePath?0:10*e,h=i.strokeCap==="none"?0:a;e+=Math.max(n,h)}return i.__useArrow&&(e+=5*a),o&&(e=Math.max(o.__layout.strokeSpread=o.__updateStrokeSpread(),e),t=o.__layout.strokeBoxSpread),this.__layout.strokeBoxSpread=t,e},__updateRenderSpread(){let e=0;const{shadow:t,innerShadow:i,blur:s,backgroundBlur:a,filter:o,renderSpread:n}=this.__;t&&t.forEach(_=>e=Math.max(e,Math.max(Math.abs(_.y),Math.abs(_.x))+(_.spread>0?_.spread:0)+1.5*_.blur)),s&&(e=Math.max(e,s)),o&&(e+=ze.getSpread(o)),n&&(e+=n);let h=e=Math.ceil(e);return i&&i.forEach(_=>h=Math.max(h,Math.max(Math.abs(_.y),Math.abs(_.x))+(_.spread<0?-_.spread:0)+1.5*_.blur)),a&&(h=Math.max(h,a)),this.__layout.renderShapeSpread=h,e+=this.__layout.strokeSpread||0,this.__box?Math.max(this.__box.__updateRenderSpread(),e):e}},Ut={getValidMove(e,t,i,s,a){const o=e.x+s.x,n=e.y+s.y,h=o+e.width,_=n+e.height,p=t.x+t.width,u=t.y+t.height;a||(s=Object.assign({},s));const f=e.width>t.width,M=e.height>t.height;return f&&i!=="outer"?o>t.x?s.x+=t.x-o:h<p&&(s.x+=p-h):o<t.x?s.x+=t.x-o:h>p&&(s.x+=p-h),M&&i!=="outer"?n>t.y?s.y+=t.y-n:_<u&&(s.y+=u-_):n<t.y?s.y+=t.y-n:_>u&&(s.y+=u-_),s.x=kt.float(s.x),s.y=kt.float(s.y),s},axisMove(e,t){const{draggable:i}=e;i==="x"&&(t.y=0),i==="y"&&(t.x=0)},limitMove(e,t){const{dragBounds:i,dragBoundsType:s}=e;i&&_e.getValidMove(e.__localBoxBounds,i==="parent"?e.parent.boxBounds:i,s,t,!0),_e.axisMove(e,t)}},_e=Ut,{stintSet:xt}=P,Li={__updateChange(){const e=this.__;if(e.__useStroke){const t=e.__useStroke=!(!e.stroke||!e.strokeWidth);xt(this.__world,"half",t&&e.strokeAlign==="center"&&e.strokeWidth%2),xt(e,"__fillAfterStroke",t&&e.strokeAlign==="outside"&&e.fill&&!e.__isTransparentFill)}if(e.__useEffect){const{shadow:t,fill:i,stroke:s}=e,a=e.innerShadow||e.blur||e.backgroundBlur||e.filter;xt(e,"__isFastShadow",t&&!a&&t.length<2&&!t[0].spread&&i&&!e.__isTransparentFill&&!(Tt(i)&&i.length>1)&&(this.useFastShadow||!s||s&&e.strokeAlign==="inside")),e.__useEffect=!(!t&&!a)}e.__checkSingle(),xt(e,"__complex",e.__isFills||e.__isStrokes||e.cornerRadius||e.__useEffect)},__drawFast(e,t){le(this,e,t)},__draw(e,t,i){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:a,stroke:o,__drawAfterFill:n,__fillAfterStroke:h,__isFastShadow:_}=s;if(this.__drawRenderPath(e),s.__useEffect&&!_){const p=y.shape(this,e,t);this.__nowWorld=this.__getNowWorld(t);const{shadow:u,innerShadow:f,filter:M}=s;u&&re.shadow(this,e,p),h&&(s.__isStrokes?y.strokes(o,this,e):y.stroke(o,this,e)),a&&(s.__isFills?y.fills(a,this,e):y.fill(a,this,e)),n&&this.__drawAfterFill(e,t),f&&re.innerShadow(this,e,p),o&&!h&&(s.__isStrokes?y.strokes(o,this,e):y.stroke(o,this,e)),M&&ze.apply(M,this,this.__nowWorld,e,i,p),p.worldCanvas&&p.worldCanvas.recycle(),p.canvas.recycle()}else{if(h&&(s.__isStrokes?y.strokes(o,this,e):y.stroke(o,this,e)),_){const p=s.shadow[0],{scaleX:u,scaleY:f}=this.getRenderScaleData(!0,p.scaleFixed);e.save(),e.setWorldShadow(p.x*u,p.y*f,p.blur*u,Ie.string(p.color))}a&&(s.__isFills?y.fills(a,this,e):y.fill(a,this,e)),_&&e.restore(),n&&this.__drawAfterFill(e,t),o&&!h&&(s.__isStrokes?y.strokes(o,this,e):y.stroke(o,this,e))}}else s.__pathInputed?le(this,e,t):this.__drawFast(e,t)},__drawShape(e,t){this.__drawRenderPath(e);const i=this.__,{fill:s,stroke:a}=i;s&&!t.ignoreFill&&(i.__isAlphaPixelFill?y.fills(s,this,e):y.fill("#000000",this,e)),i.__isCanvas&&this.__drawAfterFill(e,t),a&&!t.ignoreStroke&&(i.__isAlphaPixelStroke?y.strokes(a,this,e):y.stroke("#000000",this,e))},__drawAfterFill(e,t){this.__.__clipAfterFill?(e.save(),e.clipUI(this),this.__drawContent(e,t),e.restore()):this.__drawContent(e,t)}};function le(e,t,i){const{fill:s,stroke:a,__drawAfterFill:o,__fillAfterStroke:n}=e.__;e.__drawRenderPath(t),n&&y.stroke(a,e,t),s&&y.fill(s,e,t),o&&e.__drawAfterFill(t,i),a&&!n&&y.stroke(a,e,t)}const Bi={__drawFast(e,t){let{x:i,y:s,width:a,height:o}=this.__layout.boxBounds;const{fill:n,stroke:h,__drawAfterFill:_}=this.__;if(n&&(e.fillStyle=n,e.fillRect(i,s,a,o)),_&&this.__drawAfterFill(e,t),h){const{strokeAlign:p,__strokeWidth:u}=this.__;if(!u)return;e.setStroke(h,u,this.__);const f=u/2;switch(p){case"center":e.strokeRect(0,0,a,o);break;case"inside":a-=u,o-=u,a<0||o<0?(e.save(),this.__clip(e,t),e.strokeRect(i+f,s+f,a,o),e.restore()):e.strokeRect(i+f,s+f,a,o);break;case"outside":e.strokeRect(i-f,s-f,a+u,o+u)}}}};var Kt;let d=Kt=class extends Yt{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(e){kt.assignScale(this,e)}get scale(){return this.__.scale}get isAutoWidth(){const e=this.__;return e.__autoWidth||e.autoWidth}get isAutoHeight(){const e=this.__;return e.__autoHeight||e.autoHeight}get pen(){const{path:e}=this.__;return dt.set(this.path=e||[]),e||this.__drawPathByBox(dt),dt}reset(e){}set(e,t){e&&Object.assign(this,e)}get(e){return ot(e)?this.__.__getInput(e):this.__.__getInputData(e)}createProxyData(){}find(e,t){return z.need("find")}findTag(e){return this.find({tag:e})}findOne(e,t){return z.need("find")}findId(e){return this.findOne({id:e})}getPath(e,t){this.__layout.update();let i=t?this.__.__pathForRender:this.__.path;return i||(dt.set(i=[]),this.__drawPathByBox(dt)),e?It.toCanvasData(i,!0):i}getPathString(e,t,i){return It.stringify(this.getPath(e,t),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const e=this.__;!e.lazy||this.__inLazyBounds||vi.running?e.__computePaint():e.__needComputePaint=!0}}__updateRenderPath(){const e=this.__;e.path?(e.__pathForRender=e.cornerRadius?Qe.smooth(e.path,e.cornerRadius,e.cornerSmoothing):e.path,e.__useArrow&&ci.addArrows(this)):e.__pathForRender&&(e.__pathForRender=void 0)}__drawRenderPath(e){e.beginPath(),this.__drawPathByData(e,this.__.__pathForRender)}__drawPath(e){e.beginPath(),this.__drawPathByData(e,this.__.path)}__drawPathByData(e,t){t?ti.drawPathByData(e,t):this.__drawPathByBox(e)}__drawPathByBox(e){const{x:t,y:i,width:s,height:a}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:o}=this.__;e.roundRect(t,i,s,a,bt(o)?[o]:o)}else e.rect(t,i,s,a)}drawImagePlaceholder(e,t){y.fill(this.__.placeholderColor,this,e)}animate(e,t,i,s){return this.set(e),z.need("animate")}killAnimate(e,t){}export(e,t){return z.need("export")}syncExport(e,t){return z.need("export")}clone(e){const t=P.clone(this.toJSON());return e&&Object.assign(t,e),Kt.one(t)}static one(e,t,i,s,a){return Ce.get(e.tag||this.prototype.__tag,e,t,i,s,a)}static registerUI(){x()(this)}static registerData(e){w(e)(this.prototype)}static setEditConfig(e){}static setEditOuter(e){}static setEditInner(e){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};r([w($)],d.prototype,"__",void 0),r([pi()],d.prototype,"zoomLayer",void 0),r([S("")],d.prototype,"id",void 0),r([S("")],d.prototype,"name",void 0),r([S("")],d.prototype,"className",void 0),r([A("pass-through")],d.prototype,"blendMode",void 0),r([$e(1)],d.prototype,"opacity",void 0),r([je(!0)],d.prototype,"visible",void 0),r([A(!1)],d.prototype,"locked",void 0),r([A(!1)],d.prototype,"dim",void 0),r([A(!1)],d.prototype,"dimskip",void 0),r([Ye(0)],d.prototype,"zIndex",void 0),r([Xe(!1)],d.prototype,"mask",void 0),r([Ge(!1)],d.prototype,"eraser",void 0),r([wt(0,!0)],d.prototype,"x",void 0),r([wt(0,!0)],d.prototype,"y",void 0),r([c(100,!0)],d.prototype,"width",void 0),r([c(100,!0)],d.prototype,"height",void 0),r([Qt(1,!0)],d.prototype,"scaleX",void 0),r([Qt(1,!0)],d.prototype,"scaleY",void 0),r([At(0,!0)],d.prototype,"rotation",void 0),r([At(0,!0)],d.prototype,"skewX",void 0),r([At(0,!0)],d.prototype,"skewY",void 0),r([wt(0,!0)],d.prototype,"offsetX",void 0),r([wt(0,!0)],d.prototype,"offsetY",void 0),r([te(0,!0)],d.prototype,"scrollX",void 0),r([te(0,!0)],d.prototype,"scrollY",void 0),r([ee()],d.prototype,"origin",void 0),r([ee()],d.prototype,"around",void 0),r([S(!1)],d.prototype,"lazy",void 0),r([qe(1)],d.prototype,"pixelRatio",void 0),r([jt(0)],d.prototype,"renderSpread",void 0),r([Je()],d.prototype,"path",void 0),r([R()],d.prototype,"windingRule",void 0),r([R(!0)],d.prototype,"closed",void 0),r([c(0)],d.prototype,"padding",void 0),r([c(!1)],d.prototype,"lockRatio",void 0),r([c()],d.prototype,"widthRange",void 0),r([c()],d.prototype,"heightRange",void 0),r([S(!1)],d.prototype,"draggable",void 0),r([S()],d.prototype,"dragBounds",void 0),r([S("auto")],d.prototype,"dragBoundsType",void 0),r([S(!1)],d.prototype,"editable",void 0),r([Y(!0)],d.prototype,"hittable",void 0),r([Y("path")],d.prototype,"hitFill",void 0),r([B("path")],d.prototype,"hitStroke",void 0),r([Y(!1)],d.prototype,"hitBox",void 0),r([Y(!0)],d.prototype,"hitChildren",void 0),r([Y(!0)],d.prototype,"hitSelf",void 0),r([Y()],d.prototype,"hitRadius",void 0),r([Ze("")],d.prototype,"cursor",void 0),r([A()],d.prototype,"fill",void 0),r([B(void 0,!0)],d.prototype,"stroke",void 0),r([B("inside")],d.prototype,"strokeAlign",void 0),r([B(1,!0)],d.prototype,"strokeWidth",void 0),r([B(!1)],d.prototype,"strokeWidthFixed",void 0),r([B("none")],d.prototype,"strokeCap",void 0),r([B("miter")],d.prototype,"strokeJoin",void 0),r([B()],d.prototype,"dashPattern",void 0),r([B(0)],d.prototype,"dashOffset",void 0),r([B(10)],d.prototype,"miterLimit",void 0),r([R(0)],d.prototype,"cornerRadius",void 0),r([R()],d.prototype,"cornerSmoothing",void 0),r([Q()],d.prototype,"shadow",void 0),r([Q()],d.prototype,"innerShadow",void 0),r([Q()],d.prototype,"blur",void 0),r([Q()],d.prototype,"backgroundBlur",void 0),r([Q()],d.prototype,"grayscale",void 0),r([Q()],d.prototype,"filter",void 0),r([A()],d.prototype,"placeholderColor",void 0),r([S(100)],d.prototype,"placeholderDelay",void 0),r([S({})],d.prototype,"data",void 0),r([b(Yt.prototype.reset)],d.prototype,"reset",null),d=Kt=r([mt(Ti),mt(Li),Lt()],d);let F=class extends d{get __tag(){return"Group"}get isBranch(){return!0}reset(e){this.__setBranch(),super.reset(e)}__setBranch(){this.children||(this.children=[])}set(e,t){if(e)if(e.children){const{children:i}=e;delete e.children,this.children?this.clear():this.__setBranch(),super.set(e,t),i.forEach(s=>this.add(s)),e.children=i}else super.set(e,t)}toJSON(e){const t=super.toJSON(e);return this.childlessJSON||(t.children=this.children.map(i=>i.toJSON(e))),t}pick(e,t){}addAt(e,t){this.add(e,t)}addAfter(e,t){this.add(e,this.children.indexOf(t)+1)}addBefore(e,t){this.add(e,this.children.indexOf(t))}add(e,t){}addMany(...e){}remove(e,t){}removeAll(e){}clear(){}};var Dt;r([w(Bt)],F.prototype,"__",void 0),r([c(0)],F.prototype,"width",void 0),r([c(0)],F.prototype,"height",void 0),F=r([mt(ri),x()],F);const Ai=Xt.get("Leafer");let G=Dt=class extends F{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&ei.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||Be()}constructor(e,t){super(t),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=e,e&&(e.view||e.width)&&this.init(e),Dt.list.add(this)}init(e,t){if(this.canvas)return;let i;const{config:s}=this;this.__setLeafer(this),t&&(this.parentApp=t,this.__bindApp(t),i=t.running),e&&(this.parent=t,this.initType(e.type),this.parent=void 0,P.assign(s,e));const a=this.canvas=D.canvas(s);this.__controllers.push(this.renderer=D.renderer(this,a,s),this.watcher=D.watcher(this,s),this.layouter=D.layouter(this,s)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),this.view=a.view,t||(this.selector=D.selector(this),this.interaction=D.interaction(this,a,this.selector,s),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=D.hitCanvasManager()),this.canvasManager=new Ae,i=s.start),this.hittable=s.hittable,this.fill=s.fill,this.canvasManager.add(a),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),_t.run(this.__initWait),this.onInit()}onInit(){}initType(e){}set(e,t){this.waitInit(()=>{super.set(e,t)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(E.RESTART):this.emitLeafer(E.START),this.__controllers.forEach(e=>e.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(e=>e.stop()),this.running=!1,this.emitLeafer(E.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(e){const t=P.copyAttrs({},e,V);Object.keys(t).forEach(i=>this[i]=t[i])}forceRender(e,t){const{renderer:i}=this;i&&(i.addBlock(e?new Oe(e):this.canvas.bounds),this.viewReady&&(t?i.render():i.update()))}requestRender(e=!1){this.renderer&&this.renderer.update(e)}updateCursor(e){const t=this.interaction;t&&(e?t.setCursor(e):t.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(e){const{canvas:t}=this;if(!t||t.isSameSize(e))return;const i=P.copyAttrs({},this.canvas,V);t.resize(e),this.updateLazyBounds(),this.__onResize(new Fe(e,i))}__onResize(e){this.emitEvent(e),P.copyAttrs(this.__,e,V),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(e){this.selector=e.selector,this.interaction=e.interaction,this.canvasManager=e.canvasManager,this.hitCanvasManager=e.hitCanvasManager}__setLeafer(e){this.leafer=e,this.__level=1}__checkAutoLayout(){const{config:e,parentApp:t}=this;t||(e.width&&e.height||(this.autoLayout=new ii(e)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(e,t){return this.canvas&&(V.includes(e)?this.__changeCanvasSize(e,t):e==="fill"?this.__changeFill(t):e==="hittable"?this.parent||(this.canvas.hittable=t):e==="zIndex"&&(this.canvas.zIndex=t,setTimeout(()=>this.parent&&this.parent.__updateSortChildren()))),super.__setAttr(e,t)}__getAttr(e){return this.canvas&&V.includes(e)?this.canvas[e]:super.__getAttr(e)}__changeCanvasSize(e,t){const{config:i,canvas:s}=this,a=P.copyAttrs({},s,V);a[e]=i[e]=t,i.width&&i.height?s.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(a)}__changeFill(e){this.config.fill=e,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=e:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(E.BEFORE_READY),this.emitLeafer(E.READY),this.emitLeafer(E.AFTER_READY),_t.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(E.VIEW_READY),_t.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:e,width:t,height:i}=this.config;if(e){let{width:s,height:a,pixelRatio:o}=this;const n=e==="box"?this.worldBoxBounds:this.__world;t||(s=Math.max(1,n.x+n.width)),i||(a=Math.max(1,n.y+n.height)),this.__doResize({width:s,height:a,pixelRatio:o})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){_t.run(this.__nextRenderWait);const{imageReady:e}=this;e&&!this.viewCompleted&&this.__checkViewCompleted(),e||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(e=!0){this.nextRender(()=>{this.imageReady&&(e&&this.emitLeafer(E.VIEW_COMPLETED),_t.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(e,t){t&&(e=e.bind(t)),this.__initWait||(this.__initWait=[]),this.canvas?e():this.__initWait.push(e)}waitReady(e,t){t&&(e=e.bind(t)),this.ready?e():this.__readyWait.push(e)}waitViewReady(e,t){t&&(e=e.bind(t)),this.viewReady?e():this.__viewReadyWait.push(e)}waitViewCompleted(e,t){t&&(e=e.bind(t)),this.__viewCompletedWait.push(e),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(e,t,i){t&&(e=e.bind(t));const s=this.__nextRenderWait;if(i){for(let a=0;a<s.length;a++)if(s[a]===e){s.splice(a,1);break}}else s.push(e);this.requestRender()}zoom(e,t,i,s){return z.need("view")}getValidMove(e,t,i){return{x:e,y:t}}getValidScale(e){return e}getWorldPointByClient(e,t){return this.interaction&&this.interaction.getLocal(e,t)}getPagePointByClient(e,t){return this.getPagePoint(this.getWorldPointByClient(e,t))}getClientPointByWorld(e){const{x:t,y:i}=this.clientBounds;return{x:t+e.x,y:i+e.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(e){}emitLeafer(e){this.emitEvent(new E(e,this))}__listenEvents(){const e=ie.start("FirstCreate "+this.innerName);this.once([[E.START,()=>ie.end(e)],[zt.START,this.updateLazyBounds,this],[nt.START,this.__onCreated,this],[nt.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[si.DATA,this.__onWatchData,this],[zt.END,this.__onLayoutEnd,this],[nt.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(e){const t=()=>{if(!this.destroyed){Dt.list.remove(this);try{this.stop(),this.emitLeafer(E.END),this.__removeListenEvents(),this.__controllers.forEach(i=>!(this.parent&&i===this.interaction)&&i.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{Ht.clearRecycled()},100)}catch(i){Ai.error(i)}}};e?t():setTimeout(t)}};G.list=new L,r([w(mi)],G.prototype,"__",void 0),r([c()],G.prototype,"pixelRatio",void 0),G=Dt=r([x()],G);let q=class extends d{get __tag(){return"Rect"}};r([w(Jt)],q.prototype,"__",void 0),q=r([mt(Bi),Lt(),x()],q);const{add:pe,includes:Oi,scroll:Fi}=Z,j=q.prototype,Mi=F.prototype;let m=class extends F{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(e){super(e),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(e){if(this.children.length&&!this.pathInputed){const t=this.__;if(t.__autoSide){t.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:i}=this.__layout;t.__autoSize||(t.__autoWidth?(i.width+=i.x,i.x=0,i.height=t.height,i.y=0):(i.height+=i.y,i.y=0,i.width=t.width,i.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let e,t;if(this.children.length){const i=this.__,s=this.__layout,{renderBounds:a,boxBounds:o}=s,{overflow:n}=i,h=s.childrenRenderBounds||(s.childrenRenderBounds=Be());super.__updateRenderBounds(h),(t=n.includes("scroll"))&&(pe(h,o),Fi(h,i)),this.__updateRectRenderBounds(),e=!Oi(o,h),e&&n==="show"&&pe(a,h)}else this.__updateRectRenderBounds();P.stintSet(this,"isOverflow",e),this.__checkScroll(t)}__updateRectRenderBounds(){}__checkScroll(e){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(e,t){}__renderGroup(e,t){}__render(e,t){this.__.__drawAfterFill?this.__renderRect(e,t):(this.__renderRect(e,t),this.children.length&&this.__renderGroup(e,t)),this.hasScroller&&this.scroller.__render(e,t)}__drawContent(e,t){this.__renderGroup(e,t),(this.__.__useStroke||this.__.__useEffect)&&(e.setWorld(this.__nowWorld),this.__drawRenderPath(e))}};r([w(He)],m.prototype,"__",void 0),r([c(100)],m.prototype,"width",void 0),r([c(100)],m.prototype,"height",void 0),r([S(!1)],m.prototype,"resizeChildren",void 0),r([jt("show")],m.prototype,"overflow",void 0),r([b(j.__updateStrokeSpread)],m.prototype,"__updateStrokeSpread",null),r([b(j.__updateRenderSpread)],m.prototype,"__updateRectRenderSpread",null),r([b(j.__updateBoxBounds)],m.prototype,"__updateRectBoxBounds",null),r([b(j.__updateStrokeBounds)],m.prototype,"__updateStrokeBounds",null),r([b(j.__updateRenderBounds)],m.prototype,"__updateRectRenderBounds",null),r([b(j.__updateChange)],m.prototype,"__updateRectChange",null),r([b(j.__render)],m.prototype,"__renderRect",null),r([b(Mi.__render)],m.prototype,"__renderGroup",null),m=r([Lt(),x()],m);let ut=class extends m{get __tag(){return"Frame"}get isFrame(){return!0}};r([w(wi)],ut.prototype,"__",void 0),r([A("#FFFFFF")],ut.prototype,"fill",void 0),r([jt("hide")],ut.prototype,"overflow",void 0),ut=r([x()],ut);const{moveTo:ue,closePath:ce,ellipse:tt}=Ct;let et=class extends d{get __tag(){return"Ellipse"}__updatePath(){const{width:e,height:t,innerRadius:i,startAngle:s,endAngle:a}=this.__,o=e/2,n=t/2,h=this.__.path=[];i?(s||a?(i<1&&tt(h,o,n,o*i,n*i,0,s,a,!1),tt(h,o,n,o,n,0,a,s,!0),i<1&&ce(h)):(i<1&&(tt(h,o,n,o*i,n*i),ue(h,e,n)),tt(h,o,n,o,n,0,360,0,!0)),U.ellipseToCurve&&(this.__.path=this.getPath(!0))):s||a?(ue(h,o,n),tt(h,o,n,o,n,0,s,a,!1),ce(h)):tt(h,o,n,o,n)}};r([w(xi)],et.prototype,"__",void 0),r([R(0)],et.prototype,"innerRadius",void 0),r([R(0)],et.prototype,"startAngle",void 0),r([R(0)],et.prototype,"endAngle",void 0),et=r([x()],et);const{moveTo:Wi,lineTo:Ii,drawPoints:zi}=Ct,{rotate:Hi,getAngle:Ni,getDistance:Vi,defaultPoint:ge}=J;let I=class extends d{get __tag(){return"Line"}get toPoint(){const{width:e,rotation:t}=this.__,i=ai();return e&&(i.x=e),t&&Hi(i,t),i}set toPoint(e){this.width=Vi(ge,e),this.rotation=Ni(ge,e),this.height&&(this.height=0)}__updatePath(){const e=this.__,t=e.path=[];e.points?zi(t,e.points,e.curve,e.closed):(Wi(t,0,0),Ii(t,this.width,0))}};r([w(Ne)],I.prototype,"__",void 0),r([Gt("center")],I.prototype,"strokeAlign",void 0),r([c(0)],I.prototype,"height",void 0),r([R()],I.prototype,"points",void 0),r([R(0)],I.prototype,"curve",void 0),r([R(!1)],I.prototype,"closed",void 0),I=r([x()],I);const{sin:Ui,cos:Ki,PI:ve}=Math,{moveTo:$i,lineTo:ji,closePath:Yi,drawPoints:Xi}=Ct,ye=I.prototype;let N=class extends d{get __tag(){return"Polygon"}__updatePath(){const e=this.__,t=e.path=[];if(e.points)Xi(t,e.points,e.curve,!0);else{const{width:i,height:s,sides:a}=e,o=i/2,n=s/2;$i(t,o,0);for(let h=1;h<a;h++)ji(t,o+o*Ui(2*h*ve/a),n-n*Ki(2*h*ve/a));Yi(t)}}__updateRenderPath(){}__updateBoxBounds(){}};r([w(Ri)],N.prototype,"__",void 0),r([R(3)],N.prototype,"sides",void 0),r([R()],N.prototype,"points",void 0),r([R(0)],N.prototype,"curve",void 0),r([b(ye.__updateRenderPath)],N.prototype,"__updateRenderPath",null),r([b(ye.__updateBoxBounds)],N.prototype,"__updateBoxBounds",null),N=r([Lt(),x()],N);const{sin:Gi,cos:qi,PI:fe}=Math,{moveTo:Ji,lineTo:Zi,closePath:Qi}=Ct;let ct=class extends d{get __tag(){return"Star"}__updatePath(){const{width:e,height:t,corners:i,innerRadius:s}=this.__,a=e/2,o=t/2,n=this.__.path=[];Ji(n,a,0);for(let h=1;h<2*i;h++)Zi(n,a+(h%2==0?a:a*s)*Gi(h*fe/i),o-(h%2==0?o:o*s)*qi(h*fe/i));Qi(n)}};r([w(Pi)],ct.prototype,"__",void 0),r([R(5)],ct.prototype,"corners",void 0),r([R(.382)],ct.prototype,"innerRadius",void 0),ct=r([x()],ct);let Rt=class extends q{get __tag(){return"Image"}get ready(){const{image:e}=this;return e&&e.ready}get image(){const{fill:e}=this.__;return Tt(e)&&e[0].image}};r([w(bi)],Rt.prototype,"__",void 0),r([c("")],Rt.prototype,"url",void 0),Rt=r([x()],Rt);let W=class extends q{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(e){super(e),this.canvas=D.canvas(this.__),e&&e.url&&this.drawImage(e.url)}drawImage(e){new hi({url:e}).load(t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new se(se.LOADED,{image:t}))})}draw(e,t,i,s){const a=new Nt(e.worldTransform).invert(),o=new Nt;t&&o.translate(t.x,t.y),i&&(bt(i)?o.scale(i):o.scale(i.x,i.y)),s&&o.rotate(s),a.multiplyParent(o),e.__render(this.canvas,{matrix:a.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(e,t){const{width:i,height:s}=this.__,{view:a}=this.canvas;e.drawImage(a,0,0,a.width,a.height,0,0,i,s)}__updateSize(){const{canvas:e}=this;if(e){const{smooth:t,safeResize:i}=this.__;e.resize(this.__,i),e.smooth!==t&&(e.smooth=t)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};r([w(Ci)],W.prototype,"__",void 0),r([lt(100)],W.prototype,"width",void 0),r([lt(100)],W.prototype,"height",void 0),r([lt(1)],W.prototype,"pixelRatio",void 0),r([lt(!0)],W.prototype,"smooth",void 0),r([S(!1)],W.prototype,"safeResize",void 0),r([lt()],W.prototype,"contextSettings",void 0),W=r([x()],W);const{copyAndSpread:ts,includes:es,spread:is,setList:ss}=Z;let g=class extends d{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const e=this.__,{lineHeight:t,letterSpacing:i,fontFamily:s,fontSize:a,fontWeight:o,italic:n,textCase:h,textOverflow:_,padding:p}=e;e.__lineHeight=ae.number(t,a),e.__letterSpacing=ae.number(i,a),e.__padding=p?kt.fourNumber(p):void 0,e.__baseLine=e.__lineHeight-(e.__lineHeight-.7*a)/2,e.__font=`${n?"italic ":""}${h==="small-caps"?"small-caps ":""}${o!=="normal"?o+" ":""}${a||12}px ${s||"caption"}`,e.__clipText=_!=="show"&&!e.__autoSize,e.__textDrawData=ui.getDrawData((e.__isPlacehold=e.placeholder&&e.text==="")?e.placeholder:e.text,this.__)}__updateBoxBounds(){const e=this.__,t=this.__layout,{fontSize:i,italic:s,padding:a,__autoWidth:o,__autoHeight:n}=e;this.__updateTextDrawData();const{bounds:h}=e.__textDrawData,_=t.boxBounds;if(t.contentBounds=h,e.__lineHeight<i&&is(h,i/2),o||n){if(_.x=o?h.x:0,_.y=n?h.y:0,_.width=o?h.width:e.width,_.height=n?h.height:e.height,a){const[p,u,f,M]=e.__padding;o&&(_.x-=M,_.width+=u+M),n&&(_.y-=p,_.height+=f+p)}this.__updateNaturalSize()}else super.__updateBoxBounds();s&&(_.width+=.16*i),P.stintSet(this,"isOverflow",!es(_,h)),this.isOverflow?(ss(e.__textBoxBounds={},[_,h]),t.renderChanged=!0):e.__textBoxBounds=_}__onUpdateSize(){this.__box&&this.__box.__onUpdateSize(),super.__onUpdateSize()}__updateRenderSpread(){let e=super.__updateRenderSpread();return e||(e=this.isOverflow?1:0),e}__updateRenderBounds(){const{renderBounds:e,renderSpread:t}=this.__layout;ts(e,this.__.__textBoxBounds,t),this.__box&&(this.__box.__layout.renderBounds=e)}__drawRenderPath(e){e.font=this.__.__font}__draw(e,t,i){const s=this.__box;s&&(s.__nowWorld=this.__nowWorld,s.__draw(e,t,i)),this.textEditing&&!t.exporting||super.__draw(e,t,i)}__drawShape(e,t){t.shape&&this.__box&&this.__box.__drawShape(e,t),super.__drawShape(e,t)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};r([w(ki)],g.prototype,"__",void 0),r([c(0)],g.prototype,"width",void 0),r([c(0)],g.prototype,"height",void 0),r([A()],g.prototype,"boxStyle",void 0),r([S(!1)],g.prototype,"resizeFontSize",void 0),r([A("#000000")],g.prototype,"fill",void 0),r([Gt("outside")],g.prototype,"strokeAlign",void 0),r([Y("all")],g.prototype,"hitFill",void 0),r([c("")],g.prototype,"text",void 0),r([c("")],g.prototype,"placeholder",void 0),r([c("caption")],g.prototype,"fontFamily",void 0),r([c(12)],g.prototype,"fontSize",void 0),r([c("normal")],g.prototype,"fontWeight",void 0),r([c(!1)],g.prototype,"italic",void 0),r([c("none")],g.prototype,"textCase",void 0),r([c("none")],g.prototype,"textDecoration",void 0),r([c(0)],g.prototype,"letterSpacing",void 0),r([c({type:"percent",value:1.5})],g.prototype,"lineHeight",void 0),r([c(0)],g.prototype,"paraIndent",void 0),r([c(0)],g.prototype,"paraSpacing",void 0),r([c("x")],g.prototype,"writingMode",void 0),r([c("left")],g.prototype,"textAlign",void 0),r([c("top")],g.prototype,"verticalAlign",void 0),r([c(!0)],g.prototype,"autoSizeAlign",void 0),r([c("normal")],g.prototype,"textWrap",void 0),r([c("show")],g.prototype,"textOverflow",void 0),r([A(!1)],g.prototype,"textEditing",void 0),g=r([x()],g);let yt=class extends d{get __tag(){return"Path"}};r([w(Si)],yt.prototype,"__",void 0),r([Gt("center")],yt.prototype,"strokeAlign",void 0),yt=r([x()],yt);let Pt=class extends F{get __tag(){return"Pen"}setStyle(e){const t=this.pathElement=new yt(e);return this.pathStyle=e,this.__path=t.path||(t.path=[]),this.add(t),this}beginPath(){return this}moveTo(e,t){return this}lineTo(e,t){return this}bezierCurveTo(e,t,i,s,a,o){return this}quadraticCurveTo(e,t,i,s){return this}closePath(){return this}rect(e,t,i,s){return this}roundRect(e,t,i,s,a){return this}ellipse(e,t,i,s,a,o,n,h){return this}arc(e,t,i,s,a,o){return this}arcTo(e,t,i,s,a){return this}drawEllipse(e,t,i,s,a,o,n,h){return this}drawArc(e,t,i,s,a,o){return this}drawPoints(e,t,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};r([w(Ei)],Pt.prototype,"__",void 0),r([(e,t)=>{Te(e,t,{get(){return this.__path}})}],Pt.prototype,"path",void 0),Pt=r([mt(oi,["set","path","paint"]),x()],Pt);function H(e,t,i,s){var a,o=arguments.length,n=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(o<3?a(n):o>3?a(t,i,n):a(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n}let me=class extends G{get __tag(){return"App"}get isApp(){return!0}constructor(e,t){super(e,t)}init(e,t){if(super.init(e,t),e){const{ground:i,tree:s,sky:a,editor:o}=e;i&&(this.ground=this.addLeafer(i)),(s||o)&&(this.tree=this.addLeafer(s||{type:e.type||"design"})),(a||o)&&(this.sky=this.addLeafer(a)),o&&D.editor(o,this)}}__setApp(){const{canvas:e}=this,{realCanvas:t,view:i}=this.config;t||i===this.canvas.view||!e.parentView?this.realCanvas=!0:e.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(e=>e.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(e=>e.start())}stop(){this.forEach(e=>e.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(e=>e.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(e=>e.lockLayout())}forceRender(e,t){this.forEach(i=>i.forceRender(e,t))}addLeafer(e){const t=new G(e);return this.add(t),t}add(e,t){if(!e.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(e,t),10);e.init(this.__getChildConfig(e.userConfig),this)}super.add(e,t),qt(t)||(e.canvas.childIndex=t),this.__listenChildEvents(e)}forEach(e){this.children.forEach(e)}__onCreated(){this.created=this.children.every(e=>e.created)}__onReady(){this.children.every(e=>e.ready)&&super.__onReady()}__onViewReady(){this.children.every(e=>e.viewReady)&&super.__onViewReady()}__onChildRenderEnd(e){this.renderer.addBlock(e.renderBounds),this.viewReady&&this.renderer.update()}__render(e,t){e.context&&this.forEach(i=>t.matrix?i.__render(e,t):e.copyWorld(i.canvas,t.bounds))}__onResize(e){this.forEach(t=>t.resize(e)),super.__onResize(e)}updateLayout(){this.forEach(e=>e.updateLayout())}__getChildConfig(e){const t=Object.assign({},this.config);return t.hittable=t.realCanvas=void 0,e&&P.assign(t,e),this.autoLayout&&P.copyAttrs(t,this,V),t.view=this.realCanvas?void 0:this.view,t.fill=void 0,t}__listenChildEvents(e){e.once([[zt.END,this.__onReady,this],[nt.START,this.__onCreated,this],[nt.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(e.on_(nt.END,this.__onChildRenderEnd,this))}};me=H([x()],me);const St={},ht={isHoldSpaceKey:()=>ht.isHold("Space"),isHold:e=>St[e],isHoldKeys:(e,t)=>t?e(t):void 0,setDownCode(e){St[e]||(St[e]=!0)},setUpCode(e){St[e]=!1}},C={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(e){e.buttons||(e.buttons=1)},left:e=>e.buttons===1,right:e=>e.buttons===2,middle:e=>e.buttons===4};class Ve extends di{get spaceKey(){return ht.isHoldSpaceKey()}get left(){return C.left(this)}get right(){return C.right(this)}get middle(){return C.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}isHoldKeys(t){return ht.isHoldKeys(t,this)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,i){We.changeName(t,i)}}let l=class extends Ve{};l.POINTER="pointer",l.BEFORE_DOWN="pointer.before_down",l.BEFORE_MOVE="pointer.before_move",l.BEFORE_UP="pointer.before_up",l.DOWN="pointer.down",l.MOVE="pointer.move",l.UP="pointer.up",l.OVER="pointer.over",l.OUT="pointer.out",l.ENTER="pointer.enter",l.LEAVE="pointer.leave",l.TAP="tap",l.DOUBLE_TAP="double_tap",l.CLICK="click",l.DOUBLE_CLICK="double_click",l.LONG_PRESS="long_press",l.LONG_TAP="long_tap",l.MENU="pointer.menu",l.MENU_TAP="pointer.menu_tap",l=H([K()],l);const gt={};let v=class extends l{static setList(e){this.list=e instanceof L?e:new L(e)}static setData(e){this.data=e}static getValidMove(e,t,i,s=!0){const a=e.getLocalPoint(i,null,!0);return J.move(a,t.x-e.x,t.y-e.y),s&&this.limitMove(e,a),Ut.axisMove(e,a),a}static limitMove(e,t){Ut.limitMove(e,t)}getPageMove(e){return this.assignMove(e),this.current.getPagePoint(gt,null,!0)}getInnerMove(e,t){return e||(e=this.current),this.assignMove(t),e.getInnerPoint(gt,null,!0)}getLocalMove(e,t){return e||(e=this.current),this.assignMove(t),e.getLocalPoint(gt,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(e){return this.getInnerMove(e,!0)}getLocalTotal(e){return this.getLocalMove(e,!0)}getPageBounds(){const e=this.getPageTotal(),t=this.getPagePoint(),i={};return Z.set(i,t.x-e.x,t.y-e.y,e.x,e.y),Z.unsign(i),i}assignMove(e){gt.x=e?this.totalX:this.moveX,gt.y=e?this.totalY:this.moveY}};v.BEFORE_DRAG="drag.before_drag",v.START="drag.start",v.DRAG="drag",v.END="drag.end",v.OVER="drag.over",v.OUT="drag.out",v.ENTER="drag.enter",v.LEAVE="drag.leave",v=H([K()],v);let ft=class extends l{static setList(e){v.setList(e)}static setData(e){v.setData(e)}};ft.DROP="drop",ft=H([K()],ft);let O=class extends v{};O.BEFORE_MOVE="move.before_move",O.START="move.start",O.MOVE="move",O.END="move.end",O=H([K()],O);let it=class extends l{};it.BEFORE_ROTATE="rotate.before_rotate",it.START="rotate.start",it.ROTATE="rotate",it.END="rotate.end",it=H([K()],it);let T=class extends v{};T.SWIPE="swipe",T.LEFT="swipe.left",T.RIGHT="swipe.right",T.UP="swipe.up",T.DOWN="swipe.down",T=H([K()],T);let st=class extends l{};st.BEFORE_ZOOM="zoom.before_zoom",st.START="zoom.start",st.ZOOM="zoom",st.END="zoom.end",st=H([K()],st);let k=class extends Ve{};k.BEFORE_DOWN="key.before_down",k.BEFORE_UP="key.before_up",k.DOWN="key.down",k.HOLD="key.hold",k.UP="key.up",k=H([K()],k);const Zt={getDragEventData:(e,t,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-t.x,moveY:i.y-t.y,totalX:i.x-e.x,totalY:i.y-e.y}),getDropEventData:(e,t,i)=>Object.assign(Object.assign({},e),{list:t,data:i}),getSwipeDirection:e=>e<-45&&e>-135?T.UP:e>45&&e<135?T.DOWN:e<=45&&e>=-45?T.RIGHT:T.LEFT,getSwipeEventData:(e,t,i)=>Object.assign(Object.assign({},i),{moveX:t.moveX,moveY:t.moveY,totalX:i.x-e.x,totalY:i.y-e.y,type:as.getSwipeDirection(J.getAngle(e,i))}),getBase(e){const t=e.button===1?4:e.button;return{altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,buttons:qt(e.buttons)?1:e.buttons===0?t:e.buttons,origin:e}},pathHasEventType(e,t){const{list:i}=e;for(let s=0,a=i.length;s<a;s++)if(i[s].hasEvent(t))return!0;return!1},filterPathByEventType(e,t){const i=new L,{list:s}=e;for(let a=0,o=s.length;a<o;a++)s[a].hasEvent(t)&&i.add(s[a]);return i},pathCanDrag:e=>e&&e.list.some(t=>Vt.draggable(t)||!t.isLeafer&&t.hasEvent(v.DRAG)),pathHasOutside:e=>e&&e.list.some(t=>t.isOutside)},as=Zt,we=new L,{getDragEventData:Ft,getDropEventData:rs,getSwipeEventData:os}=Zt;class ns{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Ft(t,t,t),this.canAnimate=this.canDragOut=!0}getList(t,i){const{proxy:s}=this.interaction.selector,a=s&&s.list.length,o=v.list||this.draggableList||we;return this.dragging&&(a?t?we:new L(i?[...s.list,...s.dragHoverExclude]:s.list):o)}checkDrag(t,i){const{interaction:s}=this;if(this.moving&&t.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(O.START,this.dragData)),this.moving||this.dragStart(t,i),this.drag(t)}dragStart(t,i){this.dragging||(this.dragging=i&&C.left(t),this.dragging&&(this.interaction.emit(v.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(i=>this.dragStartPoints[i.innerId]={x:i.x,y:i.y})}getDraggableList(t){let i;for(let s=0,a=t.length;s<a;s++)if(i=t.list[s],Vt.draggable(i)){this.draggableList=new L(i);break}}drag(t){const{interaction:i,dragData:s,downData:a}=this,{path:o,throughPath:n}=a;this.dragData=Ft(a,s,t),n&&(this.dragData.throughPath=n),this.dragData.path=o,this.moving?(this.dragData.moveType="drag",i.emit(O.BEFORE_MOVE,this.dragData),i.emit(O.MOVE,this.dragData)):this.dragging&&(this.dragReal(),i.emit(v.BEFORE_DRAG,this.dragData),i.emit(v.DRAG,this.dragData))}dragReal(t){const{interaction:i}=this,{running:s}=i,a=this.realDraggableList;if(a.length&&s){const{totalX:o,totalY:n}=this.dragData,{dragLimitAnimate:h}=i.p,_=!h||!!t;a.forEach(p=>{if(p.draggable){const u=ot(p.draggable),f=v.getValidMove(p,this.dragStartPoints[p.innerId],{x:o,y:n},_||u);h&&!u&&t?Vt.animateMove(p,f,bt(h)?h:.3):p.move(f)}})}}dragOverOrOut(t){const{interaction:i}=this,{dragOverPath:s}=this,{path:a}=t;this.dragOverPath=a,s?a.indexAt(0)!==s.indexAt(0)&&(i.emit(v.OUT,t,s),i.emit(v.OVER,t,a)):i.emit(v.OVER,t,a)}dragEnterOrLeave(t){const{interaction:i}=this,{dragEnterPath:s}=this,{path:a}=t;i.emit(v.LEAVE,t,s,a),i.emit(v.ENTER,t,a,s),this.dragEnterPath=a}dragEnd(t,i){(this.dragging||this.moving)&&(this.checkDragEndAnimate(t,i)||this.dragEndReal(t))}dragEndReal(t){const{interaction:i,downData:s,dragData:a}=this;t||(t=a);const{path:o,throughPath:n}=s,h=Ft(s,t,t);if(n&&(h.throughPath=n),h.path=o,this.moving&&(this.moving=!1,h.moveType="drag",i.emit(O.END,h)),this.dragging){const _=this.getList();this.dragging=!1,i.p.dragLimitAnimate&&this.dragReal(!0),i.emit(v.END,h),this.swipe(t,s,a,h),this.drop(t,_,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(t,i,s,a){const{interaction:o}=this;if(J.getDistance(i,t)>o.config.pointer.swipeDistance){const n=os(i,s,a);this.interaction.emit(n.type,n)}}drop(t,i,s){const a=rs(t,i,v.data);a.path=s,this.interaction.emit(ft.DROP,a),this.interaction.emit(v.LEAVE,t,s)}dragReset(){v.list=v.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragEndAnimate(t,i){return!1}animate(t,i){}checkDragOut(t){}autoMoveOnDragOut(t){}autoMoveCancel(){}destroy(){this.dragReset()}}const hs=Xt.get("emit"),ds=["move","zoom","rotate","key"];function xe(e,t,i,s,a){if(ds.some(o=>t.startsWith(o))&&e.__.hitChildren&&!Ue(e,a)){let o;for(let n=0,h=e.children.length;n<h;n++)o=e.children[n],!i.path.has(o)&&o.__.hittable&&$t(o,t,i,s,a)}}function $t(e,t,i,s,a){if(e.destroyed)return!1;if(e.__.hitSelf&&!Ue(e,a)&&(oe.updateEventStyle&&!s&&oe.updateEventStyle(e,t),e.hasEvent(t,s))){i.phase=s?1:e===i.target?2:3;const o=We.get(t,i);if(e.emitEvent(o,s),o.isStop)return!0}return!1}function Ue(e,t){return t&&t.has(e)}const _s={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Mt,pathCanDrag:ls,pathHasOutside:Re}=Zt;class ms{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&C.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&C.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&ht.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,i,s,a){this.config=P.clone(_s),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=i,this.selector=s,this.defaultPath=new L(t),this.createTransformer(),this.dragger=new ns(this),a&&(this.config=P.default(a,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,i){t||(t=this.hoverData),t&&(C.defaultLeft(t),this.updateDownData(t),this.checkPath(t,i),this.downTime=Date.now(),this.emit(l.BEFORE_DOWN,t),this.emit(l.DOWN,t),C.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitRightTap=C.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:i}=this;i&&C.defaultLeft(t),(this.canvas.bounds.hitPoint(t)||i)&&(this.pointerMoveReal(t),i&&this.dragger.checkDragOut(t))}pointerMoveReal(t){if(this.emit(l.BEFORE_MOVE,t,this.defaultPath),this.downData){const i=J.getDistance(this.downData,t)>this.p.dragDistance;i&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(t,i)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(l.MOVE,t),this.pointerHover(t),this.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:i}=this;if(t||(t=i),!i)return;C.defaultLeft(t),t.multiTouch=i.multiTouch,this.findPath(t);const s=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(i.path.list),this.checkPath(t),this.downData=null,this.emit(l.BEFORE_UP,t),this.emit(l.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}menu(t){this.findPath(t),this.emit(l.MENU,t),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(t)}menuTap(t){this.waitRightTap&&this.waitMenuTap&&(this.emit(l.MENU_TAP,t),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(t){}zoom(t){}rotate(t){}transformEnd(){}wheel(t){}multiTouch(t,i){}keyDown(t){if(!this.config.keyEvent)return;this.emit(k.BEFORE_DOWN,t,this.defaultPath);const{code:i}=t;this.downKeyMap[i]||(this.downKeyMap[i]=!0,ht.setDownCode(i),this.emit(k.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(k.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;this.emit(k.BEFORE_UP,t,this.defaultPath);const{code:i}=t;this.downKeyMap[i]=!1,ht.setUpCode(i),this.emit(k.UP,t,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover(t){!this.canHover||this.dragging&&!this.p.dragHover||(t.path||(t.path=new L),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:i}=t,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(l.OUT,t,s),this.emit(l.OVER,t,i)):this.emit(l.OVER,t,i)}pointerEnterOrLeave(t){let{path:i}=t;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach(a=>i.add(a)));const{enterPath:s}=this;this.enterPath=i,this.emit(l.LEAVE,t,s,i),this.emit(l.ENTER,t,i,s)}touchLeave(t){t.pointerType==="touch"&&this.enterPath&&(this.emit(l.LEAVE,t),this.dragger.dragging&&this.emit(ft.LEAVE,t))}tap(t){const{pointer:i}=this.config,s=this.longTap(t);if(!i.tapMore&&s||!this.waitTap)return;i.tapMore&&this.emitTap(t);const a=Date.now()-this.downTime,o=[l.DOUBLE_TAP,l.DOUBLE_CLICK].some(n=>Mt(t.path,n));a<i.tapTime+50&&o?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(t))},i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,i){const{hitRadius:s,through:a}=this.p,{bottomList:o,target:n}=this;U.backgrounder||t.origin||n&&n.updateLayout();const h=this.selector.getByPoint(t,s,Object.assign({bottomList:o,name:t.type},i||{through:a}));return h.throughPath&&(t.throughPath=h.throughPath),t.path=h.path,h.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const i=this.target.app;return!(!i||!i.isApp)&&i.editor&&!t.path.has(i.editor)&&t.path.has(i.tree)&&!t.target.syncEventer}checkPath(t,i){(i||this.moveMode&&!Re(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||this.m.drag==="auto"&&!ls(t.path))&&!Re(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,i,s){const{downData:a}=this;!t&&a&&(t=a),t&&(this.findPath(t,i),s&&a&&t.path.addList(a.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(!1,!0),name:l.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let i,s;const{path:a}=t;for(let o=0,n=a.length;o<n&&(i=a.list[o],s=i.syncEventer&&i.syncEventer.cursor||i.cursor,!s);o++);this.setCursor(s)}setCursor(t){this.cursor=t}getLocal(t,i){const s=this.canvas.getClientBounds(i),a={x:t.clientX-s.x,y:t.clientY-s.y},{bounds:o}=this.canvas;return a.x*=o.width/s.width,a.y*=o.height/s.height,this.p.snap&&J.round(a),a}emitTap(t){this.emit(l.TAP,t),this.emit(l.CLICK,t)}emitDoubleTap(t){this.emit(l.DOUBLE_TAP,t),this.emit(l.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(l.LONG_PRESS,t)},this.p.longPressTime)}longTap(t){let i;return this.longPressed&&(this.emit(l.LONG_TAP,t),(Mt(t.path,l.LONG_TAP)||Mt(t.path,l.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:t}=this.m;this.shrinkCanvasBounds=new Oe(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(bt(t)?t:2))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Fe.RESIZE,this.__onResize,this)],t.once(E.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,i,s,a){this.running&&function(o,n,h,_){if(!h&&!n.path)return;let p;n.type=o,h?n=Object.assign(Object.assign({},n),{path:h}):h=n.path,n.target=h.indexAt(0);try{for(let u=h.length-1;u>-1;u--){if(p=h.list[u],$t(p,o,n,!0,_))return;p.isApp&&xe(p,o,n,!0,_)}for(let u=0,f=h.length;u<f;u++)if(p=h.list[u],p.isApp&&xe(p,o,n,!1,_),$t(p,o,n,!1,_))return}catch(u){hs.error(u)}}(t,i,s,a)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class ps{static set(t,i){this.custom[t]=i}static get(t){return this.custom[t]}}ps.custom={};class ws extends Ae{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new L,this.pixelList=new L}getPixelType(t,i){return this.__autoClear(),this.pixelList.add(t),D.hitCanvas(i)}getPathType(t){return this.__autoClear(),this.pathList.add(t),D.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(i=>{i.__hitCanvas&&(i.__hitCanvas.destroy(),i.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}U.getSelector=function(e){return e.leafer?e.leafer.selector:U.selector||(U.selector=D.selector())};const{toInnerRadiusPointOf:us,copy:Pe,setRadius:Se}=J,{hitRadiusPoint:cs,hitPoint:gs}=Z,vt={},at={},rt=Yt.prototype;rt.hit=function(e,t=0){this.updateLayout(),Pe(at,e),Se(at,t);const i=this.__world;return!!(t?cs(i,at):gs(i,at))&&(this.isBranch?U.getSelector(this).hitPoint(Object.assign({},at),t,{target:this}):this.__hitWorld(at))},rt.__hitWorld=function(e){const t=this.__;if(!t.hitSelf)return!1;const i=this.__world,s=this.__layout,a=i.width<10&&i.height<10;if(t.hitRadius&&(Pe(vt,e),Se(e=vt,t.hitRadius)),us(e,i,vt),t.hitBox||a){if(Z.hitRadiusPoint(s.boxBounds,vt))return!0;if(a)return!1}return!s.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),s.boundsChanged||(s.hitCanvasChanged=!1)),this.__hit(vt)},rt.__hitFill=function(e){const t=this.__hitCanvas;return t&&t.hitFill(e,this.__.windingRule)},rt.__hitStroke=function(e,t){const i=this.__hitCanvas;return i&&i.hitStroke(e,t)},rt.__hitPixel=function(e){const t=this.__hitCanvas;return t&&t.hitPixel(e,this.__layout.renderBounds,t.hitScale)},rt.__drawHitPath=function(e){e&&this.__drawRenderPath(e)};const vs=new Nt,Ee=d.prototype;Ee.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const e=this.leafer||this.parent&&this.parent.leafer;if(!e)return;const t=this.__,{hitCanvasManager:i}=e,s=(t.__isAlphaPixelFill||t.__isCanvas)&&t.hitFill==="pixel",a=t.__isAlphaPixelStroke&&t.hitStroke==="pixel",o=s||a;this.__hitCanvas||(this.__hitCanvas=o?i.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):i.getPathType(this));const n=this.__hitCanvas;if(o){const{renderBounds:h}=this.__layout,_=U.image.hitCanvasSize,p=n.hitScale=X.set(0,0,_,_).getFitMatrix(h).a,{x:u,y:f,width:M,height:Ke}=X.set(h).scale(p);n.resize({width:M,height:Ke,pixelRatio:1}),n.clear(),Ht.patternLocked=!0,this.__renderShape(n,{matrix:vs.setWith(this.__world).scaleWith(1/p).invertWith().translate(-u,-f),ignoreFill:!s,ignoreStroke:!a}),Ht.patternLocked=!1,n.resetTransform(),t.__isHitPixel=!0}else t.__isHitPixel&&(t.__isHitPixel=!1);this.__drawHitPath(n),n.setStrokeOptions(t)},Ee.__hit=function(e){if(this.__box&&this.__box.__hit(e))return!0;const t=this.__;if(t.__isHitPixel&&this.__hitPixel(e))return!0;const{hitFill:i}=t,s=(t.fill||t.__isCanvas)&&(i==="path"||i==="pixel"&&!(t.__isAlphaPixelFill||t.__isCanvas))||i==="all";if(s&&this.__hitFill(e))return!0;const{hitStroke:a,__maxStrokeWidth:o}=t,n=t.stroke&&(a==="path"||a==="pixel"&&!t.__isAlphaPixelStroke)||a==="all";if(!s&&!n)return!1;const h=2*e.radiusX;let _=h;if(n)switch(t.strokeAlign){case"inside":if(_+=2*o,!s&&this.__hitFill(e)&&this.__hitStroke(e,_))return!0;_=h;break;case"center":_+=o;break;case"outside":if(_+=2*o,!s){if(!this.__hitFill(e)&&this.__hitStroke(e,_))return!0;_=h}}return!!_&&this.__hitStroke(e,_)};const De=d.prototype,ke=q.prototype,be=m.prototype;ke.__updateHitCanvas=be.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?De.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},ke.__hitFill=be.__hitFill=function(e){return this.__hitCanvas?De.__hitFill.call(this,e):Z.hitRadiusPoint(this.__layout.boxBounds,e)},g.prototype.__drawHitPath=function(e){const{__lineHeight:t,fontSize:i,__baseLine:s,__letterSpacing:a,__textDrawData:o}=this.__;e.beginPath(),a<0?this.__drawPathByBox(e):o.rows.forEach(n=>e.rect(n.x,n.y-s,n.width,t<i?i:t))},F.prototype.pick=function(e,t){return t||(t=_i),this.updateLayout(),U.getSelector(this).getByPoint(e,t.hitRadius||0,Object.assign(Object.assign({},t),{target:this}))};const Wt=li.prototype;Wt.hitFill=function(e,t){return t?this.context.isPointInPath(e.x,e.y,t):this.context.isPointInPath(e.x,e.y)},Wt.hitStroke=function(e,t){return this.strokeWidth=t,this.context.isPointInStroke(e.x,e.y)},Wt.hitPixel=function(e,t,i=1){let{x:s,y:a,radiusX:o,radiusY:n}=e;t&&(s-=t.x,a-=t.y),X.set(s-o,a-n,2*o,2*n).scale(i).ceil();const{data:h}=this.context.getImageData(X.x,X.y,X.width||1,X.height||1);for(let _=0,p=h.length;_<p;_+=4)if(h[_+3]>0)return!0;return h[3]>0};export{Zt as $,y as A,gi as C,vi as E,re as F,I as L,fs as P,ui as R,N as X,Rt as Z,ms as _,q as a,g as b,G as g,Ie as k,ws as m,F as u,ps as v};
