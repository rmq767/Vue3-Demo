import{l as x,c as V}from"./element-plus-gomRs06A.js";import{s as O,B as H,d as U,e as F,r as K,w as q,l as G,n as M,c as D,a as _,S as B,T as Q,V as P,Q as $,K as X,aw as Y,ax as j,o as z,X as R,W as N,u as A}from"./@vue-1pEateLc.js";import{l as p}from"./leaflet-dgfGk-q1.js";import"./leaflet.chinatmsproviders-MeioCgZa.js";import{p as J,q as W}from"./@element-plus-GFHZwatb.js";import{_ as ee}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const te=""+new URL("../png/image-BQhIfE8b.png",import.meta.url).href,oe=(f,r)=>{const e=O(null),u=p.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),g=p.layerGroup([u]);let C=[],v=[];const S=()=>{const t=p.latLng(-90,-180),n=p.latLng(90,180),a=p.latLngBounds(t,n),s=p.canvas();e.value=new p.Map(f,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[g],maxBounds:a,renderer:s,crs:p.CRS.EPSG3857,zoomControl:!1,doubleClickZoom:!1})},I=t=>{var n;if(t!=null&&t.length){const a=[];t.forEach(o=>{var b,m,E;a.push({lng:o.pointData[0].lon,lat:o.pointData[0].lat});const l=p.divIcon({html:`<div class='tooltip-content'>${o.name}</div>`,className:(b=r.value)!=null&&b.includes(o.businessId)?"tooltip":""}),c=p.marker([o.pointData[0].lat,o.pointData[0].lon],{icon:l,data:{name:o.name,id:o.businessId,checked:(m=r.value)==null?void 0:m.includes(o.businessId)}}).addTo(e.value);v.push(c),c.on("click",h);const d=p.circleMarker({lat:o.pointData[0].lat,lng:o.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:8,data:{name:o.name,id:o.businessId,checked:(E=r.value)==null?void 0:E.includes(o.businessId)},icon:l}).addTo(e.value);debugger;C.push(d),d.on("click",h)});const s=p.latLngBounds(a);(n=e.value)==null||n.fitBounds(s,{padding:[10,10]})}},h=t=>{const n=t.target.options.data,{id:a}=n,s=v.find(c=>c.options.data.id===a),o=C.find(c=>c.options.data.id===a),l=!n.checked;if(l&&r.value.length+1>3){x.warning("最多只能选择3口井");return}if(!l&&r.value.length-1===0){x.warning("最少选择1口井");return}s.options.data.checked=l,o.options.data.checked=l,l?y(s,n,!0):y(s,n,!1)},y=(t,n,a=!1)=>{const{id:s}=n,o=t.options.icon;if(a)o.options.className="tooltip",r.value.push(s);else{o.options.className="";const l=r.value.indexOf(s);l>-1&&r.value.splice(l,1)}t.setIcon(o)},i=()=>{e.value&&(C.forEach(t=>{t.off("click",h)}),v.forEach(t=>{t.off("click",h)}),C=[],v=[],e.value.remove())};return H(()=>{i()}),{map:e,checked:r,drawPoint:I,initMap:S,destroyMap:i}},ae=(f,r)=>{const e=O(),u={max:1e7,min:100},g=()=>{var i;e.value=new Cesium.Viewer(f,{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),e.value.scene.screenSpaceCameraController.minimumZoomDistance=u.min,e.value.scene.screenSpaceCameraController.maximumZoomDistance=u.max,e.value.cesiumWidget.creditContainer.style.display="none",e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),e.value.resolutionScale=window.devicePixelRatio,e.value.scene.postProcessStages.fxaa.enabled=!0,e.value.screenSpaceEventHandler.setInputAction(()=>{},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.value.screenSpaceEventHandler.setInputAction(t=>{var a;const n=(a=e.value)==null?void 0:a.scene.pick(t.endPosition);n&&n.id?e.value._container.style.cursor="pointer":e.value._container.style.cursor="default"},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.value.screenSpaceEventHandler.setInputAction(t=>{var a,s;const n=(a=e.value)==null?void 0:a.scene.pick(t.position);if(n&&n.id){const o=n.id,l=o.properties.checked.valueOf(),c=o.id;if(l&&r.value.length-1===0){x.warning("最少选择1口井");return}if(!l&&r.value.length+1>3){x.warning("最多只能选择3口井");return}l?(r.value.splice(r.value.indexOf(c),1),o.properties.checked=!1,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.BLACK),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.WHITE.withAlpha(.8))):(r.value.push(c),o.properties.checked=!0,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.WHITE),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.fromCssColorString("#409eff").withAlpha(.8))),(s=e.value)==null||s.scene.requestRender()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),((i=e.value)==null?void 0:i.scene.screenSpaceCameraController).zoomEventTypes=[],document.addEventListener("wheel",y,{passive:!1})},C=i=>{var a;const t=i.map(s=>({lon:s.pointData[0].lon,lat:s.pointData[0].lat})),n=v(t);(a=e.value)==null||a.camera.setView({destination:n})},v=i=>{let t=Cesium.Math.toRadians(1/0),n=Cesium.Math.toRadians(-1/0),a=Cesium.Math.toRadians(1/0),s=Cesium.Math.toRadians(-1/0);return i.forEach(l=>{const c=Cesium.Math.toRadians(l.lon),d=Cesium.Math.toRadians(l.lat);c<t&&(t=c),c>n&&(n=c),d<a&&(a=d),d>s&&(s=d)}),new Cesium.Rectangle(t-.05,a-.05,n+.05,s+.05)},S=i=>{const t=Cesium.Cartesian3.fromDegrees(i.pointData[0].lon,i.pointData[0].lat),n=r.value.includes(i.businessId)?Cesium.Color.WHITE:Cesium.Color.BLACK,a=r.value.includes(i.businessId)?Cesium.Color.fromCssColorString("#409eff").withAlpha(.8):Cesium.Color.WHITE.withAlpha(.8);e.value.entities.add({position:t,name:i.name,id:i.businessId,properties:{checked:r.value.includes(i.businessId)},point:{pixelSize:12,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:i.name,font:"12px",scale:.8,pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:n,backgroundColor:a,showBackground:!0,outlineWidth:0,backgroundPadding:new Cesium.Cartesian2(8,10)}})},I=i=>{i.forEach(t=>{S(t)})},h=()=>{var i,t;document.removeEventListener("wheel",y),(i=e.value)==null||i.entities.removeAll(),(t=e.value)==null||t.destroy(),e.value=void 0},y=i=>{var a,s,o,l;i.preventDefault();const t=Math.sign(i.deltaY),n=5;t>0?(s=e.value)==null||s.camera.zoomOut(((a=e.value)==null?void 0:a.camera.positionCartographic.height)/n):(l=e.value)==null||l.camera.zoomIn(((o=e.value)==null?void 0:o.camera.positionCartographic.height)/n)};return H(()=>{h()}),{viewer:e,init:g,setCameraPosition:C,drawCesiumPoint:I}},ne=f=>(Y("data-v-b806e701"),f=f(),j(),f),se={class:"map"},ie={key:0,id:"map",class:"h-full w-full"},le={key:1,id:"cesium",class:"h-full w-full"},re={class:"action"},ce=ne(()=>_("div",{class:"direction"},[_("span",null,"北"),_("img",{src:te,alt:""})],-1)),ue={class:"trigger"},de={name:""},pe=U({...de,props:{data:{type:Array,default:()=>[]}},emits:["checked"],setup(f,{emit:r}){const e=f,u=F({isCollpased:!1,type:"2d"}),g=K(["1676779130877161474"]),{drawPoint:C,initMap:v,destroyMap:S}=oe("map",g),{init:I,setCameraPosition:h,drawCesiumPoint:y}=ae("cesium",g),i=r;q(()=>g.value,a=>{t(a)},{deep:!0});const t=a=>{const s=[];a.forEach(o=>{let l=0,c=0,d=0,b=0;const m=e.data.find(E=>E.businessId===o);if(m){const E=m.info.map((w,k)=>{if(k===0)return d=w.size,b=w.size,{...w,width:0,height:0};{d=Math.max(w.size,m.info[k-1].size,d),b=Math.min(w.size,m.info[k-1].size,b);const T=w.tvd-m.info[k-1].tvd,L=w.md-m.info[k-1].md;l+=L;const Z=Number((L*L-T*T).toFixed(2));return c+=Z,{...w,width:c,height:l}}});s.push({...m,info:E,length:Number(c.toFixed(2)),distance:Number(l.toFixed(2)),maxSize:d,minSize:b})}}),i("checked",s)},n=()=>{u.type==="3d"?(u.type="2d",S(),M(()=>{v(),C(e.data)})):(u.type="3d",M(()=>{I(),h(e.data),y(e.data)}))};return G(()=>{u.type==="3d"?M(()=>{I(),h(e.data),y(e.data)}):(v(),C(e.data)),t(g.value)}),(a,s)=>{const o=V;return z(),D("div",{class:X(["leaflet-container",{collpased:u.isCollpased}])},[_("div",se,[u.type==="2d"?(z(),D("div",ie)):B("",!0),u.type==="3d"?(z(),D("div",le)):B("",!0)]),_("div",re,[ce,_("div",{class:"type",onClick:n},Q(u.type==="2d"?"3D":"2D"),1)]),_("div",ue,[P(o,{class:"trigger-icon",onClick:s[0]||(s[0]=l=>u.isCollpased=!u.isCollpased)},{default:$(()=>[R(P(A(J),null,null,512),[[N,!u.isCollpased]]),R(P(A(W),null,null,512),[[N,u.isCollpased]])]),_:1})])],2)}}}),Me=ee(pe,[["__scopeId","data-v-b806e701"]]);export{Me as default};
