import{c as z}from"./element-plus-GEy8-a9f.js";import{l as g}from"./leaflet-dgfGk-q1.js";import"./leaflet.chinatmsproviders-MeioCgZa.js";import{s as T,r as X,l as j,B as Y,d as J,e as Q,b as U,c as W,V,Q as H,aw as K,ax as oo,a as to,o as no,u as eo}from"./@vue-1pEateLc.js";import{l as O,p as P,d as $,b as ro,e as so}from"./@turf-VZU31W4K.js";import{V as ao}from"./@element-plus-GFHZwatb.js";import{_ as co}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const io=(u,o)=>{const n=T(null),e=g.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),m=g.layerGroup([e]);let r=null,c=null,p="start",f=null;const t=T([]),l=T([]),v=T([]),L=X(0),w=()=>{const d=g.latLng(-90,-180),s=g.latLng(90,180),a=g.latLngBounds(d,s),i=g.canvas();n.value=new g.Map(u,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[m],maxBounds:a,renderer:i,crs:g.CRS.EPSG3857,zoomControl:!1})},_=()=>{var d;if(o!=null&&o.length){const s=[];if(o.forEach(i=>{s.push({lng:i.pointData[0].lon,lat:i.pointData[0].lat}),g.circleMarker({lat:i.pointData[0].lat,lng:i.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:10}).bindTooltip(i.name,{permanent:!0,direction:"top",className:"my-custom-tooltip"}).addTo(n.value)}),o.length===1){const i=o[0].pointData[0];r=g.polyline([[i.lat-.003,i.lon-.01],[i.lat-.003,i.lon+.01]],{color:"red"}).addTo(n.value),s.push(r.getLatLngs()),D(),k(),console.log(t.value)}const a=g.latLngBounds(s);(d=n.value)==null||d.fitBounds(a,{padding:[10,10]})}},B=()=>{var d,s;(d=n.value)==null||d.on("click",x),(s=n.value)==null||s.on("mousemove",C)},x=d=>{if(p==="start"){r&&(l.value.forEach(a=>{a.remove()}),v.value.forEach(a=>{a.remove()}),r.remove(),c==null||c.remove());const s=d.latlng;f=s,r=g.polyline([s,s],{color:"red",weight:3,dashArray:"5,5"}).addTo(n.value),p="drawing"}else if(p==="drawing"){const s=d.latlng;r==null||r.setLatLngs([f,s]),r==null||r.setStyle({dashArray:void 0}),p="start"}},C=d=>{p==="drawing"&&f&&(r==null||r.setLatLngs([f,d.latlng]))},I=()=>{var d,s;(d=n.value)==null||d.off("click",x),(s=n.value)==null||s.off("mousemove",C)},G=()=>{n.value&&n.value.remove()},D=()=>{if(r){t.value=[];const d=r.getLatLngs().map(a=>[a.lng,a.lat]),s=O(d);o==null||o.forEach((a,i)=>{const h=po([a.pointData[0].lon,a.pointData[0].lat],s.geometry.coordinates[0],s.geometry.coordinates[1]);h&&t.value.push({point:h,...a})}),t.value.length===1||t.value.sort((a,i)=>{const h=E(s,a.point);Reflect.set(a,"distance",h);const y=E(s,i.point);return Reflect.set(i,"distance",y),h-y}),t.value.forEach((a,i)=>{l.value[i]=g.circleMarker([a.point[1],a.point[0]],{stroke:!0,color:"#fff",fillColor:"green",fill:!0,fillOpacity:1,radius:5}).bindTooltip(`${i+1}`,{permanent:!0,direction:"top"}).addTo(n.value)})}};function E(d,s){const a=d.geometry.coordinates[0],i=P(s);return $(a,i,{units:"kilometres"})}function k(){const[d,s]=r==null?void 0:r.getLatLngs();if(c=g.polyline([],{color:"green",weight:1,dashArray:[10,10]}).addTo(n.value),t.value.forEach(a=>{a.info.forEach(h=>{const y=go(h.coordinate,[d.lng,d.lat],[s.lng,s.lat]),A=g.circleMarker([y[1],y[0]],{stroke:!0,color:"#fff",fillColor:"green",fill:!0,fillOpacity:1,radius:5}).bindTooltip(h.type,{permanent:!0,direction:"top"}).addTo(n.value);v.value.push(A),c==null||c.addLatLng([y[1],y[0]])})}),L.value=ro(c.toGeoJSON(),{units:"kilometres"}),c.getLatLngs().length){const a=[];t.value.forEach(i=>{const h=c.getLatLngs().map(M=>[M.lng,M.lat]),y=O(h),A=P([i.pointData[0].lon,i.pointData[0].lat]),Z=fo(y,A),q=P(Z[0].geometry.coordinates);i.info.forEach((M,F)=>{const b=c==null?void 0:c.getLatLngs()[F],S=P([b.lng,b.lat]),N=$(q,S,{units:"kilometres"});Reflect.set(M,"distance",N),a.push(N)})}),L.value=Math.max(...a)}}return j(()=>{w(),_()}),Y(()=>{G()}),{map:n,drawLine:B,nearestPoints:t,getNearestPointOnLine:D,removeLinsener:I,lineLength:L,drawLongLine:k}};function R(u,o){return u[0]*o[0]+u[1]*o[1]}function lo(u,o,n){const e=[n[0]-o[0],n[1]-o[1]],m=[u[0]-o[0],u[1]-o[1]],r=R(m,e)/R(e,e),c=[e[0]*r,e[1]*r];return[o[0]+c[0],o[1]+c[1]]}function uo(u,o,n){const[e,m]=u,[r,c]=o,[p,f]=n;return e>=Math.min(r,p)&&e<=Math.max(r,p)&&m>=Math.min(c,f)&&m<=Math.max(c,f)}function po(u,o,n){const e=lo(u,o,n);return uo(e,o,n)?e:null}function go(u,o,n){const e=[n[0]-o[0],n[1]-o[1]],m=[u[0]-o[0],u[1]-o[1]],r=e[0]*m[0]+e[1]*m[1],c=e[0]*e[0]+e[1]*e[1],p=r/c,f=o[0]+p*e[0],t=o[1]+p*e[1];return[f,t]}function fo(u,o){function n(t,l){return{x:l.geometry.coordinates[0]-t.geometry.coordinates[0],y:l.geometry.coordinates[1]-t.geometry.coordinates[1]}}function e(t,l){return t.x*l.x+t.y*l.y}function m(t,l){return t.x*l.y-t.y*l.x}function r(t,l){const v=e(t,l),L=Math.sqrt(e(t,t)),w=Math.sqrt(e(l,l)),_=v/(L*w);return Math.acos(_)}const c=so(u.geometry.coordinates[0]),p=n({geometry:{coordinates:c}},o),f=u.geometry.coordinates.map(t=>{const l=P(t),v=n({geometry:{coordinates:c}},l),L=r(p,v),w=m(p,v);return{point:l,angle:L,cross:w}});return f.sort((t,l)=>t.cross!==l.cross?l.cross-t.cross:t.angle-l.angle),f.map(t=>t.point)}const mo=u=>(K("data-v-49cb495b"),u=u(),oo(),u),ho={class:"leaflet-container"},Lo=mo(()=>to("div",{id:"map",class:"h-full w-full"},null,-1)),vo={name:""},yo=J({...vo,props:{data:{type:Array,default:()=>[]}},emits:["getPoints"],setup(u,{emit:o}){const n=u,e=Q({drawing:!1}),m=U(()=>e.drawing?"var(--el-color-primary)":"var(--el-color-info)"),{map:r,drawLine:c,nearestPoints:p,getNearestPointOnLine:f,removeLinsener:t,lineLength:l,drawLongLine:v}=io("map",n.data),L=o,w=()=>{e.drawing=!e.drawing,e.drawing?c():(t(),f(),v(),L("getPoints",p,l))};return j(()=>{L("getPoints",p,l)}),(_,B)=>{const x=z;return no(),W("div",ho,[Lo,V(x,{color:m.value,class:"draw-icon",onClick:w},{default:H(()=>[V(eo(ao))]),_:1},8,["color"])])}}}),$o=co(yo,[["__scopeId","data-v-49cb495b"]]);export{$o as default};
