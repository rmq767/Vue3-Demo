var G=Object.defineProperty;var W=(t,o,e)=>o in t?G(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var h=(t,o,e)=>(W(t,typeof o!="symbol"?o+"":o,e),e);import{x as q,b as N}from"./element-plus-9-QK-U0O.js";import{d as $,o as y,P as A,Q as _,a as r,T as b,c as k,S as L,M as O,r as T,s as Q,e as H,ai as J,V as f,U as M,ad as K,ac as X,n as Y}from"./@vue-1pEateLc.js";import{_ as w}from"./plugin-vueexport-helper-x3n3nnut.js";import{M as B,D,W as P,V as U,z as E,A as Z,j as ee,E as te}from"./@codemirror-lq3ilx3k.js";import{b as oe}from"./codemirror-QByZyPV8.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@element-plus-GFHZwatb.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";import"./@lezer-eqgAWrhG.js";import"./style-mod-S7zvAXGh.js";import"./crelt-9OWz1RP4.js";import"./@marijn-SOylZkLX.js";import"./w3c-keyname-KjuS0gPF.js";const se=["onMouseenter"],ne={key:0,class:"desc"},ae={name:"Tree"},ie=$({...ae,props:{data:{default:()=>[]}},emits:["mouseenter"],setup(t,{emit:o}){const e=t,s=o,c=d=>{s("mouseenter",d)};return(d,g)=>{const i=q;return y(),A(i,O({style:{"max-width":"600px"},data:e.data},d.$attrs),{default:_(({node:u,data:n})=>[r("div",{class:"tree-node",onMouseenter:m=>c(n)},[r("span",null,b(n.label),1),n.desc?(y(),k("span",ne,b(n.desc),1)):L("",!0)],40,se)]),_:1},16,["data"])}}}),V=w(ie,[["__scopeId","data-v-9ecb9895"]]),re={class:"desc"},ce={class:"title"},le={class:"example"},de={class:"description"},pe={name:"Desc"},ue=$({...pe,props:{title:{type:String,default:""},example:{type:String,default:""},description:{type:String,default:""}},setup(t){const o=t;return(e,s)=>(y(),k("div",re,[r("h4",ce,b(o.title),1),r("p",le,b(o.example),1),r("p",de,b(o.description),1)]))}}),me=w(ue,[["__scopeId","data-v-59c8cf75"]]),S=new B({regexp:/\[\[(.+?)\]\]/g,decoration:t=>D.replace({widget:new fe(t[1])})});class fe extends P{constructor(e){super();h(this,"id","");h(this,"text","");if(e){const[s,...c]=e.split(".");s&&c.length&&(this.text=c.join("."),this.id=s,console.log(this.text,"id:",this.id))}}eq(e){return this.text==e.text}toDOM(){let e=document.createElement("span");return this.text&&(e.className="cm-tag",e.textContent=this.text),e}ignoreEvent(){return!0}}const he=U.fromClass(class{constructor(t){h(this,"placeholders");this.placeholders=S.createDeco(t)}update(t){this.placeholders=S.updateDeco(t,this.placeholders)}},{decorations:t=>t.placeholders,provide:t=>E.atomicRanges.of(o=>{var e;return((e=o.plugin(t))==null?void 0:e.placeholders)||D.none})}),F=new B({regexp:/\{\{(.+?)\}\}/g,decoration:t=>D.replace({widget:new _e(t[1])})});class _e extends P{constructor(e){super();h(this,"text","");e&&(this.text=e)}eq(e){return this.text==e.text}toDOM(){let e=document.createElement("span");return this.text&&(e.className="cm-fn",e.textContent=this.text),e}ignoreEvent(){return!0}}const ge=U.fromClass(class{constructor(t){h(this,"placeholders");this.placeholders=F.createDeco(t)}update(t){this.placeholders=F.updateDeco(t,this.placeholders)}},{decorations:t=>t.placeholders,provide:t=>E.atomicRanges.of(o=>{var e;return((e=o.plugin(t))==null?void 0:e.placeholders)||D.none})}),ve=E.baseTheme({".cm-tag":{paddingLeft:"6px",paddingRight:"6px",paddingTop:"3px",paddingBottom:"3px",marginLeft:"3px",marginRight:"3px",backgroundColor:"#ffcdcc",borderRadius:"4px"},".cm-fn":{color:"#01a252"}}),xe=[{label:"SUM",apply:I},{label:"IF",apply:I}];function be(t){let o=t.matchBefore(/[s](?:u(?:m)?)?|[i](?:f)?/gi);return!t.explicit&&!o?null:{from:o?o.from:t.pos,options:xe}}const ye=()=>{const t=T(""),o=Q(),e=T(),s=[he,ge,ve,E.lineWrapping,oe,Z(),ee({override:[be]})];return{code:t,view:o,editorRef:e,init:()=>{e.value&&(o.value=new E({parent:e.value,state:te.create({doc:t.value,extensions:s})}),setTimeout(()=>{var i;(i=o.value)==null||i.focus()},0))},destroyed:()=>{var i;(i=o.value)==null||i.destroy(),o.value=void 0},insertText:(i,u="tag")=>{if(o.value){let n=u==="tag"?`[[${i}]]`:`{{${i}}}()`;const m=o.value.state.selection;if(m.main.empty){const a=m.main.head,v=u==="tag"?a+n.length:a+n.length-1,x=o.value.state.update({changes:{from:a,to:a,insert:n},selection:{anchor:v}});o.value.dispatch(x)}else{const a=m.main.from,v=m.main.to,x=u==="tag"?a+n.length:a+n.length-1,C=o.value.state.update({changes:{from:a,to:v,insert:n},selection:{anchor:x}});o.value.dispatch(C)}setTimeout(()=>{var a;(a=o.value)==null||a.focus()},0)}}}},Ee=t=>({SUM:{title:"求和",example:"SUM(数值1,数值2,...)",description:"SUM(数学成绩,语文成绩,英语成绩,...) = 各科总成绩"},AVERAGE:{title:"平均数",example:"AVERAGE(数值1,数值2,...)",description:"AVERAGE(数学成绩,语文成绩,英语成绩,...) = 平均成绩"},IF:{title:"条件判断",example:"IF(条件,真值,假值)",description:"IF(数学成绩>90,优秀,良好)"}})[t];function I(t,o,e,s){const c=`{{${o.label}}}()`,d=e+c.length-1,g=t.state.update({changes:{from:e,to:s,insert:c},selection:{anchor:d}});t.dispatch(g)}const Ce={class:"editor-container"},$e={class:"editor-content"},De={class:"fn"},Te={class:"fn-list"},Me={class:"fn-desc"},ke={name:"Editor"},we=$({...ke,setup(t,{expose:o}){const e=H({visible:!1,paramsData:[{label:"参数1",id:"1"},{label:"参数2",id:"2"},{label:"参数3",id:"3"}],fnData:[{label:"常用函数",id:"1",children:[{label:"SUM",desc:"求和",id:"1-1"},{label:"IF",desc:"条件判断",id:"1-2"}]}],info:{}}),{code:s,view:c,editorRef:d,init:g,destroyed:i,insertText:u}=ye(),n=l=>{l.children||u(`${l.id}.${l.label}`)},m=l=>{l.children||u(`${l.label}`,"fn")},a=l=>{const p=Ee(l.label);p&&(e.info=p)},v=()=>{var p;const l=(p=c.value)==null?void 0:p.state.doc;console.log(l)},x=()=>{e.visible=!0,Y(()=>{g()})},C=()=>{i(),e.visible=!1};return o({open:x}),(l,p)=>{const R=N,j=J("MyDialog");return y(),A(j,{modelValue:e.visible,"onUpdate:modelValue":p[0]||(p[0]=z=>e.visible=z),title:"Editor",width:800,center:"","close-on-click-modal":!1,"destroy-on-close":!0,onClose:C},{footer:_(()=>[r("div",null,[f(R,{onClick:C},{default:_(()=>[M("取消")]),_:1}),f(R,{type:"primary",onClick:v},{default:_(()=>[M("确认")]),_:1})])]),default:_(()=>[r("div",Ce,[f(V,{class:"editor-tree",data:e.paramsData,onNodeClick:n},null,8,["data"]),r("div",$e,[r("div",{class:"editor-main",ref_key:"editorRef",ref:d},null,512),r("div",De,[r("div",Te,[f(V,{"default-expand-all":!0,data:e.fnData,onNodeClick:m,onMouseenter:a},null,8,["data"])]),r("div",Me,[f(me,K(X(e.info)),null,16)])])])])]),_:1},8,["modelValue"])}}}),Re=w(we,[["__scopeId","data-v-1aec9e85"]]),Ve={name:"RulesEditor"},et=$({...Ve,setup(t){const o=T(),e=()=>{var s;(s=o.value)==null||s.open()};return(s,c)=>{const d=N;return y(),k("div",null,[f(d,{type:"primary",size:"default",onClick:e},{default:_(()=>[M("编辑")]),_:1}),f(Re,{ref_key:"editor",ref:o},null,512)])}}});export{et as default};
