import{c as z}from"./element-plus-DRy_UtcF.js";import{l as g}from"./leaflet-v1Y5QXvJ.js";import"./leaflet.chinatmsproviders-DrehvF96.js";import{s as T,r as J,k as j,X as Y,d as U,e as W,b as H,c as K,a as Q,R,J as S,o as tt,u as ot}from"./@vue-DtXbQ2UY.js";import{e as nt,l as V,b as x,d as $,f as et}from"./@turf-n0MF4LHv.js";import{V as rt}from"./@element-plus-dWmgPpBK.js";import{_ as st}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./lodash-es-CVJ_Bk8S.js";import"./@vueuse-ZySg_D90.js";import"./@sxzz-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B7BNuc5J.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-D0iZPv2f.js";const at=(d,t)=>{const n=T(null),e=g.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),m=g.layerGroup([e]);let r=null,s=null,f="start",p=null;const o=T([]),l=T([]),h=T([]),v=J(0),w=()=>{const u=g.latLng(-90,-180),a=g.latLng(90,180),c=g.latLngBounds(u,a),i=g.canvas();n.value=new g.Map(d,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[m],maxBounds:c,renderer:i,crs:g.CRS.EPSG3857,zoomControl:!1})},P=()=>{var u;if(t!=null&&t.length){const a=[];if(t.forEach(i=>{a.push({lng:i.pointData[0].lon,lat:i.pointData[0].lat}),g.circleMarker({lat:i.pointData[0].lat,lng:i.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:10}).bindTooltip(i.name,{permanent:!0,direction:"top",className:"my-custom-tooltip"}).addTo(n.value)}),t.length===1){const i=t[0].pointData[0];r=g.polyline([[i.lat-.003,i.lon-.01],[i.lat-.003,i.lon+.01]],{color:"red"}).addTo(n.value),a.push(r.getLatLngs()),C(),E(),console.log(o.value)}const c=g.latLngBounds(a);(u=n.value)==null||u.fitBounds(c,{padding:[10,10]})}},M=()=>{var u,a;(u=n.value)==null||u.on("click",B),(a=n.value)==null||a.on("mousemove",k)},B=u=>{if(f==="start"){r&&(l.value.forEach(c=>{c.remove()}),h.value.forEach(c=>{c.remove()}),r.remove(),s==null||s.remove());const a=u.latlng;p=a,r=g.polyline([a,a],{color:"red",weight:3,dashArray:"5,5"}).addTo(n.value),f="drawing"}else if(f==="drawing"){const a=u.latlng;r==null||r.setLatLngs([p,a]),r==null||r.setStyle({dashArray:void 0}),f="start"}},k=u=>{f==="drawing"&&p&&(r==null||r.setLatLngs([p,u.latlng]))},G=()=>{var u,a;(u=n.value)==null||u.off("click",B),(a=n.value)==null||a.off("mousemove",k)},Z=()=>{n.value&&n.value.remove()},C=()=>{if(r){o.value=[];const u=r.getLatLngs().map(c=>[c.lng,c.lat]),a=V(u);t==null||t.forEach((c,i)=>{const L=lt([c.pointData[0].lon,c.pointData[0].lat],a.geometry.coordinates[0],a.geometry.coordinates[1]);L&&o.value.push({point:L,...c})}),o.value.length===1||o.value.sort((c,i)=>{const L=D(a,c.point);Reflect.set(c,"distance",L);const y=D(a,i.point);return Reflect.set(i,"distance",y),L-y}),o.value.forEach((c,i)=>{l.value[i]=g.circleMarker([c.point[1],c.point[0]],{stroke:!0,color:"#fff",fillColor:"green",fill:!0,fillOpacity:1,radius:5}).bindTooltip(`${i+1}`,{permanent:!0,direction:"top"}).addTo(n.value)})}};function D(u,a){const c=u.geometry.coordinates[0],i=x(a);return $(c,i,{units:"kilometres"})}function E(){const[u,a]=r==null?void 0:r.getLatLngs();if(s=g.polyline([],{color:"green",weight:1,dashArray:[10,10]}).addTo(n.value),o.value.forEach(c=>{c.info.forEach(L=>{const y=ut(L.coordinate,[u.lng,u.lat],[a.lng,a.lat]),A=g.circleMarker([y[1],y[0]],{stroke:!0,color:"#fff",fillColor:"green",fill:!0,fillOpacity:1,radius:5}).bindTooltip(L.type,{permanent:!0,direction:"top"}).addTo(n.value);h.value.push(A),s==null||s.addLatLng([y[1],y[0]])})}),v.value=nt(s.toGeoJSON(),{units:"kilometres"}),s.getLatLngs().length){const c=[];o.value.forEach(i=>{const L=s.getLatLngs().map(_=>[_.lng,_.lat]),y=V(L),A=x([i.pointData[0].lon,i.pointData[0].lat]),q=dt(y,A),F=x(q[0].geometry.coordinates);i.info.forEach((_,I)=>{const N=s==null?void 0:s.getLatLngs()[I],X=x([N.lng,N.lat]),O=$(F,X,{units:"kilometres"});Reflect.set(_,"distance",O),c.push(O)})}),v.value=Math.max(...c)}}return j(()=>{w(),P()}),Y(()=>{Z()}),{map:n,drawLine:M,nearestPoints:o,getNearestPointOnLine:C,removeLinsener:G,lineLength:v,drawLongLine:E}};function b(d,t){return d[0]*t[0]+d[1]*t[1]}function ct(d,t,n){const e=[n[0]-t[0],n[1]-t[1]],m=[d[0]-t[0],d[1]-t[1]],r=b(m,e)/b(e,e),s=[e[0]*r,e[1]*r];return[t[0]+s[0],t[1]+s[1]]}function it(d,t,n){const[e,m]=d,[r,s]=t,[f,p]=n;return e>=Math.min(r,f)&&e<=Math.max(r,f)&&m>=Math.min(s,p)&&m<=Math.max(s,p)}function lt(d,t,n){const e=ct(d,t,n);return it(e,t,n)?e:null}function ut(d,t,n){const e=[n[0]-t[0],n[1]-t[1]],m=[d[0]-t[0],d[1]-t[1]],r=e[0]*m[0]+e[1]*m[1],s=e[0]*e[0]+e[1]*e[1],f=r/s,p=t[0]+f*e[0],o=t[1]+f*e[1];return[p,o]}function dt(d,t){function n(o,l){return{x:l.geometry.coordinates[0]-o.geometry.coordinates[0],y:l.geometry.coordinates[1]-o.geometry.coordinates[1]}}function e(o,l){return o.x*l.x+o.y*l.y}function m(o,l){return o.x*l.y-o.y*l.x}function r(o,l){const h=e(o,l),v=Math.sqrt(e(o,o)),w=Math.sqrt(e(l,l)),P=h/(v*w);return Math.acos(P)}const s=et(d.geometry.coordinates[0]),f=n({geometry:{coordinates:s}},t),p=d.geometry.coordinates.map(o=>{const l=x(o),h=n({geometry:{coordinates:s}},l),v=r(f,h),w=m(f,h);return{point:l,angle:v,cross:w}});return p.sort((o,l)=>o.cross!==l.cross?l.cross-o.cross:o.angle-l.angle),p.map(o=>o.point)}const ft={class:"leaflet-container"},gt={name:""},pt=U({...gt,props:{data:{type:Array,default:()=>[]}},emits:["getPoints"],setup(d,{emit:t}){const n=d,e=W({drawing:!1}),m=H(()=>e.drawing?"var(--el-color-primary)":"var(--el-color-info)"),{drawLine:r,nearestPoints:s,getNearestPointOnLine:f,removeLinsener:p,lineLength:o,drawLongLine:l}=at("map",n.data),h=t,v=()=>{e.drawing=!e.drawing,e.drawing?r():(p(),f(),l(),h("getPoints",s,o))};return j(()=>{h("getPoints",s,o)}),(w,P)=>{const M=z;return tt(),K("div",ft,[P[0]||(P[0]=Q("div",{id:"map",class:"h-full w-full"},null,-1)),R(M,{color:m.value,class:"draw-icon",onClick:v},{default:S(()=>[R(ot(rt))]),_:1},8,["color"])])}}}),Et=st(pt,[["__scopeId","data-v-49cb495b"]]);export{Et as default};
