import{s as O,r as z,w as G,d as W,c as F,o as U,a as H,R as k,J as N,u as g}from"./@vue-AhIeOBdH.js";import{c as q,a as V}from"./element-plus-t8j70jxJ.js";import{e as Z,S as K,T as j,U as J,B as Y,A as Q}from"./@element-plus-CLWHGgw5.js";import{_ as $}from"./plugin-vueexport-helper-DlAUqK2U.js";var T=(e=>(e.Point="point",e.Polyline="polyline",e.Polygon="polygon",e))(T||{}),X=(e=>(e[e.Plan=0]="Plan",e[e.Block=1]="Block",e[e.Platform=2]="Platform",e[e.Well=3]="Well",e[e.Pipeline=4]="Pipeline",e[e.Device=5]="Device",e))(X||{}),R=(e=>(e.Area="area",e.Line="line",e))(R||{});const Ce=e=>{const a=O(),o=O(),l=z(!1),s={lookAt:[108.341768,22.804393,1e7],max:1e7,min:100,flyHeight:1e3,pitch:-.5,...e};let C,b=null;const E=async()=>{a.value=new Cesium.Viewer("cesium",{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),a.value.scene.screenSpaceCameraController.minimumZoomDistance=s.min,a.value.scene.screenSpaceCameraController.maximumZoomDistance=s.max,a.value.cesiumWidget.creditContainer.style.display="none",a.value.resolutionScale=window.devicePixelRatio,a.value.scene.postProcessStages.fxaa.enabled=!0,a.value.camera.setView({destination:Cesium.Cartesian3.fromDegrees(s.lookAt[0],s.lookAt[1],s.lookAt[2]),orientation:{heading:0,pitch:-Cesium.Math.PI/180*80,roll:0}}),a.value.screenSpaceEventHandler.setInputAction(()=>{m("zoomIn")},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},m=i=>{var v,S,_;const d=(v=a.value)==null?void 0:v.camera.positionCartographic.height;i==="zoomIn"?(S=a.value)==null||S.camera.zoomIn(d/10):(_=a.value)==null||_.camera.zoomOut(d/10)};return{viewer:a,zoomFn:m,adjustNorthUp:()=>{var i,d,v,S,_,A;if(b)(i=a.value)==null||i.camera.flyToBoundingSphere(b,{offset:new Cesium.HeadingPitchRange(0,-Cesium.Math.PI/2,0)});else{const L=-Cesium.Math.PI/2,M=Cesium.Math.PI*2;if(((d=a.value)==null?void 0:d.scene.camera.heading)===M&&((v=a.value)==null?void 0:v.scene.camera.pitch)===L&&((S=a.value)==null?void 0:S.scene.camera.roll)===0)return;const u=a.value.camera.pickEllipsoid(new Cesium.Cartesian2(a.value.canvas.clientWidth/2,a.value.canvas.clientHeight/2))||((_=a.value)==null?void 0:_.camera.position),c=Cesium.Ellipsoid.WGS84.cartesianToCartographic(u),n=c.longitude*180/Math.PI,h=c.latitude*180/Math.PI;(A=a.value)==null||A.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(n,h,s.flyHeight),orientation:{heading:0,pitch:L,roll:0},duration:2})}},loadRoadNetwork:()=>{var i;l.value?((i=a.value)==null||i.imageryLayers.remove(o.value,!0),l.value=!1):(o.value=a.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),l.value=!0)},flyTo:(i,d,v=s.flyHeight)=>{var _;const S=B([i,d]);b=new Cesium.BoundingSphere(S,v),(_=a.value)==null||_.camera.flyToBoundingSphere(b,{offset:new Cesium.HeadingPitchRange(0,s.pitch,0),complete:()=>{var M;const A=(M=a.value)==null?void 0:M.camera.positionCartographic,L=A==null?void 0:A.height;L&&(s.flyHeight=L)}})},destroyed:()=>{var i,d;(i=a.value)==null||i.entities.removeAll(),(d=a.value)==null||d.destroy(),a.value=void 0},init:E,orbitTickFunction:(i,d)=>{var v,S,_,A;(v=a.value)==null||v.camera.lookAtTransform(C),(S=a.value)==null||S.camera.rotateLeft(i),(_=a.value)==null||_.camera.rotateUp(d),(A=a.value)==null||A.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)},getFrame:()=>{let i=new Cesium.Cartesian3;const d=a.value.camera,v=a.value.scene,S=new Cesium.Ray;S.origin=d.positionWC,S.direction=d.directionWC,i=v.globe.pick(S,v,i)||a.value.camera.position,i=d.worldToCameraCoordinatesPoint(i,i);const _=new Cesium.Matrix4;C=Cesium.Transforms.eastNorthUpToFixedFrame(i,v.globe.ellipsoid,_)}}},he=e=>{const a=z([]),o=z(0),l=O(),s=.3,C=.5;let b="area";const E=new Cesium.PolygonHierarchy,m=new Cesium.Entity({name:"polygon",polygon:{hierarchy:new Cesium.CallbackProperty(function(){return E},!1),outline:!0,outlineColor:Cesium.Color.RED,outlineWidth:10,fill:!0,material:Cesium.Color.RED.withAlpha(s)}});let t=[];const r=new Cesium.Entity({name:"polygon",polyline:{positions:new Cesium.CallbackProperty(function(){let u=[];return t.length>=3?u=[...t,t[0]]:u=[...t],u},!1),width:4,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED.withAlpha(1),dashLength:20})}});let y=[];const P=new Cesium.Entity({name:"polyline",polyline:{positions:new Cesium.CallbackProperty(function(){return y},!1),width:20,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.WHITE)}});function p(u,c,n){var h,w;(w=e.value)==null||w.entities.add({id:String(c),name:"point",properties:(n==null?void 0:n.properties)||{},position:Cesium.Cartesian3.fromDegrees(u[0],u[1],10),point:{pixelSize:((h=n==null?void 0:n.point)==null?void 0:h.pixelSize)||6,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,...n==null?void 0:n.point},label:{text:`点${c+1}--[${u[0]},${u[1]}]`,font:"12px sans-serif",pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:Cesium.Color.RED,backgroundColor:Cesium.Color.WHITE.withAlpha(C),showBackground:!0}})}function f(u){return e.value.camera.pickEllipsoid(u,e.value.scene.globe.ellipsoid)}function i(u,c){d(),u.forEach((n,h)=>{c===T.Point&&p(n.degrees,h,{point:{pixelSize:16},properties:n.data}),c===T.Polyline&&(p(n.degrees,h,{point:{pixelSize:6},properties:n.data}),y.push(B(n.degrees))),c===T.Polygon&&(p(n.degrees,h,{point:{pixelSize:6},properties:n.data}),b===R.Area?E.positions.push(B(n.degrees)):t.push(B(n.degrees)))}),a.value=u,o.value=u.length}function d(){a.value=[],o.value=0,y=[],E.positions=[],t=[]}function v(u){var D,x;const c=(x=e.value)==null?void 0:x.camera.pickEllipsoid(u,(D=e.value)==null?void 0:D.scene.globe.ellipsoid),n=Cesium.Cartographic.fromCartesian(c),h=Number(Cesium.Math.toDegrees(n.longitude).toFixed(6)),w=Number(Cesium.Math.toDegrees(n.latitude).toFixed(6));return{longitude:h,latitude:w,cartesian:c}}function S(){e.value&&e.value.screenSpaceEventHandler.setInputAction(u=>{var n;if(!((n=e.value)==null?void 0:n.scene.pick(u.position))){const{latitude:h,longitude:w}=v(u.position);o.value=0,a.value=[{degrees:[w,h],index:o.value}],M(),p([w,h],o.value,{point:{pixelSize:16}}),requestAnimationFrame(()=>{var D;(D=e.value)==null||D.scene.requestRender()})}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}function _(){e.value&&(e.value.entities.add(P),e.value.screenSpaceEventHandler.setInputAction(u=>{var n;if(!((n=e.value)==null?void 0:n.scene.pick(u.position))){const{latitude:h,longitude:w,cartesian:D}=v(u.position);a.value.push({degrees:[w,h],index:o.value}),p([w,h],o.value),y.push(D.clone()),o.value+=1,requestAnimationFrame(()=>{var x;(x=e.value)==null||x.scene.requestRender()})}},Cesium.ScreenSpaceEventType.LEFT_CLICK))}function A(u=R.Area){if(b=u,!!e.value){if(u===R.Area){const c=e.value.entities.add(m);c.polygon.material=Cesium.Color.BLUE.withAlpha(s)}else{const c=e.value.entities.add(r);c.polyline.material=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.BLUE.withAlpha(1),dashLength:20})}e.value.screenSpaceEventHandler.setInputAction(c=>{var h;if(!((h=e.value)==null?void 0:h.scene.pick(c.position))){const{latitude:w,longitude:D,cartesian:x}=v(c.position);a.value.push({degrees:[D,w],index:o.value}),p([D,w],o.value),u===R.Area?E.positions.push(x.clone()):t.push(x.clone()),o.value+=1,requestAnimationFrame(()=>{var I;(I=e.value)==null||I.scene.requestRender()})}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}}function L(u){e.value&&(e.value.screenSpaceEventHandler.setInputAction(c=>{var h;const n=(h=e.value)==null?void 0:h.scene.pick(c.position);n&&n.id&&n.id.name!=="polygon"&&n.id.name!=="polyline"&&n.id.name!==void 0?(l.value=n.id,e.value.scene.screenSpaceCameraController.enableRotate=!1,e.value.scene.screenSpaceCameraController.enableTranslate=!1,e.value.scene.screenSpaceCameraController.enableZoom=!1):l.value=void 0},Cesium.ScreenSpaceEventType.LEFT_DOWN),e.value.screenSpaceEventHandler.setInputAction(()=>{var c;l.value=void 0,e.value.scene.screenSpaceCameraController.enableRotate=!0,e.value.scene.screenSpaceCameraController.enableTranslate=!0,e.value.scene.screenSpaceCameraController.enableZoom=!0,(c=e.value)==null||c.scene.requestRender()},Cesium.ScreenSpaceEventType.LEFT_UP),e.value.screenSpaceEventHandler.setInputAction(c=>{var h,w;const n=(h=e.value)==null?void 0:h.scene.pick(c.endPosition);if(n&&n.id&&n.id.name!=="polygon"&&n.id.name!=="polyline"&&n.id.name!==void 0?e.value._container.style.cursor="pointer":e.value._container.style.cursor="default",l.value){const D=Number(l.value.id),x=f(c.endPosition),I=te(x);a.value[D].degrees=I,l.value.position=x,l.value.label.text=`点${D+1}--[${I[0]},${I[1]}]`,u===T.Polyline&&(y[D]=x),u===T.Polygon&&(b===R.Area?E.positions[D]=x:t[D]=x),(w=e.value)==null||w.scene.requestRender()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE))}function M(){var u;(u=e.value)==null||u.entities.values.forEach(c=>{var n;c&&((n=e.value)==null||n.entities.remove(c))})}return{data:a,draw:i,reset:d,initDrawPoint:S,initDrawLine:_,initDrawArea:A,initEntityMove:L}},ye=(e,a=!1)=>{G(e,m=>{m&&a&&se(m)});function o(m,t=R.Area,r){var d;const y=(r==null?void 0:r.showPoint)??!0,P=(r==null?void 0:r.showLabel)??!0,p=new Cesium.PolygonHierarchy(m),f=new Cesium.CustomDataSource("area");let i;if(t===R.Area)i=new Cesium.Entity({name:"polygon",polygon:{material:Cesium.Color.RED.withAlpha(.3),hierarchy:p,fill:!0,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...(r==null?void 0:r.polygon)||{}}});else{const v=[...p.positions,p.positions[0]];i=new Cesium.Entity({name:"polygon",polyline:{material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED.withAlpha(.3),dashLength:20}),positions:v,width:4,clampToGround:!0,...(r==null?void 0:r.polyline)||{}}})}if(f.entities.add(i),y&&m.forEach(v=>{const S=C(v,{label:{text:r==null?void 0:r.properties.name},properties:r==null?void 0:r.properties,isChildren:!0});f.entities.add(S)}),P){const v=B(ae(p.positions)),S=b(v,r==null?void 0:r.label);f.entities.add(S)}(d=e.value)==null||d.dataSources.add(f)}function l(m,t){var f;const r=(t==null?void 0:t.showPoint)??!0,y=(t==null?void 0:t.showLabel)??!0,P=(t==null?void 0:t.is3D)??!1,p=new Cesium.CustomDataSource("line");if(P){const i=new Cesium.Entity({name:"polyline",polylineVolume:{positions:m,shape:ne(20),material:Cesium.Color.WHITE.withAlpha(.6),...(t==null?void 0:t.polylineVolume)||{}}});p.entities.add(i)}else{const i=new Cesium.Entity({name:"polyline",polyline:{positions:m,width:10,material:Cesium.Color.WHITE.withAlpha(.3),clampToGround:!0,...(t==null?void 0:t.polyline)||{}}});p.entities.add(i)}r&&m.forEach(i=>{const d=C(i,{label:{text:t==null?void 0:t.properties.name},properties:t==null?void 0:t.properties,isChildren:!0});p.entities.add(d)}),y&&s(m,t==null?void 0:t.properties).forEach(d=>{p.entities.add(d)}),(f=e.value)==null||f.dataSources.add(p)}function s(m,t){let r=[];for(let y=0;y<m.length-1;y++){const P=m[y],p=m[y+1],f=Cesium.Cartesian3.midpoint(P,p,new Cesium.Cartesian3),i=new Cesium.Entity({name:"polyline",position:f,label:{text:t==null?void 0:t.name,font:"12px sans-serif",scale:.8,fillColor:Cesium.Color.BLACK.withAlpha(.9),backgroundColor:Cesium.Color.WHITE.withAlpha(.6),showBackground:!0,backgroundPadding:new Cesium.Cartesian2(2,2),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e5),scaleByDistance:new Cesium.NearFarScalar(100,1.5,1e5,.8),pixelOffset:new Cesium.Cartesian2(0,-10),heightReference:Cesium.HeightReference.NONE}});r.push(i)}return r}function C(m,t){var P,p;const r=(t==null?void 0:t.isChildren)??!1;let y;if(t!=null&&t.img?y=new Cesium.Entity({position:m,properties:(t==null?void 0:t.properties)||{},billboard:{image:t.img,color:Cesium.Color.RED,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...t.billboard||{}},label:{font:"12px sans-serif",scale:.8,pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:new Cesium.Color(.2,.494,.8,1),backgroundColor:Cesium.Color.WHITE.withAlpha(.7),showBackground:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e5),scaleByDistance:new Cesium.NearFarScalar(100,1.5,1e5,.8),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...t.label||{}}}):y=new Cesium.Entity({position:m,properties:(t==null?void 0:t.properties)||{},point:{pixelSize:((P=t==null?void 0:t.point)==null?void 0:P.pixelSize)||10,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...(t==null?void 0:t.point)||{}},label:{font:"12px sans-serif",scale:.8,pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:new Cesium.Color(.2,.494,.8,1),backgroundColor:Cesium.Color.WHITE.withAlpha(.7),showBackground:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e5),scaleByDistance:new Cesium.NearFarScalar(100,1.5,1e5,.8),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...(t==null?void 0:t.label)||{}}}),!r){const f=new Cesium.CustomDataSource("point");f.entities.add(y),(p=e.value)==null||p.dataSources.add(f)}return y}function b(m,t){return new Cesium.Entity({position:m,label:{showBackground:!1,disableDepthTestDistance:0,scaleByDistance:new Cesium.NearFarScalar(100,2,1e6,.5),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,...t||{}}})}function E(){var t,r;(t=e.value)!=null&&t.screenSpaceEventHandler.getInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)||(r=e.value)==null||r.screenSpaceEventHandler.setInputAction(y=>{var p;const P=(p=e.value)==null?void 0:p.scene.pick(y.endPosition);if(P&&P.id&&P.id.name!=="polygon"&&P.id.name!=="polyline"){const f=P.id;f&&f.properties&&(e.value._container.style.cursor="pointer",ee(y.endPosition.x,y.endPosition.y,f.properties.getValue()))}else{e.value._container.style.cursor="default";const f=document.getElementById("cesium-tips");f&&(f.style.display="none")}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}return{drawArea:o,drawLine:l,drawPoint:C,initHoverEvent:E}},ee=(e,a,o)=>{if(o&&o.remark){const l=document.getElementById("cesium-tips");if(l)l.style.display="block",l.style.left=e+20+"px",l.style.top=a+"px",l.innerHTML=`<div>${o.remark}</div>`;else{const s=document.createElement("div");s.id="cesium-tips",s.style.position="absolute",s.style.backgroundColor="rgba(0,0,0,0.8)",s.style.color="white",s.style.zIndex="999",s.style.maxWidth="250px",s.style.fontSize="14px",s.style.lineHeight="20px",s.style.padding="8px",s.style.borderRadius="5px",document.getElementById("cesium-container").appendChild(s),s.style.left=e+20+"px",s.style.top=a+"px"}}},te=e=>{const a=Cesium.Cartographic.fromCartesian(e),o=Number(Cesium.Math.toDegrees(a.longitude).toFixed(6)),l=Number(Cesium.Math.toDegrees(a.latitude).toFixed(6));return[o,l]},B=(e,a=0)=>Cesium.Cartesian3.fromDegrees(e[0],e[1],a),ae=e=>{let a=Cesium.Cartesian3.ZERO;const o=e.length;e.forEach(b=>{a=Cesium.Cartesian3.add(a,b,new Cesium.Cartesian3)}),a=Cesium.Cartesian3.divideByScalar(a,o,new Cesium.Cartesian3);const l=Cesium.Cartographic.fromCartesian(a),s=Number(Cesium.Math.toDegrees(l.longitude).toFixed(6)),C=Number(Cesium.Math.toDegrees(l.latitude).toFixed(6));return[s,C]},ve=e=>{let a=0,o,l;for(let s=0;s<e.length;s++)for(let C=s+1;C<e.length;C++){const b=Cesium.Cartesian3.distance(e[s],e[C]);b>a&&(a=b,o=e[s],l=e[C])}return{maxDistance:a,farthestPoint1:o,farthestPoint2:l}};function ne(e){const a=[];for(let o=0;o<360;o++){const l=Cesium.Math.toRadians(o);a.push(new Cesium.Cartesian2(e*Math.cos(l),e*Math.sin(l)))}return a}async function se(e){e.scene.sun.show=!1,e.scene.moon.show=!1,e.scene.skyBox.show=!1,e.scene.fog.enabled=!1,e.scene.skyAtmosphere.show=!1;const a=await Cesium.createWorldTerrainAsync({requestVertexNormals:!0,requestWaterMask:!1});e.terrainProvider=a,e.scene.globe.depthTestAgainstTerrain=!1,e.scene.verticalExaggeration=1,e.scene.verticalExaggerationRelativeHeight=.1}const oe={class:"inner"},le=W({__name:"cameraControl",emits:["moveCamera","mouse-down","mouse-up"],setup(e,{emit:a}){const o=a;let l=null;const s=b=>{o("mouse-down"),l=setInterval(()=>{o("moveCamera",b)},10)},C=()=>{clearInterval(l),o("mouse-up")};return(b,E)=>{const m=q;return U(),F("div",oe,[H("div",{class:"outer",onMousedown:E[0]||(E[0]=t=>s("top")),onMouseup:C},[k(m,null,{default:N(()=>[k(g(Z))]),_:1})],32),H("div",{class:"outer",onMousedown:E[1]||(E[1]=t=>s("right")),onMouseup:C},[k(m,null,{default:N(()=>[k(g(K))]),_:1})],32),H("div",{class:"outer",onMousedown:E[2]||(E[2]=t=>s("bottom")),onMouseup:C},[k(m,null,{default:N(()=>[k(g(j))]),_:1})],32),H("div",{class:"outer",onMousedown:E[3]||(E[3]=t=>s("left")),onMouseup:C},[k(m,null,{default:N(()=>[k(g(J))]),_:1})],32),E[4]||(E[4]=H("div",{class:"inner-circle"},null,-1))])}}}),Ee=$(le,[["__scopeId","data-v-20f4bba5"]]),ie={class:"btn-group-zoom"},re={name:"GisZoom"},ue=W({...re,emits:["zoom"],setup(e,{emit:a}){const o=a,l=s=>{o("zoom",s)};return(s,C)=>{const b=V;return U(),F("div",ie,[k(b,{type:"primary",size:"small",icon:g(Y),onClick:C[0]||(C[0]=E=>l("zoomIn"))},null,8,["icon"]),k(b,{type:"primary",size:"small",icon:g(Q),onClick:C[1]||(C[1]=E=>l("zoomOut"))},null,8,["icon"])])}}}),fe=$(ue,[["__scopeId","data-v-32e30e9e"]]);export{Ee as C,R as P,fe as Z,X as a,ae as b,ve as c,T as d,he as e,B as g,Ce as i,ye as u};
