import{b as A,c as G,a as q,d as Z,e as j}from"./element-plus-Xozj5gs8.js";import{s as B,b as N,d as H,_ as $,o as V,O as K,P as F,a as w,U as y,u as k,T as O,n as J,aw as Q,ax as X,e as Y,c as ee,S as te}from"./@vue-1LENYTn8.js";import{Q as ae,R as oe,u as ne,z as se,r as le}from"./@element-plus-3D7pSXXm.js";import{_ as U}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-xtaXTKrS.js";import"./@vueuse-u16MxwrG.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-1TH0Fy64.js";import"./acorn-bQvPYi_r.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";var p=(t=>(t.Point="point",t.Polyline="polyline",t.Polygon="polygon",t))(p||{});const ie=t=>{const e=B(),l=B(),o=N(!0),i={lookAt:[108.904967,34.313311,5e6],max:5e6,min:200,flyHeight:8e3,...t};return{viewer:e,zoomFn:(r,v=200)=>{var _,b;debugger;r==="zoomIn"?(_=e.value)==null||_.camera.zoomIn(v):(b=e.value)==null||b.camera.zoomOut(v)},adjustNorthUp:()=>{var z,x,n,s;if(((z=e.value)==null?void 0:z.scene.camera.heading)===6.283185307179586&&((x=e.value)==null?void 0:x.scene.camera.pitch)===-1.5707963267948966&&((n=e.value)==null?void 0:n.scene.camera.roll)===0)return;const r=e.value.camera.pickEllipsoid(new Cesium.Cartesian2(e.value.canvas.clientWidth/2,e.value.canvas.clientHeight/2)),v=Cesium.Ellipsoid.WGS84.cartesianToCartographic(r),_=v.longitude*180/Math.PI,b=v.latitude*180/Math.PI;(s=e.value)==null||s.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(_,b,i.flyHeight),orientation:{heading:0,pitch:-Cesium.Math.PI/2,roll:0},duration:2})},loadRoadNetwork:()=>{var r;o.value?((r=e.value)==null||r.imageryLayers.remove(l.value,!0),o.value=!1):(l.value=e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),o.value=!0)},flyTo:(r,v)=>{var _;(_=e.value)==null||_.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(r,v,i.flyHeight),orientation:{heading:0,pitch:-Cesium.Math.PI/2,roll:0}})},destroyed:()=>{var r,v;(r=e.value)==null||r.entities.removeAll(),(v=e.value)==null||v.destroy(),e.value=void 0},init:async()=>{e.value=new Cesium.Viewer("cesium",{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),e.value.scene.screenSpaceCameraController.minimumZoomDistance=i.min,e.value.scene.screenSpaceCameraController.maximumZoomDistance=i.max,e.value.cesiumWidget.creditContainer.style.display="none",l.value=e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),e.value.resolutionScale=window.devicePixelRatio,e.value.scene.postProcessStages.fxaa.enabled=!0,e.value.camera.setView({destination:Cesium.Cartesian3.fromDegrees(i.lookAt[0],i.lookAt[1],i.lookAt[2]),orientation:{heading:0,pitch:-Cesium.Math.PI/2,roll:0}})}}},re=t=>{const e=N([]),l=N(0),o=B(),i=.3,P=.5,d=new Cesium.PolygonHierarchy,h=new Cesium.Entity({name:"polygon",isStatic:!1,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return d},!1),outline:!0,outlineColor:Cesium.Color.RED,outlineWidth:10,fill:!0,material:Cesium.Color.RED.withAlpha(i)}});let f=[];const I=new Cesium.Entity({name:"polyline",isStatic:!1,polyline:{positions:new Cesium.CallbackProperty(function(){return f},!1),width:20,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.WHITE)}}),R=n=>{t.value&&(n===p.Polyline&&t.value.entities.add(I),n===p.Polygon&&t.value.entities.add(h),t.value.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.value.screenSpaceEventHandler.setInputAction(s=>{var c,E,g,T;const a=(c=t.value)==null?void 0:c.scene.pick(s.position);if(!a||a.id.isStatic){const m=(g=t.value)==null?void 0:g.camera.pickEllipsoid(s.position,(E=t.value)==null?void 0:E.scene.globe.ellipsoid),u=Cesium.Cartographic.fromCartesian(m),C=Number(Cesium.Math.toDegrees(u.longitude).toFixed(6)),D=Number(Cesium.Math.toDegrees(u.latitude).toFixed(6));n===p.Point?(l.value=0,e.value=[{degrees:[C,D],index:l.value}],x(),r([C,D],l.value,16),(T=t.value)==null||T.scene.requestRender()):(e.value.push({degrees:[C,D],index:l.value}),r([C,D],l.value)),n===p.Polyline&&f.push(m.clone()),n===p.Polygon&&d.positions.push(m.clone()),l.value+=1}},Cesium.ScreenSpaceEventType.LEFT_CLICK),t.value.screenSpaceEventHandler.setInputAction(s=>{var c;const a=(c=t.value)==null?void 0:c.scene.pick(s.position);a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0?(o.value=a.id,t.value.scene.screenSpaceCameraController.enableRotate=!1,t.value.scene.screenSpaceCameraController.enableTranslate=!1,t.value.scene.screenSpaceCameraController.enableZoom=!1):o.value=void 0},Cesium.ScreenSpaceEventType.LEFT_DOWN),t.value.screenSpaceEventHandler.setInputAction(()=>{var s;o.value=void 0,t.value.scene.screenSpaceCameraController.enableRotate=!0,t.value.scene.screenSpaceCameraController.enableTranslate=!0,t.value.scene.screenSpaceCameraController.enableZoom=!0,(s=t.value)==null||s.scene.requestRender()},Cesium.ScreenSpaceEventType.LEFT_UP),t.value.screenSpaceEventHandler.setInputAction(s=>{var c,E;const a=(c=t.value)==null?void 0:c.scene.pick(s.endPosition);if(a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0)t.value._container.style.cursor="pointer",a.id.data&&ce(s.endPosition.x,s.endPosition.y,a.id.data);else{t.value._container.style.cursor="default";const g=document.getElementById("tips");g&&(g.style.display="none")}if(o.value){const g=Number(o.value.id),T=v(s.endPosition),m=ue(T);e.value[g].degrees=m;const u=t.value.entities.getById(String(g));u.position=M(m,10),u.label.text=`点${g+1}--[${m[0]},${m[1]}]`,n===p.Polyline&&(f[g]=T),n===p.Polygon&&(d.positions[g]=T),(E=t.value)==null||E.scene.requestRender()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE))},r=(n,s,a=6,c)=>{var E;(E=t.value)==null||E.entities.add({id:String(s),name:"point",data:c,position:Cesium.Cartesian3.fromDegrees(n[0],n[1],10),isStatic:!1,point:{pixelSize:a,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:`点${s+1}--[${n[0]},${n[1]}]`,font:"12px sans-serif",pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:Cesium.Color.RED,backgroundColor:Cesium.Color.WHITE.withAlpha(P),showBackground:!0}})},v=n=>t.value.camera.pickEllipsoid(n,t.value.scene.globe.ellipsoid),_=(n,s)=>{b(),n.forEach((a,c)=>{s===p.Point&&r(a.degrees,c,16,a.data),s===p.Polyline&&(r(a.degrees,c,6,a.data),f.push(M(a.degrees,10))),s===p.Polygon&&(r(a.degrees,c,6,a.data),d.positions.push(M(a.degrees,10)))}),e.value=n,l.value=n.length},b=()=>{e.value=[],l.value=0,f=[],d.positions=[]},z=()=>{var s;const n=(s=t.value)==null?void 0:s.entities.values.filter(a=>a.isStatic);n==null||n.forEach(a=>{var c;(c=t.value)==null||c.entities.remove(a)})},x=()=>{var s;const n=(s=t.value)==null?void 0:s.entities.values.filter(a=>!a.isStatic);n==null||n.forEach(a=>{var c;(c=t.value)==null||c.entities.remove(a)})};return{data:e,initEvent:R,reDraw:_,removeStaticEntites:z,removeNonStaticEntites:x,reset:b}},ce=(t,e,l)=>{if(l.data&&l.data.content){const o=document.getElementById("tips");if(o)o.style.display="block",o.style.left=t+10+"px",o.style.top=e+"px",o.innerHTML=`<div>${l.data.content}</div>`;else{const i=document.createElement("div");i.id="tips",i.style.position="absolute",i.style.backgroundColor="rgba(0,0,0,0.5)",i.style.color="white",i.style.padding="5px",i.style.borderRadius="5px",document.getElementById("cesium-container").appendChild(i),i.style.left=t+10+"px",i.style.top=e+"px"}}},ue=t=>{const e=Cesium.Cartographic.fromCartesian(t),l=Number(Cesium.Math.toDegrees(e.longitude).toFixed(6)),o=Number(Cesium.Math.toDegrees(e.latitude).toFixed(6));return[l,o]},M=(t,e)=>Cesium.Cartesian3.fromDegrees(t[0],t[1],e),de=t=>{let e=Cesium.Cartesian3.ZERO;const l=t.length;t.forEach(d=>{e=Cesium.Cartesian3.add(e,d,new Cesium.Cartesian3)}),e=Cesium.Cartesian3.divideByScalar(e,l,new Cesium.Cartesian3);const o=Cesium.Cartographic.fromCartesian(e),i=Number(Cesium.Math.toDegrees(o.longitude).toFixed(6)),P=Number(Cesium.Math.toDegrees(o.latitude).toFixed(6));return[i,P]},me=t=>(Q("data-v-00328037"),t=t(),X(),t),pe={id:"cesium-container"},fe=me(()=>w("div",{id:"cesium"},null,-1)),ve={class:"shortcut-keys"},ge={name:"Cesium"},Ce=H({...ge,emits:["save"],setup(t,{expose:e,emit:l}){const o=$({filter:"",type:void 0,search:"",radio:"",visible:!1,drawType:p.Point,isFull:!1});let{viewer:i,zoomFn:P,loadRoadNetwork:d,destroyed:h,init:f,adjustNorthUp:I,flyTo:R}=ie();const{data:r,initEvent:v,reDraw:_,reset:b}=re(i),z=l,x=m=>{P(m,200)},n=()=>{var m=document.fullscreenElement;if(m)document.exitFullscreen(),o.isFull=!1;else{const u=document.getElementById("cesium-container");u.requestFullscreen&&(u.requestFullscreen(),o.isFull=!0)}},s=()=>{I()},a=()=>{d()},c=()=>{z("save",r.value),E()},E=()=>{b(),h(),r.value=[],o.visible=!1},g=m=>{if(!m.length)return;const u=m.map((S,W)=>({degrees:[S.lon,S.lat],index:W,data:S.flag}));_(u,o.drawType);const C=m.map(S=>M([S.lon,S.lat])),[D,L]=de(C);R(D,L)};return e({open:(m,u)=>{o.drawType=m,o.visible=!0,J(()=>{f(),v(o.drawType),u&&i.value&&g(u)})}}),(m,u)=>{const C=A,D=G,L=q;return V(),K(L,{title:"地图标点",width:"80%",modelValue:o.visible,"onUpdate:modelValue":u[2]||(u[2]=S=>o.visible=S),center:"",top:"0",fullscreen:!0,onClose:E,class:"gis-dialog","destroy-on-close":"","append-to-body":!0},{default:F(()=>[w("div",pe,[fe,w("div",ve,[y(D,null,{default:F(()=>[y(C,{title:"文字图层控制",icon:k(ae),onClick:a},null,8,["icon"]),y(C,{title:"定位",icon:k(oe),onClick:s},null,8,["icon"]),y(C,{title:"放大",icon:k(ne),onClick:u[0]||(u[0]=S=>x("zoomIn"))},null,8,["icon"]),y(C,{title:"缩小",icon:k(se),onClick:u[1]||(u[1]=S=>x("zoomOut"))},null,8,["icon"]),y(C,{title:"全屏控制",onClick:n,icon:k(le)},null,8,["icon"])]),_:1})]),y(C,{type:"primary",class:"save",onClick:c},{default:F(()=>[O("保存")]),_:1})])]),_:1},8,["modelValue"])}}}),ye=U(Ce,[["__scopeId","data-v-00328037"]]),he={class:"gis-getdata"},_e={class:"code"},Ee={class:"handle"},Se={name:"getData"},be=H({...Se,setup(t){const e=$({drawType:p.Point,formData:{pointData:[]},code:""});Y(()=>e.formData.pointData,(d,h)=>{const f=JSON.stringify(d);e.code=f},{deep:!0,immediate:!0});const l=N(),o=()=>{var d;(d=l.value)==null||d.open(e.drawType,e.formData.pointData)},i=d=>{d&&(e.formData.pointData=d.map(h=>({lon:h.degrees[0],lat:h.degrees[1]})))},P=()=>{e.formData.pointData=[]};return(d,h)=>{const f=j,I=Z,R=A;return V(),ee("div",he,[w("div",_e,te(e.code),1),w("div",Ee,[y(I,{modelValue:e.drawType,"onUpdate:modelValue":h[0]||(h[0]=r=>e.drawType=r),onChange:P},{default:F(()=>[y(f,{label:"画点",value:k(p).Point},null,8,["value"]),y(f,{label:"画线",value:k(p).Polyline},null,8,["value"]),y(f,{label:"画面",value:k(p).Polygon},null,8,["value"])]),_:1},8,["modelValue"]),y(R,{type:"primary",onClick:o},{default:F(()=>[O("标点")]),_:1})]),y(ye,{ref_key:"gisSignRef",ref:l,onSave:i},null,512)])}}}),Ae=U(be,[["__scopeId","data-v-3971aae3"]]);export{Ae as default};
