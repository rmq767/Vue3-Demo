import{c as j,b as Z,a as ae,d as oe,e as ne}from"./element-plus-vO1D8aWL.js";import{s as O,r as $,d as A,o as H,c as G,a as _,V as u,Q as E,u as P,aw as K,ax as Q,e as J,ai as se,P as le,T as Y,U as X,n as ie,w as re}from"./@vue-1pEateLc.js";import{e as ce,Q as ue,R as de,S as me,B as pe,A as fe,T as ve,U as ge,r as Ce}from"./@element-plus-sRoPj2gC.js";import{_ as U}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-1TH0Fy64.js";import"./acorn-bQvPYi_r.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";var h=(e=>(e.Point="point",e.Polyline="polyline",e.Polygon="polygon",e))(h||{}),ee=(e=>(e[e.Plan=0]="Plan",e[e.Block=1]="Block",e[e.Platform=2]="Platform",e[e.Well=3]="Well",e[e.Pipeline=4]="Pipeline",e[e.Device=5]="Device",e))(ee||{});const _e=e=>{const t=O(),r=O(),n=$(!1),o={lookAt:[108.341768,22.804393,1e7],max:1e7,min:100,flyHeight:1e3,pitch:-.5,...e};let d,i=null;const p=async()=>{t.value=new Cesium.Viewer("cesium",{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),t.value.scene.screenSpaceCameraController.minimumZoomDistance=o.min,t.value.scene.screenSpaceCameraController.maximumZoomDistance=o.max,t.value.cesiumWidget.creditContainer.style.display="none",t.value.resolutionScale=window.devicePixelRatio,t.value.scene.postProcessStages.fxaa.enabled=!0,t.value.camera.setView({destination:Cesium.Cartesian3.fromDegrees(o.lookAt[0],o.lookAt[1],o.lookAt[2]),orientation:{heading:0,pitch:-Cesium.Math.PI/180*80,roll:0}}),t.value.screenSpaceEventHandler.setInputAction(()=>{v("zoomIn")},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},v=(m,g=1e4)=>{var s,l;m==="zoomIn"?(s=t.value)==null||s.camera.zoomIn(g):(l=t.value)==null||l.camera.zoomOut(g)};return{viewer:t,zoomFn:v,adjustNorthUp:()=>{var m,g,s,l,a,c;if(i)(m=t.value)==null||m.camera.flyToBoundingSphere(i,{offset:new Cesium.HeadingPitchRange(0,-Cesium.Math.PI/2,0)});else{const y=-Cesium.Math.PI/2,C=Cesium.Math.PI*2;if(((g=t.value)==null?void 0:g.scene.camera.heading)===C&&((s=t.value)==null?void 0:s.scene.camera.pitch)===y&&((l=t.value)==null?void 0:l.scene.camera.roll)===0)return;const I=t.value.camera.pickEllipsoid(new Cesium.Cartesian2(t.value.canvas.clientWidth/2,t.value.canvas.clientHeight/2))||((a=t.value)==null?void 0:a.camera.position),S=Cesium.Ellipsoid.WGS84.cartesianToCartographic(I),w=S.longitude*180/Math.PI,R=S.latitude*180/Math.PI;(c=t.value)==null||c.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(w,R,o.flyHeight),orientation:{heading:0,pitch:y,roll:0},duration:2})}},loadRoadNetwork:()=>{var m;n.value?((m=t.value)==null||m.imageryLayers.remove(r.value,!0),n.value=!1):(r.value=t.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),n.value=!0)},flyTo:(m,g,s=o.flyHeight)=>{var a;const l=B([m,g]);i=new Cesium.BoundingSphere(l,s),(a=t.value)==null||a.camera.flyToBoundingSphere(i,{offset:new Cesium.HeadingPitchRange(0,o.pitch,0),complete:()=>{var C;const c=(C=t.value)==null?void 0:C.camera.positionCartographic,y=c==null?void 0:c.height;y&&(o.flyHeight=y)}})},destroyed:()=>{var m,g;(m=t.value)==null||m.entities.removeAll(),(g=t.value)==null||g.destroy(),t.value=void 0},init:p,orbitTickFunction:(m,g)=>{var s,l,a,c;(s=t.value)==null||s.camera.lookAtTransform(d),(l=t.value)==null||l.camera.rotateLeft(m),(a=t.value)==null||a.camera.rotateUp(g),(c=t.value)==null||c.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)},getFrame:()=>{let m=new Cesium.Cartesian3;const g=t.value.camera,s=t.value.scene,l=new Cesium.Ray;l.origin=g.positionWC,l.direction=g.directionWC,m=s.globe.pick(l,s,m)||t.value.camera.position,m=g.worldToCameraCoordinatesPoint(m,m);const a=new Cesium.Matrix4;d=Cesium.Transforms.eastNorthUpToFixedFrame(m,s.globe.ellipsoid,a)}}},ye=(e,t)=>{const r=$([]),n=$(0),o=O(),d=.5;let i=[];const p=new Cesium.Entity({name:"polygon",isStatic:!1,polyline:{positions:new Cesium.CallbackProperty(function(){let s=[];return i.length>=3?s=[...i,i[0]]:s=[...i],s},!1),width:4,clampToGround:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED.withAlpha(1),dashLength:20})}});let v=[];const x=new Cesium.Entity({name:"polyline",isStatic:!1,polyline:{positions:new Cesium.CallbackProperty(function(){return v},!1),width:20,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.WHITE)}}),L=s=>{if(e.value){if(s===h.Polyline&&e.value.entities.add(x),s===h.Polygon){const l=e.value.entities.add(p);t&&t.value===ee.Platform&&(l.polyline.material=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.BLUE.withAlpha(1),dashLength:20}))}e.value.screenSpaceEventHandler.setInputAction(l=>{var c,y,C,I;const a=(c=e.value)==null?void 0:c.scene.pick(l.position);if(!a||a.id.isStatic){const S=(C=e.value)==null?void 0:C.camera.pickEllipsoid(l.position,(y=e.value)==null?void 0:y.scene.globe.ellipsoid),w=Cesium.Cartographic.fromCartesian(S),R=Number(Cesium.Math.toDegrees(w.longitude).toFixed(6)),b=Number(Cesium.Math.toDegrees(w.latitude).toFixed(6));s===h.Point?(n.value=0,r.value=[{degrees:[R,b],index:n.value}],g(),D([R,b],n.value,16),(I=e.value)==null||I.scene.requestRender()):(r.value.push({degrees:[R,b],index:n.value}),D([R,b],n.value)),s===h.Polyline&&v.push(S.clone()),s===h.Polygon&&i.push(S.clone()),n.value+=1}},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.value.screenSpaceEventHandler.setInputAction(l=>{var c;const a=(c=e.value)==null?void 0:c.scene.pick(l.position);a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0?(o.value=a.id,e.value.scene.screenSpaceCameraController.enableRotate=!1,e.value.scene.screenSpaceCameraController.enableTranslate=!1,e.value.scene.screenSpaceCameraController.enableZoom=!1):o.value=void 0},Cesium.ScreenSpaceEventType.LEFT_DOWN),e.value.screenSpaceEventHandler.setInputAction(()=>{var l;o.value=void 0,e.value.scene.screenSpaceCameraController.enableRotate=!0,e.value.scene.screenSpaceCameraController.enableTranslate=!0,e.value.scene.screenSpaceCameraController.enableZoom=!0,(l=e.value)==null||l.scene.requestRender()},Cesium.ScreenSpaceEventType.LEFT_UP),e.value.screenSpaceEventHandler.setInputAction(l=>{var c,y;const a=(c=e.value)==null?void 0:c.scene.pick(l.endPosition);if(a&&a.id&&a.id.name!=="polygon"&&a.id.name!=="polyline"&&a.id.name!=="areaLine"&&a.id.name!=="area"&&a.id.name!==void 0)e.value._container.style.cursor="pointer",a.id.data&&he(l.endPosition.x,l.endPosition.y,a.id.data);else{e.value._container.style.cursor="default";const C=document.getElementById("cesium-tips");C&&(C.style.display="none")}if(o.value){const C=Number(o.value.id),I=M(l.endPosition),S=be(I);r.value[C].degrees=S;const w=e.value.entities.getById(String(C));w.position=B(S,10),w.label.text=`点${C+1}--[${S[0]},${S[1]}]`,s===h.Polyline&&(v[C]=I),s===h.Polygon&&(i[C]=I),(y=e.value)==null||y.scene.requestRender()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},D=(s,l,a=6,c)=>{var y;(y=e.value)==null||y.entities.add({id:String(l),name:"point",data:c,position:Cesium.Cartesian3.fromDegrees(s[0],s[1],10),isStatic:!1,point:{pixelSize:a,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:`点${l+1}--[${s[0]},${s[1]}]`,font:"12px sans-serif",pixelOffset:new Cesium.Cartesian2(0,-20),fillColor:Cesium.Color.RED,backgroundColor:Cesium.Color.WHITE.withAlpha(d),showBackground:!0}})},M=s=>e.value.camera.pickEllipsoid(s,e.value.scene.globe.ellipsoid),F=(s,l)=>{N(),s.forEach((a,c)=>{l===h.Point&&D(a.degrees,c,16,a.data),l===h.Polyline&&(D(a.degrees,c,6,a.data),v.push(B(a.degrees,10))),l===h.Polygon&&(D(a.degrees,c,6,a.data),i.push(B(a.degrees,10)))}),r.value=s,n.value=s.length},N=()=>{r.value=[],n.value=0,v=[],i=[]},m=()=>{var l;const s=(l=e.value)==null?void 0:l.entities.values.filter(a=>a.isStatic);s==null||s.forEach(a=>{var c;(c=e.value)==null||c.entities.remove(a)})},g=()=>{var l;const s=(l=e.value)==null?void 0:l.entities.values.filter(a=>!a.isStatic);s==null||s.forEach(a=>{var c;(c=e.value)==null||c.entities.remove(a)})};return{data:r,initEvent:L,reDraw:F,removeStaticEntites:m,removeNonStaticEntites:g,reset:N}},he=(e,t,r)=>{if(r.data&&r.data.content){const n=document.getElementById("cesium-tips");if(n)n.style.display="block",n.style.left=e+20+"px",n.style.top=t+"px",n.innerHTML=`<div>${r.data.content}</div>`;else{const o=document.createElement("div");o.id="cesium-tips",o.style.position="absolute",o.style.backgroundColor="rgba(0,0,0,0.8)",o.style.color="white",o.style.zIndex="999",o.style.maxWidth="250px",o.style.fontSize="14px",o.style.lineHeight="20px",o.style.padding="8px",o.style.borderRadius="5px",document.getElementById("cesium-container").appendChild(o),o.style.left=e+20+"px",o.style.top=t+"px"}}},be=e=>{const t=Cesium.Cartographic.fromCartesian(e),r=Number(Cesium.Math.toDegrees(t.longitude).toFixed(6)),n=Number(Cesium.Math.toDegrees(t.latitude).toFixed(6));return[r,n]},B=(e,t)=>Cesium.Cartesian3.fromDegrees(e[0],e[1],t),Pe=e=>{let t=Cesium.Cartesian3.ZERO;const r=e.length;e.forEach(i=>{t=Cesium.Cartesian3.add(t,i,new Cesium.Cartesian3)}),t=Cesium.Cartesian3.divideByScalar(t,r,new Cesium.Cartesian3);const n=Cesium.Cartographic.fromCartesian(t),o=Number(Cesium.Math.toDegrees(n.longitude).toFixed(6)),d=Number(Cesium.Math.toDegrees(n.latitude).toFixed(6));return[o,d]},Se=e=>{let t=0,r,n;for(let o=0;o<e.length;o++)for(let d=o+1;d<e.length;d++){const i=Cesium.Cartesian3.distance(e[o],e[d]);i>t&&(t=i,r=e[o],n=e[d])}return{maxDistance:t,farthestPoint1:r,farthestPoint2:n}},Ee=e=>(K("data-v-20f4bba5"),e=e(),Q(),e),ke={class:"inner"},xe=Ee(()=>_("div",{class:"inner-circle"},null,-1)),De=A({__name:"cameraControl",emits:["moveCamera","mouse-down","mouse-up"],setup(e,{emit:t}){const r=t;let n=null;const o=i=>{r("mouse-down"),n=setInterval(()=>{r("moveCamera",i)},10)},d=()=>{clearInterval(n),r("mouse-up")};return(i,p)=>{const v=j;return H(),G("div",ke,[_("div",{class:"outer",onMousedown:p[0]||(p[0]=x=>o("top")),onMouseup:d},[u(v,null,{default:E(()=>[u(P(ce))]),_:1})],32),_("div",{class:"outer",onMousedown:p[1]||(p[1]=x=>o("right")),onMouseup:d},[u(v,null,{default:E(()=>[u(P(ue))]),_:1})],32),_("div",{class:"outer",onMousedown:p[2]||(p[2]=x=>o("bottom")),onMouseup:d},[u(v,null,{default:E(()=>[u(P(de))]),_:1})],32),_("div",{class:"outer",onMousedown:p[3]||(p[3]=x=>o("left")),onMouseup:d},[u(v,null,{default:E(()=>[u(P(me))]),_:1})],32),xe])}}}),Ie=U(De,[["__scopeId","data-v-20f4bba5"]]),we={class:"btn-group-zoom"},Te={name:"GisZoom"},Me=A({...Te,emits:["zoom"],setup(e,{emit:t}){const r=t,n=o=>{r("zoom",o)};return(o,d)=>{const i=Z;return H(),G("div",we,[u(i,{type:"primary",size:"small",icon:P(pe),onClick:d[0]||(d[0]=p=>n("zoomIn"))},null,8,["icon"]),u(i,{type:"primary",size:"small",icon:P(fe),onClick:d[1]||(d[1]=p=>n("zoomOut"))},null,8,["icon"])])}}}),Re=U(Me,[["__scopeId","data-v-32e30e9e"]]),q=e=>(K("data-v-4344db19"),e=e(),Q(),e),Le={id:"cesium-container"},Ne=q(()=>_("div",{id:"cesium"},null,-1)),ze={class:"shortcut-keys"},Be={class:"btn-group"},$e={class:"btn-content"},Fe=q(()=>_("span",null,"路网地名",-1)),Ae={class:"btn-content"},He=q(()=>_("span",null,"正向俯视",-1)),Ue={class:"btn-content"},Ve={name:"Cesium"},We=A({...Ve,emits:["save"],setup(e,{expose:t,emit:r}){const n=J({checked:["1","2","3","4","5","直井","水平井","定向井"],visible:!1,drawType:h.Point,isFull:!1,filterType:void 0,filterName:"",filterId:""}),o=$();let{viewer:d,zoomFn:i,loadRoadNetwork:p,destroyed:v,init:x,adjustNorthUp:L,flyTo:D,orbitTickFunction:M,getFrame:F}=_e();const{data:N,initEvent:m,reDraw:g,reset:s,removeStaticEntites:l}=ye(d,o),a=r,c=()=>{var b=document.fullscreenElement;if(b)document.exitFullscreen(),n.isFull=!1;else{const k=document.getElementById("cesium-container");k.requestFullscreen&&(k.requestFullscreen(),n.isFull=!0)}},y=()=>{F()},C=b=>{var f;const k=((f=d.value)==null?void 0:f.camera.pitch)||Number((-Cesium.Math.PI/2).toFixed(15));switch(b){case"top":k<=Cesium.Math.toRadians(-10)&&M(0,.01);break;case"bottom":k>Cesium.Math.toRadians(-90)&&M(0,-.01);break;case"left":M(.01,0);break;case"right":M(-.01,0);break}},I=()=>{a("save",N.value),S()},S=()=>{s(),v(),N.value=[],n.visible=!1},w=b=>{if(!b.length)return;const k=b.map((T,te)=>({degrees:[T.lon,T.lat],index:te,data:T.flag}));g(k,n.drawType);const f=b.map(T=>B([T.lon,T.lat])),[z,V]=Pe(f),{maxDistance:W}=Se(f);D(z,V,W)};return t({open:(b,k,f)=>{n.drawType=b,o.value=f==null?void 0:f.editType,n.filterType=f==null?void 0:f.filterType,n.filterId=f==null?void 0:f.filterId,n.filterName=f==null?void 0:f.filterName,n.visible=!0,ie(()=>{x(),m(n.drawType),k&&d.value&&w(k)})}}),(b,k)=>{const f=j,z=Z,V=se("LengendDialog"),W=ae;return H(),le(W,{title:"地图标点",modelValue:n.visible,"onUpdate:modelValue":k[0]||(k[0]=T=>n.visible=T),center:"",fullscreen:!0,onClose:S,class:"gis-dialog","destroy-on-close":"","append-to-body":!0},{default:E(()=>[_("div",Le,[Ne,_("div",ze,[_("div",Be,[u(z,{title:"路网地名",onClick:P(p)},{default:E(()=>[_("div",$e,[u(f,null,{default:E(()=>[u(P(ve))]),_:1}),Fe])]),_:1},8,["onClick"]),u(z,{title:"正向俯视",onClick:P(L)},{default:E(()=>[_("div",Ae,[u(f,null,{default:E(()=>[u(P(ge))]),_:1}),He])]),_:1},8,["onClick"]),u(z,{title:"全屏控制",onClick:c},{default:E(()=>[_("div",Ue,[u(f,null,{default:E(()=>[u(P(Ce))]),_:1}),_("span",null,Y(n.isFull?"退出全屏":"全屏"),1)])]),_:1}),u(Re,{onZoom:P(i),class:"zoom-control"},null,8,["onZoom"])])]),u(z,{type:"primary",class:"save",onClick:I},{default:E(()=>[X("保存")]),_:1})]),u(Ie,{class:"camera-control",onMoveCamera:C,onMouseDown:y}),u(V,{ref:"lengendDialogRef"},null,512)]),_:1},8,["modelValue"])}}}),Oe=U(We,[["__scopeId","data-v-4344db19"]]),Ze={class:"gis-getdata"},Ge={class:"code"},qe={class:"handle"},je={name:"getData"},Ke=A({...je,setup(e){const t=J({drawType:h.Point,formData:{pointData:[]},code:""});re(()=>t.formData.pointData,(i,p)=>{const v=JSON.stringify(i);t.code=v},{deep:!0,immediate:!0});const r=$(),n=()=>{var i;(i=r.value)==null||i.open(t.drawType,t.formData.pointData)},o=i=>{i&&(t.formData.pointData=i.map(p=>({lon:p.degrees[0],lat:p.degrees[1]})))},d=()=>{t.formData.pointData=[]};return(i,p)=>{const v=ne,x=oe,L=Z;return H(),G("div",Ze,[_("div",Ge,Y(t.code),1),_("div",qe,[u(x,{modelValue:t.drawType,"onUpdate:modelValue":p[0]||(p[0]=D=>t.drawType=D),onChange:d},{default:E(()=>[u(v,{label:"画点",value:P(h).Point},null,8,["value"]),u(v,{label:"画线",value:P(h).Polyline},null,8,["value"]),u(v,{label:"画面",value:P(h).Polygon},null,8,["value"])]),_:1},8,["modelValue"]),u(L,{type:"primary",onClick:n},{default:E(()=>[X("标点")]),_:1})]),u(Oe,{ref_key:"gisSignRef",ref:r,onSave:o},null,512)])}}}),ut=U(Ke,[["__scopeId","data-v-3971aae3"]]);export{ut as default};
