import{f as K,g as W,h as Z,j as ee,k as te,l as ae,b as U,m as le,n as ne,o as oe,p as se,q as re}from"./element-plus-gomRs06A.js";import{d as M,r as R,e as q,o as f,c as C,V as r,Q as c,a as V,F,a8 as S,T as ce,P as T,S as L,J as $,aa as ie,M as de,ai as ue,u as P,U as B,n as pe}from"./@vue-1pEateLc.js";import{_ as D}from"./plugin-vueexport-helper-x3n3nnut.js";import{o as me,M as fe}from"./@element-plus-GFHZwatb.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const _e={class:"fn-panel"},be={class:"operation"},ve=["title","onClick"],xe={class:"operation"},ge=["title","onClick","innerHTML"],ye={name:"FnPanel"},ke=M({...ye,emits:["getValue"],setup(w,{emit:k}){const g=R(["1","2"]),n=q({operation:[{label:"=",value:"=",key:"=",index:1,desc:"等于"},{label:"+",value:"+",key:"+",index:1,desc:"加"},{label:"-",value:"-",key:"-",index:1,desc:"减"},{label:"*",value:"*",key:"*",index:1,desc:"乘"},{label:"/",value:"/",key:"/",index:1,desc:"除"},{label:"^",value:"^",key:"^",index:1,desc:"幂"},{label:"(",value:"(",key:"(",index:1,desc:"左括号"},{label:")",value:")",key:")",index:1,desc:"右括号"}],fn:[{label:"exp()",value:"exp()",desc:"e为底的指数函数"},{label:"sqrt()",value:"sqrt()",desc:"平方根"},{label:"ln()",value:"ln()",desc:"e为底的对数"},{label:"log10()",value:"log10()",desc:"10为底的对数"},{label:"log2()",value:"log2()",desc:"2为底的对数"},{label:"abs()",value:"abs()",desc:"绝对值"},{label:"sin()",value:"sin()",desc:"正弦函数"},{label:"cos()",value:"cos()",desc:"余弦函数"},{label:"tan()",value:"tan()",desc:"正切函数"},{label:"asin()",value:"asin()",desc:"反正弦函数"},{label:"acos()",value:"acos()",desc:"反余弦函数"},{label:"atan()",value:"atan()",desc:"反正切函数"}]}),i=k,e=(l,m)=>{i("getValue",{item:m,type:l})};return(l,m)=>{const E=K,h=W;return f(),C("div",_e,[r(h,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=t=>g.value=t)},{default:c(()=>[r(E,{title:"运算符",name:"1"},{default:c(()=>[V("div",be,[(f(!0),C(F,null,S(n.operation,t=>(f(),C("div",{key:t.value,title:t.desc,tabindex:-1,onClick:_=>e("operation",t)},ce(t.value),9,ve))),128))])]),_:1}),r(E,{title:"函数",name:"2"},{default:c(()=>[V("div",xe,[(f(!0),C(F,null,S(n.fn,t=>(f(),C("div",{key:t.value,title:t.desc,onClick:_=>e("fn",t),tabindex:-1,innerHTML:t.value},null,8,ge))),128))])]),_:1})]),_:1},8,["modelValue"])])}}}),he=D(ke,[["__scopeId","data-v-05c7e2e6"]]),I=M({__name:"index",props:{data:{},column:{},index:{type:Boolean,default:!0},radio:{type:Boolean,default:!1}},setup(w,{expose:k}){const g=w,n=R(),i=[{color:"#F56C6C",percentage:50},{color:"#E6A23C",percentage:60},{color:"#409EFF",percentage:80},{color:"#67C23A",percentage:100}];return k({tableRef:n}),(e,l)=>{const m=Z,E=ee,h=te;return f(),T(h,de({ref_key:"tableRef",ref:n,data:g.data},e.$attrs),{default:c(()=>[g.index?(f(),T(m,{key:0,align:"center",label:"序号",type:"index",width:"60"})):L("",!0),g.radio?(f(),T(m,{key:1,align:"center",label:"单选",width:"60"},{default:c(({row:t})=>[$(e.$slots,"radio",{row:t})]),_:3})):L("",!0),(f(!0),C(F,null,S(e.column,t=>(f(),T(m,{key:t.label,prop:t.prop,label:t.label,width:t.width,align:"center","column-key":t.prop,filters:t.filters},ie({_:2},[t.template==="progress"?{name:"default",fn:c(({row:_})=>[r(E,{"text-inside":!0,"stroke-width":16,percentage:_[t.prop]<=1?_[t.prop]*100:_[t.prop],color:_.color?_.color:i},null,8,["percentage","color"])]),key:"0"}:t.slot?{name:"default",fn:c(({row:_})=>[$(e.$slots,t.slot,{row:_})]),key:"1"}:void 0]),1032,["prop","label","width","column-key","filters"]))),128)),$(e.$slots,"default")]),_:3},16,["data"])}}}),Ce={class:"check"},Ee={class:"mb-1 mt-4"},Te={name:"CreateFn"},Re=M({...Te,emits:["submit"],setup(w,{expose:k,emit:g}){const n=q({visible:!1,fn:"",search:"",activeTab:"1",tableData:[{abbreviation:"y",name:"Y参数",id:"1"},{abbreviation:"x",name:"X参数",id:"2"},{abbreviation:"a",name:"A参数",id:"3"},{abbreviation:"b",name:"B参数",id:"4"}],column:[{label:"参数缩写",prop:"abbreviation"},{label:"参数名称",prop:"name"},{label:"参数单位",prop:"unit"},{label:"默认取值范围",prop:"range"},{label:"创建人",prop:"creator"},{label:"参数解释",prop:"remark"}],type:"combo"}),i=R();let e,l=null;const m=R(),E=R();let h;const t=g,_=o=>{l=window.getSelection(),e=l==null?void 0:l.getRangeAt(0).cloneRange()},H=o=>{X(o)},O=({item:o,type:a})=>{const d=document.createTextNode(o.value);e==null||e.deleteContents(),e==null||e.insertNode(d),e==null||e.setStartAfter(d),e==null||e.setEndAfter(d),e==null||e.collapse(!0),l==null||l.removeAllRanges(),l==null||l.addRange(e)},X=o=>{let a=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${o.id}">`,d="</span>",u=document.createElement("span");u.innerHTML=a+o.abbreviation+d;let s=document.createDocumentFragment().appendChild(u.firstChild);e==null||e.deleteContents(),e==null||e.insertNode(s),e==null||e.setStartAfter(s),e==null||e.collapse(!0),l==null||l.removeAllRanges(),l==null||l.addRange(e)},j=()=>{var b;const o=(b=i.value)==null?void 0:b.getElementsByClassName("fn-param");let a=i.value.innerHTML,d=/<span class="fake" contenteditable="false">[\s\S]*?<\/span>/g;a=a.replace(d,"");const u=[];if(o)for(let s=0;s<o.length;s++){const p=o[s],v=a.indexOf(p.outerHTML);u.push({name:p.innerText,id:p.dataset.param,index:v}),a=a.replace(p.outerHTML,p.innerText)}return{text:i.value.innerText,params:u}},G=()=>{const{text:o,params:a}=j();if(o.length===0){ae.warning("请编辑函数内容！");return}console.log(o,a),t("submit",{text:o,params:a}),N()},J=o=>{const{fn:a,params:d}=o;let u=a,b=0;d.forEach(s=>{const x=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${s.id}">`+s.name+"</span>";u=u.replaceAll(s.name,(y,A)=>A===s.index+b?x:y),b+=x.length-s.name.length}),pe(()=>{i.value.innerHTML=u})},Q=()=>{h=new MutationObserver((o,a)=>{for(const d of o)d.type==="characterData"&&setTimeout(()=>{var b;const u=i.value.lastChild;if(u&&u.nodeType===Node.TEXT_NODE){const s=(b=i.value)==null?void 0:b.childNodes;s==null||s.forEach(y=>{var A;y.className==="fake"&&((A=i.value)==null||A.removeChild(y))});const p=document.createRange();p.setStartAfter(u),p.setEndAfter(u);const v=document.createElement("span");v.className="fake",v.contentEditable="false",v.textContent="​",p.deleteContents(),p.insertNode(v),p.setStartAfter(v),p.setEndAfter(v);const x=window.getSelection();x==null||x.removeAllRanges(),x==null||x.addRange(p)}},100)}),h.observe(i.value,{characterData:!0,subtree:!0})},Y=(o,a)=>{n.type=o,n.visible=!0,a&&J(a),!a&&setTimeout(()=>{var d;(d=i.value)==null||d.focus(),Q()},0)},N=()=>{n.fn="",n.search="",i.value.innerHTML="",n.visible=!1,h==null||h.disconnect()},z=(o,a)=>{console.log(o,a)};return k({open:Y}),(o,a)=>{const d=U,u=le,b=ne,s=oe,p=se,v=re,x=ue("MyDialog");return f(),T(x,{modelValue:n.visible,"onUpdate:modelValue":a[2]||(a[2]=y=>n.visible=y),title:"函数编辑器",fullscreen:"",onClose:N,onCancel:N,onSubmit:G},{default:c(()=>[r(b,{gutter:20},{default:c(()=>[r(u,{span:12,class:"panel"},{default:c(()=>[V("div",{ref_key:"textRef",ref:i,class:"fn-editor",contenteditable:"true",onBlur:_},null,544),V("div",Ce,[r(d,{type:"primary",icon:P(me)},{default:c(()=>[B("函数校验")]),_:1},8,["icon"])])]),_:1}),r(u,{span:12},{default:c(()=>[r(he,{onGetValue:O})]),_:1})]),_:1}),V("div",Ee,[r(s,{modelValue:n.search,"onUpdate:modelValue":a[0]||(a[0]=y=>n.search=y),style:{width:"300px"},placeholder:"参数名称"},{append:c(()=>[r(d,{icon:P(fe)},null,8,["icon"])]),_:1},8,["modelValue"])]),r(v,{modelValue:n.activeTab,"onUpdate:modelValue":a[1]||(a[1]=y=>n.activeTab=y),onTabClick:z},{default:c(()=>[r(p,{label:"函数参数库",name:"1"},{default:c(()=>[r(I,{ref_key:"tableRef1",ref:m,data:n.tableData,column:n.column,"highlight-current-row":"",onRowClick:H},null,8,["data","column"])]),_:1}),n.type==="basic"?(f(),T(p,{key:0,label:"组合函数库",name:"2"},{default:c(()=>[r(I,{ref_key:"tableRef2",ref:E,data:n.tableData,column:n.column,"highlight-current-row":"",onRowClick:H},null,8,["data","column"])]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ve=D(Re,[["__scopeId","data-v-118b91cc"]]),we={class:"fn-editor-container"},Ae={name:"FnEditor"},Me=M({...Ae,setup(w){const k=R(),g=({text:e,params:l})=>{console.log(e,l)},n=()=>{var e;(e=k.value)==null||e.open("basic")},i=()=>{var l;const e={fn:"y=exp(x)+sqrt(a)a",params:[{name:"y",id:"1",index:0},{name:"x",id:"2",index:6},{name:"a",id:"3",index:14}]};(l=k.value)==null||l.open("combo",e)};return(e,l)=>{const m=U;return f(),C("div",we,[r(m,{type:"primary",onClick:n},{default:c(()=>[B("编辑函数")]),_:1}),r(m,{type:"warning",onClick:i},{default:c(()=>[B("修改函数")]),_:1}),r(Ve,{ref_key:"fnEditorRef",ref:k,onSubmit:g},null,512)])}}}),je=D(Me,[["__scopeId","data-v-8da8daed"]]);export{je as default};
