const K={toURL(e,t){let s=encodeURIComponent(e);return t==="text"?s="data:text/plain;charset=utf-8,"+s:t==="svg"&&(s="data:image/svg+xml,"+s),s},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(e){const{prefix:t,suffix:s}=K.image;return s&&!e.startsWith("data:")&&!e.startsWith("blob:")&&(e+=(e.includes("?")?"&":"?")+s),t&&e[0]==="/"&&(e=t+e),e}}},Je={},rt={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(e){const{types:t}=Mi;return t[e]?t[e]++:(t[e]=1,0)}},Mi=rt,{round:Ai,pow:$i,PI:Ve}=Math,ut={within(e,t,s){return typeof t=="object"&&(s=t.max,t=t.min),t!==void 0&&e<t&&(e=t),s!==void 0&&e>s&&(e=s),e},fourNumber(e,t){let s;if(e instanceof Array)switch(e.length){case 4:s=t===void 0?e:[...e];break;case 2:s=[e[0],e[1],e[0],e[1]];break;case 3:s=[e[0],e[1],e[2],e[1]];break;case 1:e=e[0];break;default:e=0}if(s||(s=[e,e,e,e]),t)for(let i=0;i<4;i++)s[i]>t&&(s[i]=t);return s},formatRotation(e,t){return e%=360,t?e<0&&(e+=360):(e>180&&(e-=360),e<-180&&(e+=360)),ut.float(e)},getGapRotation(e,t,s=0){let i=e+s;if(t>1){const n=Math.abs(i%t);(n<1||n>t-1)&&(i=Math.round(i/t)*t)}return i-s},float(e,t){const s=t?$i(10,t):1e12;return e=Ai(e*s)/s,e===-0?0:e},getScaleData(e,t,s,i){return i||(i={}),t?(i.scaleX=(typeof t=="number"?t:t.width)/s.width,i.scaleY=(typeof t=="number"?t:t.height)/s.height):e&&ut.assignScale(i,e),i},assignScale(e,t){typeof t=="number"?e.scaleX=e.scaleY=t:(e.scaleX=t.x,e.scaleY=t.y)}},k=Ve/180,q=Ve*2,It=Ve/2;function Wi(){return{x:0,y:0}}function gi(){return{x:0,y:0,width:0,height:0}}function oe(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:ge,cos:ye,acos:Xt,sqrt:me}=Math,{float:Tt}=ut,kt={};function hs(){return Object.assign(Object.assign(Object.assign({},oe()),gi()),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const b={defaultMatrix:oe(),defaultWorld:hs(),tempMatrix:{},set(e,t=1,s=0,i=0,n=1,o=0,r=0){e.a=t,e.b=s,e.c=i,e.d=n,e.e=o,e.f=r},get:oe,getWorld:hs,copy(e,t){e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f},translate(e,t,s){e.e+=t,e.f+=s},translateInner(e,t,s,i){e.e+=e.a*t+e.c*s,e.f+=e.b*t+e.d*s,i&&(e.e-=t,e.f-=s)},scale(e,t,s=t){e.a*=t,e.b*=t,e.c*=s,e.d*=s},scaleOfOuter(e,t,s,i){S.toInnerPoint(e,t,kt),S.scaleOfInner(e,kt,s,i)},scaleOfInner(e,t,s,i=s){S.translateInner(e,t.x,t.y),S.scale(e,s,i),S.translateInner(e,-t.x,-t.y)},rotate(e,t){const{a:s,b:i,c:n,d:o}=e;t*=k;const r=ye(t),a=ge(t);e.a=s*r-i*a,e.b=s*a+i*r,e.c=n*r-o*a,e.d=n*a+o*r},rotateOfOuter(e,t,s){S.toInnerPoint(e,t,kt),S.rotateOfInner(e,kt,s)},rotateOfInner(e,t,s){S.translateInner(e,t.x,t.y),S.rotate(e,s),S.translateInner(e,-t.x,-t.y)},skew(e,t,s){const{a:i,b:n,c:o,d:r}=e;s&&(s*=k,e.a=i+o*s,e.b=n+r*s),t&&(t*=k,e.c=o+i*t,e.d=r+n*t)},skewOfOuter(e,t,s,i){S.toInnerPoint(e,t,kt),S.skewOfInner(e,kt,s,i)},skewOfInner(e,t,s,i=0){S.translateInner(e,t.x,t.y),S.skew(e,s,i),S.translateInner(e,-t.x,-t.y)},multiply(e,t){const{a:s,b:i,c:n,d:o,e:r,f:a}=e;e.a=t.a*s+t.b*n,e.b=t.a*i+t.b*o,e.c=t.c*s+t.d*n,e.d=t.c*i+t.d*o,e.e=t.e*s+t.f*n+r,e.f=t.e*i+t.f*o+a},multiplyParent(e,t,s,i,n,o){let{e:r,f:a}=e;if(o&&(r+=o.scrollX,a+=o.scrollY),s||(s=e),i===void 0&&(i=e.a!==1||e.b||e.c||e.d!==1),i){const{a:h,b:l,c:u,d}=e;s.a=h*t.a+l*t.c,s.b=h*t.b+l*t.d,s.c=u*t.a+d*t.c,s.d=u*t.b+d*t.d,n&&(s.scaleX=t.scaleX*n.scaleX,s.scaleY=t.scaleY*n.scaleY)}else s.a=t.a,s.b=t.b,s.c=t.c,s.d=t.d,n&&(s.scaleX=t.scaleX,s.scaleY=t.scaleY);s.e=r*t.a+a*t.c+t.e,s.f=r*t.b+a*t.d+t.f},divide(e,t){S.multiply(e,S.tempInvert(t))},divideParent(e,t){S.multiplyParent(e,S.tempInvert(t))},tempInvert(e){const{tempMatrix:t}=S;return S.copy(t,e),S.invert(t),t},invert(e){const{a:t,b:s,c:i,d:n,e:o,f:r}=e;if(!s&&!i)if(t===1&&n===1)e.e=-o,e.f=-r;else{const a=1/(t*n);e.a=n*a,e.d=t*a,e.e=-o*n*a,e.f=-r*t*a}else{const a=1/(t*n-s*i);e.a=n*a,e.b=-s*a,e.c=-i*a,e.d=t*a,e.e=-(o*n-r*i)*a,e.f=-(r*t-o*s)*a}},toOuterPoint(e,t,s,i){const{x:n,y:o}=t;s||(s=t),s.x=n*e.a+o*e.c,s.y=n*e.b+o*e.d,i||(s.x+=e.e,s.y+=e.f)},toInnerPoint(e,t,s,i){const{a:n,b:o,c:r,d:a}=e,h=1/(n*a-o*r),{x:l,y:u}=t;if(s||(s=t),s.x=(l*a-u*r)*h,s.y=(u*n-l*o)*h,!i){const{e:d,f:_}=e;s.x-=(d*a-_*r)*h,s.y-=(_*n-d*o)*h}},setLayout(e,t,s,i,n){const{x:o,y:r,scaleX:a,scaleY:h}=t;if(n===void 0&&(n=t.rotation||t.skewX||t.skewY),n){const{rotation:l,skewX:u,skewY:d}=t,_=l*k,c=ye(_),g=ge(_);if(u||d){const m=u*k,x=d*k;e.a=(c+x*-g)*a,e.b=(g+x*c)*a,e.c=(-g+m*c)*h,e.d=(c+m*g)*h}else e.a=c*a,e.b=g*a,e.c=-g*h,e.d=c*h}else e.a=a,e.b=0,e.c=0,e.d=h;e.e=o,e.f=r,(s=s||i)&&S.translateInner(e,-s.x,-s.y,!i)},getLayout(e,t,s,i){const{a:n,b:o,c:r,d:a,e:h,f:l}=e;let u=h,d=l,_,c,g,m,x;if(o||r){const C=n*a-o*r;if(r&&!i){_=me(n*n+o*o),c=C/_;const T=n/_;g=o>0?Xt(T):-Xt(T)}else{c=me(r*r+a*a),_=C/c;const T=r/c;g=It-(a>0?Xt(-T):-Xt(T))}const O=Tt(ye(g)),P=ge(g);_=Tt(_),c=Tt(c),m=O?Tt((r/c+P)/O/k,9):0,x=O?Tt((o/_-P)/O/k,9):0,g=Tt(g/k)}else _=n,c=a,g=m=x=0;return(t=s||t)&&(u+=t.x*n+t.y*r,d+=t.x*o+t.y*a,s||(u-=t.x,d-=t.y)),{x:u,y:d,scaleX:_,scaleY:c,rotation:g,skewX:m,skewY:x}},withScale(e,t,s=t){const i=e;if(!t||!s){const{a:n,b:o,c:r,d:a}=e;o||r?(t=me(n*n+o*o),s=(n*a-o*r)/t):(t=n,s=a)}return i.scaleX=t,i.scaleY=s,i},reset(e){S.set(e)}},S=b,{toInnerPoint:xe,toOuterPoint:ls}=b,{sin:us,cos:cs,abs:_s,sqrt:Ni,atan2:be,min:Yi,PI:Di}=Math,v={defaultPoint:Wi(),tempPoint:{},tempRadiusPoint:{},set(e,t=0,s=0){e.x=t,e.y=s},setRadius(e,t,s){e.radiusX=t,e.radiusY=s===void 0?t:s},copy(e,t){e.x=t.x,e.y=t.y},copyFrom(e,t,s){e.x=t,e.y=s},move(e,t,s){e.x+=t,e.y+=s},scale(e,t,s=t){e.x&&(e.x*=t),e.y&&(e.y*=s)},scaleOf(e,t,s,i=s){e.x+=(e.x-t.x)*(s-1),e.y+=(e.y-t.y)*(i-1)},rotate(e,t,s){s||(s=bt.defaultPoint),t*=k;const i=cs(t),n=us(t),o=e.x-s.x,r=e.y-s.y;e.x=s.x+o*i-r*n,e.y=s.y+o*n+r*i},tempToInnerOf(e,t){const{tempPoint:s}=bt;return Ce(s,e),xe(t,s,s),s},tempToOuterOf(e,t){const{tempPoint:s}=bt;return Ce(s,e),ls(t,s,s),s},tempToInnerRadiusPointOf(e,t){const{tempRadiusPoint:s}=bt;return Ce(s,e),bt.toInnerRadiusPointOf(e,t,s),s},toInnerRadiusPointOf(e,t,s){s||(s=e),xe(t,e,s),s.radiusX=Math.abs(e.radiusX/t.scaleX),s.radiusY=Math.abs(e.radiusY/t.scaleY)},toInnerOf(e,t,s){xe(t,e,s)},toOuterOf(e,t,s){ls(t,e,s)},getCenter(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}},getCenterX(e,t){return e+(t-e)/2},getCenterY(e,t){return e+(t-e)/2},getDistance(e,t){return we(e.x,e.y,t.x,t.y)},getDistanceFrom(e,t,s,i){const n=_s(s-e),o=_s(i-t);return Ni(n*n+o*o)},getMinDistanceFrom(e,t,s,i,n,o){return Yi(we(e,t,s,i),we(s,i,n,o))},getAngle(e,t){return ds(e,t)/k},getRotation(e,t,s,i){return i||(i=t),bt.getRadianFrom(e.x,e.y,t.x,t.y,s.x,s.y,i.x,i.y)/k},getRadianFrom(e,t,s,i,n,o,r,a){r===void 0&&(r=s,a=i);let h=be(t-i,e-s);const u=be(o-a,n-r)-h;return u<-Di?u+q:u},getAtan2(e,t){return be(t.y-e.y,t.x-e.x)},getDistancePoint(e,t,s,i){const n=ds(e,t);return t=i?t:{},t.x=e.x+cs(n)*s,t.y=e.y+us(n)*s,t},toNumberPoints(e){let t=e;return typeof e[0]=="object"&&(t=[],e.forEach(s=>t.push(s.x,s.y))),t},reset(e){}},bt=v,{getDistanceFrom:we,copy:Ce,getAtan2:ds}=bt;class Yt{constructor(t,s){this.set(t,s)}set(t,s){return typeof t=="object"?v.copy(this,t):v.set(this,t,s),this}get(){const{x:t,y:s}=this;return{x:t,y:s}}clone(){return new Yt(this)}move(t,s){return v.move(this,t,s),this}scale(t,s){return v.scale(this,t,s),this}scaleOf(t,s,i){return v.scaleOf(this,t,s,i),this}rotate(t,s){return v.rotate(this,t,s),this}rotateOf(t,s){return v.rotate(this,s,t),this}getRotation(t,s,i){return v.getRotation(this,t,s,i)}toInnerOf(t,s){return v.toInnerOf(this,t,s),this}toOuterOf(t,s){return v.toOuterOf(this,t,s),this}getCenter(t){return new Yt(v.getCenter(this,t))}getDistance(t){return v.getDistance(this,t)}getDistancePoint(t,s,i){return new Yt(v.getDistancePoint(this,t,s,i))}getAngle(t){return v.getAngle(this,t)}getAtan2(t){return v.getAtan2(this,t)}reset(){return this}}new Yt;class le{constructor(t,s,i,n,o,r){this.set(t,s,i,n,o,r)}set(t,s,i,n,o,r){return typeof t=="object"?b.copy(this,t):b.set(this,t,s,i,n,o,r),this}setWith(t){return b.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:s,c:i,d:n,e:o,f:r}=this;return{a:t,b:s,c:i,d:n,e:o,f:r}}clone(){return new le(this)}translate(t,s){return b.translate(this,t,s),this}translateInner(t,s){return b.translateInner(this,t,s),this}scale(t,s){return b.scale(this,t,s),this}scaleWith(t,s){return b.scale(this,t,s),this.scaleX*=t,this.scaleY*=s||t,this}scaleOfOuter(t,s,i){return b.scaleOfOuter(this,t,s,i),this}scaleOfInner(t,s,i){return b.scaleOfInner(this,t,s,i),this}rotate(t){return b.rotate(this,t),this}rotateOfOuter(t,s){return b.rotateOfOuter(this,t,s),this}rotateOfInner(t,s){return b.rotateOfInner(this,t,s),this}skew(t,s){return b.skew(this,t,s),this}skewOfOuter(t,s,i){return b.skewOfOuter(this,t,s,i),this}skewOfInner(t,s,i){return b.skewOfInner(this,t,s,i),this}multiply(t){return b.multiply(this,t),this}multiplyParent(t){return b.multiplyParent(this,t),this}divide(t){return b.divide(this,t),this}divideParent(t){return b.divideParent(this,t),this}invert(){return b.invert(this),this}invertWith(){return b.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,s,i){b.toOuterPoint(this,t,s,i)}toInnerPoint(t,s,i){b.toInnerPoint(this,t,s,i)}setLayout(t,s,i){return b.setLayout(this,t,s,i),this}getLayout(t,s,i){return b.getLayout(this,t,s,i)}withScale(t,s){return b.withScale(this,t,s)}reset(){b.reset(this)}}new le;const ue={tempPointBounds:{},setPoint(e,t,s){e.minX=e.maxX=t,e.minY=e.maxY=s},addPoint(e,t,s){e.minX=t<e.minX?t:e.minX,e.minY=s<e.minY?s:e.minY,e.maxX=t>e.maxX?t:e.maxX,e.maxY=s>e.maxY?s:e.maxY},addBounds(e,t,s,i,n){fs(e,t,s),fs(e,t+i,s+n)},copy(e,t){e.minX=t.minX,e.minY=t.minY,e.maxX=t.maxX,e.maxY=t.maxY},addPointBounds(e,t){e.minX=t.minX<e.minX?t.minX:e.minX,e.minY=t.minY<e.minY?t.minY:e.minY,e.maxX=t.maxX>e.maxX?t.maxX:e.maxX,e.maxY=t.maxY>e.maxY?t.maxY:e.maxY},toBounds(e,t){t.x=e.minX,t.y=e.minY,t.width=e.maxX-e.minX,t.height=e.maxY-e.minY}},{addPoint:fs}=ue,{tempPointBounds:ht,setPoint:ps,addPoint:jt,toBounds:gs}=ue,{toOuterPoint:zt}=b,{float:Ht,fourNumber:Fi}=ut,{floor:ys,ceil:Ut}=Math;let Z,J,gt,yt;const et={},z={},y={tempBounds:{},set(e,t=0,s=0,i=0,n=0){e.x=t,e.y=s,e.width=i,e.height=n},copy(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},copyAndSpread(e,t,s,i,n){const{x:o,y:r,width:a,height:h}=t;if(s instanceof Array){const l=Fi(s);i?B.set(e,o+l[3],r+l[0],a-l[1]-l[3],h-l[2]-l[0]):B.set(e,o-l[3],r-l[0],a+l[1]+l[3],h+l[2]+l[0])}else i&&(s=-s),B.set(e,o-s,r-s,a+s*2,h+s*2);n&&(n==="width"?(e.y=r,e.height=h):(e.x=o,e.width=a))},minX(e){return e.width>0?e.x:e.x+e.width},minY(e){return e.height>0?e.y:e.y+e.height},maxX(e){return e.width>0?e.x+e.width:e.x},maxY(e){return e.height>0?e.y+e.height:e.y},move(e,t,s){e.x+=t,e.y+=s},getByMove(e,t,s){return e=Object.assign({},e),B.move(e,t,s),e},toOffsetOutBounds(e,t,s){t?xs(t,e):t=e,s?(t.offsetX=-(B.maxX(s)-e.x),t.offsetY=-(B.maxY(s)-e.y)):(t.offsetX=e.x+e.width,t.offsetY=e.y+e.height),B.move(t,-t.offsetX,-t.offsetY)},scale(e,t,s=t){v.scale(e,t,s),e.width*=t,e.height*=s},scaleOf(e,t,s,i=s){v.scaleOf(e,t,s,i),e.width*=s,e.height*=i},tempToOuterOf(e,t){return B.copy(B.tempBounds,e),B.toOuterOf(B.tempBounds,t),B.tempBounds},getOuterOf(e,t){return e=Object.assign({},e),B.toOuterOf(e,t),e},toOuterOf(e,t,s){if(s||(s=e),t.b===0&&t.c===0){const{a:i,d:n}=t;i>0?(s.width=e.width*i,s.x=t.e+e.x*i):(s.width=e.width*-i,s.x=t.e+e.x*i-s.width),n>0?(s.height=e.height*n,s.y=t.f+e.y*n):(s.height=e.height*-n,s.y=t.f+e.y*n-s.height)}else et.x=e.x,et.y=e.y,zt(t,et,z),ps(ht,z.x,z.y),et.x=e.x+e.width,zt(t,et,z),jt(ht,z.x,z.y),et.y=e.y+e.height,zt(t,et,z),jt(ht,z.x,z.y),et.x=e.x,zt(t,et,z),jt(ht,z.x,z.y),gs(ht,s)},toInnerOf(e,t,s){s||(s=e),B.move(s,-t.e,-t.f),B.scale(s,1/t.a,1/t.d)},getFitMatrix(e,t,s=1){const i=Math.min(s,Math.min(e.width/t.width,e.height/t.height));return new le(i,0,0,i,-t.x*i,-t.y*i)},getSpread(e,t,s){const i={};return B.copyAndSpread(i,e,t,!1,s),i},spread(e,t,s){B.copyAndSpread(e,e,t,!1,s)},shrink(e,t,s){B.copyAndSpread(e,e,t,!0,s)},ceil(e){const{x:t,y:s}=e;e.x=ys(e.x),e.y=ys(e.y),e.width=t>e.x?Ut(e.width+t-e.x):Ut(e.width),e.height=s>e.y?Ut(e.height+s-e.y):Ut(e.height)},unsign(e){e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height)},float(e,t){e.x=Ht(e.x,t),e.y=Ht(e.y,t),e.width=Ht(e.width,t),e.height=Ht(e.height,t)},add(e,t,s){Z=e.x+e.width,J=e.y+e.height,gt=t.x,yt=t.y,s||(gt+=t.width,yt+=t.height),Z=Z>gt?Z:gt,J=J>yt?J:yt,e.x=e.x<t.x?e.x:t.x,e.y=e.y<t.y?e.y:t.y,e.width=Z-e.x,e.height=J-e.y},addList(e,t){B.setListWithFn(e,t,void 0,!0)},setList(e,t,s=!1){B.setListWithFn(e,t,void 0,s)},addListWithFn(e,t,s){B.setListWithFn(e,t,s,!0)},setListWithFn(e,t,s,i=!1){let n,o=!0;for(let r=0,a=t.length;r<a;r++)n=s?s(t[r]):t[r],n&&(n.width||n.height)&&(o?(o=!1,i||xs(e,n)):ms(e,n));o&&B.reset(e)},setPoints(e,t){t.forEach((s,i)=>i===0?ps(ht,s.x,s.y):jt(ht,s.x,s.y)),gs(ht,e)},setPoint(e,t){B.set(e,t.x,t.y)},addPoint(e,t){ms(e,t,!0)},getPoints(e){const{x:t,y:s,width:i,height:n}=e;return[{x:t,y:s},{x:t+i,y:s},{x:t+i,y:s+n},{x:t,y:s+n}]},hitRadiusPoint(e,t,s){return s&&(t=v.tempToInnerRadiusPointOf(t,s)),t.x>=e.x-t.radiusX&&t.x<=e.x+e.width+t.radiusX&&t.y>=e.y-t.radiusY&&t.y<=e.y+e.height+t.radiusY},hitPoint(e,t,s){return s&&(t=v.tempToInnerOf(t,s)),t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},hit(e,t,s){return s&&(t=B.tempToOuterOf(t,s)),!(e.y+e.height<t.y||t.y+t.height<e.y||e.x+e.width<t.x||t.x+t.width<e.x)},includes(e,t,s){return s&&(t=B.tempToOuterOf(t,s)),e.x<=t.x&&e.y<=t.y&&e.x+e.width>=t.x+t.width&&e.y+e.height>=t.y+t.height},getIntersectData(e,t,s){if(s&&(t=B.tempToOuterOf(t,s)),!B.hit(e,t))return gi();let{x:i,y:n,width:o,height:r}=t;return Z=i+o,J=n+r,gt=e.x+e.width,yt=e.y+e.height,i=i>e.x?i:e.x,n=n>e.y?n:e.y,Z=Z<gt?Z:gt,J=J<yt?J:yt,o=Z-i,r=J-n,{x:i,y:n,width:o,height:r}},intersect(e,t,s){B.copy(e,B.getIntersectData(e,t,s))},isSame(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},isEmpty(e){return e.x===0&&e.y===0&&e.width===0&&e.height===0},reset(e){B.set(e)}},B=y,{add:ms,copy:xs}=B;class Ct{get minX(){return y.minX(this)}get minY(){return y.minY(this)}get maxX(){return y.maxX(this)}get maxY(){return y.maxY(this)}constructor(t,s,i,n){this.set(t,s,i,n)}set(t,s,i,n){return typeof t=="object"?y.copy(this,t):y.set(this,t,s,i,n),this}get(){const{x:t,y:s,width:i,height:n}=this;return{x:t,y:s,width:i,height:n}}clone(){return new Ct(this)}move(t,s){return y.move(this,t,s),this}scale(t,s){return y.scale(this,t,s),this}scaleOf(t,s,i){return y.scaleOf(this,t,s,i),this}toOuterOf(t,s){return y.toOuterOf(this,t,s),this}toInnerOf(t,s){return y.toInnerOf(this,t,s),this}getFitMatrix(t,s){return y.getFitMatrix(this,t,s)}spread(t,s){return y.spread(this,t,s),this}shrink(t,s){return y.shrink(this,t,s),this}ceil(){return y.ceil(this),this}unsign(){return y.unsign(this),this}float(t){return y.float(this,t),this}add(t){return y.add(this,t),this}addList(t){return y.setList(this,t,!0),this}setList(t){return y.setList(this,t),this}addListWithFn(t,s){return y.setListWithFn(this,t,s,!0),this}setListWithFn(t,s){return y.setListWithFn(this,t,s),this}setPoint(t){return y.setPoint(this,t),this}setPoints(t){return y.setPoints(this,t),this}addPoint(t){return y.addPoint(this,t),this}getPoints(){return y.getPoints(this)}hitPoint(t,s){return y.hitPoint(this,t,s)}hitRadiusPoint(t,s){return y.hitRadiusPoint(this,t,s)}hit(t,s){return y.hit(this,t,s)}includes(t,s){return y.includes(this,t,s)}intersect(t,s){return y.intersect(this,t,s),this}getIntersect(t,s){return new Ct(y.getIntersectData(this,t,s))}isSame(t){return y.isSame(this,t)}isEmpty(){return y.isEmpty(this)}reset(){y.reset(this)}}const R=new Ct;class ua{constructor(t,s,i,n,o,r){typeof t=="object"?this.copy(t):this.set(t,s,i,n,o,r)}set(t=0,s=0,i=0,n=0,o=0,r=0){this.top=t,this.right=s,this.bottom=i,this.left=n,this.width=o,this.height=r}copy(t){const{top:s,right:i,bottom:n,left:o,width:r,height:a}=t;this.set(s,i,n,o,r,a)}getBoundsFrom(t){const{top:s,right:i,bottom:n,left:o,width:r,height:a}=this;return new Ct(o,s,r||t.width-o-i,a||t.height-s-n)}}var bs;(function(e){e[e.top=0]="top",e[e.right=1]="right",e[e.bottom=2]="bottom",e[e.left=3]="left"})(bs||(bs={}));var Ge;(function(e){e[e.topLeft=0]="topLeft",e[e.top=1]="top",e[e.topRight=2]="topRight",e[e.right=3]="right",e[e.bottomRight=4]="bottomRight",e[e.bottom=5]="bottom",e[e.bottomLeft=6]="bottomLeft",e[e.left=7]="left",e[e.center=8]="center",e[e["top-left"]=0]="top-left",e[e["top-right"]=2]="top-right",e[e["bottom-right"]=4]="bottom-right",e[e["bottom-left"]=6]="bottom-left"})(Ge||(Ge={}));const Ke=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];Ke.forEach(e=>e.type="percent");const ts={directionData:Ke,tempPoint:{},get:ws,toPoint(e,t,s,i,n){const o=ws(e);s.x=o.x,s.y=o.y,o.type==="percent"&&(s.x*=t.width,s.y*=t.height,n&&(s.x-=n.x,s.y-=n.y,o.x&&(s.x-=o.x===1?n.width:o.x===.5?o.x*n.width:0),o.y&&(s.y-=o.y===1?n.height:o.y===.5?o.y*n.height:0))),i||(s.x+=t.x,s.y+=t.y)}};function ws(e){return typeof e=="string"?Ke[Ge[e]]:e}const{toPoint:Xi}=ts,ca={toPoint(e,t,s,i,n){Xi(e,s,i,n,t)}},ji={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class ${constructor(t){this.repeatMap={},this.name=t}static get(t){return new $(t)}static set filter(t){this.filterList=Cs(t)}static set exclude(t){this.excludeList=Cs(t)}log(...t){if(mt.enable){if(mt.filterList.length&&mt.filterList.every(s=>s!==this.name)||mt.excludeList.length&&mt.excludeList.some(s=>s===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){mt.enable&&this.warn(...t)}warn(...t){mt.showWarn&&console.warn(this.name,...t)}repeat(t,...s){this.repeatMap[t]||(this.warn("repeat:"+t,...s),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(s){console.error(this.name,...t,s)}}}$.filterList=[];$.excludeList=[];$.showWarn=!0;function Cs(e){return e?typeof e=="string"&&(e=[e]):e=[],e}const mt=$,zi=$.get("RunTime"),Hi={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(e,t){const s=rt.create(rt.RUNTIME);return H.currentId=H.idMap[s]=t?performance.now():Date.now(),H.currentName=H.nameMap[s]=e,H.nameToIdMap[e]=s,s},end(e,t){const s=H.idMap[e],i=H.nameMap[e],n=t?(performance.now()-s)/1e3:Date.now()-s;H.idMap[e]=H.nameMap[e]=H.nameToIdMap[i]=void 0,zi.log(i,n,"ms")},endOfName(e,t){const s=H.nameToIdMap[e];s!==void 0&&H.end(s,t)}},H=Hi;function Bs(e){console.error("need plugin: @leafer-in/"+e)}const Ts=$.get("UICreator"),es={list:{},register(e){const{__tag:t}=e.prototype;qt[t]&&Ts.repeat(t),qt[t]=e},get(e,t,s,i,n,o){qt[e]||Ts.error("not register "+e);const r=new qt[e](t);return s!==void 0&&(r.x=s,i&&(r.y=i),n&&(r.width=n),o&&(r.height=o)),r}},{list:qt}=es,Ui=$.get("EventCreator"),ae={nameList:{},register(e){let t;Object.keys(e).forEach(s=>{t=e[s],typeof t=="string"&&(At[t]&&Ui.repeat(t),At[t]=e)})},changeName(e,t){const s=At[e];if(s){const i=Object.keys(s).find(n=>s[n]===e);i&&(s[i]=t,At[t]=s)}},has(e){return!!this.nameList[e]},get(e,...t){return new At[e](...t)}},{nameList:At}=ae;class _a{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let s;const{list:i}=this;for(let o=0,r=i.length;o<r;o++)if(s=i[o],s.recycled&&s.isSameSize(t))return s.recycled=!1,s.manager||(s.manager=this),s;const n=Je.canvas(t);return this.add(n),n}recycle(t){t.recycled=!0}clearRecycled(){let t;const s=[];for(let i=0,n=this.list.length;i<n;i++)t=this.list[i],t.recycled?t.destroy():s.push(t);this.list=s}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}}const ce={default(e,t){return Be(t,e),Be(e,t),e},assign(e,t){let s;Object.keys(t).forEach(i=>{var n;s=t[i],(s==null?void 0:s.constructor)===Object&&((n=e[i])===null||n===void 0?void 0:n.constructor)===Object?Be(e[i],t[i]):e[i]=t[i]})},copyAttrs(e,t,s){return s.forEach(i=>{t[i]!==void 0&&(e[i]=t[i])}),e},clone(e){return JSON.parse(JSON.stringify(e))},toMap(e){const t={};for(let s=0,i=e.length;s<i;s++)t[e[s]]=!0;return t}},{assign:Be}=ce;class qi{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&t.length===6&&t[0]===1}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:t}=this;return t==="pass-through"?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const s=this.__input[t];if(s!==void 0)return s}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:s}=this;let i;for(let n in this)n[0]!=="_"&&(i=s?s[n]:void 0,t[n]=i===void 0?this[n]:i);return t}__setInput(t,s){this.__input||(this.__input={}),this.__input[t]=s}__getInput(t){if(this.__input){const s=this.__input[t];if(s!==void 0)return s}if(!(t==="path"&&!this.__pathInputed))return this["_"+t]}__removeInput(t){this.__input&&this.__input[t]!==void 0&&(this.__input[t]=void 0)}__getInputData(t,s){const i={};if(t)if(t instanceof Array)for(let n of t)i[n]=this.__getInput(n);else for(let n in t)i[n]=this.__getInput(n);else{let n,o,{__input:r}=this;i.tag=this.__leaf.tag;for(let a in this)if(a[0]!=="_"&&(n=this["_"+a],n!==void 0)){if(a==="path"&&!this.__pathInputed)continue;o=r?r[a]:void 0,i[a]=o===void 0?n:o}}if(s&&s.matrix){const{a:n,b:o,c:r,d:a,e:h,f:l}=this.__leaf.__localMatrix;i.matrix={a:n,b:o,c:r,d:a,e:h,f:l}}return i}__setMiddle(t,s){this.__middle||(this.__middle={}),this.__middle[t]=s}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if(t.blendMode==="pass-through"){const s=this.__leaf;t.opacity<1&&(s.isBranch||t.__hasMultiPaint)||s.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var ks;(function(e){e[e.No=0]="No",e[e.Yes=1]="Yes",e[e.NoAndSkip=2]="NoAndSkip",e[e.YesAndSkip=3]="YesAndSkip"})(ks||(ks={}));function f(e,t,s,i){var n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,s,o):r(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o}function yi(e,t,s,i){function n(o){return o instanceof s?o:new s(function(r){r(o)})}return new(s||(s=Promise))(function(o,r){function a(u){try{l(i.next(u))}catch(d){r(d)}}function h(u){try{l(i.throw(u))}catch(d){r(d)}}function l(u){u.done?o(u.value):n(u.value).then(a,h)}l((i=i.apply(e,t||[])).next())})}function L(e){return(t,s)=>{e||(e=s),Object.defineProperty(t,s,{get(){return this.context[e]},set(i){this.context[e]=i}})}}const mi=[];function w(){return(e,t)=>{mi.push(t)}}const Gi=[];class p{set blendMode(t){t==="normal"&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||Gi)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;mi.forEach(s=>{t=this.context[s],t&&(this[s]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,s,i,n,o,r){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,s,i,n,o,r){typeof t=="object"?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,s,i,n,o,r)}translate(t,s){}scale(t,s){}rotate(t){}fill(t,s){}stroke(t){}clip(t,s){}fillRect(t,s,i,n){}strokeRect(t,s,i,n){}clearRect(t,s,i,n){}drawImage(t,s,i,n,o,r,a,h,l){switch(arguments.length){case 9:if(s<0){const u=-s/n*h;n+=s,s=0,r+=u,h-=u}if(i<0){const u=-i/o*l;o+=i,i=0,a+=u,l-=u}this.context.drawImage(t,s,i,n,o,r,a,h,l);break;case 5:this.context.drawImage(t,s,i,n,o);break;case 3:this.context.drawImage(t,s,i)}}beginPath(){}moveTo(t,s){}lineTo(t,s){}bezierCurveTo(t,s,i,n,o,r){}quadraticCurveTo(t,s,i,n){}closePath(){}arc(t,s,i,n,o,r){}arcTo(t,s,i,n,o){}ellipse(t,s,i,n,o,r,a,h){}rect(t,s,i,n){}roundRect(t,s,i,n,o){}createConicGradient(t,s,i){}createLinearGradient(t,s,i,n){}createPattern(t,s){}createRadialGradient(t,s,i,n,o,r){}fillText(t,s,i,n){}measureText(t){}strokeText(t,s,i,n){}destroy(){this.context=null}}f([L("imageSmoothingEnabled")],p.prototype,"smooth",void 0);f([L("imageSmoothingQuality")],p.prototype,"smoothLevel",void 0);f([L("globalAlpha")],p.prototype,"opacity",void 0);f([L()],p.prototype,"fillStyle",void 0);f([L()],p.prototype,"strokeStyle",void 0);f([L("lineWidth")],p.prototype,"strokeWidth",void 0);f([L("lineCap")],p.prototype,"strokeCap",void 0);f([L("lineJoin")],p.prototype,"strokeJoin",void 0);f([L("lineDashOffset")],p.prototype,"dashOffset",void 0);f([L()],p.prototype,"miterLimit",void 0);f([L()],p.prototype,"shadowBlur",void 0);f([L()],p.prototype,"shadowColor",void 0);f([L()],p.prototype,"shadowOffsetX",void 0);f([L()],p.prototype,"shadowOffsetY",void 0);f([L()],p.prototype,"filter",void 0);f([L()],p.prototype,"font",void 0);f([L()],p.prototype,"fontKerning",void 0);f([L()],p.prototype,"fontStretch",void 0);f([L()],p.prototype,"fontVariantCaps",void 0);f([L()],p.prototype,"textAlign",void 0);f([L()],p.prototype,"textBaseline",void 0);f([L()],p.prototype,"textRendering",void 0);f([L()],p.prototype,"wordSpacing",void 0);f([L()],p.prototype,"letterSpacing",void 0);f([L()],p.prototype,"direction",void 0);f([w()],p.prototype,"setTransform",null);f([w()],p.prototype,"resetTransform",null);f([w()],p.prototype,"getTransform",null);f([w()],p.prototype,"save",null);f([w()],p.prototype,"restore",null);f([w()],p.prototype,"translate",null);f([w()],p.prototype,"scale",null);f([w()],p.prototype,"rotate",null);f([w()],p.prototype,"fill",null);f([w()],p.prototype,"stroke",null);f([w()],p.prototype,"clip",null);f([w()],p.prototype,"fillRect",null);f([w()],p.prototype,"strokeRect",null);f([w()],p.prototype,"clearRect",null);f([w()],p.prototype,"beginPath",null);f([w()],p.prototype,"moveTo",null);f([w()],p.prototype,"lineTo",null);f([w()],p.prototype,"bezierCurveTo",null);f([w()],p.prototype,"quadraticCurveTo",null);f([w()],p.prototype,"closePath",null);f([w()],p.prototype,"arc",null);f([w()],p.prototype,"arcTo",null);f([w()],p.prototype,"ellipse",null);f([w()],p.prototype,"rect",null);f([w()],p.prototype,"roundRect",null);f([w()],p.prototype,"createConicGradient",null);f([w()],p.prototype,"createLinearGradient",null);f([w()],p.prototype,"createPattern",null);f([w()],p.prototype,"createRadialGradient",null);f([w()],p.prototype,"fillText",null);f([w()],p.prototype,"measureText",null);f([w()],p.prototype,"strokeText",null);const{copy:Qi}=b,Zi={width:1,height:1,pixelRatio:1},vs=["width","height","pixelRatio"];class da extends p{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,s){super(),this.size={},this.worldTransform={},t||(t=Zi),t.pixelRatio||(t.pixelRatio=K.devicePixelRatio),this.manager=s,this.innerId=rt.create(rt.CNAVAS);const{width:i,height:n,pixelRatio:o}=t;this.autoLayout=!i||!n,this.size.pixelRatio=o,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:s}=this.config;this.context=s?t.getContext("2d",s):t.getContext("2d"),this.__bindContext()}export(t,s){}toBlob(t,s){}toDataURL(t,s){}saveAs(t,s){}resize(t){if(this.isSameSize(t))return;let s;this.context&&!this.unreal&&this.width&&(s=this.getSameCanvas(),s.copyWorld(this));const i=this.size;ce.copyAttrs(i,t,vs),vs.forEach(n=>i[n]||(i[n]=1)),this.bounds=new Ct(0,0,this.width,this.height),this.context&&!this.unreal&&(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&s&&(this.clearWorld(s.bounds),this.copyWorld(s),s.recycle())}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,s){}stopAutoLayout(){}setCursor(t){}setWorld(t,s){const{pixelRatio:i}=this,n=this.worldTransform;if(s){const{a:o,b:r,c:a,d:h,e:l,f:u}=s;this.setTransform(n.a=(t.a*o+t.b*a)*i,n.b=(t.a*r+t.b*h)*i,n.c=(t.c*o+t.d*a)*i,n.d=(t.c*r+t.d*h)*i,n.e=(t.e*o+t.f*a+l)*i,n.f=(t.e*r+t.f*h+u)*i)}else this.setTransform(n.a=t.a*i,n.b=t.b*i,n.c=t.c*i,n.d=t.d*i,n.e=t.e*i,n.f=t.f*i)}useWorldTransform(t){t&&(this.worldTransform=t);const s=this.worldTransform;s&&this.setTransform(s.a,s.b,s.c,s.d,s.e,s.f)}setStroke(t,s,i){s&&(this.strokeWidth=s),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i)}setStrokeOptions(t){this.strokeCap=t.strokeCap==="none"?"butt":t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,s){return!0}hitStroke(t,s){return!0}hitPixel(t,s,i=1){return!0}setWorldShadow(t,s,i,n){const{pixelRatio:o}=this;this.shadowOffsetX=t*o,this.shadowOffsetY=s*o,this.shadowBlur=i*o,this.shadowColor=n||"black"}setWorldBlur(t){const{pixelRatio:s}=this;this.filter=`blur(${t*s}px)`}copyWorld(t,s,i,n){if(n&&(this.blendMode=n),s){const{pixelRatio:o}=this;i||(i=s),this.drawImage(t.view,s.x*o,s.y*o,s.width*o,s.height*o,i.x*o,i.y*o,i.width*o,i.height*o)}else this.drawImage(t.view,0,0);n&&(this.blendMode="source-over")}copyWorldToInner(t,s,i,n){if(n&&(this.blendMode=n),s.b||s.c)this.save(),this.resetTransform(),this.copyWorld(t,s,y.tempToOuterOf(i,s)),this.restore();else{const{pixelRatio:o}=this;this.drawImage(t.view,s.x*o,s.y*o,s.width*o,s.height*o,i.x,i.y,i.width,i.height)}n&&(this.blendMode="source-over")}copyWorldByReset(t,s,i,n,o){this.resetTransform(),this.copyWorld(t,s,i,n),o||this.useWorldTransform()}useGrayscaleAlpha(t){this.setTempBounds(t,!0,!0);let s,i;const{context:n}=this,o=n.getImageData(R.x,R.y,R.width,R.height),{data:r}=o;for(let a=0,h=r.length;a<h;a+=4)i=r[a]*.299+r[a+1]*.587+r[a+2]*.114,(s=r[a+3])&&(r[a+3]=s===255?i:s*(i/255));n.putImageData(o,R.x,R.y)}useMask(t,s,i){this.copyWorld(t,s,i,"destination-in")}useEraser(t,s,i){this.copyWorld(t,s,i,"destination-out")}fillWorld(t,s,i){i&&(this.blendMode=i),this.fillStyle=s,this.setTempBounds(t),this.fillRect(R.x,R.y,R.width,R.height),i&&(this.blendMode="source-over")}strokeWorld(t,s,i){i&&(this.blendMode=i),this.strokeStyle=s,this.setTempBounds(t),this.strokeRect(R.x,R.y,R.width,R.height),i&&(this.blendMode="source-over")}clearWorld(t,s){this.setTempBounds(t,s),this.clearRect(R.x,R.y,R.width,R.height)}clipWorld(t,s){this.beginPath(),this.setTempBounds(t,s),this.rect(R.x,R.y,R.width,R.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}setTempBounds(t,s,i){R.set(t),i&&R.intersect(this.bounds),R.scale(this.pixelRatio),s&&R.ceil()}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t,s){const i=this.manager?this.manager.get(this.size):Je.canvas(Object.assign({},this.size));return i.save(),t&&(Qi(i.worldTransform,this.worldTransform),i.useWorldTransform()),s&&(i.smooth=this.smooth),i}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t,!0):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const V={creator:{},parse(e,t){},convertToCanvasData(e,t){}},xi={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Q=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},xi),bi={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},wi={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Ji=Object.assign(Object.assign({},wi),xi),he=Q,Ci={};for(let e in he)Ci[he[e]]=e;const Bi={};for(let e in he)Bi[he[e]]=bi[e];const Ti={drawRoundRect(e,t,s,i,n,o){const r=ut.fourNumber(o,Math.min(i/2,n/2)),a=t+i,h=s+n;r[0]?e.moveTo(t+r[0],s):e.moveTo(t,s),r[1]?e.arcTo(a,s,a,h,r[1]):e.lineTo(a,s),r[2]?e.arcTo(a,h,t,h,r[2]):e.lineTo(a,h),r[3]?e.arcTo(t,h,t,s,r[3]):e.lineTo(t,h),r[0]?e.arcTo(t,s,a,s,r[0]):e.lineTo(t,s)}},{sin:vt,cos:$t,atan2:Os,ceil:Vi,abs:Te,PI:Rs,sqrt:Ps,pow:Gt}=Math,{setPoint:ke,addPoint:Qt}=ue,{set:Zt,toNumberPoints:Ki}=v,{M:Ls,L:ve,C:Oe,Q:Ss,Z:tn}=Q,Re={},wt={points(e,t,s,i){let n=Ki(t);if(e.push(Ls,n[0],n[1]),s&&n.length>5){let o,r,a,h,l,u,d,_,c,g,m,x,C,O=n.length;const P=s===!0?.5:s;i&&(n=[n[O-2],n[O-1],...n,n[0],n[1],n[2],n[3]],O=n.length);for(let T=2;T<O-2;T+=2)o=n[T-2],r=n[T-1],a=n[T],h=n[T+1],l=n[T+2],u=n[T+3],m=Ps(Gt(a-o,2)+Gt(h-r,2)),x=Ps(Gt(l-a,2)+Gt(u-h,2)),C=m+x,m=P*m/C,x=P*x/C,l-=o,u-=r,d=a-m*l,_=h-m*u,T===2?i||e.push(Ss,d,_,a,h):e.push(Oe,c,g,d,_,a,h),c=a+x*l,g=h+x*u;i||e.push(Ss,c,g,n[O-2],n[O-1])}else for(let o=2,r=n.length;o<r;o+=2)e.push(ve,n[o],n[o+1]);i&&e.push(tn)},rect(e,t,s,i,n){V.creator.path=e,V.creator.moveTo(t,s).lineTo(t+i,s).lineTo(t+i,s+n).lineTo(t,s+n).lineTo(t,s)},roundRect(e,t,s,i,n,o){V.creator.path=[],Ti.drawRoundRect(V.creator,t,s,i,n,o),e.push(...V.convertToCanvasData(V.creator.path,!0))},arcTo(e,t,s,i,n,o,r,a,h,l,u){const d=i-t,_=n-s,c=o-i,g=r-n;let m=Os(_,d),x=Os(g,c),C=x-m;if(C<0&&(C+=q),C===Rs||Te(d+_)<1e-12||Te(c+g)<1e-12){e&&e.push(ve,i,n),h&&(ke(h,t,s),Qt(h,i,n)),u&&Zt(u,t,s),l&&Zt(l,i,n);return}const O=d*g-c*_<0,P=O?-1:1,T=a/$t(C/2),Y=i+T*$t(m+C/2+It*P),N=n+T*vt(m+C/2+It*P);return m-=It*P,x-=It*P,Ms(e,Y,N,a,a,0,m/k,x/k,O,h,l,u)},arc(e,t,s,i,n,o,r,a,h,l){return Ms(e,t,s,i,i,0,n,o,r,a,h,l)},ellipse(e,t,s,i,n,o,r,a,h,l,u,d){const _=o*k,c=vt(_),g=$t(_);let m=r*k,x=a*k;m>Rs&&(m-=q),x<0&&(x+=q);let C=x-m;C<0?C+=q:C>q&&(C-=q),h&&(C-=q);const O=Vi(Te(C/It)),P=C/O,T=vt(P/4),Y=8/3*T*T/vt(P/2);x=m+P;let N=$t(m),A=vt(m),D,G,F,X,tt,dt,ft,pt,Bt=F=g*i*N-c*n*A,de=X=c*i*N+g*n*A,fe=t+F,pe=s+X;e&&e.push(e.length?ve:Ls,fe,pe),l&&ke(l,fe,pe),d&&Zt(d,fe,pe);for(let as=0;as<O;as++)D=$t(x),G=vt(x),F=g*i*D-c*n*G,X=c*i*D+g*n*G,tt=t+Bt-Y*(g*i*A+c*n*N),dt=s+de-Y*(c*i*A-g*n*N),ft=t+F+Y*(g*i*G+c*n*D),pt=s+X+Y*(c*i*G-g*n*D),e&&e.push(Oe,tt,dt,ft,pt,t+F,s+X),l&&Es(t+Bt,s+de,tt,dt,ft,pt,t+F,s+X,l,!0),Bt=F,de=X,N=D,A=G,m=x,x+=P;u&&Zt(u,t+F,s+X)},quadraticCurveTo(e,t,s,i,n,o,r){e.push(Oe,(t+2*i)/3,(s+2*n)/3,(o+2*i)/3,(r+2*n)/3,o,r)},toTwoPointBoundsByQuadraticCurve(e,t,s,i,n,o,r,a){Es(e,t,(e+2*s)/3,(t+2*i)/3,(n+2*s)/3,(o+2*i)/3,n,o,r,a)},toTwoPointBounds(e,t,s,i,n,o,r,a,h,l){const u=[];let d,_,c,g,m,x,C,O,P=e,T=s,Y=n,N=r;for(let A=0;A<2;++A){if(A==1&&(P=t,T=i,Y=o,N=a),d=-3*P+9*T-9*Y+3*N,_=6*P-12*T+6*Y,c=3*T-3*P,Math.abs(d)<1e-12){if(Math.abs(_)<1e-12)continue;g=-c/_,0<g&&g<1&&u.push(g);continue}C=_*_-4*c*d,O=Math.sqrt(C),!(C<0)&&(m=(-_+O)/(2*d),0<m&&m<1&&u.push(m),x=(-_-O)/(2*d),0<x&&x<1&&u.push(x))}l?Qt(h,e,t):ke(h,e,t),Qt(h,r,a);for(let A=0,D=u.length;A<D;A++)Is(u[A],e,t,s,i,n,o,r,a,Re),Qt(h,Re.x,Re.y)},getPointAndSet(e,t,s,i,n,o,r,a,h,l){const u=1-e,d=u*u*u,_=3*u*u*e,c=3*u*e*e,g=e*e*e;l.x=d*t+_*i+c*o+g*a,l.y=d*s+_*n+c*r+g*h},getPoint(e,t,s,i,n,o,r,a,h){const l={};return Is(e,t,s,i,n,o,r,a,h,l),l}},{getPointAndSet:Is,toTwoPointBounds:Es,ellipse:Ms}=wt,{sin:en,cos:sn,sqrt:As,atan2:$s}=Math,{ellipse:nn}=wt,rn={ellipticalArc(e,t,s,i,n,o,r,a,h,l,u){const d=(h-t)/2,_=(l-s)/2,c=o*k,g=en(c),m=sn(c),x=-m*d-g*_,C=-m*_+g*d,O=i*i,P=n*n,T=C*C,Y=x*x,N=O*P-O*T-P*Y;let A=0;if(N<0){const Bt=As(1-N/(O*P));i*=Bt,n*=Bt}else A=(r===a?-1:1)*As(N/(O*T+P*Y));const D=A*i*C/n,G=-A*n*x/i,F=$s((C-G)/n,(x-D)/i),X=$s((-C-G)/n,(-x-D)/i);let tt=X-F;a===0&&tt>0?tt-=q:a===1&&tt<0&&(tt+=q);const dt=t+d+m*D-g*G,ft=s+_+g*D+m*G,pt=tt<0?1:0;u||K.ellipseToCurve?nn(e,dt,ft,i,n,o,F/k,X/k,pt):i===n&&!o?e.push(Q.O,dt,ft,i,F/k,X/k,pt):e.push(Q.G,dt,ft,i,n,o,F/k,X/k,pt)}},{M:Pe,m:on,L:Wt,l:an,H:hn,h:ln,V:un,v:cn,C:Ot,c:_n,S:Le,s:dn,Q:Rt,q:fn,T:Se,t:pn,A:gn,a:yn,Z:Ie,z:mn,N:xn,D:bn,X:wn,G:Cn,F:Bn,O:Tn,P:kn,U:vn}=Q,{rect:On,roundRect:Ws,arcTo:Rn,arc:Ns,ellipse:Ys,quadraticCurveTo:Ds}=wt,{ellipticalArc:Pn}=rn,Ln=$.get("PathConvert"),st={},_e={current:{dot:0},stringify(e,t){let s=0,i=e.length,n,o="",r,a;for(;s<i;){r=e[s],n=Bi[r],r===a?o+=" ":o+=Ci[r];for(let h=1;h<n;h++)o+=ut.float(e[s+h],t),h===n-1||(o+=" ");a=r,s+=n}return o},parse(e,t){let s,i,n,o="";const r=[],a=t?Ji:wi;for(let h=0,l=e.length;h<l;h++)i=e[h],ji[i]?(i==="."&&(U.dot&&(xt(r,o),o=""),U.dot++),o==="0"&&i!=="."&&(xt(r,o),o=""),o+=i):Q[i]?(o&&(xt(r,o),o=""),U.name=Q[i],U.length=bi[i],U.index=0,xt(r,U.name),!s&&a[i]&&(s=!0)):i==="-"||i==="+"?n==="e"||n==="E"?o+=i:(o&&xt(r,o),o=i):o&&(xt(r,o),o=""),n=i;return o&&xt(r,o),s?_e.toCanvasData(r,t):r},toCanvasData(e,t){let s=0,i=0,n=0,o=0,r=0,a=e.length,h,l,u,d,_;const c=[];for(;r<a;){switch(u=e[r],u){case on:e[r+1]+=s,e[r+2]+=i;case Pe:s=e[r+1],i=e[r+2],c.push(Pe,s,i),r+=3;break;case ln:e[r+1]+=s;case hn:s=e[r+1],c.push(Wt,s,i),r+=2;break;case cn:e[r+1]+=i;case un:i=e[r+1],c.push(Wt,s,i),r+=2;break;case an:e[r+1]+=s,e[r+2]+=i;case Wt:s=e[r+1],i=e[r+2],c.push(Wt,s,i),r+=3;break;case dn:e[r+1]+=s,e[r+2]+=i,e[r+3]+=s,e[r+4]+=i,u=Le;case Le:_=d===Ot||d===Le,n=_?s*2-h:e[r+1],o=_?i*2-l:e[r+2],h=e[r+1],l=e[r+2],s=e[r+3],i=e[r+4],c.push(Ot,n,o,h,l,s,i),r+=5;break;case _n:e[r+1]+=s,e[r+2]+=i,e[r+3]+=s,e[r+4]+=i,e[r+5]+=s,e[r+6]+=i,u=Ot;case Ot:h=e[r+3],l=e[r+4],s=e[r+5],i=e[r+6],c.push(Ot,e[r+1],e[r+2],h,l,s,i),r+=7;break;case pn:e[r+1]+=s,e[r+2]+=i,u=Se;case Se:_=d===Rt||d===Se,h=_?s*2-h:e[r+1],l=_?i*2-l:e[r+2],t?Ds(c,s,i,h,l,e[r+1],e[r+2]):c.push(Rt,h,l,e[r+1],e[r+2]),s=e[r+1],i=e[r+2],r+=3;break;case fn:e[r+1]+=s,e[r+2]+=i,e[r+3]+=s,e[r+4]+=i,u=Rt;case Rt:h=e[r+1],l=e[r+2],t?Ds(c,s,i,h,l,e[r+3],e[r+4]):c.push(Rt,h,l,e[r+3],e[r+4]),s=e[r+3],i=e[r+4],r+=5;break;case yn:e[r+6]+=s,e[r+7]+=i;case gn:Pn(c,s,i,e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],t),s=e[r+6],i=e[r+7],r+=8;break;case mn:case Ie:c.push(Ie),r++;break;case xn:s=e[r+1],i=e[r+2],t?On(c,s,i,e[r+3],e[r+4]):lt(c,e,r,5),r+=5;break;case bn:s=e[r+1],i=e[r+2],t?Ws(c,s,i,e[r+3],e[r+4],[e[r+5],e[r+6],e[r+7],e[r+8]]):lt(c,e,r,9),r+=9;break;case wn:s=e[r+1],i=e[r+2],t?Ws(c,s,i,e[r+3],e[r+4],e[r+5]):lt(c,e,r,6),r+=6;break;case Cn:Ys(t?c:lt(c,e,r,9),e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],null,st),s=st.x,i=st.y,r+=9;break;case Bn:t?Ys(c,e[r+1],e[r+2],e[r+3],e[r+4],0,0,360,!1):lt(c,e,r,5),s=e[r+1]+e[r+3],i=e[r+2],r+=5;break;case Tn:Ns(t?c:lt(c,e,r,7),e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],null,st),s=st.x,i=st.y,r+=7;break;case kn:t?Ns(c,e[r+1],e[r+2],e[r+3],0,360,!1):lt(c,e,r,4),s=e[r+1]+e[r+3],i=e[r+2],r+=4;break;case vn:Rn(t?c:lt(c,e,r,6),s,i,e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],null,st),s=st.x,i=st.y,r+=6;break;default:return Ln.error(`command: ${u} [index:${r}]`,e),c}d=u}return c},objectToCanvasData(e){const t=[];return e.forEach(s=>{switch(s.name){case"M":t.push(Pe,s.x,s.y);break;case"L":t.push(Wt,s.x,s.y);break;case"C":t.push(Ot,s.x1,s.y1,s.x2,s.y2,s.x,s.y);break;case"Q":t.push(Rt,s.x1,s.y1,s.x,s.y);break;case"Z":t.push(Ie)}}),t},copyData(e,t,s,i){for(let n=s,o=s+i;n<o;n++)e.push(t[n])},pushData(e,t){U.index===U.length&&(U.index=1,e.push(U.name)),e.push(Number(t)),U.index++,U.dot=0}},{current:U,pushData:xt,copyData:lt}=_e,{M:Ee,L:Sn,C:In,Q:En,Z:Mn,N:Fs,D:An,X:$n,G:Wn,F:Nn,O:Yn,P:Dn,U:Xs}=Q,{getMinDistanceFrom:Fn,getRadianFrom:Xn}=v,{tan:jn,min:zn,abs:Hn}=Math,Pt={},ss={beginPath(e){e.length=0},moveTo(e,t,s){e.push(Ee,t,s)},lineTo(e,t,s){e.push(Sn,t,s)},bezierCurveTo(e,t,s,i,n,o,r){e.push(In,t,s,i,n,o,r)},quadraticCurveTo(e,t,s,i,n){e.push(En,t,s,i,n)},closePath(e){e.push(Mn)},rect(e,t,s,i,n){e.push(Fs,t,s,i,n)},roundRect(e,t,s,i,n,o){if(typeof o=="number")e.push($n,t,s,i,n,o);else{const r=ut.fourNumber(o);r?e.push(An,t,s,i,n,...r):e.push(Fs,t,s,i,n)}},ellipse(e,t,s,i,n,o,r,a,h){o===void 0?e.push(Nn,t,s,i,n):(r===void 0&&(r=0),a===void 0&&(a=360),e.push(Wn,t,s,i,n,o,r,a,h?1:0))},arc(e,t,s,i,n,o,r){n===void 0?e.push(Dn,t,s,i):(o===void 0&&(o=360),e.push(Yn,t,s,i,n,o,r?1:0))},arcTo(e,t,s,i,n,o,r,a){if(r!==void 0){const h=jn(Xn(r,a,t,s,i,n)/2)*(Fn(r,a,t,s,i,n)/2);e.push(Xs,t,s,i,n,zn(o,Hn(h)))}else e.push(Xs,t,s,i,n,o)},drawEllipse(e,t,s,i,n,o,r,a,h){wt.ellipse(null,t,s,i,n,o===void 0?0:o,r===void 0?0:r,a===void 0?360:a,h,null,null,Pt),e.push(Ee,Pt.x,Pt.y),Un(e,t,s,i,n,o,r,a,h)},drawArc(e,t,s,i,n,o,r){wt.arc(null,t,s,i,n===void 0?0:n,o===void 0?360:o,r,null,null,Pt),e.push(Ee,Pt.x,Pt.y),qn(e,t,s,i,n,o,r)},drawPoints(e,t,s,i){wt.points(e,t,s,i)}},{ellipse:Un,arc:qn}=ss,{moveTo:Gn,lineTo:Qn,quadraticCurveTo:Zn,bezierCurveTo:Jn,closePath:Vn,beginPath:Kn,rect:tr,roundRect:er,ellipse:sr,arc:ir,arcTo:nr,drawEllipse:rr,drawArc:or,drawPoints:ar}=ss;class ki{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return t?this.__path=typeof t=="string"?V.parse(t):t:this.__path=[],this}beginPath(){return Kn(this.__path),this.paint(),this}moveTo(t,s){return Gn(this.__path,t,s),this.paint(),this}lineTo(t,s){return Qn(this.__path,t,s),this.paint(),this}bezierCurveTo(t,s,i,n,o,r){return Jn(this.__path,t,s,i,n,o,r),this.paint(),this}quadraticCurveTo(t,s,i,n){return Zn(this.__path,t,s,i,n),this.paint(),this}closePath(){return Vn(this.__path),this.paint(),this}rect(t,s,i,n){return tr(this.__path,t,s,i,n),this.paint(),this}roundRect(t,s,i,n,o){return er(this.__path,t,s,i,n,o),this.paint(),this}ellipse(t,s,i,n,o,r,a,h){return sr(this.__path,t,s,i,n,o,r,a,h),this.paint(),this}arc(t,s,i,n,o,r){return ir(this.__path,t,s,i,n,o,r),this.paint(),this}arcTo(t,s,i,n,o){return nr(this.__path,t,s,i,n,o),this.paint(),this}drawEllipse(t,s,i,n,o,r,a,h){return rr(this.__path,t,s,i,n,o,r,a,h),this.paint(),this}drawArc(t,s,i,n,o,r){return or(this.__path,t,s,i,n,o,r),this.paint(),this}drawPoints(t,s,i){return ar(this.__path,t,s,i),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:hr,L:lr,C:ur,Q:cr,Z:_r,N:dr,D:fr,X:pr,G:gr,F:yr,O:mr,P:xr,U:br}=Q,wr=$.get("PathDrawer"),fa={drawPathByData(e,t){if(!t)return;let s,i=0,n=t.length;for(;i<n;)switch(s=t[i],s){case hr:e.moveTo(t[i+1],t[i+2]),i+=3;break;case lr:e.lineTo(t[i+1],t[i+2]),i+=3;break;case ur:e.bezierCurveTo(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5],t[i+6]),i+=7;break;case cr:e.quadraticCurveTo(t[i+1],t[i+2],t[i+3],t[i+4]),i+=5;break;case _r:e.closePath(),i+=1;break;case dr:e.rect(t[i+1],t[i+2],t[i+3],t[i+4]),i+=5;break;case fr:e.roundRect(t[i+1],t[i+2],t[i+3],t[i+4],[t[i+5],t[i+6],t[i+7],t[i+8]]),i+=9;break;case pr:e.roundRect(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]),i+=6;break;case gr:e.ellipse(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]*k,t[i+6]*k,t[i+7]*k,t[i+8]),i+=9;break;case yr:e.ellipse(t[i+1],t[i+2],t[i+3],t[i+4],0,0,q,!1),i+=5;break;case mr:e.arc(t[i+1],t[i+2],t[i+3],t[i+4]*k,t[i+5]*k,t[i+6]),i+=7;break;case xr:e.arc(t[i+1],t[i+2],t[i+3],0,q,!1),i+=4;break;case br:e.arcTo(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]),i+=6;break;default:wr.error(`command: ${s} [index:${i}]`,t);return}}},{M:Cr,L:Br,C:js,Q:zs,Z:Hs,N:Tr,D:Us,X:kr,G:vr,F:Or,O:Rr,P:Pr,U:Lr}=Q,{toTwoPointBounds:Sr,toTwoPointBoundsByQuadraticCurve:Ir,arcTo:Er,arc:Mr,ellipse:Ar}=wt,{addPointBounds:Nt,copy:Me,addPoint:$r,setPoint:Ae,addBounds:Jt,toBounds:Wr}=ue,Nr=$.get("PathBounds");let Lt,Vt,$e;const j={},qs={},it={},vi={toBounds(e,t){vi.toTwoPointBounds(e,qs),Wr(qs,t)},toTwoPointBounds(e,t){if(!e||!e.length)return Ae(t,0,0);let s=0,i=0,n=0,o,r,a,h,l;const u=e.length;for(;s<u;)switch(l=e[s],s===0&&(l===Hs||l===js||l===zs?Ae(t,i,n):Ae(t,e[s+1],e[s+2])),l){case Cr:case Br:i=e[s+1],n=e[s+2],$r(t,i,n),s+=3;break;case js:a=e[s+5],h=e[s+6],Sr(i,n,e[s+1],e[s+2],e[s+3],e[s+4],a,h,j),Nt(t,j),i=a,n=h,s+=7;break;case zs:o=e[s+1],r=e[s+2],a=e[s+3],h=e[s+4],Ir(i,n,o,r,a,h,j),Nt(t,j),i=a,n=h,s+=5;break;case Hs:s+=1;break;case Tr:i=e[s+1],n=e[s+2],Jt(t,i,n,e[s+3],e[s+4]),s+=5;break;case Us:case kr:i=e[s+1],n=e[s+2],Jt(t,i,n,e[s+3],e[s+4]),s+=l===Us?9:6;break;case vr:Ar(null,e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6],e[s+7],e[s+8],j,it),s===0?Me(t,j):Nt(t,j),i=it.x,n=it.y,s+=9;break;case Or:i=e[s+1],n=e[s+2],Vt=e[s+3],$e=e[s+4],Jt(t,i-Vt,n-$e,Vt*2,$e*2),i+=Vt,s+=5;break;case Rr:Mr(null,e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6],j,it),s===0?Me(t,j):Nt(t,j),i=it.x,n=it.y,s+=7;break;case Pr:i=e[s+1],n=e[s+2],Lt=e[s+3],Jt(t,i-Lt,n-Lt,Lt*2,Lt*2),i+=Lt,s+=4;break;case Lr:Er(null,i,n,e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],j,it),s===0?Me(t,j):Nt(t,j),i=it.x,n=it.y,s+=6;break;default:Nr.error(`command: ${l} [index:${s}]`,e);return}}},{M:We,L:Kt,C:Gs,Z:te}=Q,{getCenterX:Yr,getCenterY:Dr}=v,{arcTo:Ne}=ss,pa={smooth(e,t,s){let i,n=0,o=0,r=0,a=0,h=0,l=0,u=0,d=0,_=0;const c=e.length,g=[];for(;n<c;)switch(i=e[n],i){case We:a=d=e[n+1],h=_=e[n+2],n+=3,e[n]===Kt?(l=e[n+1],u=e[n+2],g.push(We,Yr(a,l),Dr(h,u))):g.push(We,a,h);break;case Kt:switch(o=e[n+1],r=e[n+2],n+=3,e[n]){case Kt:Ne(g,o,r,e[n+1],e[n+2],t,d,_);break;case te:Ne(g,o,r,a,h,t,d,_);break;default:g.push(Kt,o,r)}d=o,_=r;break;case Gs:g.push(Gs,e[n+1],e[n+2],e[n+3],e[n+4],e[n+5],e[n+6]),n+=7;break;case te:Ne(g,a,h,l,u,t,d,_),g.push(te),n+=1;break}return i!==te&&(g[1]=a,g[2]=h),g}};V.creator=new ki;V.parse=_e.parse;V.convertToCanvasData=_e.toCanvasData;const ga=new ki,{drawRoundRect:Fr}=Ti;function Xr(e){e&&!e.roundRect&&(e.roundRect=function(t,s,i,n,o){Fr(this,t,s,i,n,o)})}function ya(e){Xr(e)}const ie={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType(e){return!e||e.startsWith("image")?e:(e==="jpg"&&(e="jpeg"),"image/"+e)},fileType(e){const t=e.split(".");return t[t.length-1]},isOpaqueImage(e){const t=Qe.fileType(e);return["jpg","jpeg"].some(s=>s===t)},getExportOptions(e){switch(typeof e){case"object":return e;case"number":return{quality:e};case"boolean":return{blob:e};default:return{}}}},Qe=ie;Qe.opacityTypes.forEach(e=>Qe.upperCaseTypeMap[e]=e.toUpperCase());const jr=$.get("TaskProcessor");class zr{constructor(t){this.parallel=!0,this.time=1,this.id=rt.create(rt.TASK),this.task=t}run(){return yi(this,void 0,void 0,function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){jr.error(t)}})}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class Qs{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let s=0,i=0;for(let n=0;n<t;n++)n<=this.finishedIndex?(i+=this.list[n].time,n===this.finishedIndex&&(s=i)):s+=this.list[n].time;return this.isComplete?1:i/s}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&ce.assign(this.config,t),this.empty()}add(t,s){let i,n,o,r;const a=new zr(t);return a.parent=this,typeof s=="number"?r=s:s&&(n=s.parallel,i=s.start,o=s.time,r=s.delay),o&&(a.time=o),n===!1&&(a.parallel=!1),r===void 0?this.push(a,i):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(a,i))},r)),this.isComplete=!1,a}push(t,s){this.list.push(t),s!==!1&&!this.timer&&(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.cancel()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];if(!t){this.nextTask();return}t.run().then(()=>{this.onTask(t),this.index++,this.nextTask()}).catch(s=>{this.onError(s)})}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(s=>{this.onParallelError(s)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let s=this.index+this.config.parallel;s>this.list.length&&(s=this.list.length);for(let i=this.index;i<s&&(t=this.list[i],t.parallel);i++)this.parallelList.push(t)}fillParallelTask(){let t;const s=this.parallelList;this.parallelSuccessNumber++,s.pop();const i=s.length,n=this.finishedIndex+i;if(s.length){if(!this.running)return;n<this.total&&(t=this.list[n],t&&t.parallel&&(s.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(s=>{s.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const ne={map:{},recycledList:[],tasker:new Qs,patternTasker:new Qs,get isComplete(){return nt.tasker.isComplete},get(e){let t=nt.map[e.url];return t||(t=Je.image(e),nt.map[e.url]=t),t.use++,t},recycle(e){e.use--,setTimeout(()=>{e.use||nt.recycledList.push(e)})},clearRecycled(){const e=nt.recycledList;e.length>100&&(e.forEach(t=>{!t.use&&t.url&&(delete nt.map[t.url],t.destroy())}),e.length=0)},hasOpacityPixel(e){return ie.opacityTypes.some(t=>nt.isFormat(t,e))},isFormat(e,t){if(t.format===e)return!0;const{url:s}=t;if(s.startsWith("data:")){if(s.startsWith("data:"+ie.mineType(e)))return!0}else{if(s.includes("."+e)||s.includes("."+ie.upperCaseTypeMap[e]))return!0;if(e==="png"&&!s.includes("."))return!0}return!1},destroy(){nt.map={},nt.recycledList=[]}},nt=ne,{IMAGE:Hr,create:Ur}=rt;class ma{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=Ur(Hr),this.config=t||{url:""},this.isSVG=ne.isFormat("svg",t),this.hasOpacityPixel=ne.hasOpacityPixel(t)}load(t,s){return this.loading||(this.loading=!0,ne.tasker.add(()=>yi(this,void 0,void 0,function*(){return yield K.origin.loadImage(this.url).then(i=>{this.ready=!0,this.width=i.naturalWidth||i.width,this.height=i.naturalHeight||i.height,this.view=i,this.onComplete(!0)}).catch(i=>{this.error=i,this.onComplete(!1)})}))),this.waitComplete.push(t,s),this.waitComplete.length-2}unload(t,s){const i=this.waitComplete;if(s){const n=i[t+1];n&&n({type:"stop"})}i[t]=i[t+1]=void 0}onComplete(t){let s;this.waitComplete.forEach((i,n)=>{s=n%2,i&&(t?s||i(this):s&&i(this.error))}),this.waitComplete.length=0,this.loading=!1}getCanvas(t,s,i,n){if(t||(t=this.width),s||(s=this.height),this.cache){let{params:a,data:h}=this.cache;for(let l in a)if(a[l]!==arguments[l]){h=null;break}if(h)return h}const o=K.origin.createCanvas(t,s),r=o.getContext("2d");return i&&(r.globalAlpha=i),r.drawImage(this.view,0,0,t,s),this.cache=this.use>1?{data:o,params:arguments}:null,o}getPattern(t,s,i,n){const o=K.canvas.createPattern(t,s);try{i&&o.setTransform&&(o.setTransform(i),i=null)}catch{}return n&&(n.transform=i),o}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function is(e,t,s,i){i||(s.configurable=s.enumerable=!0),Object.defineProperty(e,t,s)}function Oi(e,t){return Object.getOwnPropertyDescriptor(e,t)}function qr(e){return Object.getOwnPropertyNames(e)}function M(e,t){return(s,i)=>Gr(s,i,e,t&&t(i))}function xa(e){return e}function Gr(e,t,s,i){is(e,t,Object.assign({get(){return this.__getAttr(t)},set(o){this.__setAttr(t,o)}},i||{})),Pi(e,t,s)}function ba(e){return M(e)}function wa(e,t){return M(e,s=>({set(i){this.__setAttr(s,i,t)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function Ca(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal())}}))}function Ba(e,t){return M(e,s=>({set(i){this.__setAttr(s,i,t)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function Ta(e,t){return M(e,s=>({set(i){this.__setAttr(s,i,t)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function Ri(e,t){return M(e,s=>({set(i){this.__setAttr(s,i,t)&&Dt(this)}}))}function ka(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(Dt(this),this.__.__removeNaturalSize())}}))}function Dt(e){e.__layout.boxChanged||e.__layout.boxChange(),e.__hasAutoLayout&&(e.__layout.matrixChanged||e.__layout.matrixChange())}function va(e){return M(e,t=>({set(s){const i=this.__;i.__pathInputed!==2&&(i.__pathInputed=s?1:0),s||(i.__pathForRender=void 0),this.__setAttr(t,s),Dt(this)}}))}const Oa=Ri;function Qr(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&Zr(this)}}))}function Zr(e){e.__layout.strokeChanged||e.__layout.strokeChange(),e.__.__useArrow&&Dt(e)}const Ra=Qr;function Pa(e){return M(e,t=>({set(s){this.__setAttr(t,s),this.__layout.renderChanged||this.__layout.renderChange()}}))}function La(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Sa(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}}))}function Ia(e){return M(e,t=>({set(s){const i=this.visible;if(i===!0&&s===0){if(this.animationOut)return this.__runAnimation("out",()=>Zs(this,t,s,i))}else i===0&&s===!0&&this.animation&&this.__runAnimation("in");Zs(this,t,s,i)}}))}function Zs(e,t,s,i){e.__setAttr(t,s)&&(e.__layout.opacityChanged||e.__layout.opacityChange(),(i===0||s===0)&&Dt(e))}function Ea(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function Ma(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(s)}))}}))}function Aa(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&this.waitParent(()=>{this.parent.__updateEraser(s)})}}))}function $a(e){return M(e,t=>({set(s){this.__setAttr(t,s)&&(this.__layout.hitCanvasChanged=!0,$.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}}))}function Wa(e){return M(e,t=>({set(s){this.__setAttr(t,s),this.leafer&&this.leafer.updateCursor()}}))}function Na(e){return(t,s)=>{is(t,"__DataProcessor",{get(){return e}})}}function Jr(e){return"set"+e.charAt(0).toUpperCase()+e.slice(1)}function Pi(e,t,s){const i=e.__DataProcessor.prototype,n="_"+t,o=Jr(t),r={get(){const l=this[n];return l===void 0?s:l},set(l){this[n]=l}};if(s===void 0)r.get=function(){return this[n]};else if(typeof s=="object"){const{clone:l}=ce;r.get=function(){let u=this[n];return u===void 0&&(this[n]=u=l(s)),u}}t==="width"?r.get=function(){const l=this[n];if(l===void 0){const u=this;return u._height&&u.__naturalWidth&&u.__useNaturalRatio?u._height*u.__naturalWidth/u.__naturalHeight:u.__naturalWidth||s}else return l}:t==="height"&&(r.get=function(){const l=this[n];if(l===void 0){const u=this;return u._width&&u.__naturalHeight&&u.__useNaturalRatio?u._width*u.__naturalHeight/u.__naturalWidth:u.__naturalHeight||s}else return l});let a,h=i;for(;!a&&h;)a=Oi(h,t),h=h.__proto__;a&&a.set&&(r.set=a.set),i[o]&&(r.set=i[o],delete i[o]),is(i,t,r)}const Vr=new $("rewrite"),re=[],Kr=["destroy","constructor"];function Ya(e){return(t,s)=>{re.push({name:t.constructor.name+"."+s,run:()=>{t[s]=e}})}}function Da(){return e=>{Li()}}function Li(e){re.length&&(re.forEach(t=>{e&&Vr.error(t.name,"需在Class上装饰@rewriteAble()"),t.run()}),re.length=0)}setTimeout(()=>Li(!0));function Et(e,t){return s=>{(e.prototype?qr(e.prototype):Object.keys(e)).forEach(n=>{!Kr.includes(n)&&(!t||!t.includes(n))&&(e.prototype?Oi(e.prototype,n).writable&&(s.prototype[n]=e.prototype[n]):s.prototype[n]=e[n])})}}function Fa(){return e=>{es.register(e)}}function Xa(){return e=>{ae.register(e)}}const{copy:St,toInnerPoint:to,toOuterPoint:eo,scaleOfOuter:Js,rotateOfOuter:so,skewOfOuter:io,multiplyParent:Vs,divideParent:Ks,getLayout:no}=b,I={},Ft={updateAllMatrix(e,t,s){if(t&&e.__hasAutoLayout&&e.__layout.matrixChanged&&(s=!0),oo(e,t,s),e.isBranch){const{children:i}=e;for(let n=0,o=i.length;n<o;n++)ro(i[n],t,s)}},updateMatrix(e,t,s){const i=e.__layout;t?s&&(i.waitAutoLayout=!0,e.__hasAutoLayout&&(i.matrixChanged=!1)):i.waitAutoLayout&&(i.waitAutoLayout=!1),i.matrixChanged&&e.__updateLocalMatrix(),i.waitAutoLayout||e.__updateWorldMatrix()},updateBounds(e){const t=e.__layout;t.boundsChanged&&e.__updateLocalBounds(),t.waitAutoLayout||e.__updateWorldBounds()},updateAllWorldOpacity(e){if(e.__updateWorldOpacity(),e.isBranch){const{children:t}=e;for(let s=0,i=t.length;s<i;s++)ti(t[s])}},updateAllChange(e){if(ti(e),e.__updateChange(),e.isBranch){const{children:t}=e;for(let s=0,i=t.length;s<i;s++)ao(t[s])}},worldHittable(e){for(;e;){if(!e.__.hittable)return!1;e=e.parent}return!0},moveWorld(e,t,s=0,i){const n=typeof t=="object"?Object.assign({},t):{x:t,y:s};i?eo(e.localTransform,n,n,!0):e.parent&&to(e.parent.worldTransform,n,n,!0),W.moveLocal(e,n.x,n.y)},moveLocal(e,t,s=0){typeof t=="object"?(e.x+=t.x,e.y+=t.y):(e.x+=t,e.y+=s)},zoomOfWorld(e,t,s,i,n){W.zoomOfLocal(e,Ye(e,t),s,i,n)},zoomOfLocal(e,t,s,i=s,n){St(I,e.__localMatrix),Js(I,t,s,i),e.origin||e.around?W.setTransform(e,I,n):(ei(e,I),e.scaleResize(s,i,n!==!0))},rotateOfWorld(e,t,s){W.rotateOfLocal(e,Ye(e,t),s)},rotateOfLocal(e,t,s){St(I,e.__localMatrix),so(I,t,s),e.origin||e.around?W.setTransform(e,I):(ei(e,I),e.rotation=ut.formatRotation(e.rotation+s))},skewOfWorld(e,t,s,i,n){W.skewOfLocal(e,Ye(e,t),s,i,n)},skewOfLocal(e,t,s,i=0,n){St(I,e.__localMatrix),io(I,t,s,i),W.setTransform(e,I,n)},transformWorld(e,t,s){St(I,e.worldTransform),Vs(I,t),e.parent&&Ks(I,e.parent.worldTransform),W.setTransform(e,I,s)},transform(e,t,s){St(I,e.localTransform),Vs(I,t),W.setTransform(e,I,s)},setTransform(e,t,s){const i=no(t,e.origin&&W.getInnerOrigin(e,e.origin),e.around&&W.getInnerOrigin(e,e.around));if(s){const n=i.scaleX/e.scaleX,o=i.scaleY/e.scaleY;delete i.scaleX,delete i.scaleY,e.set(i),e.scaleResize(n,o,s!==!0)}else e.set(i)},getFlipTransform(e,t){const s=oe(),i=t==="x"?1:-1;return Js(s,W.getLocalOrigin(e,"center"),-1*i,1*i),s},getLocalOrigin(e,t){return v.tempToOuterOf(W.getInnerOrigin(e,t),e.localTransform)},getInnerOrigin(e,t){const s={};return ts.toPoint(t,e.boxBounds,s),s},getRelativeWorld(e,t,s){return St(I,e.worldTransform),Ks(I,t.worldTransform),s?I:Object.assign({},I)},drop(e,t,s,i){e.setTransform(W.getRelativeWorld(e,t,!0),i),t.add(e,s)},hasParent(e,t){if(!t)return!1;for(;e;){if(t===e)return!0;e=e.parent}}},W=Ft,{updateAllMatrix:ro,updateMatrix:oo,updateAllWorldOpacity:ti,updateAllChange:ao}=W;function ei(e,t){const{e:s,f:i}=e.__localMatrix;e.x+=t.e-s,e.y+=t.f-i}function Ye(e,t){return e.__layout.update(),e.parent?v.tempToInnerOf(t,e.parent.__world):t}const Si={worldBounds(e){return e.__world},localBoxBounds(e){return e.__.eraser||e.__.visible===0?null:e.__local||e.__layout},localStrokeBounds(e){return e.__.eraser||e.__.visible===0?null:e.__layout.localStrokeBounds},localRenderBounds(e){return e.__.eraser||e.__.visible===0?null:e.__layout.localRenderBounds},maskLocalBoxBounds(e){return e.__.mask?e.__localBoxBounds:null},maskLocalStrokeBounds(e){return e.__.mask?e.__layout.localStrokeBounds:null},maskLocalRenderBounds(e){return e.__.mask?e.__layout.localRenderBounds:null},excludeRenderBounds(e,t){return!!(t.bounds&&!t.bounds.hit(e.__world,t.matrix)||t.hideBounds&&t.hideBounds.includes(e.__world,t.matrix))}},{updateBounds:si}=Ft,ns={sort(e,t){return e.__.zIndex===t.__.zIndex?e.__tempNumber-t.__tempNumber:e.__.zIndex-t.__.zIndex},pushAllChildBranch(e,t){if(e.__tempNumber=1,e.__.__childBranchNumber){const{children:s}=e;for(let i=0,n=s.length;i<n;i++)e=s[i],e.isBranch&&(e.__tempNumber=1,t.add(e),ho(e,t))}},pushAllParent(e,t){const{keys:s}=t;if(s)for(;e.parent&&s[e.parent.innerId]===void 0;)t.add(e.parent),e=e.parent;else for(;e.parent;)t.add(e.parent),e=e.parent},pushAllBranchStack(e,t){let s=t.length;const{children:i}=e;for(let n=0,o=i.length;n<o;n++)i[n].isBranch&&t.push(i[n]);for(let n=s,o=t.length;n<o;n++)ii(t[n],t)},updateBounds(e,t){const s=[e];ii(e,s),lo(s,t)},updateBoundsByBranchStack(e,t){let s,i;for(let n=e.length-1;n>-1;n--){s=e[n],i=s.children;for(let o=0,r=i.length;o<r;o++)si(i[o]);t&&t===s||si(s)}}},{pushAllChildBranch:ho,pushAllBranchStack:ii,updateBoundsByBranchStack:lo}=ns,ja={run(e){if(e&&e.length){const t=e.length;for(let s=0;s<t;s++)e[s]();e.length===t?e.length=0:e.splice(0,t)}}},{getRelativeWorld:ni}=Ft,{toOuterOf:ee,getPoints:uo,copy:co}=y,De="_localContentBounds",Fe="_worldContentBounds",Xe="_worldBoxBounds",je="_worldStrokeBounds";class _o{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return ee(this.contentBounds,this.leaf.__localMatrix,this[De]||(this[De]={})),this[De]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return ee(this.contentBounds,this.leaf.__world,this[Fe]||(this[Fe]={})),this[Fe]}get worldBoxBounds(){return ee(this.boxBounds,this.leaf.__world,this[Xe]||(this[Xe]={})),this[Xe]}get worldStrokeBounds(){return ee(this.strokeBounds,this.leaf.__world,this[je]||(this[je]={})),this[je]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():t.start();else{let s=this.leaf;for(;s.parent&&!s.parent.leafer;)s=s.parent;K.layout(s)}}getTransform(t="world"){this.update();const{leaf:s}=this;switch(t){case"world":return s.__world;case"local":return s.__localMatrix;case"inner":return b.defaultMatrix;case"page":t=s.zoomLayer;default:return ni(s,t)}}getBounds(t,s="world"){switch(this.update(),s){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":s=this.leaf.zoomLayer;default:return new Ct(this.getInnerBounds(t)).toOuterOf(this.getTransform(s))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,s="world",i){const{leaf:n}=this;let o,r,a,h=this.getInnerBounds(t);switch(s){case"world":o=n.getWorldPoint(h),r=n.__world;break;case"local":const{scaleX:l,scaleY:u,rotation:d,skewX:_,skewY:c}=n.__;a={scaleX:l,scaleY:u,rotation:d,skewX:_,skewY:c},o=n.getLocalPointByInner(h);break;case"inner":o=h,r=b.defaultMatrix;break;case"page":s=n.zoomLayer;default:o=n.getWorldPoint(h,s),r=ni(n,s,!0)}if(a||(a=b.getLayout(r)),co(a,h),v.copy(a,o),i){const{scaleX:l,scaleY:u}=a,d=Math.abs(l),_=Math.abs(u);(d!==1||_!==1)&&(a.scaleX/=d,a.scaleY/=_,a.width*=d,a.height*=_)}return a}getLayoutPoints(t,s="world"){const{leaf:i}=this,n=uo(this.getInnerBounds(t));let o;switch(s){case"world":o=null;break;case"local":o=i.parent;break;case"inner":break;case"page":s=i.zoomLayer;default:o=s}return o!==void 0&&n.forEach(r=>i.innerToWorld(r,null,!1,o)),n}shrinkContent(){const{x:t,y:s,width:i,height:n}=this.boxBounds;this._contentBounds={x:t,y:s,width:i,height:n}}spreadStroke(){const{x:t,y:s,width:i,height:n}=this.strokeBounds;this._strokeBounds={x:t,y:s,width:i,height:n},this._localStrokeBounds={x:t,y:s,width:i,height:n},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:s,width:i,height:n}=this.renderBounds;this._renderBounds={x:t,y:s,width:i,height:n},this._localRenderBounds={x:t,y:s,width:i,height:n}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class ct{constructor(t,s){this.bubbles=!1,this.type=t,s&&(this.target=s)}stopDefault(){this.isStopDefault=!0,this.origin&&K.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&K.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&K.event.stop(this.origin)}}class E extends ct{constructor(t,s,i){super(t,s),this.parent=i,this.child=s}}E.ADD="child.add";E.REMOVE="child.remove";E.CREATED="created";E.MOUNTED="mounted";E.UNMOUNTED="unmounted";E.DESTROY="destroy";class Mt extends ct{constructor(t,s,i,n,o){super(t,s),this.attrName=i,this.oldValue=n,this.newValue=o}}Mt.CHANGE="property.change";Mt.LEAFER_CHANGE="property.leafer_change";class rs extends ct{constructor(t,s){super(t),Object.assign(this,s)}}rs.LOAD="image.load";rs.LOADED="image.loaded";rs.ERROR="image.error";class os extends ct{get bigger(){if(!this.old)return!0;const{width:t,height:s}=this.old;return this.width>=t&&this.height>=s}get smaller(){return!this.bigger}get samePixelRatio(){return this.old?this.pixelRatio===this.old.pixelRatio:!0}constructor(t,s){typeof t=="object"?(super(os.RESIZE),Object.assign(this,t)):super(t),this.old=s}}os.RESIZE="resize";class Ii extends ct{constructor(t,s){super(t),this.data=s}}Ii.REQUEST="watch.request";Ii.DATA="watch.data";class _t extends ct{constructor(t,s,i){super(t),s&&(this.data=s,this.times=i)}}_t.CHECK_UPDATE="layout.check_update";_t.REQUEST="layout.request";_t.START="layout.start";_t.BEFORE="layout.before";_t.LAYOUT="layout";_t.AFTER="layout.after";_t.AGAIN="layout.again";_t.END="layout.end";class ot extends ct{constructor(t,s,i,n){super(t),s&&(this.times=s),i&&(this.renderBounds=i,this.renderOptions=n)}}ot.REQUEST="render.request";ot.CHILD_START="render.child_start";ot.START="render.start";ot.BEFORE="render.before";ot.RENDER="render";ot.AFTER="render.after";ot.AGAIN="render.again";ot.END="render.end";ot.NEXT="render.next";class at extends ct{}at.START="leafer.start";at.BEFORE_READY="leafer.before_ready";at.READY="leafer.ready";at.AFTER_READY="leafer.after_ready";at.VIEW_READY="leafer.view_ready";at.VIEW_COMPLETED="leafer.view_completed";at.STOP="leafer.stop";at.RESTART="leafer.restart";at.END="leafer.end";const ri={};class fo{set event(t){this.on(t)}on(t,s,i){if(!s){let u,d=t;for(let _ in d)u=d[_],u instanceof Array?this.on(_,u[0],u[1]):this.on(_,u);return}let n,o;i&&(i==="once"?o=!0:typeof i=="boolean"?n=i:(n=i.capture,o=i.once));let r;const a=ze(this,n,!0),h=typeof t=="string"?t.split(" "):t,l=o?{listener:s,once:o}:{listener:s};h.forEach(u=>{u&&(r=a[u],r?r.findIndex(d=>d.listener===s)===-1&&r.push(l):a[u]=[l])})}off(t,s,i){if(t){const n=typeof t=="string"?t.split(" "):t;if(s){let o;i&&(o=typeof i=="boolean"?i:i==="once"?!1:i.capture);let r,a;const h=ze(this,o);n.forEach(l=>{l&&(r=h[l],r&&(a=r.findIndex(u=>u.listener===s),a>-1&&r.splice(a,1),r.length||delete h[l]))})}else{const{__bubbleMap:o,__captureMap:r}=this;n.forEach(a=>{o&&delete o[a],r&&delete r[a]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,s,i,n){return i&&(s=s.bind(i)),this.on(t,s,n),{type:t,current:this,listener:s,options:n}}off_(t){if(!t)return;const s=t instanceof Array?t:[t];s.forEach(i=>i.current.off(i.type,i.listener,i.options)),s.length=0}once(t,s,i){this.on(t,s,{once:!0,capture:i})}emit(t,s,i){!s&&ae.has(t)&&(s=ae.get(t,{type:t,target:this,current:this}));const o=ze(this,i)[t];if(o){let r;for(let a=0,h=o.length;a<h&&(r=o[a],r.listener(s),r.once&&(this.off(t,r.listener,i),a--,h--),!(s&&s.isStopNow));a++);}this.syncEventer&&this.syncEventer.emitEvent(s,i)}emitEvent(t,s){t.current=this,this.emit(t.type,t,s)}hasEvent(t,s){if(this.syncEventer&&this.syncEventer.hasEvent(t,s))return!0;const{__bubbleMap:i,__captureMap:n}=this,o=i&&i[t],r=n&&n[t];return!!(s===void 0?o||r:s?r:o)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function ze(e,t,s){if(t){const{__captureMap:i}=e;return i||(s?e.__captureMap={}:ri)}else{const{__bubbleMap:i}=e;return i||(s?e.__bubbleMap={}:ri)}}const{on:po,on_:go,off:yo,off_:mo,once:xo,emit:bo,emitEvent:wo,hasEvent:Co,destroy:Bo}=fo.prototype,To={on:po,on_:go,off:yo,off_:mo,once:xo,emit:bo,emitEvent:wo,hasEvent:Co,destroyEventer:Bo},{isFinite:ko}=Number,vo=$.get("setAttr"),Oo={__setAttr(e,t,s){if(this.leaferIsCreated){const i=this.__.__getInput(e);if(s&&!ko(t)&&t!==void 0&&(vo.warn(this.innerName,e,t),t=void 0),typeof t=="object"||i!==t){this.__realSetAttr(e,t);const{CHANGE:n}=Mt,o=new Mt(n,this,e,i,t);return this.isLeafer?this.emitEvent(new Mt(Mt.LEAFER_CHANGE,this,e,i,t)):this.hasEvent(n)&&this.emitEvent(o),this.leafer.emitEvent(o),!0}else return!1}else return this.__realSetAttr(e,t),!0},__realSetAttr(e,t){const s=this.__;s[e]=t,this.__proxyData&&this.setProxyAttr(e,t),s.normalStyle&&(this.lockNormalStyle||s.normalStyle[e]===void 0||(s.normalStyle[e]=t))},__getAttr(e){return this.__proxyData?this.getProxyAttr(e):this.__.__get(e)}},{setLayout:Ro,multiplyParent:Po,translateInner:Lo,defaultWorld:So}=b,{toPoint:Io,tempPoint:He}=ts,Eo={__updateWorldMatrix(){Po(this.__local||this.__layout,this.parent?this.parent.__world:So,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const e=this.__layout,t=this.__local,s=this.__;e.affectScaleOrRotation&&(e.scaleChanged||e.rotationChanged)&&(Ro(t,s,null,null,e.affectRotation),e.scaleChanged=e.rotationChanged=!1),t.e=s.x+s.offsetX,t.f=s.y+s.offsetY,(s.around||s.origin)&&(Io(s.around||s.origin,e.boxBounds,He),Lo(t,-He.x,-He.y,!s.around))}this.__layout.matrixChanged=!1}},{updateMatrix:Mo,updateAllMatrix:oi}=Ft,{updateBounds:ai}=ns,{toOuterOf:se,copyAndSpread:hi,copy:Ao}=y,{toBounds:$o}=vi,Wo={__updateWorldBounds(){se(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const e=this.__layout;e.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),e.resized=!0),e.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),e.localBoxChanged=!1,e.strokeSpread&&(e.strokeChanged=!0),e.renderSpread&&(e.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),e.boxChanged=!1,e.strokeChanged&&(e.strokeSpread=this.__updateStrokeSpread(),e.strokeSpread?(e.strokeBounds===e.boxBounds&&e.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):e.spreadStrokeCancel(),e.strokeChanged=!1,(e.renderSpread||e.strokeSpread!==e.strokeBoxSpread)&&(e.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),e.resized=!0),e.renderChanged&&(e.renderSpread=this.__updateRenderSpread(),e.renderSpread?((e.renderBounds===e.boxBounds||e.renderBounds===e.strokeBounds)&&e.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):e.spreadRenderCancel(),e.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),e.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),se(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){se(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){se(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const e=this.__layout.boxBounds,t=this.__;t.__pathInputed?$o(t.path,e):(e.x=0,e.y=0,e.width=t.width,e.height=t.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leaferIsReady&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),oi(this),ai(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(oi(this),ai(this,this))):Mo(this)},__updateNaturalSize(){const{__:e,__layout:t}=this;e.__naturalWidth=t.boxBounds.width,e.__naturalHeight=t.boxBounds.height},__updateStrokeBounds(){const e=this.__layout;hi(e.strokeBounds,e.boxBounds,e.strokeBoxSpread)},__updateRenderBounds(){const e=this.__layout;e.renderSpread>0?hi(e.renderBounds,e.boxBounds,e.renderSpread):Ao(e.renderBounds,e.strokeBounds)}},No={__render(e,t){if(this.__worldOpacity)if(e.setWorld(this.__nowWorld=this.__getNowWorld(t)),e.opacity=this.__.opacity,this.__.__single){if(this.__.eraser==="path")return this.__renderEraser(e,t);const s=e.getSameCanvas(!0,!0);this.__draw(s,t),this.__worldFlipped?e.copyWorldByReset(s,this.__nowWorld,null,this.__.__blendMode,!0):e.copyWorldToInner(s,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),s.recycle(this.__nowWorld)}else this.__draw(e,t)},__clip(e,t){this.__worldOpacity&&(e.setWorld(this.__nowWorld=this.__getNowWorld(t)),this.__drawRenderPath(e),this.windingRule?e.clip(this.windingRule):e.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:li}=Si,Yo={__updateChange(){const{__layout:e}=this;e.childrenSortChanged&&(this.__updateSortChildren(),e.childrenSortChanged=!1),this.__.__checkSingle()},__render(e,t){if(this.__nowWorld=this.__getNowWorld(t),this.__worldOpacity)if(this.__.__single){if(this.__.eraser==="path")return this.__renderEraser(e,t);const s=e.getSameCanvas(!1,!0);this.__renderBranch(s,t);const i=this.__nowWorld;e.opacity=this.__.opacity,e.copyWorldByReset(s,i,i,this.__.__blendMode,!0),s.recycle(i)}else this.__renderBranch(e,t)},__renderBranch(e,t){if(this.__hasMask)this.__renderMask(e,t);else{const{children:s}=this;for(let i=0,n=s.length;i<n;i++)li(s[i],t)||s[i].__render(e,t)}},__clip(e,t){if(this.__worldOpacity){const{children:s}=this;for(let i=0,n=s.length;i<n;i++)li(s[i],t)||s[i].__clip(e,t)}}},{LEAF:Do,create:Fo}=rt,{toInnerPoint:Xo,toOuterPoint:jo,multiplyParent:zo}=b,{toOuterOf:ui}=y,{copy:ci,move:_i}=v,{moveLocal:Ho,zoomOfLocal:Uo,rotateOfLocal:qo,skewOfLocal:Go,moveWorld:di,zoomOfWorld:Qo,rotateOfWorld:Zo,skewOfWorld:Jo,transform:fi,transformWorld:Vo,setTransform:Ko,getFlipTransform:ta,getLocalOrigin:Ue,getRelativeWorld:ea,drop:sa}=Ft;let Ze=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return qi}get __LayoutProcessor(){return _o}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=Fo(Do),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(E.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},t!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,s){s&&(t=t.bind(s)),this.parent?t():this.on(E.ADD,t,"once")}waitLeafer(t,s){s&&(t=t.bind(s)),this.leafer?t():this.on(E.MOUNTED,t,"once")}nextRender(t,s,i){this.leafer?this.leafer.nextRender(t,s,i):this.waitLeafer(()=>this.leafer.nextRender(t,s,i))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&t!==null&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(E.MOUNTED)):this.__emitLifeEvent(E.UNMOUNTED),this.isBranch){const{children:s}=this;for(let i=0,n=s.length;i<n;i++)s[i].__bindLeafer(t)}}set(t,s){}get(t){}setAttr(t,s){this[t]=s}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,s){return!0}__getAttr(t){}setProxyAttr(t,s){}getProxyAttr(t){}find(t,s){}findTag(t){}findOne(t,s){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){t===void 0?t="width":t==="surface"&&(t="blendMode");const s=this.__.__getInput(t);this.__[t]=s===void 0?null:void 0,this[t]=s}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=t?!0:this.children.some(s=>s.__.eraser)}__renderEraser(t,s){t.save(),this.__clip(t,s);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=t?!0:this.children.some(s=>s.__.mask)}__renderMask(t,s){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const s=this.__cameraWorld;return zo(this.__world,t.matrix,s,void 0,this.__world),ui(this.__layout.renderBounds,s,s),s}else return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,s){return this.__layout.getBounds(t,s)}getLayoutBounds(t,s,i){return this.__layout.getLayoutBounds(t,s,i)}getLayoutPoints(t,s){return this.__layout.getLayoutPoints(t,s)}getWorldBounds(t,s,i){const n=s?ea(this,s):this.worldTransform,o=i?t:{};return ui(t,n,o),o}worldToLocal(t,s,i,n){this.parent?this.parent.worldToInner(t,s,i,n):s&&ci(s,t)}localToWorld(t,s,i,n){this.parent?this.parent.innerToWorld(t,s,i,n):s&&ci(s,t)}worldToInner(t,s,i,n){n&&(n.innerToWorld(t,s,i),t=s||t),Xo(this.worldTransform,t,s,i)}innerToWorld(t,s,i,n){jo(this.worldTransform,t,s,i),n&&n.worldToInner(s||t,null,i)}getBoxPoint(t,s,i,n){return this.getBoxPointByInner(this.getInnerPoint(t,s,i,n),null,null,!0)}getBoxPointByInner(t,s,i,n){const o=n?t:Object.assign({},t),{x:r,y:a}=this.boxBounds;return _i(o,-r,-a),o}getInnerPoint(t,s,i,n){const o=n?t:{};return this.worldToInner(t,o,i,s),o}getInnerPointByBox(t,s,i,n){const o=n?t:Object.assign({},t),{x:r,y:a}=this.boxBounds;return _i(o,r,a),o}getInnerPointByLocal(t,s,i,n){return this.getInnerPoint(t,this.parent,i,n)}getLocalPoint(t,s,i,n){const o=n?t:{};return this.worldToLocal(t,o,i,s),o}getLocalPointByInner(t,s,i,n){return this.getWorldPoint(t,this.parent,i,n)}getPagePoint(t,s,i,n){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,s,i,n)}getWorldPoint(t,s,i,n){const o=n?t:{};return this.innerToWorld(t,o,i,s),o}getWorldPointByBox(t,s,i,n){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,n),s,i,!0)}getWorldPointByLocal(t,s,i,n){const o=n?t:{};return this.localToWorld(t,o,i,s),o}getWorldPointByPage(t,s,i,n){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,s,i,n)}setTransform(t,s){Ko(this,t,s)}transform(t,s){fi(this,t,s)}move(t,s){Ho(this,t,s)}moveInner(t,s){di(this,t,s,!0)}scaleOf(t,s,i,n){Uo(this,Ue(this,t),s,i,n)}rotateOf(t,s){qo(this,Ue(this,t),s)}skewOf(t,s,i,n){Go(this,Ue(this,t),s,i,n)}transformWorld(t,s){Vo(this,t,s)}moveWorld(t,s){di(this,t,s)}scaleOfWorld(t,s,i,n){Qo(this,t,s,i,n)}rotateOfWorld(t,s){Zo(this,t,s)}skewOfWorld(t,s,i,n){Jo(this,t,s,i,n)}flip(t){fi(this,ta(this,t))}scaleResize(t,s=t,i){this.scaleX*=t,this.scaleY*=s}__scaleResize(t,s){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,s){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,s){}__drawFast(t,s){}__draw(t,s){}__clip(t,s){}__renderShape(t,s,i,n){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Bs("path")}getMotionPoint(t){return Bs("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,s){}__updateSortChildren(){}add(t,s){}remove(t,s){this.parent&&this.parent.remove(this,s)}dropTo(t,s,i){sa(this,t,s,i)}on(t,s,i){}off(t,s,i){}on_(t,s,i,n){}off_(t){}once(t,s,i){}emit(t,s,i){}emitEvent(t,s){}hasEvent(t,s){return!1}static changeAttr(t,s,i){i?this.addAttr(t,s,i):Pi(this.prototype,t,s)}static addAttr(t,s,i){i||(i=Ri),i(s)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new E(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(E.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};Ze=f([Et(Oo),Et(Eo),Et(Wo),Et(To),Et(No)],Ze);const{setListWithFn:qe}=y,{sort:ia}=ns,{localBoxBounds:na,localStrokeBounds:ra,localRenderBounds:oa,maskLocalBoxBounds:aa,maskLocalStrokeBounds:ha,maskLocalRenderBounds:la}=Si;let pi=class extends Ze{__updateStrokeSpread(){const{children:t}=this;for(let s=0,i=t.length;s<i;s++)if(t[s].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let s=0,i=t.length;s<i;s++)if(t[s].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){qe(this.__layout.boxBounds,this.children,this.__hasMask?aa:na)}__updateStrokeBounds(){qe(this.__layout.strokeBounds,this.children,this.__hasMask?ha:ra)}__updateRenderBounds(){qe(this.__layout.renderBounds,this.children,this.__hasMask?la:oa)}__updateSortChildren(){let t;const{children:s}=this;if(s.length>1){for(let i=0,n=s.length;i<n;i++)s[i].__tempNumber=i,s[i].__.zIndex&&(t=!0);s.sort(ia),this.__layout.affectChildrenSort=t}}add(t,s){if(t===this)return;const i=s===void 0;if(!t.__){if(t instanceof Array)return t.forEach(n=>{this.add(n,s),i||s++});t=es.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(s,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(E.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(E.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,s){t?t.__?t.animationOut?t.__runAnimation("out",()=>this.__remove(t,s)):this.__remove(t,s):this.find(t).forEach(i=>this.remove(i,s)):t===void 0&&super.remove(null,s)}removeAll(t){const{children:s}=this;s.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,s.forEach(i=>{this.__realRemoveChild(i),t&&i.destroy()}))}clear(){this.removeAll(!0)}__remove(t,s){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),s&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(E.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(E.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,s){const i=new E(t,s,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}};pi=f([Et(Yo)],pi);class Ei{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&this.keys[t.innerId]!==void 0}indexAt(t){return this.list[t]}indexOf(t){const s=this.keys[t.innerId];return s===void 0?-1:s}add(t){const{list:s,keys:i}=this;i[t.innerId]===void 0&&(s.push(t),i[t.innerId]=s.length-1)}addAt(t,s=0){const{keys:i}=this;if(i[t.innerId]===void 0){const{list:n}=this;for(let o=s,r=n.length;o<r;o++)i[n[o].innerId]++;s===0?n.unshift(t):(s>n.length&&(s=n.length),n.splice(s,0,t)),i[t.innerId]=s}}addList(t){for(let s=0;s<t.length;s++)this.add(t[s])}remove(t){const{list:s}=this;let i;for(let n=0,o=s.length;n<o;n++)i!==void 0?this.keys[s[n].innerId]=n-1:s[n].innerId===t.innerId&&(i=n,delete this.keys[t.innerId]);i!==void 0&&s.splice(i,1)}sort(t){const{list:s}=this;t?s.sort((i,n)=>n.__level-i.__level):s.sort((i,n)=>i.__level-n.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new Ei;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:s}=this;for(let i=0,n=t.length;i<n;i++)s[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Ua{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return this.keys[t.innerId]!==void 0}without(t){return this.keys[t.innerId]===void 0}sort(t){const{levels:s}=this;t?s.sort((i,n)=>n-i):s.sort((i,n)=>i-n)}addList(t){t.forEach(s=>{this.add(s)})}add(t){const{keys:s,levelMap:i}=this;s[t.innerId]||(s[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let s;this.levels.forEach(i=>{s=this.levelMap[i];for(let n=0,o=s.length;n<o;n++)t(s[n])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}export{$,Bs as A,Fa as B,Et as C,Da as D,ce as E,Je as F,_a as G,at as H,ne as I,vs as J,Ct as K,Ze as L,ut as M,ua as N,Hi as O,_e as P,_t as Q,os as R,ot as S,Ii as T,es as U,Pa as V,ja as W,Qr as X,xa as Y,qi as Z,pi as _,ba as a,y as a0,K as a1,ss as a2,v as a3,vi as a4,Wi as a5,rs as a6,ma as a7,le as a8,ki as a9,R as aa,Xa as ab,Mt as ac,ct as ad,ae,da as af,ya as ag,E as ah,Ua as ai,ns as aj,Ft as ak,Si as al,ie as am,Qs as an,ks as ao,ca as ap,b as aq,ts as ar,bs as as,ue as at,Ea as b,Ri as c,Na as d,Aa as e,Ba as f,Ca as g,va as h,Oa as i,$a as j,Ra as k,Wa as l,Ma as m,ka as n,Sa as o,wa as p,Ya as q,Ta as r,La as s,Ei as t,M as u,Ia as v,is as w,ga as x,pa as y,fa as z};
