import{z as ElDivider,s as ElForm,h as ElTable,t as ElFormItem,n as ElInput,l as ElRow,m as ElCol,A as ElSelect,B as ElOption,C as ElInputNumber,D as ElDatePicker,a as ElButton,j as ElTableColumn}from"./element-plus-CU5GJTiG.js";import{d as defineComponent,e as reactive,c as createElementBlock,a as createBaseVNode,R as createVNode,J as withCtx,o as openBlock,O as createTextVNode,Q as Fragment,a6 as renderList,I as createBlock,L as createCommentVNode,P as toDisplayString}from"./@vue-AhIeOBdH.js";import{_ as _export_sfc}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./lodash-es-CVJ_Bk8S.js";import"./@vueuse-CAc1CHwG.js";import"./@element-plus-BPC4xHUH.js";import"./@sxzz-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BkBTkyCe.js";import"./@turf-Bfw5sV2K.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-D0iZPv2f.js";class SafeComparator{static equal(e,a){return Number.isNaN(e)&&Number.isNaN(a)?!0:e===a}static notEqual(e,a){return Number.isNaN(e)&&Number.isNaN(a)?!1:e!==a}static greaterThan(e,a){return typeof e!="number"||typeof a!="number"?!1:e>a}static lessThan(e,a){return typeof e!="number"||typeof a!="number"?!1:e<a}static greaterOrEqual(e,a){return typeof e!="number"||typeof a!="number"?!1:e>=a}static lessOrEqual(e,a){return typeof e!="number"||typeof a!="number"?!1:e<=a}static isNil(e){return e==null}static isNotNil(e){return!this.isNil(e)}static isEmpty(e){return!!(this.isNil(e)||typeof e=="string"&&e.trim()===""||Array.isArray(e)&&e.length===0||e.constructor===Object&&Object.keys(e).length===0)}static isNotEmpty(e){return!this.isEmpty(e)}}const _hoisted_1={class:"rule-linkage"},_hoisted_2={class:"left"},_hoisted_3={class:"right"},_hoisted_4={key:4},__default__={name:"RuleLinkage"},_sfc_main=defineComponent({...__default__,setup(__props){const state=reactive({tableData:[{id:1,name:"技术",type:"input",value:null,options:null},{id:2,name:"工龄",type:"number",value:null,options:null},{id:3,name:"项目",value:null,options:null,children:[{id:31,name:"炒菜",value:null,type:"select",options:[{value:"炒粉",label:"炒粉"},{value:"蛋炒饭",label:"蛋炒饭"}]},{id:32,name:"经商",value:null,type:"select",options:[{value:"外卖",label:"外卖"},{value:"滴滴",label:"滴滴"}]}]},{id:4,name:"周期",type:"date",value:null,options:null}],form:{ruleName:"",conditions:[{id:"",symbol:"",value:"",type:"",options:null}],actions:[{id:"",value:"",type:"",options:null}]},symbolOption:[">","<",">=","<=","==","!=","为空","不为空"],ruleList:[{ruleName:"技术==js&&工龄>=3，则周期为2025-07-28",conditions:[{id:1,symbol:"==",value:"js",type:"input",options:null},{id:2,symbol:">=",value:3,type:"number",options:null}],actions:[{id:4,value:"2025-07-28",type:"date",options:null}]}]}),onSubmit=()=>{console.log(state.form),state.ruleList.push(state.form),onReset()},setidType=(o,e)=>{const a=getItemsWithType().find(r=>r.id===o);a&&(e.type=a.type,e.options=a.options)};function getItemsWithType(){let o=[];function e(a){a.forEach(r=>{r.hasOwnProperty("type")&&o.push(r),r.children&&r.children.length>0&&e(r.children)})}return e(state.tableData),o}const addRule=()=>{state.form.conditions.push({id:"",symbol:"",value:"",type:"",options:null})},deleteRule=o=>{state.form.conditions.splice(o,1)},addAction=()=>{state.form.actions.push({id:"",value:"",type:"",options:null})},deleteAction=o=>{state.form.actions.splice(o,1)},onReset=()=>{state.form={ruleName:"",conditions:[{id:"",symbol:"",value:"",type:"",options:null}],actions:[{id:"",value:"",type:"",options:null}]}},onChange=o=>{const e=getCondition(o.id,o.value);console.log(e);try{const a=new Function(`return ${e}`);console.log(a())}catch(a){console.log(a)}};function getCondition(id,value){let conditionStr="";return state.ruleList.forEach(item=>{let ids=[];const symbols=item.conditions.map(o=>{ids.push(o.id);let e="";const a=findTreeNodeById(state.tableData,o.id).node;switch(o.symbol){case"==":e=`${SafeComparator.equal(a.value,o.value)}`;break;case">":e=`${SafeComparator.greaterThan(a.value,o.value)}`;break;case"<":e=`${SafeComparator.lessThan(a.value,o.value)}`;break;case">=":e=`${SafeComparator.greaterOrEqual(a.value,o.value)}`;break;case"<=":e=`${SafeComparator.lessOrEqual(a.value,o.value)}`;break;case"!=":e=`${SafeComparator.notEqual(a.value,o.value)}`;break;case"为空":e=`${SafeComparator.isEmpty(a.value)}`;break;case"不为空":e=`${SafeComparator.isNotEmpty(a.value)}`;break}return e});ids.includes(id)&&((value==null||value==="")&&item.actions.forEach(o=>{const e=findTreeNodeById(state.tableData,o.id).node;e&&(e.value=void 0)}),conditionStr=symbols.join(" && "),eval(conditionStr)?item.actions.forEach(o=>{const e=findTreeNodeById(state.tableData,o.id).node;e&&(e.value=o.value)}):item.actions.forEach(o=>{const e=findTreeNodeById(state.tableData,o.id).node;e&&(e.value=void 0)}))}),conditionStr}function findTreeNodeById(o,e,a="id"){for(const r of o){if(r[a]===e)return{node:r,path:[r]};if(r.children&&r.children.length>0){const u=findTreeNodeById(r.children,e,a);if(u.node)return{node:u.node,path:[r,...u.path]}}}return{node:null,path:[]}}return(o,e)=>{const a=ElDivider,r=ElInput,u=ElFormItem,s=ElOption,c=ElSelect,d=ElCol,p=ElInputNumber,m=ElDatePicker,i=ElButton,V=ElRow,y=ElForm,f=ElTableColumn,k=ElTable;return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(a,null,{default:withCtx(()=>[...e[1]||(e[1]=[createTextVNode("规则配置",-1)])]),_:1}),createVNode(y,{model:state.form,ref:"form","label-width":"100px",inline:!1},{default:withCtx(()=>[createVNode(u,{label:"规则名称"},{default:withCtx(()=>[createVNode(r,{modelValue:state.form.ruleName,"onUpdate:modelValue":e[0]||(e[0]=t=>state.form.ruleName=t)},null,8,["modelValue"])]),_:1}),createVNode(u,{label:"条件"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(state.form.conditions,(t,n)=>(openBlock(),createBlock(V,{style:{width:"100%"},gutter:20,key:n},{default:withCtx(()=>[createVNode(d,{span:6,offset:0},{default:withCtx(()=>[e[2]||(e[2]=createBaseVNode("span",null,"项目：",-1)),createVNode(c,{modelValue:t.id,"onUpdate:modelValue":l=>t.id=l,onChange:l=>setidType(l,t)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getItemsWithType(),l=>(openBlock(),createBlock(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[e[3]||(e[3]=createBaseVNode("span",null,"符号：",-1)),createVNode(c,{modelValue:t.symbol,"onUpdate:modelValue":l=>t.symbol=l},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(state.symbolOption,l=>(openBlock(),createBlock(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[e[4]||(e[4]=createBaseVNode("span",null,"值：",-1)),t.type==="input"?(openBlock(),createBlock(r,{key:0,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):t.type==="number"?(openBlock(),createBlock(p,{key:1,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请输入",controls:!1},null,8,["modelValue","onUpdate:modelValue"])):t.type==="select"?(openBlock(),createBlock(c,{key:2,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请选择"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.options,l=>(openBlock(),createBlock(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="date"?(openBlock(),createBlock(m,{key:3,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"选择日期时间","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):createCommentVNode("",!0)]),_:2},1024),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[createVNode(i,{type:"danger",onClick:l=>deleteRule(n)},{default:withCtx(()=>[...e[5]||(e[5]=[createTextVNode("删除",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),createVNode(i,{type:"primary",onClick:addRule},{default:withCtx(()=>[...e[6]||(e[6]=[createTextVNode("新增条件",-1)])]),_:1})]),_:1}),createVNode(u,{label:"动作"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(state.form.actions,(t,n)=>(openBlock(),createBlock(V,{style:{width:"100%"},gutter:20,key:n},{default:withCtx(()=>[createVNode(d,{span:6,offset:0},{default:withCtx(()=>[e[7]||(e[7]=createBaseVNode("span",null,"项目：",-1)),createVNode(c,{modelValue:t.id,"onUpdate:modelValue":l=>t.id=l,onChange:l=>setidType(l,t)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getItemsWithType(),l=>(openBlock(),createBlock(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[...e[8]||(e[8]=[createBaseVNode("span",null,"设置为：",-1)])]),_:1}),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[e[9]||(e[9]=createBaseVNode("span",null,"值：",-1)),t.type==="input"?(openBlock(),createBlock(r,{key:0,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])):t.type==="number"?(openBlock(),createBlock(p,{key:1,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请输入",controls:!1},null,8,["modelValue","onUpdate:modelValue"])):t.type==="select"?(openBlock(),createBlock(c,{key:2,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"请选择"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.options,l=>(openBlock(),createBlock(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="date"?(openBlock(),createBlock(m,{key:3,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:"选择日期时间","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):createCommentVNode("",!0)]),_:2},1024),createVNode(d,{span:6,offset:0},{default:withCtx(()=>[createVNode(i,{type:"danger",onClick:l=>deleteAction(n)},{default:withCtx(()=>[...e[10]||(e[10]=[createTextVNode("删除",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),createVNode(i,{type:"primary",onClick:addAction},{default:withCtx(()=>[...e[11]||(e[11]=[createTextVNode("新增动作",-1)])]),_:1})]),_:1}),createVNode(u,null,{default:withCtx(()=>[createVNode(i,{type:"primary",onClick:onSubmit},{default:withCtx(()=>[...e[12]||(e[12]=[createTextVNode("保存规则",-1)])]),_:1}),createVNode(i,{onClick:onReset},{default:withCtx(()=>[...e[13]||(e[13]=[createTextVNode("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),createVNode(a,null,{default:withCtx(()=>[...e[14]||(e[14]=[createTextVNode("规则表",-1)])]),_:1}),createVNode(k,{data:state.ruleList},{default:withCtx(()=>[createVNode(f,{prop:"ruleName",label:"规则名称",align:"left"})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_3,[createVNode(a,null,{default:withCtx(()=>[...e[15]||(e[15]=[createTextVNode("数据表",-1)])]),_:1}),createVNode(k,{data:state.tableData,"row-key":"id",border:"","default-expand-all":""},{default:withCtx(()=>[createVNode(f,{prop:"name",label:"项目",align:"left"}),createVNode(f,{prop:"value",label:"值",align:"center"},{default:withCtx(({row:t})=>[t.type==="input"?(openBlock(),createBlock(r,{key:0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:"请输入",onChange:n=>onChange(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])):t.type==="number"?(openBlock(),createBlock(p,{key:1,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:"请输入",controls:!1,onChange:n=>onChange(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])):t.type==="select"?(openBlock(),createBlock(c,{key:2,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:"请选择",clearable:"",onChange:n=>onChange(t)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.options,n=>(openBlock(),createBlock(s,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):t.type==="date"?(openBlock(),createBlock(m,{key:3,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:"选择日期时间","value-format":"YYYY-MM-DD",onChange:n=>onChange(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(openBlock(),createElementBlock("span",_hoisted_4,toDisplayString(t.value),1))]),_:1})]),_:1},8,["data"])])])}}}),index=_export_sfc(_sfc_main,[["__scopeId","data-v-a25cf87a"]]);export{index as default};
