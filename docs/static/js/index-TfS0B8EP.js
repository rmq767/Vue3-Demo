import{f as z,g as K,h as W,j as Z,k as ee,l as ae,b as U,m as te,n as le,o as ne,p as oe,q as se}from"./element-plus-gsjOKJd0.js";import{d as M,r as T,e as q,o as m,c as h,V as s,Q as r,a as R,F as A,a8 as B,T as re,P as C,S as H,J as L,aa as ie,M as ce,s as D,ai as de,u as P,U as S,n as ue}from"./@vue-1pEateLc.js";import{_ as N}from"./plugin-vueexport-helper-x3n3nnut.js";import{o as pe,M as me}from"./@element-plus-lCXqhmUZ.js";import"./lodash-es-xtaXTKrS.js";import"./@vueuse-qk1NsRtR.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-1TH0Fy64.js";import"./acorn-bQvPYi_r.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const _e={class:"fn-panel"},fe={class:"operation"},be=["title","onClick"],ve={class:"operation"},ge=["title","onClick","innerHTML"],xe={name:"FnPanel"},ye=M({...xe,emits:["getValue"],setup($,{emit:x}){const v=T(["1","2"]),t=q({operation:[{label:"=",value:"=",key:"=",index:1,desc:"等于"},{label:"+",value:"+",key:"+",index:1,desc:"加"},{label:"-",value:"-",key:"-",index:1,desc:"减"},{label:"*",value:"*",key:"*",index:1,desc:"乘"},{label:"/",value:"/",key:"/",index:1,desc:"除"},{label:"^",value:"^",key:"^",index:1,desc:"幂"},{label:"(",value:"(",key:"(",index:1,desc:"左括号"},{label:")",value:")",key:")",index:1,desc:"右括号"}],fn:[{label:"exp()",value:"exp()",desc:"e为底的指数函数"},{label:"sqrt()",value:"sqrt()",desc:"平方根"},{label:"ln()",value:"ln()",desc:"e为底的对数"},{label:"log10()",value:"log10()",desc:"10为底的对数"},{label:"log2()",value:"log2()",desc:"2为底的对数"},{label:"abs()",value:"abs()",desc:"绝对值"},{label:"sin()",value:"sin()",desc:"正弦函数"},{label:"cos()",value:"cos()",desc:"余弦函数"},{label:"tan()",value:"tan()",desc:"正切函数"},{label:"asin()",value:"asin()",desc:"反正弦函数"},{label:"acos()",value:"acos()",desc:"反余弦函数"},{label:"atan()",value:"atan()",desc:"反正切函数"}]}),u=x,a=(i,p)=>{u("getValue",{item:p,type:i})};return(i,p)=>{const k=z,E=K;return m(),h("div",_e,[s(E,{modelValue:v.value,"onUpdate:modelValue":p[0]||(p[0]=e=>v.value=e)},{default:r(()=>[s(k,{title:"运算符",name:"1"},{default:r(()=>[R("div",fe,[(m(!0),h(A,null,B(t.operation,e=>(m(),h("div",{key:e.value,title:e.desc,tabindex:-1,onClick:_=>a("operation",e)},re(e.value),9,be))),128))])]),_:1}),s(k,{title:"函数",name:"2"},{default:r(()=>[R("div",ve,[(m(!0),h(A,null,B(t.fn,e=>(m(),h("div",{key:e.value,title:e.desc,onClick:_=>a("fn",e),tabindex:-1,innerHTML:e.value},null,8,ge))),128))])]),_:1})]),_:1},8,["modelValue"])])}}}),he=N(ye,[["__scopeId","data-v-05c7e2e6"]]),I=M({__name:"index",props:{data:{},column:{},index:{type:Boolean,default:!0},radio:{type:Boolean,default:!1}},setup($,{expose:x}){const v=$,t=T(),u=[{color:"#F56C6C",percentage:50},{color:"#E6A23C",percentage:60},{color:"#409EFF",percentage:80},{color:"#67C23A",percentage:100}];return x({tableRef:t}),(a,i)=>{const p=W,k=Z,E=ee;return m(),C(E,ce({ref_key:"tableRef",ref:t,data:v.data},a.$attrs),{default:r(()=>[v.index?(m(),C(p,{key:0,align:"center",label:"序号",type:"index",width:"60"})):H("",!0),v.radio?(m(),C(p,{key:1,align:"center",label:"单选",width:"60"},{default:r(({row:e})=>[L(a.$slots,"radio",{row:e})]),_:3})):H("",!0),(m(!0),h(A,null,B(a.column,e=>(m(),C(p,{key:e.label,prop:e.prop,label:e.label,width:e.width,align:"center","column-key":e.prop,filters:e.filters},ie({_:2},[e.template==="progress"?{name:"default",fn:r(({row:_})=>[s(k,{"text-inside":!0,"stroke-width":16,percentage:_[e.prop]<=1?_[e.prop]*100:_[e.prop],color:_.color?_.color:u},null,8,["percentage","color"])]),key:"0"}:e.slot?{name:"default",fn:r(({row:_})=>[L(a.$slots,e.slot,{row:_})]),key:"1"}:void 0]),1032,["prop","label","width","column-key","filters"]))),128)),L(a.$slots,"default")]),_:3},16,["data"])}}}),ke={class:"check"},Ce={class:"mb-1 mt-4"},Te={name:"CreateFn"},Ee=M({...Te,emits:["submit"],setup($,{expose:x,emit:v}){const t=q({visible:!1,fn:"",search:"",activeTab:"1",tableData:[{abbreviation:"y",name:"Y参数",id:"1"},{abbreviation:"x",name:"X参数",id:"2"},{abbreviation:"a",name:"A参数",id:"3"},{abbreviation:"b",name:"B参数",id:"4"}],column:[{label:"参数缩写",prop:"abbreviation"},{label:"参数名称",prop:"name"},{label:"参数单位",prop:"unit"},{label:"默认取值范围",prop:"range"},{label:"创建人",prop:"creator"},{label:"参数解释",prop:"remark"}],type:"combo"}),u=T(),a=D(),i=D(null),p=T(),k=T(),E=v,e=()=>{var l;i.value=window.getSelection(),a.value=(l=i.value)==null?void 0:l.getRangeAt(0)},_=l=>{G(l)},j=({item:l,type:n})=>{var d,f,o,b;const c=document.createTextNode(l.value);a.value.insertNode(c),(d=a.value)==null||d.setStartAfter(c),(f=a.value)==null||f.collapse(!0),(o=i.value)==null||o.removeAllRanges(),(b=i.value)==null||b.addRange(a.value)},G=l=>{var b,V,y,g,F;let n=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${l.id}">`,c="</span>",d=document.createElement("span");d.innerHTML=n+l.abbreviation+c;let o=document.createDocumentFragment().appendChild(d.firstChild);(b=a.value)==null||b.insertNode(o),(V=a.value)==null||V.setStartAfter(o),(y=a.value)==null||y.collapse(!0),(g=i.value)==null||g.removeAllRanges(),(F=i.value)==null||F.addRange(a.value)},J=()=>{var d;const l=(d=u.value)==null?void 0:d.getElementsByClassName("fn-param");let n=u.value.innerHTML;const c=[];if(l)for(let f=0;f<l.length;f++){const o=l[f],b=n.indexOf(o.outerHTML);c.push({name:o.innerText,id:o.dataset.param,index:b}),n=n.replace(o.outerHTML,o.innerText)}return{text:u.value.innerText,params:c}},O=()=>{const{text:l,params:n}=J();if(l.length===0){ae.warning("请编辑函数内容！");return}console.log(l,n),E("submit",{text:l,params:n}),w()},Q=l=>{const{fn:n,params:c}=l;let d=n,f=0;c.forEach(o=>{const y=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${o.id}">`+o.name+"</span>";d=d.replaceAll(o.name,(g,F)=>F===o.index+f?y:g),f+=y.length-o.name.length}),ue(()=>{u.value.innerHTML=d})},X=(l,n)=>{t.type=l,t.visible=!0,n&&Q(n),!n&&setTimeout(()=>{var c;(c=u.value)==null||c.focus()},0)},w=()=>{t.fn="",t.search="",u.value.innerHTML="",t.visible=!1},Y=(l,n)=>{console.log(l,n)};return x({open:X}),(l,n)=>{const c=U,d=te,f=le,o=ne,b=oe,V=se,y=de("MyDialog");return m(),C(y,{modelValue:t.visible,"onUpdate:modelValue":n[2]||(n[2]=g=>t.visible=g),title:"函数编辑器",fullscreen:"",onClose:w,onCancel:w,onSubmit:O},{default:r(()=>[s(f,{gutter:20},{default:r(()=>[s(d,{span:12,class:"panel"},{default:r(()=>[R("div",{ref_key:"textRef",ref:u,class:"fn-editor",contenteditable:!0,onBlur:e},null,544),R("div",ke,[s(c,{type:"primary",icon:P(pe)},{default:r(()=>[S("函数校验")]),_:1},8,["icon"])])]),_:1}),s(d,{span:12},{default:r(()=>[s(he,{onGetValue:j})]),_:1})]),_:1}),R("div",Ce,[s(o,{modelValue:t.search,"onUpdate:modelValue":n[0]||(n[0]=g=>t.search=g),style:{width:"300px"},placeholder:"参数名称"},{append:r(()=>[s(c,{icon:P(me)},null,8,["icon"])]),_:1},8,["modelValue"])]),s(V,{modelValue:t.activeTab,"onUpdate:modelValue":n[1]||(n[1]=g=>t.activeTab=g),onTabClick:Y},{default:r(()=>[s(b,{label:"函数参数库",name:"1"},{default:r(()=>[s(I,{ref_key:"tableRef1",ref:p,data:t.tableData,column:t.column,"highlight-current-row":"",onCurrentChange:_},null,8,["data","column"])]),_:1}),t.type==="basic"?(m(),C(b,{key:0,label:"组合函数库",name:"2"},{default:r(()=>[s(I,{ref_key:"tableRef2",ref:k,data:t.tableData,column:t.column,"highlight-current-row":"",onCurrentChange:_},null,8,["data","column"])]),_:1})):H("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ve=N(Ee,[["__scopeId","data-v-992f37b2"]]),Re={class:"fn-editor-container"},$e={name:"FnEditor"},Fe=M({...$e,setup($){const x=T(),v=({text:a,params:i})=>{console.log(a,i)},t=()=>{var a;(a=x.value)==null||a.open("basic")},u=()=>{var i;const a={fn:"y=exp(x)+sqrt(a)a",params:[{name:"y",id:"1",index:0},{name:"x",id:"2",index:6},{name:"a",id:"3",index:14}]};(i=x.value)==null||i.open("combo",a)};return(a,i)=>{const p=U;return m(),h("div",Re,[s(p,{type:"primary",onClick:t},{default:r(()=>[S("编辑函数")]),_:1}),s(p,{type:"warning",onClick:u},{default:r(()=>[S("修改函数")]),_:1}),s(Ve,{ref_key:"fnEditorRef",ref:x,onSubmit:v},null,512)])}}}),Ge=N(Fe,[["__scopeId","data-v-8da8daed"]]);export{Ge as default};
