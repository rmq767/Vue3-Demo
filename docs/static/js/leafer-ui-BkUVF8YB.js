import{ao as xe,s as lt,ae as mi,ad as y,p as xi,E as j,ap as ei,aq as bi,an as Bi,b as tt,a1 as xt,ac as st,o as dt,C as ki,S as pe,U as Ei,L as R,G as W,a0 as Ot,D as Q,ar as Li,P as yt,ak as X,as as ii,a as Y,at as Vt,au as Si,a3 as J,a2 as V,ag as Ti,a4 as bt,av as jt,aw as Ri,B as si,ax as Pi,Y as ge,ay as _e,az as Ci,j as Mi,af as Gt}from"./@leafer-Dgei2GiV.js";import{u as Ai,R as Di,k as I,A as ni,C as Bt,P as Wt,F as Oi,m as Wi,E as Xt,_ as zi,$ as Z,v as Fi}from"./@leafer-ui-CS0pT7tI.js";const be=xt.get("LeaferCanvas");class oi extends Bi{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const n=i.children[t];n?(this.setAbsolute(n),i.insertBefore(e,n)):i.appendChild(n)}}init(){const{config:t}=this,e=t.view||t.canvas;e?this.__createViewFrom(e):this.__createView();const{style:i}=this.view;if(i.display||(i.display="block"),this.parentView=this.view.parentElement,this.parentView){const n=this.parentView.style;n.webkitUserSelect=n.userSelect="none"}y.syncDomFont&&!this.parentView&&(i.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=tt(t)?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let i=e;if(e===window||e===document){const o=document.createElement("div"),{style:r}=o;r.position="absolute",r.top=r.bottom=r.left=r.right="0px",document.body.appendChild(o),i=o}this.__createView();const n=this.view;i.hasChildNodes()&&(this.setAbsolute(n),i.style.position||(i.style.position="relative")),i.appendChild(n)}else be.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:n}=this.view;if(this.unreal){const{config:o,autoWidthStr:r,autoHeightStr:a}=this;o.width?(st(r)&&(this.autoWidthStr=n.width||""),n.width=o.width+"px"):st(r)||(n.width=r),o.height?(st(a)&&(this.autoHeightStr=n.height||""),n.height=o.height+"px"):st(a)||(n.height=a)}else n.width=t+"px",n.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(t,e){if(this.resizeListener=e,t){if(this.autoBounds=t,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(n=>{this.updateClientBounds();for(const o of n)this.checkAutoBounds(o.contentRect)});const i=this.parentView;i?(this.resizeObserver.observe(i),this.checkAutoBounds(i.getBoundingClientRect())):(this.checkAutoBounds(this.view),be.warn("no parent"))}catch{this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),y.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const t=y.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(t){const e=this.view,{x:i,y:n,width:o,height:r}=this.autoBounds.getBoundsFrom(t),a={width:o,height:r,pixelRatio:this.config.pixelRatio?this.pixelRatio:y.devicePixelRatio};if(!this.isSameSize(a)){const{style:h}=e;h.marginLeft=i+"px",h.marginTop=n+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(t){const e={};dt.copyAttrs(e,this,ki),this.resize(t),this.resizeListener&&!st(this.width)&&this.resizeListener(new pe(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),this.stopListenPixelRatio(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}xe(CanvasRenderingContext2D.prototype),xe(Path2D.prototype);const{mineType:Nt,fileType:Ii}=Ci;function Ui(s,t){y.origin={createCanvas(e,i){const n=document.createElement("canvas");return n.width=e,n.height=i,n},canvasToDataURL:(e,i,n)=>{const o=Nt(i),r=e.toDataURL(o,n);return o==="image/bmp"?r.replace("image/png;","image/bmp;"):r},canvasToBolb:(e,i,n)=>new Promise(o=>e.toBlob(o,Nt(i),n)),canvasSaveAs:(e,i,n)=>{const o=e.toDataURL(Nt(Ii(i)),n);return y.origin.download(o,i)},download:(e,i)=>new Promise(n=>{let o=document.createElement("a");o.href=e,o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),n()}),loadImage:e=>new Promise((i,n)=>{const o=new y.origin.Image,{crossOrigin:r}=y.image;r&&(o.setAttribute("crossOrigin",r),o.crossOrigin=r),o.onload=()=>{i(o)},o.onerror=a=>{n(a)},o.src=y.image.getRealURL(e)}),Image,PointerEvent,DragEvent},y.event={stopDefault(e){e.preventDefault()},stopNow(e){e.stopImmediatePropagation()},stop(e){e.stopPropagation()}},y.canvas=lt.canvas(),y.conicGradientSupport=!!y.canvas.context.createConicGradient}Object.assign(lt,{canvas:(s,t)=>new oi(s,t),image:s=>new mi(s)}),y.name="web",y.isMobile="ontouchstart"in window,y.requestRender=function(s){window.requestAnimationFrame(s)},xi(y,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:St}=navigator;St.indexOf("Firefox")>-1?(y.conicGradientRotate90=!0,y.intWheelDeltaY=!0,y.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&(y.fullImageShadow=!0),St.indexOf("Windows")>-1?(y.os="Windows",y.intWheelDeltaY=!0):St.indexOf("Mac")>-1?y.os="Mac":St.indexOf("Linux")>-1&&(y.os="Linux");class ji{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new Y;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new Y,this.target=t,e&&(this.config=dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(W.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===Vt.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let i=0,n=e.length;i<n;i++)this.__pushChild(e[i])}__onRquestData(){this.target.emitEvent(new yt(yt.DATA,{updatedList:this.updatedList})),this.__updatedList=new Y,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Si.CHANGE,this.__onAttrChange,this],[[Vt.ADD,Vt.REMOVE],this.__onChildEvent,this],[yt.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:Gi,updateBounds:Be,updateChange:Yi}=X,{pushAllChildBranch:Vi,pushAllParent:ke}=ii,{worldBounds:Ee}=ei;class Le{constructor(t){this.updatedBounds=new j,this.beforeBounds=new j,this.afterBounds=new j,bt(t)&&(t=new Y(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,Ee)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,Ee),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Xi,updateAllChange:Ni}=X,Ht=xt.get("Layouter");class Ft{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new Li,this.target=t,e&&(this.config=dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:t}=this;this.times=0;try{t.emit(R.START),this.layoutOnce(),t.emitEvent(new R(R.END,this.layoutedBlocks,this.times))}catch(e){Ht.error(e)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Ht.warn("layouting"):this.times>3?Ht.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(yt.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(!((t=this.__updatedList)===null||t===void 0)&&t.length))return;const e=Q.start("PartLayout"),{target:i,__updatedList:n}=this,{BEFORE:o,LAYOUT:r,AFTER:a}=R,h=this.getBlocks(n);h.forEach(l=>l.setBefore()),i.emitEvent(new R(o,h,this.times)),this.extraBlock=null,n.sort(),function(l,c){let d;l.list.forEach(u=>{d=u.__layout,c.without(u)&&!d.proxyZoom&&(d.matrixChanged?(Gi(u,!0),c.add(u),u.isBranch&&Vi(u,c),ke(u,c)):d.boundsChanged&&(c.add(u),u.isBranch&&(u.__tempNumber=0),ke(u,c)))})}(n,this.__levelList),function(l){let c,d,u;l.sort(!0),l.levels.forEach(f=>{c=l.levelMap[f];for(let p=0,v=c.length;p<v;p++){if(d=c[p],d.isBranch&&d.__tempNumber){u=d.children;for(let m=0,g=u.length;m<g;m++)u[m].isBranch||Be(u[m])}Be(d)}})}(this.__levelList),function(l){l.list.forEach(Yi)}(n),this.extraBlock&&h.push(this.extraBlock),h.forEach(l=>l.setAfter()),i.emitEvent(new R(r,h,this.times)),i.emitEvent(new R(a,h,this.times)),this.addBlocks(h),this.__levelList.reset(),this.__updatedList=null,Q.end(e)}fullLayout(){const t=Q.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:n,AFTER:o}=R,r=this.getBlocks(new Y(e));e.emitEvent(new R(i,r,this.times)),Ft.fullLayout(e),r.forEach(a=>{a.setAfter()}),e.emitEvent(new R(n,r,this.times)),e.emitEvent(new R(o,r,this.times)),this.addBlocks(r),Q.end(t)}static fullLayout(t){Xi(t,!0),t.isBranch?ii.updateBounds(t):X.updateBounds(t),Ni(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new Le([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new Le(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[R.REQUEST,this.layout,this],[R.AGAIN,this.layoutAgain,this],[yt.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const ot=xt.get("Renderer");class Yt{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:120},this.target=t,this.canvas=e,i&&(this.config=dt.default(i,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(t=!0){this.changed||(this.changed=t),this.__requestRender()}requestLayout(){this.target.emit(R.REQUEST)}checkRender(){if(this.running){const{target:t}=this;t.isApp&&(t.emit(W.CHILD_START,t),t.children.forEach(e=>{e.renderer.FPS=this.FPS,e.renderer.checkRender()}),t.emit(W.CHILD_END,t)),this.changed&&this.canvas.view&&this.render(),this.target.emit(W.NEXT)}}render(t){if(!this.running||!this.canvas.view)return this.update();const{target:e}=this;this.times=0,this.totalBounds=new j,ot.log(e.innerName,"--->");try{this.emitRender(W.START),this.renderOnce(t),this.emitRender(W.END,this.totalBounds),Ot.clearRecycled()}catch(i){this.rendering=!1,ot.error(i)}ot.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return ot.warn("rendering");if(this.times>3)return ot.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new j,this.renderOptions={},t)this.emitRender(W.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(W.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(W.RENDER,this.renderBounds,this.renderOptions),this.emitRender(W.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;e&&(this.mergeBlocks(),e.forEach(i=>{t.bounds.hit(i)&&!i.isEmpty()&&this.clipRender(i)}))}clipRender(t){const e=Q.start("PartRender"),{canvas:i}=this,n=t.getIntersect(i.bounds),o=new j(n);i.save(),n.spread(Yt.clipSpread).ceil(),i.clearWorld(n),i.clipWorld(n),this.__render(n,o),i.restore(),Q.end(e)}fullRender(){const t=Q.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds),e.restore(),Q.end(t)}__render(t,e){const{canvas:i}=this,n=t.includes(this.target.__world),o=n?{includes:n}:{bounds:t,includes:n};this.needFill&&i.fillWorld(t,this.config.fill),xt.showRepaint&&xt.drawRepaint(i,t),this.target.__render(i,o),this.renderBounds=e=e||t,this.renderOptions=o,this.totalBounds.isEmpty()?this.totalBounds=e:this.totalBounds.add(e),i.updateRender(e)}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new j;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=this.target;if(this.requestTime||!t)return;if(t.parentApp)return t.parentApp.requestRender(!1);const e=this.requestTime=Date.now(),i=()=>{const n=1e3/(Date.now()-e),{maxFPS:o}=this.config;if(o&&n>o-.5)return y.requestRender(i);this.FPS=Math.min(120,Math.ceil(n)),this.requestTime=0,this.checkRender()};y.requestRender(i)}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new j(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new j(0,0,1,1)),this.update()}}__onLayoutEnd(t){t.data&&t.data.map(e=>{let i;e.updatedList&&e.updatedList.list.some(n=>(i=!n.__world.width||!n.__world.height,i&&(n.isLeafer||ot.tip(n.innerName,": empty"),i=!n.isBranch||n.isBranchLeaf),i)),this.addBlock(i?this.canvas.bounds:e.updatedBounds)})}emitRender(t,e,i){this.target.emitEvent(new W(t,this.times,e,i))}__listenEvents(){this.__eventIds=[this.target.on_([[W.REQUEST,this.update,this],[R.END,this.__onLayoutEnd,this],[W.AGAIN,this.renderAgain,this],[pe.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}Yt.clipSpread=10;const{hitRadiusPoint:Hi}=V;class $i{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const n=i.through||!1,o=i.ignoreHittable||!1,r=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new Y(i.findList),i.findList||this.hitBranch(r.isBranchLeaf?{children:[r]}:r);const{list:a}=this.findList,h=this.getBestMatchLeaf(a,i.bottomList,o),l=o?this.getPath(h):this.getHitablePath(h);return this.clear(),n?{path:l,target:h,throughPath:a.length?this.getThroughPath(a):l}:{path:l,target:h}}hitPoint(t,e,i){return!!this.getByPoint(t,e,i).target}getBestMatchLeaf(t,e,i){const n=this.findList=new Y;if(t.length){let o;const{x:r,y:a}=this.point,h={x:r,y:a,radiusX:0,radiusY:0};for(let l=0,c=t.length;l<c;l++)if(o=t[l],(i||X.worldHittable(o))&&(this.hitChild(o,h),n.length)){if(o.isBranchLeaf&&t.some(d=>d!==o&&X.hasParent(d,o))){n.reset();break}return n.list[0]}}if(e){for(let o=0,r=e.length;o<r;o++)if(this.hitChild(e[o].target,this.point,e[o].proxy),n.length)return n.list[0]}return i?t[0]:t.find(o=>X.worldHittable(o))}getPath(t){const e=new Y;for(;t;)e.add(t),t=t.parent;return this.target&&e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,n=new Y;for(let o=e.list.length-1;o>-1&&(i=e.list[o],i.__.hittable)&&(n.addAt(i,0),i.__.hitChildren);o--);return n}getThroughPath(t){const e=new Y,i=[];for(let a=t.length-1;a>-1;a--)i.push(this.getPath(t[a]));let n,o,r;for(let a=0,h=i.length;a<h;a++){n=i[a],o=i[a+1];for(let l=0,c=n.length;l<c&&(r=n.list[l],!o||!o.has(r));l++)e.add(r)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,n;const{point:o}=this;for(let r=t.length-1;r>-1;r--)i=t[r],!i.__.visible||e&&!i.__.mask||(n=!!i.__.hitRadius||Hi(i.__world,o),i.isBranch?(n||i.__ignoreHitWorld)&&(i.topChildren&&this.eachFind(i.topChildren,!1),this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,o)):n&&this.hitChild(i,o))}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:n}=t;if(n&&n.__hasMask&&!t.__.mask){let o,r=[];const{children:a}=n;for(let h=0,l=a.length;h<l;h++)if(o=a[h],o.__.mask&&r.push(o),o===t){if(r&&!r.every(c=>c.__hitWorld(e)))return;break}}this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class qi{constructor(t,e){this.config={},e&&(this.config=dt.default(e,this.config)),this.picker=new $i(this.target=t,this),this.finder=lt.finder&&lt.finder()}getByPoint(t,e,i){const{target:n,picker:o}=this;return y.backgrounder&&n&&n.updateLayout(),o.getByPoint(t,e,i)}hitPoint(t,e,i){return this.picker.hitPoint(t,e,i)}getBy(t,e,i,n){return this.finder?this.finder.getBy(t,e,i,n):Ei.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}Object.assign(lt,{watcher:(s,t)=>new ji(s,t),layouter:(s,t)=>new Ft(s,t),renderer:(s,t,e)=>new Yt(s,t,e),selector:(s,t)=>new qi(s,t)}),y.layout=Ft.fullLayout;const M={convert(s,t){const e=Z.getBase(s),i=Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:s.width,height:s.height,pointerType:s.pointerType,pressure:s.pressure});return i.pointerType==="pen"&&(i.tangentialPressure=s.tangentialPressure,i.tiltX=s.tiltX,i.tiltY=s.tiltY,i.twist=s.twist),i},convertMouse(s,t){const e=Z.getBase(s);return Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(s,t){const e=M.getTouch(s),i=Z.getBase(s);return Object.assign(Object.assign({},i),{x:t.x,y:t.y,width:1,height:1,pointerType:"touch",multiTouch:s.touches.length>1,pressure:e.force})},getTouch:s=>s.targetTouches[0]||s.changedTouches[0]},Se={convert(s){const t=Z.getBase(s);return Object.assign(Object.assign({},t),{code:s.code,key:s.key})}},{pathCanDrag:Ki}=Z;class Qi extends zi{get notPointer(){const{p:t}=this;return t.type!=="pointer"||t.touch||this.useMultiTouch}get notTouch(){const{p:t}=this;return t.type==="mouse"||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let n in e)e[n]=e[n].bind(this),t.addEventListener(n,e[n]);for(let n in i)i[n]=i[n].bind(this),window.addEventListener(n,i[n])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let i in t)this.view.removeEventListener(i,t[i]),this.viewEvents={};for(let i in e)window.removeEventListener(i,e[i]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,n=t.length;i<n;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(Se.convert(t))}onKeyUp(t){this.keyUp(Se.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(M.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(M.convert(t,this.getLocal(t))))}onPointerMove(t,e){if(this.notPointer||this.preventWindowPointer(t))return;this.usePointer||(this.usePointer=!0);const i=M.convert(t,this.getLocal(t,!0));e?this.pointerHover(i):this.pointerMove(i)}onPointerLeave(t){this.onPointerMove(t,!0)}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.notPointer||this.preventWindowPointer(t)||this.pointerUp(M.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.notMouse||this.pointerDown(M.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.notMouse||this.preventWindowPointer(t)||this.pointerMove(M.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.notMouse||this.preventWindowPointer(t)||this.pointerUp(M.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(t){const e=M.getTouch(t),i=this.getLocal(e,!0),{preventDefault:n}=this.config.touch;(n===!0||n==="auto"&&Ki(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(M.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.notTouch||this.preventWindowPointer(t))return;const e=M.getTouch(t);this.pointerMove(M.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=M.getTouch(t);this.pointerUp(M.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(Z.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const n=[];return t.forEach(o=>{i=e.find(r=>r.identifier===o.identifier),i&&n.push({from:this.getLocal(o),to:this.getLocal(i)})}),n}getLocalTouchs(t){return t.map(e=>this.getLocal(e))}onWheel(t){this.preventDefaultWheel(t),this.wheel(Object.assign(Object.assign(Object.assign({},Z.getBase(t)),this.getLocal(t)),{deltaX:t.deltaX,deltaY:t.deltaY}))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=Z.getBase(t);Object.assign(e,this.getLocal(t));const i=t.scale/this.lastGestureScale,n=(t.rotation-this.lastGestureRotation)/Math.PI*180*(si.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},e),{scale:i*i})),this.rotate(Object.assign(Object.assign({},e),{rotation:n})),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),J(e[e.length-1])&&e.push("default"),this.canvas.view.style.cursor=e.map(i=>J(i)?`url(${i.url}) ${i.x||0} ${i.y||0}`:i).join(",")}eachCursor(t,e,i=0){if(i++,bt(t))t.forEach(n=>this.eachCursor(n,e,i));else{const n=tt(t)&&Fi.get(t);n&&i<2?this.eachCursor(n,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function we(s,t){const e=s.__,{rows:i,decorationY:n}=e.__textDrawData;let o;e.__isPlacehold&&e.placeholderColor&&(t.fillStyle=e.placeholderColor);for(let r=0,a=i.length;r<a;r++)o=i[r],o.text?t.fillText(o.text,o.x,o.y):o.data&&o.data.forEach(h=>{t.fillText(h.char,h.x,o.y)});if(n){const{decorationColor:r,decorationHeight:a}=e.__textDrawData;r&&(t.fillStyle=r),i.forEach(h=>n.forEach(l=>t.fillRect(h.x,h.y+l,h.width,a)))}}function ut(s,t){s.__.__font?we(s,t):s.__.windingRule?t.fill(s.__.windingRule):t.fill()}function ri(s,t,e){switch(t.__.strokeAlign){case"center":ce(s,1,t,e);break;case"inside":Te(s,"inside",t,e);break;case"outside":t.__.__fillAfterStroke?ce(s,2,t,e):Te(s,"outside",t,e)}}function ce(s,t,e,i){const n=e.__;J(s)?ai(s,t,!0,e,i):(i.setStroke(s,n.__strokeWidth*t,n),It(e,i))}function Te(s,t,e,i){const n=i.getSameCanvas(!0,!0);n.font=e.__.__font,ce(s,2,e,n),n.blendMode=t==="outside"?"destination-out":"destination-in",we(e,n),n.blendMode="normal",X.copyCanvasByWorld(e,i,n),n.recycle(e.__nowWorld)}function It(s,t){let e,i=s.__.__textDrawData;const{rows:n,decorationY:o}=i;for(let r=0,a=n.length;r<a;r++)e=n[r],e.text?t.strokeText(e.text,e.x,e.y):e.data&&e.data.forEach(h=>{t.strokeText(h.char,h.x,e.y)});if(o){const{decorationHeight:r}=i;n.forEach(a=>o.forEach(h=>t.strokeRect(a.x,a.y+h,a.width,r)))}}function ai(s,t,e,i,n){let o;const r=i.__,{__hasMultiStrokeStyle:a}=r;a||n.setStroke(void 0,r.__strokeWidth*t,r);for(let h=0,l=s.length;h<l;h++)if(o=s[h],(!o.image||!Bt.checkImage(i,n,o,!1))&&o.style){if(a){const{strokeStyle:c}=o;c?n.setStroke(o.style,r.__getRealStrokeWidth(c)*t,r,c):n.setStroke(o.style,r.__strokeWidth*t,r)}else n.strokeStyle=o.style;o.blendMode?(n.saveBlendMode(o.blendMode),e?It(i,n):n.stroke(),n.restoreBlendMode()):e?It(i,n):n.stroke()}}function Re(s,t,e){const i=t.__;if(i.__strokeWidth)if(i.__font)ri(s,t,e);else switch(i.strokeAlign){case"center":Tt(s,1,t,e);break;case"inside":(function(n,o,r){r.save(),r.clipUI(o),Tt(n,2,o,r),r.restore()})(s,t,e);break;case"outside":(function(n,o,r){const a=o.__;if(a.__fillAfterStroke)Tt(n,2,o,r);else{const{renderBounds:h}=o.__layout,l=r.getSameCanvas(!0,!0);o.__drawRenderPath(l),Tt(n,2,o,l),l.clipUI(a),l.clearWorld(h),X.copyCanvasByWorld(o,r,l),l.recycle(o.__nowWorld)}})(s,t,e)}}function Tt(s,t,e,i){const n=e.__;J(s)?ai(s,t,!1,e,i):(i.setStroke(s,n.__strokeWidth*t,n),i.stroke()),n.__useArrow&&ni.strokeArrow(s,e,i)}const{getSpread:Zi,getOuterOf:Ji,getByMove:ts,getIntersectData:es}=V;let de;const{stintSet:ft}=dt,{hasTransparent:is}=I;function ss(s,t,e){if(!J(t)||t.visible===!1||t.opacity===0)return;let i;const{boxBounds:n}=e.__layout;switch(t.type){case"image":i=Bt.image(e,s,t,n,!de||!de[t.url]);break;case"linear":i=Wt.linearGradient(t,n);break;case"radial":i=Wt.radialGradient(t,n);break;case"angular":i=Wt.conicGradient(t,n);break;case"solid":const{type:o,color:r,opacity:a}=t;i={type:o,style:I.string(r,a)};break;default:st(t.r)||(i={type:"solid",style:I.string(t)})}if(i){if(tt(i.style)&&is(i.style)&&(i.isTransparent=!0),t.style){if(t.style.strokeWidth===0)return;i.strokeStyle=t.style}t.editing&&(i.editing=t.editing),t.blendMode&&(i.blendMode=t.blendMode)}return i}const ns={compute:function(s,t){const e=t.__,i=[];let n,o,r,a=e.__input[s];bt(a)||(a=[a]),de=Bt.recycleImage(s,e);for(let h,l=0,c=a.length;l<c;l++)(h=ss(s,a[l],t))&&(i.push(h),h.strokeStyle&&(r||(r=1),h.strokeStyle.strokeWidth&&(r=Math.max(r,h.strokeStyle.strokeWidth))));e["_"+s]=i.length?i:void 0,i.length&&i.every(h=>h.isTransparent)&&(i.some(h=>h.image)&&(n=!0),o=!0),s==="fill"?(ft(e,"__isAlphaPixelFill",n),ft(e,"__isTransparentFill",o)):(ft(e,"__isAlphaPixelStroke",n),ft(e,"__isTransparentStroke",o),ft(e,"__hasMultiStrokeStyle",r))},fill:function(s,t,e){e.fillStyle=s,ut(t,e)},fills:function(s,t,e){let i;for(let n=0,o=s.length;n<o;n++){if(i=s[n],i.image){if(Bt.checkImage(t,e,i,!t.__.__font))continue;if(!i.style){!n&&i.image.isPlacehold&&t.drawImagePlaceholder(e,i.image);continue}}if(e.fillStyle=i.style,i.transform||i.scaleFixed){if(e.save(),i.transform&&e.transform(i.transform),i.scaleFixed){const{scaleX:r,scaleY:a}=t.getRenderScaleData(!0);(i.scaleFixed===!0||i.scaleFixed==="zoom-in"&&r>1&&a>1)&&e.scale(1/r,1/a)}i.blendMode&&(e.blendMode=i.blendMode),ut(t,e),e.restore()}else i.blendMode?(e.saveBlendMode(i.blendMode),ut(t,e),e.restoreBlendMode()):ut(t,e)}},fillPathOrText:ut,fillText:we,stroke:Re,strokes:function(s,t,e){Re(s,t,e)},strokeText:ri,drawTextStroke:It,shape:function(s,t,e){const i=t.getSameCanvas(),n=s.__nowWorld,o=t.bounds;let r,a,h,l,c,{scaleX:d,scaleY:u}=s.getRenderScaleData(!0);if(o.includes(n))c=i,r=l=n;else{const{renderShapeSpread:f}=s.__layout;let p;if(y.fullImageShadow)p=n;else{const w=f?Zi(o,d===u?f*d:[f*u,f*d]):o;p=es(w,n)}h=o.getFitMatrix(p);let{a:v,d:m}=h;h.a<1&&(c=t.getSameCanvas(),s.__renderShape(c,e),d*=v,u*=m),l=Ji(n,h),r=ts(l,-h.e,-h.f);const g=e.matrix;g?(a=new Ti(h),a.multiply(g),v*=g.scaleX,m*=g.scaleY):a=h,a.withScale(v,m),e=Object.assign(Object.assign({},e),{matrix:a})}return s.__renderShape(i,e),{canvas:i,matrix:a,fitMatrix:h,bounds:r,worldCanvas:c,shapeBounds:l,scaleX:d,scaleY:u}}};let pt={},$t=Ri();const{get:ve,rotateOfOuter:hi,translate:at,scaleOfOuter:os,multiplyParent:rs,scale:li,rotate:ci,skew:as}=jt;function di(s,t,e,i,n,o,r){const a=ve();at(a,t.x+e,t.y+i),li(a,n,o),r&&hi(a,{x:t.x+t.width/2,y:t.y+t.height/2},r),s.transform=a}function ui(s,t,e,i,n,o,r,a,h){const l=ve();pi(l,t,e,i,n,o,r,a),h&&($t.a=t.width/h.width,$t.d=t.height/h.height,rs(l,$t)),s.transform=l}function fi(s,t,e,i,n,o,r,a,h,l,c,d){const u=ve();if(d)pi(u,t,n,o,r,a,h,l);else{if(h)if(c==="center")hi(u,{x:e/2,y:i/2},h);else switch(ci(u,h),h){case 90:at(u,i,0);break;case 180:at(u,e,i);break;case 270:at(u,0,e)}pt.x=t.x+n,pt.y=t.y+o,at(u,pt.x,pt.y),r&&os(u,pt,r,a)}s.transform=u}function pi(s,t,e,i,n,o,r,a){r&&ci(s,r),a&&as(s,a.x,a.y),n&&li(s,n,o),at(s,t.x+e,t.y+i)}const{get:hs,translate:ls}=jt,cs=new j,qt={},L={};function gi(s,t,e,i){const{changeful:n,sync:o,scaleFixed:r}=e;n&&(s.changeful=n),o&&(s.sync=o),r&&(s.scaleFixed=r),s.data=_i(e,i,t)}function _i(s,t,e){s.padding&&(t=cs.set(t).shrink(s.padding)),s.mode==="strench"&&(s.mode="stretch");let{width:i,height:n}=e;const{opacity:o,mode:r,align:a,offset:h,scale:l,size:c,rotation:d,skew:u,clipSize:f,repeat:p,gap:v,filters:m}=s,g=t.width===i&&t.height===n,w={mode:r},E=a!=="center"&&(d||0)%180==90;let b,x;switch(V.set(L,0,0,E?n:i,E?i:n),r&&r!=="cover"&&r!=="fit"?((l||c)&&(si.getScaleData(l,c,e,qt),b=qt.scaleX,x=qt.scaleY),(a||v||p)&&(b&&V.scale(L,b,x,!0),a&&Pi.toPoint(a,L,t,L,!0,!0))):g&&!d||(b=x=V.getFitScale(t,L,r!=="fit"),V.put(t,e,a,b,!1,L),V.scale(L,b,x,!0)),h&&ge.move(L,h),r){case"stretch":g||(i=t.width,n=t.height);break;case"normal":case"clip":(L.x||L.y||b||f||d||u)&&ui(w,t,L.x,L.y,b,x,d,u,s.clipSize);break;case"repeat":(!g||b||d||u)&&fi(w,t,i,n,L.x,L.y,b,x,d,u,a,s.freeTransform),p||(w.repeat="repeat");const S=J(p);(v||S)&&(w.gap=function(_,k,z,D,T){let O,B;return J(_)?(O=_.x,B=_.y):O=B=_,{x:Pe(O,z,T.width,k&&k.x),y:Pe(B,D,T.height,k&&k.y)}}(v,S&&p,L.width,L.height,t));break;default:b&&di(w,t,L.x,L.y,b,x,d)}return w.transform||(t.x||t.y)&&(w.transform=hs(),ls(w.transform,t.x,t.y)),b&&r!=="stretch"&&(w.scaleX=b,w.scaleY=x),w.width=i,w.height=n,o&&(w.opacity=o),m&&(w.filters=m),p&&(w.repeat=tt(p)?p==="x"?"repeat-x":"repeat-y":"repeat"),w}function Pe(s,t,e,i){const n=tt(s)||i?(i?e-i*t:e%t)/((i||Math.floor(e/t))-1):s;return s==="auto"&&n<0?0:n}let gt,ds=new j;const{isSame:us}=V;function Ce(s,t,e,i,n,o){if(t==="fill"&&!s.__.__naturalWidth){const r=s.__;if(r.__naturalWidth=i.width/r.pixelRatio,r.__naturalHeight=i.height/r.pixelRatio,r.__autoSide)return s.forceUpdate("width"),s.__proxyData&&(s.setProxyAttr("width",r.width),s.setProxyAttr("height",r.height)),!1}return n.data||gi(n,i,e,o),!0}function Me(s,t){ye(s,Gt.LOAD,t)}function Ae(s,t){ye(s,Gt.LOADED,t)}function De(s,t,e){t.error=e,s.forceUpdate("surface"),ye(s,Gt.ERROR,t)}function ye(s,t,e){s.hasEvent(t)&&s.emitEvent(new Gt(t,e))}function Kt(s,t){const{leafer:e}=s;e&&e.viewReady&&(e.renderer.ignore=t)}const{get:Oe,scale:We,copy:ze}=jt,{floor:Fe,ceil:fs,max:Ie,abs:Ue}=Math;function Qt(s,t,e){let{scaleX:i,scaleY:n}=s.getRenderScaleData(!0,t.scaleFixed);const o=i+"-"+n+"-"+e;if(t.patternId===o||s.destroyed)return!1;{const{image:r,data:a}=t;let h,l,{width:c,height:d,scaleX:u,scaleY:f,transform:p,repeat:v,gap:m}=a;i*=e,n*=e,u&&(u=Ue(u),f=Ue(f),l=Oe(),ze(l,p),We(l,1/u,1/f),i*=u,n*=f),c*=i,d*=n;const g=c*d;if(!v&&g>y.image.maxCacheSize)return!1;let w=y.image.maxPatternSize;if(r.isSVG){const _=c/r.width;_>1&&(h=_/fs(_))}else{const _=r.width*r.height;w>_&&(w=_)}g>w&&(h=Math.sqrt(g/w)),h&&(i/=h,n/=h,c/=h,d/=h),u&&(i/=u,n/=f);const E=m&&m.x*i,b=m&&m.y*n;if(p||i!==1||n!==1){const _=c+(E||0),k=d+(b||0);i/=_/Ie(Fe(_),1),n/=k/Ie(Fe(k),1),l||(l=Oe(),p&&ze(l,p)),We(l,1/i,1/n)}const x=r.getCanvas(c,d,a.opacity,a.filters,E,b,s.leafer&&s.leafer.config.smooth),S=r.getPattern(x,v||y.origin.noRepeat||"no-repeat",l,t);return t.style=S,t.patternId=o,!0}}function ps(s,t,e,i){return new(e||(e=Promise))(function(n,o){function r(l){try{h(i.next(l))}catch(c){o(c)}}function a(l){try{h(i.throw(l))}catch(c){o(c)}}function h(l){var c;l.done?n(l.value):(c=l.value,c instanceof e?c:new e(function(d){d(c)})).then(r,a)}h((i=i.apply(s,[])).next())})}const gs={image:function(s,t,e,i,n){let o,r;const a=Ot.get(e);return gt&&e===gt.paint&&us(i,gt.boxBounds)?o=gt.leafPaint:(o={type:e.type,image:a},a.hasAlphaPixel&&(o.isTransparent=!0),gt=a.use>1?{leafPaint:o,paint:e,boxBounds:ds.set(i)}:null),(n||a.loading)&&(r={image:a,attrName:t,attrValue:e}),a.ready?(Ce(s,t,e,a,o,i),n&&(Me(s,r),Ae(s,r))):a.error?n&&De(s,r,a.error):(n&&(Kt(s,!0),Me(s,r)),o.loadId=a.load(()=>{Kt(s,!1),s.destroyed||(Ce(s,t,e,a,o,i)&&(a.hasAlphaPixel&&(s.__layout.hitCanvasChanged=!0),s.forceUpdate("surface")),Ae(s,r)),o.loadId=void 0},h=>{Kt(s,!1),De(s,r,h),o.loadId=void 0}),s.placeholderColor&&(s.placeholderDelay?setTimeout(()=>{a.ready||(a.isPlacehold=!0,s.forceUpdate("surface"))},s.placeholderDelay):a.isPlacehold=!0)),o},checkImage:function(s,t,e,i){const{scaleX:n,scaleY:o}=s.getRenderScaleData(!0,e.scaleFixed),{pixelRatio:r}=t,{data:a}=e;if(!a||e.patternId===n+"-"+o+"-"+r&&!Xt.running)return!1;if(i){if(a.repeat)i=!1;else if(!(e.changeful||y.name==="miniapp"&&pe.isResizing(s)||Xt.running)){let{width:h,height:l}=a;h*=n*r,l*=o*r,a.scaleX&&(h*=a.scaleX,l*=a.scaleY),i=h*l>y.image.maxCacheSize}}return i?(s.__.__isFastShadow&&(t.fillStyle=e.style||"#000",t.fill()),function(h,l,c,d){l.save(),l.clipUI(h),c.blendMode&&(l.blendMode=c.blendMode),d.opacity&&(l.opacity*=d.opacity),d.transform&&l.transform(d.transform),l.drawImage(c.image.getFull(d.filters),0,0,d.width,d.height),l.restore()}(s,t,e,a),!0):(!e.style||e.sync||Xt.running?Qt(s,e,r):e.patternTask||(e.patternTask=Ot.patternTasker.add(()=>ps(this,void 0,void 0,function*(){e.patternTask=null,t.bounds.hit(s.__nowWorld)&&Qt(s,e,r),s.forceUpdate("surface")}),300)),!1)},createPattern:Qt,recycleImage:function(s,t){const e=t["_"+s];if(bt(e)){let i,n,o,r,a;for(let h=0,l=e.length;h<l;h++)i=e[h],n=i.image,a=n&&n.url,a&&(o||(o={}),o[a]=!0,Ot.recycle(n),n.loading&&(r||(r=t.__input&&t.__input[s]||[],bt(r)||(r=[r])),n.unload(e[h].loadId,!r.some(c=>c.url===a))));return o}return null},createData:gi,getPatternData:_i,fillOrFitMode:di,clipMode:ui,repeatMode:fi},{toPoint:je}=_e,{hasTransparent:_s}=I,Zt={},Jt={};function te(s,t,e,i){if(e){let n,o,r,a;for(let h=0,l=e.length;h<l;h++)n=e[h],tt(n)?(r=h/(l-1),o=I.string(n,i)):(r=n.offset,o=I.string(n.color,i)),t.addColorStop(r,o),!a&&_s(o)&&(a=!0);a&&(s.isTransparent=!0)}}const{getAngle:ws,getDistance:vs}=ge,{get:ys,rotateOfOuter:Ge,scaleOfOuter:Ye}=jt,{toPoint:Ve}=_e,et={},ee={};function ie(s,t,e,i,n){let o;const{width:r,height:a}=s;if(r!==a||i){const h=ws(t,e);o=ys(),n?(Ye(o,t,r/a*(i||1),1),Ge(o,t,h+90)):(Ye(o,t,1,r/a*(i||1)),Ge(o,t,h))}return o}const{getDistance:ms}=ge,{toPoint:Xe}=_e,H={},se={},xs={linearGradient:function(s,t){let{from:e,to:i,type:n,opacity:o}=s;je(e||"top",t,Zt),je(i||"bottom",t,Jt);const r=y.canvas.createLinearGradient(Zt.x,Zt.y,Jt.x,Jt.y),a={type:n,style:r};return te(a,r,s.stops,o),a},radialGradient:function(s,t){let{from:e,to:i,type:n,opacity:o,stretch:r}=s;Ve(e||"center",t,et),Ve(i||"bottom",t,ee);const a=y.canvas.createRadialGradient(et.x,et.y,0,et.x,et.y,vs(et,ee)),h={type:n,style:a};te(h,a,s.stops,o);const l=ie(t,et,ee,r,!0);return l&&(h.transform=l),h},conicGradient:function(s,t){let{from:e,to:i,type:n,opacity:o,stretch:r}=s;Xe(e||"center",t,H),Xe(i||"bottom",t,se);const a=y.conicGradientSupport?y.canvas.createConicGradient(0,H.x,H.y):y.canvas.createRadialGradient(H.x,H.y,0,H.x,H.y,ms(H,se)),h={type:n,style:a};te(h,a,s.stops,o);const l=ie(t,H,se,r||1,y.conicGradientRotate90);return l&&(h.transform=l),h},getTransform:ie},{copy:Ne,toOffsetOutBounds:bs}=V,C={},Rt={};function He(s,t,e,i){const{bounds:n,shapeBounds:o}=i;if(y.fullImageShadow){if(Ne(C,s.bounds),C.x+=t.x-o.x,C.y+=t.y-o.y,e){const{fitMatrix:r}=i;C.x-=(n.x+(r?r.e:0)+n.width/2)*(e-1),C.y-=(n.y+(r?r.f:0)+n.height/2)*(e-1),C.width*=e,C.height*=e}s.copyWorld(i.canvas,s.bounds,C)}else e&&(Ne(C,t),C.x-=t.width/2*(e-1),C.y-=t.height/2*(e-1),C.width*=e,C.height*=e),s.copyWorld(i.canvas,o,e?C:t)}const{toOffsetOutBounds:Bs}=V,Pt={},ks={shadow:function(s,t,e){let i,n;const{__nowWorld:o,__layout:r}=s,{shadow:a}=s.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:d,scaleY:u}=e,f=t.getSameCanvas(),p=a.length-1;bs(l,Rt),a.forEach((v,m)=>{let g=1;if(v.scaleFixed){const w=Math.abs(o.scaleX);w>1&&(g=1/w)}f.setWorldShadow(Rt.offsetX+v.x*d*g,Rt.offsetY+v.y*u*g,v.blur*d*g,I.string(v.color)),n=v.spread?1+2*v.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0))*g:0,He(f,Rt,n,e),i=l,v.box&&(f.restore(),f.save(),h&&(f.copyWorld(f,l,o,"copy"),i=o),h?f.copyWorld(h,o,o,"destination-out"):f.copyWorld(e.canvas,c,l,"destination-out")),X.copyCanvasByWorld(s,t,f,i,v.blendMode),p&&m<p&&f.clearWorld(i)}),f.recycle(i)},innerShadow:function(s,t,e){let i,n;const{__nowWorld:o,__layout:r}=s,{innerShadow:a}=s.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:d,scaleY:u}=e,f=t.getSameCanvas(),p=a.length-1;Bs(l,Pt),a.forEach((v,m)=>{let g=1;if(v.scaleFixed){const w=Math.abs(o.scaleX);w>1&&(g=1/w)}f.save(),f.setWorldShadow(Pt.offsetX+v.x*d*g,Pt.offsetY+v.y*u*g,v.blur*d*g),n=v.spread?1-2*v.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0))*g:0,He(f,Pt,n,e),f.restore(),h?(f.copyWorld(f,l,o,"copy"),f.copyWorld(h,o,o,"source-out"),i=o):(f.copyWorld(e.canvas,c,l,"source-out"),i=l),f.fillWorld(i,I.string(v.color),"source-in"),X.copyCanvasByWorld(s,t,f,i,v.blendMode),p&&m<p&&f.clearWorld(i)}),f.recycle(i)},blur:function(s,t,e){const{blur:i}=s.__;e.setWorldBlur(i*s.__nowWorld.a),e.copyWorldToInner(t,s.__nowWorld,s.__layout.renderBounds),e.filter="none"},backgroundBlur:function(s,t,e){}},{excludeRenderBounds:$e}=ei;let ue;function Ct(s,t,e,i,n,o,r,a){switch(t){case"grayscale":ue||(ue=!0,n.useGrayscaleAlpha(s.__nowWorld));case"alpha":(function(h,l,c,d,u,f){const p=h.__nowWorld;c.resetTransform(),c.opacity=1,c.useMask(d,p),f&&d.recycle(p),qe(h,l,c,1,u,f)})(s,e,i,n,r,a);break;case"opacity-path":qe(s,e,i,o,r,a);break;case"path":a&&e.restore()}}function ne(s){return s.getSameCanvas(!1,!0)}function qe(s,t,e,i,n,o){const r=s.__nowWorld;t.resetTransform(),t.opacity=i,t.copyWorld(e,r,void 0,n),o?e.recycle(r):e.clearWorld(r)}Ai.prototype.__renderMask=function(s,t){let e,i,n,o,r,a;const{children:h}=this;for(let l=0,c=h.length;l<c;l++){if(e=h[l],a=e.__.mask,a){r&&(Ct(this,r,s,n,i,o,void 0,!0),i=n=null),o=e.__.opacity,ue=!1,a==="path"||a==="clipping-path"?(o<1?(r="opacity-path",n||(n=ne(s))):(r="path",s.save()),e.__clip(n||s,t)):(r=a==="grayscale"?"grayscale":"alpha",i||(i=ne(s)),n||(n=ne(s)),e.__render(i,t)),a!=="clipping"&&a!=="clipping-path"||$e(e,t)||e.__render(s,t);continue}const d=o===1&&e.__.__blendMode;d&&Ct(this,r,s,n,i,o,void 0,!1),$e(e,t)||e.__render(n||s,t),d&&Ct(this,r,s,n,i,o,d,!1)}Ct(this,r,s,n,i,o,void 0,!0)};const wi=`>)]}%!?,.:;'"》）」〉』〗】〕｝┐＞’”！？，、。：；‰`,Es=wi+"_#~&*+\\=|≮≯≈≠＝…",Ls=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([s,t])=>`[\\u${s.toString(16)}-\\u${t.toString(16)}]`).join("|"));function Lt(s){const t={};return s.split("").forEach(e=>t[e]=!0),t}const Ss=Lt("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),Ts=Lt(`{[(<'"《（「〈『〖【〔｛┌＜‘“＝¥￥＄€£￡¢￠`),Rs=Lt(wi),Ps=Lt(Es),Cs=Lt("- —／～｜┆·");var Ut;(function(s){s[s.Letter=0]="Letter",s[s.Single=1]="Single",s[s.Before=2]="Before",s[s.After=3]="After",s[s.Symbol=4]="Symbol",s[s.Break=5]="Break"})(Ut||(Ut={}));const{Letter:Ke,Single:Ms,Before:As,After:Ds,Symbol:Os,Break:Ws}=Ut;function zs(s){return Ss[s]?Ke:Cs[s]?Ws:Ts[s]?As:Rs[s]?Ds:Ps[s]?Os:Ls.test(s)?Ms:Ke}const Fs={trimRight(s){const{words:t}=s;let e,i=0,n=t.length;for(let o=n-1;o>-1&&(e=t[o].data[0],e.char===" ");o--)i++,s.width-=e.width;i&&t.splice(n-i,i)}};function Is(s,t,e){switch(t){case"title":return e?s.toUpperCase():s;case"upper":return s.toUpperCase();case"lower":return s.toLowerCase();default:return s}}const{trimRight:Us}=Fs,{Letter:oe,Single:_t,Before:Qe,After:re,Symbol:js,Break:Ze}=Ut;let mt,G,P,A,ae,U,$,kt,ct,F,K,he,wt,ht,Et,zt,fe,rt=[];function le(s,t){ct&&!kt&&(kt=ct),mt.data.push({char:s,width:t}),P+=t}function it(){A+=P,mt.width=P,G.words.push(mt),mt={data:[]},P=0}function vt(){ht&&(Et.paraNumber++,G.paraStart=!0,ht=!1),ct&&(G.startCharSize=kt,G.endCharSize=ct,kt=0),G.width=A,zt.width?Us(G):fe&&vi(),rt.push(G),G={words:[]},A=0}function vi(){A>(Et.maxWidth||0)&&(Et.maxWidth=A)}const{top:Mt,right:Je,bottom:ti,left:At}=bi;function Dt(s,t,e){const{bounds:i,rows:n}=s;i[t]+=e;for(let o=0;o<n.length;o++)n[o][t]+=e}const Gs={getDrawData:function(s,t){tt(s)||(s=String(s));let e=0,i=0,n=t.__getInput("width")||0,o=t.__getInput("height")||0;const{textDecoration:r,__font:a,__padding:h}=t;h&&(n?(e=h[At],n-=h[Je]+h[At]):t.autoSizeAlign||(e=h[At]),o?(i=h[Mt],o-=h[Mt]+h[ti]):t.autoSizeAlign||(i=h[Mt]));const l={bounds:{x:e,y:i,width:n,height:o},rows:[],paraNumber:0,font:y.canvas.font=a};return function(c,d,u){Et=c,rt=c.rows,zt=c.bounds,fe=!zt.width&&!u.autoSizeAlign;const{__letterSpacing:f,paraIndent:p,textCase:v}=u,{canvas:m}=y,{width:g,height:w}=zt;if(g||w||f||v!=="none"){const E=u.textWrap!=="none",b=u.textWrap==="break";ht=!0,K=null,kt=$=ct=P=A=0,mt={data:[]},G={words:[]},f&&(d=[...d]);for(let x=0,S=d.length;x<S;x++)U=d[x],U===`
`?(P&&it(),G.paraEnd=!0,vt(),ht=!0):(F=zs(U),F===oe&&v!=="none"&&(U=Is(U,v,!P)),$=m.measureText(U).width,f&&(f<0&&(ct=$),$+=f),he=F===_t&&(K===_t||K===oe)||K===_t&&F!==re,wt=!(F!==Qe&&F!==_t||K!==js&&K!==re),ae=ht&&p?g-p:g,E&&g&&A+P+$>ae&&(b?(P&&it(),A&&vt()):(wt||(wt=F===oe&&K==re),(he||wt||F===Ze||F===Qe||F===_t||P+$>ae)&&P&&it(),A&&vt())),U===" "&&ht!==!0&&A+P===0||(F===Ze?(U===" "&&P&&it(),le(U,$),it()):((he||wt)&&P&&it(),le(U,$))),K=F);P&&it(),A&&vt(),rt.length>0&&(rt[rt.length-1].paraEnd=!0)}else d.split(`
`).forEach(E=>{Et.paraNumber++,A=m.measureText(E).width,rt.push({x:p||0,text:E,width:A,paraStart:!0}),fe&&vi()})}(l,s,t),h&&function(c,d,u,f,p){if(!f&&u.autoSizeAlign)switch(u.textAlign){case"left":Dt(d,"x",c[At]);break;case"right":Dt(d,"x",-c[Je])}if(!p&&u.autoSizeAlign)switch(u.verticalAlign){case"top":Dt(d,"y",c[Mt]);break;case"bottom":Dt(d,"y",-c[ti])}}(h,l,t,n,o),function(c,d){const{rows:u,bounds:f}=c,p=u.length,{__lineHeight:v,__baseLine:m,__letterSpacing:g,__clipText:w,textAlign:E,verticalAlign:b,paraSpacing:x,autoSizeAlign:S}=d;let{x:_,y:k,width:z,height:D}=f,T=v*p+(x?x*(c.paraNumber-1):0),O=m;if(w&&T>D)T=Math.max(D,v),p>1&&(c.overflow=p);else if(D||S)switch(b){case"middle":k+=(D-T)/2;break;case"bottom":k+=D-T}O+=k;let B,N,q,me=z||S?z:c.maxWidth;for(let nt=0,yi=p;nt<yi;nt++){if(B=u[nt],B.x=_,B.width<z||B.width>z&&!w)switch(E){case"center":B.x+=(me-B.width)/2;break;case"right":B.x+=me-B.width}B.paraStart&&x&&nt>0&&(O+=x),B.y=O,O+=v,c.overflow>nt&&O>T&&(B.isOverflow=!0,c.overflow=nt+1),N=B.x,q=B.width,g<0&&(B.width<0?(q=-B.width+d.fontSize+g,N-=q,q+=d.fontSize):q-=g),N<f.x&&(f.x=N),q>f.width&&(f.width=q),w&&z&&z<q&&(B.isOverflow=!0,c.overflow||(c.overflow=u.length))}f.y=k,f.height=T}(l,t),function(c,d,u){const{rows:f}=c,{textAlign:p,paraIndent:v,letterSpacing:m}=d;let g,w,E,b,x,S;f.forEach(_=>{_.words&&(E=v&&_.paraStart?v:0,S=_.words.length,w=u&&(p==="justify"||p==="both")&&S>1?(u-_.width-E)/(S-1):0,b=m||_.isOverflow?0:w>.01?1:2,_.isOverflow&&!m&&(_.textMode=!0),b===2?(_.x+=E,function(k){k.text="",k.words.forEach(z=>{z.data.forEach(D=>{k.text+=D.char})})}(_)):(_.x+=E,g=_.x,_.data=[],_.words.forEach((k,z)=>{b===1?(x={char:"",x:g},g=function(D,T,O){return D.forEach(B=>{O.char+=B.char,T+=B.width}),T}(k.data,g,x),(_.isOverflow||x.char!==" ")&&_.data.push(x)):g=function(D,T,O,B){return D.forEach(N=>{(B||N.char!==" ")&&(N.x=T,O.push(N)),T+=N.width}),T}(k.data,g,_.data,_.isOverflow),!w||_.paraEnd&&p!=="both"||z===S-1||(g+=w,_.width+=w)})),_.words=null)})}(l,t,n),l.overflow&&function(c,d,u,f){if(!f)return;const{rows:p,overflow:v}=c;let{textOverflow:m}=d;if(p.splice(v),m&&m!=="show"){let g,w;m==="hide"?m="":m==="ellipsis"&&(m="...");const E=m?y.canvas.measureText(m).width:0,b=u+f-E;(d.textWrap==="none"?p:[p[v-1]]).forEach(x=>{if(x.isOverflow&&x.data){let S=x.data.length-1;for(let _=S;_>-1&&(g=x.data[_],w=g.x+g.width,!(_===S&&w<b));_--){if(w<b&&g.char!==" "||!_){x.data.splice(_+1),x.width-=g.width;break}x.width-=g.width}x.width+=E,x.data.push({char:m,x:w}),x.textMode&&function(_){_.text="",_.data.forEach(k=>{_.text+=k.char}),_.data=null}(x)}})}}(l,t,e,n),r!=="none"&&function(c,d){let u;const{fontSize:f,textDecoration:p}=d;switch(c.decorationHeight=f/11,J(p)?(u=p.type,p.color&&(c.decorationColor=I.string(p.color))):u=p,u){case"under":c.decorationY=[.15*f];break;case"delete":c.decorationY=[.35*-f];break;case"under-delete":c.decorationY=[.15*f,.35*-f]}}(l,t),l}},Ys={string:function(s,t){const e=Mi(t)&&t<1;if(tt(s)){if(!e||!I.object)return s;s=I.object(s)}let i=st(s.a)?1:s.a;e&&(i*=t);const n=s.r+","+s.g+","+s.b;return i===1?"rgb("+n+")":"rgba("+n+","+i+")"}};Object.assign(Di,Gs),Object.assign(I,Ys),Object.assign(ni,ns),Object.assign(Bt,gs),Object.assign(Wt,xs),Object.assign(Oi,ks),Object.assign(lt,{interaction:(s,t,e,i)=>new Qi(s,t,e,i),hitCanvas:(s,t)=>new oi(s,t),hitCanvasManager:()=>new Wi}),Ui();
