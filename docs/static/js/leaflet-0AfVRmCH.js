import{c as b}from"./element-plus-GEy8-a9f.js";import{l as c}from"./leaflet-dgfGk-q1.js";import"./leaflet.chinatmsproviders-MeioCgZa.js";import{s as M,r as A,l as C,B as V,d as O,e as S,b as Z,c as I,V as B,Q as R,aw as j,ax as $,a as F,o as G,u as z}from"./@vue-1pEateLc.js";import{l as W,p as X,d as Y}from"./@turf-VZU31W4K.js";import{V as Q}from"./@element-plus-GFHZwatb.js";import{_ as U}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const q=(i,t)=>{const e=M(null),l=c.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),f=c.layerGroup([l]);let a=null,u="start",p=null;const d=M([]),h=M([]),g=A(0),L=()=>{const r=c.latLng(-90,-180),o=c.latLng(90,180),n=c.latLngBounds(r,o),s=c.canvas();e.value=new c.Map(i,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[f],maxBounds:n,renderer:s,crs:c.CRS.EPSG3857,zoomControl:!1})},y=()=>{var r;if(t!=null&&t.length){const o=[];if(t.forEach(s=>{o.push({lng:s.pointData[0].lon,lat:s.pointData[0].lat}),c.circleMarker({lat:s.pointData[0].lat,lng:s.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:10}).bindTooltip(s.name,{permanent:!0,direction:"top",className:"my-custom-tooltip"}).addTo(e.value)}),t.length===1){const s=t[0].pointData[0];a=c.polyline([[s.lat-.003,s.lon-.01],[s.lat-.003,s.lon+.01]],{color:"red"}).addTo(e.value),o.push(a.getLatLngs())}const n=c.latLngBounds(o);if((r=e.value)==null||r.fitBounds(n,{padding:[10,10]}),t.length>1){const s=n.getNorthWest(),m=n.getSouthWest(),v=n.getNorthEast(),T=n.getSouthEast();a=c.polyline([[(s.lat+m.lat)/2,s.lng-e.value.getZoom()*.1],[(v.lat+T.lat)/2,v.lng+e.value.getZoom()*.1]],{color:"red"}).addTo(e.value)}k()}},x=()=>{var r,o;(r=e.value)==null||r.on("click",P),(o=e.value)==null||o.on("mousemove",w)},P=r=>{if(u==="start"){a&&(h.value.forEach(n=>{n.remove()}),a.remove());const o=r.latlng;p=o,a=c.polyline([o,o],{color:"red",weight:3,dashArray:"5,5"}).addTo(e.value),u="drawing"}else if(u==="drawing"){const o=r.latlng;a==null||a.setLatLngs([p,o]),a==null||a.setStyle({dashArray:void 0}),u="start"}},w=r=>{u==="drawing"&&p&&(a==null||a.setLatLngs([p,r.latlng]))},D=()=>{var r,o;(r=e.value)==null||r.off("click",P),(o=e.value)==null||o.off("mousemove",w)},E=()=>{e.value&&e.value.remove()},k=()=>{if(a){d.value=[];const r=a.getLatLngs().map(n=>[n.lng,n.lat]),o=W(r);if(t==null||t.forEach((n,s)=>{const m=K([n.pointData[0].lon,n.pointData[0].lat],o.geometry.coordinates[0],o.geometry.coordinates[1]);m&&d.value.push({point:m,...n})}),d.value.length===1){const n=_(o,d.value[0].point);Reflect.set(d.value[0],"distance",n)}else d.value.sort((n,s)=>{const m=_(o,n.point);Reflect.set(n,"distance",m);const v=_(o,s.point);return Reflect.set(s,"distance",v),m-v});g.value=_(o,o.geometry.coordinates[1]),d.value.forEach((n,s)=>{h.value[s]=c.circleMarker([n.point[1],n.point[0]],{stroke:!0,color:"#fff",fillColor:"green",fill:!0,fillOpacity:1,radius:5}).bindTooltip(`${s+1}`,{permanent:!0,direction:"top"}).addTo(e.value)})}};function _(r,o){const n=r.geometry.coordinates[0],s=X(o);return Y(n,s,{units:"kilometres"})}return C(()=>{L(),y()}),V(()=>{E()}),{map:e,drawLine:x,nearestPoints:d,getNearestPointOnLine:k,removeLinsener:D,lineLength:g}};function N(i,t){return i[0]*t[0]+i[1]*t[1]}function H(i,t,e){const l=[e[0]-t[0],e[1]-t[1]],f=[i[0]-t[0],i[1]-t[1]],a=N(f,l)/N(l,l),u=[l[0]*a,l[1]*a];return[t[0]+u[0],t[1]+u[1]]}function J(i,t,e){const[l,f]=i,[a,u]=t,[p,d]=e;return l>=Math.min(a,p)&&l<=Math.max(a,p)&&f>=Math.min(u,d)&&f<=Math.max(u,d)}function K(i,t,e){const l=H(i,t,e);return J(l,t,e)?l:null}const tt=i=>(j("data-v-d502fb33"),i=i(),$(),i),ot={class:"leaflet-container"},et=tt(()=>F("div",{id:"map",class:"h-full w-full"},null,-1)),nt={name:""},at=O({...nt,props:{data:{type:Array,default:()=>[]}},emits:["getPoints"],setup(i,{emit:t}){const e=i,l=S({drawing:!1}),f=Z(()=>l.drawing?"var(--el-color-primary)":"var(--el-color-info)"),{map:a,drawLine:u,nearestPoints:p,getNearestPointOnLine:d,removeLinsener:h,lineLength:g}=q("map",e.data),L=t,y=()=>{l.drawing=!l.drawing,l.drawing?u():(h(),d(),L("getPoints",p,g))};return C(()=>{L("getPoints",p,g)}),(x,P)=>{const w=b;return G(),I("div",ot,[et,B(w,{color:f.value,class:"draw-icon",onClick:y},{default:R(()=>[B(z(Q))]),_:1},8,["color"])])}}}),yt=U(at,[["__scopeId","data-v-d502fb33"]]);export{yt as default};
