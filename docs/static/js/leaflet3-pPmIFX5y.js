import{l as S,c as V}from"./element-plus-GEy8-a9f.js";import{s as O,B as H,d as U,e as F,r as K,w as q,l as G,n as L,c as M,a as _,S as B,T as Q,V as z,Q as $,K as X,aw as Y,ax as j,o as D,X as R,W as N,u as A}from"./@vue-1pEateLc.js";import{l as p}from"./leaflet-dgfGk-q1.js";import"./leaflet.chinatmsproviders-MeioCgZa.js";import{p as J,q as W}from"./@element-plus-GFHZwatb.js";import{_ as ee}from"./plugin-vueexport-helper-x3n3nnut.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";const te=""+new URL("../png/image-BQhIfE8b.png",import.meta.url).href,ae=(m,u)=>{const e=O(null),d=p.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:4}),v=p.layerGroup([d]);let f=[],C=[];const E=()=>{const t=p.latLng(-90,-180),a=p.latLng(90,180),o=p.latLngBounds(t,a),n=p.canvas();e.value=new p.Map(m,{maxZoom:18,minZoom:4,zoom:14,attributionControl:!1,layers:[v],maxBounds:o,renderer:n,crs:p.CRS.EPSG3857,zoomControl:!1,doubleClickZoom:!1}),e.value.createPane("labelPane").style.zIndex="400",e.value.createPane("circlePane").style.zIndex="401"},b=t=>{var a;if(t!=null&&t.length){y(t);const o=I(t),n=p.latLngBounds(o);(a=e.value)==null||a.fitBounds(n,{padding:[5,5]})}},I=t=>{const a=[];return t.forEach(o=>{var l;a.push({lng:o.pointData[0].lon,lat:o.pointData[0].lat});const n=p.circleMarker({lat:o.pointData[0].lat,lng:o.pointData[0].lon},{stroke:!0,color:"#fff",fillColor:"red",fill:!0,fillOpacity:1,radius:8,data:{name:o.name,id:o.businessId,checked:(l=u.value)==null?void 0:l.includes(o.businessId)},pane:"circlePane"}).addTo(e.value);f.push(n),n.on("click",s)}),a},y=t=>{t.forEach(a=>{var l,c;const o=p.divIcon({html:`<div class='tooltip-content'>${a.name}</div>`,className:(l=u.value)!=null&&l.includes(a.businessId)?"tooltip":""}),n=p.marker([a.pointData[0].lat,a.pointData[0].lon],{icon:o,data:{name:a.name,id:a.businessId,checked:(c=u.value)==null?void 0:c.includes(a.businessId)},pane:"labelPane"}).addTo(e.value);C.push(n),n.on("click",s)})},s=t=>{const a=t.target.options.data,{id:o}=a,n=C.find(h=>h.options.data.id===o),l=f.find(h=>h.options.data.id===o),c=!a.checked;if(c&&u.value.length+1>3){S.warning("最多只能选择3口井");return}if(!c&&u.value.length-1===0){S.warning("最少选择1口井");return}n.options.data.checked=c,l.options.data.checked=c,c?i(n,a,!0):i(n,a,!1)},i=(t,a,o=!1)=>{const{id:n}=a,l=t.options.icon;if(o)l.options.className="tooltip",u.value.push(n);else{l.options.className="";const c=u.value.indexOf(n);c>-1&&u.value.splice(c,1)}t.setIcon(l)},r=()=>{e.value&&(f.forEach(t=>{t.off("click",s)}),C.forEach(t=>{t.off("click",s)}),f=[],C=[],e.value.remove())};return H(()=>{r()}),{map:e,checked:u,drawPoint:b,initMap:E,destroyMap:r}},oe=(m,u)=>{const e=O(),d={max:1e7,min:100},v=()=>{var s;e.value=new Cesium.Viewer(m,{geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,homeButton:!1,animation:!1,fullscreenButton:!1,timeline:!1,scene3DOnly:!0,infoBox:!1,requestRenderMode:!0,sceneMode:Cesium.SceneMode.SCENE3D,selectionIndicator:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"}))}),e.value.scene.screenSpaceCameraController.minimumZoomDistance=d.min,e.value.scene.screenSpaceCameraController.maximumZoomDistance=d.max,e.value.cesiumWidget.creditContainer.style.display="none",e.value.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"http://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})),e.value.resolutionScale=window.devicePixelRatio,e.value.scene.postProcessStages.fxaa.enabled=!0,e.value.screenSpaceEventHandler.setInputAction(()=>{},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.value.screenSpaceEventHandler.setInputAction(i=>{var t;const r=(t=e.value)==null?void 0:t.scene.pick(i.endPosition);r&&r.id?e.value._container.style.cursor="pointer":e.value._container.style.cursor="default"},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.value.screenSpaceEventHandler.setInputAction(i=>{var t,a;const r=(t=e.value)==null?void 0:t.scene.pick(i.position);if(r&&r.id){const o=r.id,n=o.properties.checked.valueOf(),l=o.id;if(n&&u.value.length-1===0){S.warning("最少选择1口井");return}if(!n&&u.value.length+1>3){S.warning("最多只能选择3口井");return}n?(u.value.splice(u.value.indexOf(l),1),o.properties.checked=!1,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.BLACK),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.WHITE.withAlpha(.8))):(u.value.push(l),o.properties.checked=!0,o.label.fillColor=new Cesium.ConstantProperty(Cesium.Color.WHITE),o.label.backgroundColor=new Cesium.ConstantProperty(Cesium.Color.fromCssColorString("#409eff").withAlpha(.8))),(a=e.value)==null||a.scene.requestRender()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),((s=e.value)==null?void 0:s.scene.screenSpaceCameraController).zoomEventTypes=[],document.addEventListener("wheel",y,{passive:!1})},f=s=>{var t;const i=s.map(a=>({lon:a.pointData[0].lon,lat:a.pointData[0].lat})),r=C(i);(t=e.value)==null||t.camera.setView({destination:r})},C=s=>{let i=Cesium.Math.toRadians(1/0),r=Cesium.Math.toRadians(-1/0),t=Cesium.Math.toRadians(1/0),a=Cesium.Math.toRadians(-1/0);return s.forEach(n=>{const l=Cesium.Math.toRadians(n.lon),c=Cesium.Math.toRadians(n.lat);l<i&&(i=l),l>r&&(r=l),c<t&&(t=c),c>a&&(a=c)}),new Cesium.Rectangle(i-.055,t-.055,r+.055,a+.055)},E=s=>{const i=Cesium.Cartesian3.fromDegrees(s.pointData[0].lon,s.pointData[0].lat),r=u.value.includes(s.businessId)?Cesium.Color.WHITE:Cesium.Color.BLACK,t=u.value.includes(s.businessId)?Cesium.Color.fromCssColorString("#409eff").withAlpha(.8):Cesium.Color.WHITE.withAlpha(.8);e.value.entities.add({position:i,name:s.name,id:s.businessId,properties:{checked:u.value.includes(s.businessId)},point:{pixelSize:12,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:s.name,font:"12px",scale:.8,pixelOffset:new Cesium.Cartesian2(0,-18),fillColor:r,backgroundColor:t,showBackground:!0,outlineWidth:0}})},b=s=>{s.forEach(i=>{E(i)})},I=()=>{var s,i;document.removeEventListener("wheel",y),(s=e.value)==null||s.entities.removeAll(),(i=e.value)==null||i.destroy(),e.value=void 0},y=s=>{var t,a,o,n;s.preventDefault();const i=Math.sign(s.deltaY),r=5;i>0?(a=e.value)==null||a.camera.zoomOut(((t=e.value)==null?void 0:t.camera.positionCartographic.height)/r):(n=e.value)==null||n.camera.zoomIn(((o=e.value)==null?void 0:o.camera.positionCartographic.height)/r)};return H(()=>{I()}),{viewer:e,init:v,setCameraPosition:f,drawCesiumPoint:b}},ne=m=>(Y("data-v-c50f9740"),m=m(),j(),m),se={class:"map"},ie={key:0,id:"map",class:"h-full w-full"},le={key:1,id:"cesium",class:"h-full w-full"},re={class:"action"},ce=ne(()=>_("div",{class:"direction"},[_("span",null,"北"),_("img",{src:te,alt:""})],-1)),ue={class:"trigger"},de={name:""},pe=U({...de,props:{data:{type:Array,default:()=>[]}},emits:["checked"],setup(m,{emit:u}){const e=m,d=F({isCollpased:!1,type:"2d"}),v=K(["1676779130877161474"]),{drawPoint:f,initMap:C,destroyMap:E}=ae("map",v),{init:b,setCameraPosition:I,drawCesiumPoint:y}=oe("cesium",v),s=u;q(()=>v.value,t=>{i(t)},{deep:!0});const i=t=>{const a=[];t.forEach(o=>{let n=0,l=0,c=0,h=0;const w=e.data.find(k=>k.businessId===o);if(w){const k=w.info.map((g,x)=>{if(x===0)return c=g.size,h=g.size,{...g,width:0,height:0};{c=Math.max(g.size,w.info[x-1].size,c),h=Math.min(g.size,w.info[x-1].size,h);const T=g.tvd-w.info[x-1].tvd,P=g.md-w.info[x-1].md;n+=P;const Z=Number((P*P-T*T).toFixed(2));return l+=Z,{...g,width:l,height:n}}});a.push({...w,info:k,length:Number(l.toFixed(2)),distance:Number(n.toFixed(2)),maxSize:c,minSize:h})}}),s("checked",a)},r=()=>{d.type==="3d"?(d.type="2d",E(),L(()=>{C(),f(e.data)})):(d.type="3d",L(()=>{b(),I(e.data),y(e.data)}))};return G(()=>{d.type==="3d"?L(()=>{b(),I(e.data),y(e.data)}):(C(),f(e.data)),i(v.value)}),(t,a)=>{const o=V;return D(),M("div",{class:X(["leaflet-container",{collpased:d.isCollpased}])},[_("div",se,[d.type==="2d"?(D(),M("div",ie)):B("",!0),d.type==="3d"?(D(),M("div",le)):B("",!0)]),_("div",re,[ce,_("div",{class:"type",onClick:r},Q(d.type==="2d"?"3D":"2D"),1)]),_("div",ue,[z(o,{class:"trigger-icon",onClick:a[0]||(a[0]=n=>d.isCollpased=!d.isCollpased)},{default:$(()=>[R(z(A(J),null,null,512),[[N,!d.isCollpased]]),R(z(A(W),null,null,512),[[N,d.isCollpased]])]),_:1})])],2)}}}),Le=ee(pe,[["__scopeId","data-v-c50f9740"]]);export{Le as default};
