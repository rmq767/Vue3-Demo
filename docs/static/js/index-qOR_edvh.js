import{f as K,g as W,h as Z,j as ee,k as te,l as ae,m as le,a as q,n as ne,o as oe,p as se,q as re}from"./element-plus-DRy_UtcF.js";import{d as N,r as R,e as O,c as C,o as f,R as r,J as i,a as V,Q as M,a6 as S,P as ie,I as T,F as de,L,C as F,a5 as ce,al as ue,u as P,O as B,n as pe}from"./@vue-DtXbQ2UY.js";import{_ as D}from"./plugin-vueexport-helper-DlAUqK2U.js";import{j as me,M as fe}from"./@element-plus-dWmgPpBK.js";import"./lodash-es-CVJ_Bk8S.js";import"./@vueuse-ZySg_D90.js";import"./@sxzz-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B7BNuc5J.js";import"./@turf-n0MF4LHv.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-D0iZPv2f.js";const _e={class:"fn-panel"},be={class:"operation"},ve=["title","onClick"],xe={class:"operation"},ge=["title","onClick","innerHTML"],ye={name:"FnPanel"},ke=N({...ye,emits:["getValue"],setup(w,{emit:k}){const g=R(["1","2"]),n=O({operation:[{label:"=",value:"=",key:"=",index:1,desc:"等于"},{label:"+",value:"+",key:"+",index:1,desc:"加"},{label:"-",value:"-",key:"-",index:1,desc:"减"},{label:"*",value:"*",key:"*",index:1,desc:"乘"},{label:"/",value:"/",key:"/",index:1,desc:"除"},{label:"^",value:"^",key:"^",index:1,desc:"幂"},{label:"(",value:"(",key:"(",index:1,desc:"左括号"},{label:")",value:")",key:")",index:1,desc:"右括号"}],fn:[{label:"exp()",value:"exp()",desc:"e为底的指数函数"},{label:"sqrt()",value:"sqrt()",desc:"平方根"},{label:"ln()",value:"ln()",desc:"e为底的对数"},{label:"log10()",value:"log10()",desc:"10为底的对数"},{label:"log2()",value:"log2()",desc:"2为底的对数"},{label:"abs()",value:"abs()",desc:"绝对值"},{label:"sin()",value:"sin()",desc:"正弦函数"},{label:"cos()",value:"cos()",desc:"余弦函数"},{label:"tan()",value:"tan()",desc:"正切函数"},{label:"asin()",value:"asin()",desc:"反正弦函数"},{label:"acos()",value:"acos()",desc:"反余弦函数"},{label:"atan()",value:"atan()",desc:"反正切函数"}]}),d=k,e=(t,m)=>{d("getValue",{item:m,type:t})};return(t,m)=>{const E=W,h=K;return f(),C("div",_e,[r(h,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=l=>g.value=l)},{default:i(()=>[r(E,{title:"运算符",name:"1"},{default:i(()=>[V("div",be,[(f(!0),C(M,null,S(n.operation,l=>(f(),C("div",{key:l.value,title:l.desc,tabindex:-1,onClick:_=>e("operation",l)},ie(l.value),9,ve))),128))])]),_:1}),r(E,{title:"函数",name:"2"},{default:i(()=>[V("div",xe,[(f(!0),C(M,null,S(n.fn,l=>(f(),C("div",{key:l.value,title:l.desc,onClick:_=>e("fn",l),tabindex:-1,innerHTML:l.value},null,8,ge))),128))])]),_:1})]),_:1},8,["modelValue"])])}}}),he=D(ke,[["__scopeId","data-v-05c7e2e6"]]),I=N({__name:"index",props:{data:{},column:{},index:{type:Boolean,default:!0},radio:{type:Boolean,default:!1}},setup(w,{expose:k}){const g=w,n=R(),d=[{color:"#F56C6C",percentage:50},{color:"#E6A23C",percentage:60},{color:"#409EFF",percentage:80},{color:"#67C23A",percentage:100}];return k({tableRef:n}),(e,t)=>{const m=ee,E=te,h=Z;return f(),T(h,de({ref_key:"tableRef",ref:n,data:g.data},e.$attrs),{default:i(()=>[g.index?(f(),T(m,{key:0,align:"center",label:"序号",type:"index",width:"60"})):L("",!0),g.radio?(f(),T(m,{key:1,align:"center",label:"单选",width:"60"},{default:i(({row:l})=>[F(e.$slots,"radio",{row:l})]),_:3})):L("",!0),(f(!0),C(M,null,S(e.column,l=>(f(),T(m,{key:l.label,prop:l.prop,label:l.label,width:l.width,align:"center","column-key":l.prop,filters:l.filters},ce({_:2},[l.template==="progress"?{name:"default",fn:i(({row:_})=>[r(E,{"text-inside":!0,"stroke-width":16,percentage:_[l.prop]<=1?_[l.prop]*100:_[l.prop],color:_.color?_.color:d},null,8,["percentage","color"])]),key:"0"}:l.slot?{name:"default",fn:i(({row:_})=>[F(e.$slots,l.slot,{row:_})]),key:"1"}:void 0]),1032,["prop","label","width","column-key","filters"]))),128)),F(e.$slots,"default")]),_:3},16,["data"])}}}),Ce={class:"check"},Ee={class:"mb-1 mt-4"},Te={name:"CreateFn"},Re=N({...Te,emits:["submit"],setup(w,{expose:k,emit:g}){const n=O({visible:!1,fn:"",search:"",activeTab:"1",tableData:[{abbreviation:"y",name:"Y参数",id:"1"},{abbreviation:"x",name:"X参数",id:"2"},{abbreviation:"a",name:"A参数",id:"3"},{abbreviation:"b",name:"B参数",id:"4"}],column:[{label:"参数缩写",prop:"abbreviation"},{label:"参数名称",prop:"name"},{label:"参数单位",prop:"unit"},{label:"默认取值范围",prop:"range"},{label:"创建人",prop:"creator"},{label:"参数解释",prop:"remark"}],type:"combo"}),d=R();let e,t=null;const m=R(),E=R();let h;const l=g,_=o=>{t=window.getSelection(),e=t==null?void 0:t.getRangeAt(0).cloneRange()},H=o=>{j(o)},U=({item:o,type:a})=>{const c=document.createTextNode(o.value);e==null||e.deleteContents(),e==null||e.insertNode(c),e==null||e.setStartAfter(c),e==null||e.setEndAfter(c),e==null||e.collapse(!0),t==null||t.removeAllRanges(),t==null||t.addRange(e)},j=o=>{let a=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${o.id}">`,c="</span>",u=document.createElement("span");u.innerHTML=a+o.abbreviation+c;let s=document.createDocumentFragment().appendChild(u.firstChild);e==null||e.deleteContents(),e==null||e.insertNode(s),e==null||e.setStartAfter(s),e==null||e.collapse(!0),t==null||t.removeAllRanges(),t==null||t.addRange(e)},X=()=>{var b;const o=(b=d.value)==null?void 0:b.getElementsByClassName("fn-param");let a=d.value.innerHTML,c=/<span class="fake" contenteditable="false">[\s\S]*?<\/span>/g;a=a.replace(c,"");const u=[];if(o)for(let s=0;s<o.length;s++){const p=o[s],v=a.indexOf(p.outerHTML);u.push({name:p.innerText,id:p.dataset.param,index:v}),a=a.replace(p.outerHTML,p.innerText)}return{text:d.value.innerText,params:u}},G=()=>{const{text:o,params:a}=X();if(o.length===0){re.warning("请编辑函数内容！");return}console.log(o,a),l("submit",{text:o,params:a}),$()},J=o=>{const{fn:a,params:c}=o;let u=a,b=0;c.forEach(s=>{const x=`<span contenteditable="false" disabled="disabled" class="el-tag el-tag--primary el-tag--small fn-param" data-param="${s.id}">`+s.name+"</span>";u=u.replaceAll(s.name,(y,A)=>A===s.index+b?x:y),b+=x.length-s.name.length}),pe(()=>{d.value.innerHTML=u})},Q=()=>{h=new MutationObserver((o,a)=>{for(const c of o)c.type==="characterData"&&setTimeout(()=>{var b;const u=d.value.lastChild;if(u&&u.nodeType===Node.TEXT_NODE){const s=(b=d.value)==null?void 0:b.childNodes;s==null||s.forEach(y=>{var A;y.className==="fake"&&((A=d.value)==null||A.removeChild(y))});const p=document.createRange();p.setStartAfter(u),p.setEndAfter(u);const v=document.createElement("span");v.className="fake",v.contentEditable="false",v.textContent="​",p.deleteContents(),p.insertNode(v),p.setStartAfter(v),p.setEndAfter(v);const x=window.getSelection();x==null||x.removeAllRanges(),x==null||x.addRange(p)}},100)}),h.observe(d.value,{characterData:!0,subtree:!0})},Y=(o,a)=>{n.type=o,n.visible=!0,a&&J(a),!a&&setTimeout(()=>{var c;(c=d.value)==null||c.focus(),Q()},0)},$=()=>{n.fn="",n.search="",d.value.innerHTML="",n.visible=!1,h==null||h.disconnect()},z=(o,a)=>{console.log(o,a)};return k({open:Y}),(o,a)=>{const c=q,u=le,b=ae,s=ne,p=se,v=oe,x=ue("MyDialog");return f(),T(x,{modelValue:n.visible,"onUpdate:modelValue":a[2]||(a[2]=y=>n.visible=y),title:"函数编辑器",fullscreen:"",onClose:$,onCancel:$,onSubmit:G},{default:i(()=>[r(b,{gutter:20},{default:i(()=>[r(u,{span:12,class:"panel"},{default:i(()=>[V("div",{ref_key:"textRef",ref:d,class:"fn-editor",contenteditable:"true",onBlur:_},null,544),V("div",Ce,[r(c,{type:"primary",icon:P(me)},{default:i(()=>[...a[3]||(a[3]=[B("函数校验",-1)])]),_:1},8,["icon"])])]),_:1}),r(u,{span:12},{default:i(()=>[r(he,{onGetValue:U})]),_:1})]),_:1}),V("div",Ee,[r(s,{modelValue:n.search,"onUpdate:modelValue":a[0]||(a[0]=y=>n.search=y),style:{width:"300px"},placeholder:"参数名称"},{append:i(()=>[r(c,{icon:P(fe)},null,8,["icon"])]),_:1},8,["modelValue"])]),r(v,{modelValue:n.activeTab,"onUpdate:modelValue":a[1]||(a[1]=y=>n.activeTab=y),onTabClick:z},{default:i(()=>[r(p,{label:"函数参数库",name:"1"},{default:i(()=>[r(I,{ref_key:"tableRef1",ref:m,data:n.tableData,column:n.column,"highlight-current-row":"",onRowClick:H},null,8,["data","column"])]),_:1}),n.type==="basic"?(f(),T(p,{key:0,label:"组合函数库",name:"2"},{default:i(()=>[r(I,{ref_key:"tableRef2",ref:E,data:n.tableData,column:n.column,"highlight-current-row":"",onRowClick:H},null,8,["data","column"])]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ve=D(Re,[["__scopeId","data-v-118b91cc"]]),we={class:"fn-editor-container"},Ae={name:"FnEditor"},Ne=N({...Ae,setup(w){const k=R(),g=({text:e,params:t})=>{console.log(e,t)},n=()=>{var e;(e=k.value)==null||e.open("basic")},d=()=>{var t;const e={fn:"y=exp(x)+sqrt(a)a",params:[{name:"y",id:"1",index:0},{name:"x",id:"2",index:6},{name:"a",id:"3",index:14}]};(t=k.value)==null||t.open("combo",e)};return(e,t)=>{const m=q;return f(),C("div",we,[r(m,{type:"primary",onClick:n},{default:i(()=>[...t[0]||(t[0]=[B("编辑函数",-1)])]),_:1}),r(m,{type:"warning",onClick:d},{default:i(()=>[...t[1]||(t[1]=[B("修改函数",-1)])]),_:1}),r(Ve,{ref_key:"fnEditorRef",ref:k,onSubmit:g},null,512)])}}}),Xe=D(Ne,[["__scopeId","data-v-8da8daed"]]);export{Xe as default};
