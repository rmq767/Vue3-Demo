import{o as So}from"./mobx-preact-Bh0rinU2.js";import{u as x,x as V,_ as ro,b as Jr,n as rn}from"./preact-Dv5xcXl8.js";import{a as Y,c as L,m as Ve,g as dr,n as vr,p as qt,f as W,t as Ct,b as Pt,d as Ht,i as ee,e as dt,s as wo,h as Ao,j as nn,k as wr,l as Po,o as no,q as To,r as Do,u as on,v as No,w as Ar,x as bo,y as Co}from"./lodash-es-CVJ_Bk8S.js";import{c as Lo,t as Et,i as oo,s as jo,o as E,a as F,b as m,r as Ro}from"./mobx-DdXfW9UA.js";import{v as Io}from"./uuid-Dj2d8qur.js";import{c as Bo}from"./classnames-D_grozVF.js";import{M as ko}from"./mousetrap-CvuvAstW.js";import{d as Xo}from"./mobx-utils-CAWeVucu.js";var Yo=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t},xe;(function(n){function e(t){var r=Yo(t,[]),o=t.container;if(!o)throw new Error("Ensure the container of LogicFlow is specified and valid.");return Y({},n.defaults,r)}n.get=e})(xe||(xe={}));(function(n){n.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(xe||(xe={}));var an={node:!1,edge:!1},Ho={node:!0,edge:!0},Go=function(n){return!n||typeof n=="boolean"?n===!0?L(Ho):L(an):Ve(L(an),n)},zo=function(){return dr(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function rt(n){try{return JSON.parse(JSON.stringify(n))}catch{return n}}var Ie=200,Fo=9999,$o=10,X;(function(n){n[n.DEFAULT=1]="DEFAULT",n[n.TEXT_EDIT=2]="TEXT_EDIT",n[n.SHOW_MENU=3]="SHOW_MENU",n[n.ALLOW_CONNECT=4]="ALLOW_CONNECT",n[n.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(X||(X={}));var U;(function(n){n.NODE="node",n.EDGE="edge",n.GRAPH="graph"})(U||(U={}));var R;(function(n){n.NODE="node",n.CIRCLE_NODE="circle-node",n.POLYGON_NODE="polygon-node",n.RECT_NODE="rect-node",n.TEXT_NODE="text-node",n.ELLIPSE_NODE="ellipse-node",n.DIAMOND_NODE="diamond-node",n.HTML_NODE="html-node",n.CUSTOM_HTML_NODE="custom-html-node",n.EDGE="edge",n.LINE_EDGE="line-edge",n.POLYLINE_EDGE="polyline-edge",n.BEZIER_EDGE="bezier-edge",n.GRAPH="graph"})(R||(R={}));var T;(function(n){n.ELEMENT_CLICK="element:click",n.NODE_ADD="node:add",n.NODE_DELETE="node:delete",n.NODE_CLICK="node:click",n.NODE_DBCLICK="node:dbclick",n.NODE_GROUP_COPY="node:group-copy-add",n.NODE_DND_ADD="node:dnd-add",n.NODE_DND_DRAG="node:dnd-drag",n.NODE_MOUSEDOWN="node:mousedown",n.NODE_DRAGSTART="node:dragstart",n.NODE_DRAG="node:drag",n.NODE_DROP="node:drop",n.NODE_MOUSEUP="node:mouseup",n.NODE_MOUSEMOVE="node:mousemove",n.NODE_MOUSEENTER="node:mouseenter",n.NODE_MOUSELEAVE="node:mouseleave",n.NODE_CONTEXTMENU="node:contextmenu",n.NODE_ROTATE="node:rotate",n.NODE_RESIZE="node:resize",n.NODE_FOCUS="node:focus",n.NODE_BLUR="node:blur",n.NODE_PROPERTIES_CHANGE="node:properties-change",n.NODE_PROPERTIES_DELETE="node:properties-delete",n.EDGE_ADD="edge:add",n.EDGE_DELETE="edge:delete",n.EDGE_CLICK="edge:click",n.EDGE_DBCLICK="edge:dbclick",n.EDGE_FOCUS="edge:focus",n.EDGE_BLUR="edge:blur",n.EDGE_MOUSEENTER="edge:mouseenter",n.EDGE_MOUSELEAVE="edge:mouseleave",n.EDGE_CONTEXTMENU="edge:contextmenu",n.EDGE_ADJUST="edge:adjust",n.EDGE_EXCHANGE_NODE="edge:exchange-node",n.ANCHOR_CLICK="anchor:click",n.ANCHOR_MOUSEDOWN="anchor:mousedown",n.ANCHOR_DRAGSTART="anchor:dragstart",n.ANCHOR_DRAG="anchor:drag",n.ANCHOR_DROP="anchor:drop",n.ANCHOR_DRAGEND="anchor:dragend",n.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",n.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",n.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",n.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",n.ADJUST_POINT_DRAG="adjustPoint:drag",n.ADJUST_POINT_DROP="adjustPoint:drop",n.ADJUST_POINT_DRAGEND="adjustPoint:dragend",n.BLANK_MOUSEDOWN="blank:mousedown",n.BLANK_DRAGSTART="blank:dragstart",n.BLANK_DRAG="blank:drag",n.BLANK_DROP="blank:drop",n.BLANK_MOUSEMOVE="blank:mousemove",n.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",n.BLANK_MOUSEUP="blank:mouseup",n.BLANK_CLICK="blank:click",n.BLANK_CONTEXTMENU="blank:contextmenu",n.SELECTION_MOUSEDOWN="selection:mousedown",n.SELECTION_DRAGSTART="selection:dragstart",n.SELECTION_DRAG="selection:drag",n.SELECTION_DROP="selection:drop",n.SELECTION_MOUSEMOVE="selection:mousemove",n.SELECTION_MOUSEUP="selection:mouseup",n.SELECTION_CONTEXTMENU="selection:contextmenu",n.CONNECTION_NOT_ALLOWED="connection:not-allowed",n.TEXT_MOUSEDOWN="text:mousedown",n.TEXT_DRAGSTART="text:dragstart",n.TEXT_DRAG="text:drag",n.TEXT_DROP="text:drop",n.TEXT_CLICK="text:click",n.TEXT_DBCLICK="text:dbclick",n.TEXT_BLUR="text:blur",n.TEXT_MOUSEMOVE="text:mousemove",n.TEXT_MOUSEUP="text:mouseup",n.TEXT_FOCUS="text:focus",n.TEXT_ADD="text:add",n.TEXT_UPDATE="text:update",n.TEXT_CLEAR="text:clear",n.LABEL_MOUSEDOWN="label:mousedown",n.LABEL_DRAGSTART="label:dragstart",n.LABEL_DRAG="label:drag",n.LABEL_DROP="label:drop",n.LABEL_CLICK="label:click",n.LABEL_DBCLICK="label:dbclick",n.LABEL_BLUR="label:blur",n.LABEL_MOUSEMOVE="label:mousemove",n.LABEL_MOUSEUP="label:mouseup",n.LABEL_FOCUS="label:focus",n.LABEL_ADD="label:add",n.LABEL_UPDATE="label:update",n.LABEL_CLEAR="label:clear",n.LABEL_DELETE="label:delete",n.LABEL_SHOULD_ADD="label:should-add",n.LABEL_BATCH_ADD="label:batch-add",n.LABEL_SHOULD_UPDATE="label:should-update",n.LABEL_SHOULD_DELETE="label:should-delete",n.LABEL_BATCH_DELETE="label:batch-delete",n.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",n.HISTORY_CHANGE="history:change",n.GRAPH_TRANSFORM="graph:transform",n.GRAPH_RENDERED="graph:rendered",n.GRAPH_UPDATED="graph:updated",n.EDIT_CONFIG_CHANGED="editConfig:changed"})(T||(T={}));var yt;(function(n){n[n.DEFAULT=0]="DEFAULT",n[n.INCREASE=1]="INCREASE"})(yt||(yt={}));var z;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(z||(z={}));var ft;(function(n){n.TEXT="text",n.LABEL="label"})(ft||(ft={}));var Uo=0,St=function(){function n(e){var t=e.onDragStart,r=t===void 0?vr:t,o=e.onDragging,i=o===void 0?vr:o,a=e.onDragEnd,s=a===void 0?vr:a,l=e.eventType,d=l===void 0?"":l,u=e.eventCenter,f=e.step,c=f===void 0?1:f,h=e.isStopPropagation,v=h===void 0?!0:h,p=e.model,g=e.data,y=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(_){var O,S,M=window==null?void 0:window.document;if(_.button===Uo){y.isStopPropagation&&_.stopPropagation(),y.isStartDragging=!0,y.startX=_.clientX,y.startY=_.clientY,M.addEventListener("mousemove",y.handleMouseMove,!1),M.addEventListener("mouseup",y.handleMouseUp,!1);var w=(O=y.model)===null||O===void 0?void 0:O.getData();(S=y.eventCenter)===null||S===void 0||S.emit(T["".concat(y.eventType,"_MOUSEDOWN")],{e:_,data:y.data||w}),y.startTime=new Date().getTime()}},this.handleMouseMove=function(_){var O,S;if(y.isStopPropagation&&_.stopPropagation(),!!y.isStartDragging&&(y.sumDeltaX+=_.clientX-y.startX,y.sumDeltaY+=_.clientY-y.startY,y.startX=_.clientX,y.startY=_.clientY,y.step<=1||Math.abs(y.sumDeltaX)>y.step||Math.abs(y.sumDeltaY)>y.step)){var M=y.sumDeltaX%y.step,w=y.sumDeltaY%y.step,A=y.sumDeltaX-M,D=y.sumDeltaY-w;y.sumDeltaX=M,y.sumDeltaY=w;var N=(O=y.model)===null||O===void 0?void 0:O.getData();y.isDragging||((S=y.eventCenter)===null||S===void 0||S.emit(T["".concat(y.eventType,"_DRAGSTART")],{e:_,data:y.data||N}),y.onDragStart({event:_})),y.isDragging=!0,Promise.resolve().then(function(){var j,G;y.onDragging({deltaX:A,deltaY:D,event:_}),(j=y.eventCenter)===null||j===void 0||j.emit(T["".concat(y.eventType,"_MOUSEMOVE")],{deltaX:A,deltaY:D,e:_,data:y.data||N}),(G=y.eventCenter)===null||G===void 0||G.emit(T["".concat(y.eventType,"_DRAG")],{e:_,data:y.data||N})})}},this.handleMouseUp=function(_){var O=window.document;y.isStartDragging=!1,y.isStopPropagation&&_.stopPropagation(),Promise.resolve().then(function(){var S,M,w;O.removeEventListener("mousemove",y.handleMouseMove,!1),O.removeEventListener("mouseup",y.handleMouseUp,!1);var A=(S=y.model)===null||S===void 0?void 0:S.getData();(M=y.eventCenter)===null||M===void 0||M.emit(T["".concat(y.eventType,"_MOUSEUP")],{e:_,data:y.data||A}),y.isDragging&&(y.isDragging=!1,y.onDragEnd({event:_}),(w=y.eventCenter)===null||w===void 0||w.emit(T["".concat(y.eventType,"_DROP")],{e:_,data:y.data||A}))})},this.cancelDrag=function(){var _=window==null?void 0:window.document;_.removeEventListener("mousemove",y.handleMouseMove,!1),_.removeEventListener("mouseup",y.handleMouseUp,!1),y.onDragEnd({event:void 0}),y.isDragging=!1},this.destroy=function(){y.isStartDragging&&y.cancelDrag()},this.onDragStart=r,this.onDragging=i,this.onDragEnd=s,this.step=c,this.isStopPropagation=v,this.eventType=d,this.eventCenter=u,this.model=p,this.data=g}return n.prototype.setStep=function(e){this.step=e},n.prototype.setModel=function(e){this.model=e},n}(),Wo=function(n){var e=n.x,t=n.y,r=n.width,o=n.height;return{x:e-r/2,y:t-o/2,x1:e+r/2,y1:t+o/2}},Zo=function(n){var e=n.startPoint,t=n.endPoint,r=(e.x+t.x)/2,o=(e.y+t.y)/2,i=Math.abs(e.x-t.x)+10,a=Math.abs(e.y-t.y)+10;return{x:r-i/2,y:o-a/2,x1:r+i/2,y1:o+a/2}},Ko=function(n){var e=n.points,t=Gt(e),r=Oe(t,8),o=r.x,i=r.y,a=r.width,s=r.height;return{x:o-a/2,y:i-s/2,x1:o+a/2,y1:i+s/2}},Vo=function(n){var e=n.path,t=Qr(e),r=Oe(t,8),o=r.x,i=r.y,a=r.width,s=r.height;return{x:o-a/2,y:i-s/2,x1:o+a/2,y1:i+s/2}},qo=function(n){if(n.modelType===R.LINE_EDGE)return Zo(n);if(n.modelType===R.POLYLINE_EDGE)return Ko(n);if(n.modelType===R.BEZIER_EDGE)return Vo(n)},Jo=function(n,e,t,r){var o=(e.y-n.y)*(r.x-t.x)-(n.x-e.x)*(t.y-r.y);if(o===0)return!1;var i=((e.x-n.x)*(r.x-t.x)*(t.y-n.y)+(e.y-n.y)*(r.x-t.x)*n.x-(r.y-t.y)*(e.x-n.x)*t.x)/o,a=-((e.y-n.y)*(r.y-t.y)*(t.x-n.x)+(e.x-n.x)*(r.y-t.y)*n.y-(r.x-t.x)*(e.y-n.y)*t.y)/o;return(i-n.x)*(i-e.x)<=0&&(a-n.y)*(a-e.y)<=0&&(i-t.x)*(i-r.x)<=0&&(a-t.y)*(a-r.y)<=0?{x:i,y:a}:!1},Ee=function(n,e,t){var r=n.x,o=n.y,i=e.x,a=e.y,s=t.x,l=t.y,d=(l-a)/(s-i),u=a-d*i;return(r>=i&&r<=s||r<=i&&r>=s)&&(o>=a&&o<=l||o<=a&&o>=l)&&Math.abs(o-d*r-u)<Number.EPSILON},Me=function(n){var e=n.start,t=n.end,r=n.offset,o=n.verticalLength,i=n.type,a={leftX:0,leftY:0,rightX:0,rightY:0},s=Math.atan((t.y-e.y)/(t.x-e.x)),l=Math.atan(r/o),d=Math.sqrt(o*o+r*r);return i==="start"?t.x>=e.x?(a.leftX=e.x+d*Math.sin(s+l),a.leftY=e.y-d*Math.cos(s+l),a.rightX=e.x-d*Math.sin(s-l),a.rightY=e.y+d*Math.cos(s-l)):(a.leftX=e.x-d*Math.sin(s+l),a.leftY=e.y+d*Math.cos(s+l),a.rightX=e.x+d*Math.sin(s-l),a.rightY=e.y-d*Math.cos(s-l)):i==="end"&&(t.x>=e.x?(a.leftX=t.x+d*Math.sin(s-l),a.leftY=t.y-d*Math.cos(s-l),a.rightX=t.x-d*Math.sin(s+l),a.rightY=t.y+d*Math.cos(s+l)):(a.leftX=t.x-d*Math.sin(s-l),a.leftY=t.y+d*Math.cos(s-l),a.rightX=t.x+d*Math.sin(s+l),a.rightY=t.y-d*Math.cos(s+l))),a},Jt=function(){return Jt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Jt.apply(this,arguments)},ut=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},bt=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},Qo=function(n,e){return Math.abs(n.centerX-e.centerX)*2<n.width+e.width&&Math.abs(n.centerY-e.centerY)*2<n.height+e.height},Pr=function(n){var e=[],t={};return n.forEach(function(r){var o="".concat(r.x,"-").concat(r.y);r.id=o,t[o]=r}),Object.keys(t).forEach(function(r){e.push(t[r])}),e},qe=function(n,e){return n.width===0&&n.height===0?n:{x:n.x,y:n.y,centerX:n.centerX,centerY:n.centerY,minX:n.minX-e,minY:n.minY-e,maxX:n.maxX+e,maxY:n.maxY+e,height:n.height+2*e,width:n.width+2*e}},ti=function(n,e){var t=Math.abs(n.x-e.centerX),r=Math.abs(n.y-e.centerY);return t/e.width>r/e.height?z.HORIZONTAL:z.VERTICAL},Je=function(n,e,t){var r=ti(t,e);return r===z.HORIZONTAL?{x:t.x>n.centerX?n.maxX:n.minX,y:t.y}:{x:t.x,y:t.y>n.centerY?n.maxY:n.minY}},sn=function(n,e){var t=Math.min(n.minX,e.minX),r=Math.min(n.minY,e.minY),o=Math.max(n.maxX,e.maxX),i=Math.max(n.maxY,e.maxY);return{x:(t+o)/2,y:(r+i)/2,centerX:(t+o)/2,centerY:(r+i)/2,minX:t,minY:r,maxX:o,maxY:i,height:i-r,width:o-t}},Oe=function(n,e){n===void 0&&(n=[]);var t=[],r=[];n.forEach(function(u){t.push(u.x),r.push(u.y)});var o=Math.min.apply(Math,bt([],ut(t),!1)),i=Math.max.apply(Math,bt([],ut(t),!1)),a=Math.min.apply(Math,bt([],ut(r),!1)),s=Math.max.apply(Math,bt([],ut(r),!1)),l=i-o,d=s-a;return e&&(l+=e,d+=e),{centerX:(o+i)/2,centerY:(a+s)/2,maxX:i,maxY:s,minX:o,minY:a,x:(o+i)/2,y:(a+s)/2,height:d,width:l}},Qe=function(n){var e=n.minX,t=n.minY,r=n.maxX,o=n.maxY;return[{x:e,y:t},{x:r,y:t},{x:r,y:o},{x:e,y:o}]},Be=function(n,e){var t=n.x,r=n.y;return t<e.minX||t>e.maxX||r<e.minY||r>e.maxY},ei=function(n,e){return e<n.minX||e>n.maxX?[]:[{x:e,y:n.minY},{x:e,y:n.maxY}]},ri=function(n,e){return e<n.minY||e>n.maxY?[]:[{x:n.minX,y:e},{x:n.maxX,y:e}]},ni=function(n,e){return bt(bt([],ut(ei(n,e.x)),!1),ut(ri(n,e.y)),!1)},Tr=function(n,e){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},oi=function(n,e){var t=-2,r=0;return e.forEach(function(o){o&&(n.x===o.x&&(r+=t),n.y===o.y&&(r+=t))}),r},ln=function(n,e,t,r,o){return Tr(n,e)+Tr(n,t)+oi(n,[e,t,r,o])},io=function(n,e,t,r,o){o||(o=0),n.unshift(e[r]),t[r]&&t[r]!==r&&o<=100&&io(n,e,t,t[r],o+1)},ii=function(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)},se=function(n,e,t,r){var o=e.x-n.x,i=e.y-n.y,a=r.x-t.x,s=r.y-t.y,l=(-i*(n.x-t.x)+o*(n.y-t.y))/(-a*i+o*s),d=(a*(n.y-t.y)-s*(n.x-t.x))/(-a*i+o*s);return l>=0&&l<=1&&d>=0&&d<=1},dn=function(n,e,t){if(t.width===0&&t.height===0)return!1;var r=ut(Qe(t),4),o=r[0],i=r[1],a=r[2],s=r[3];return se(n,e,o,i)||se(n,e,o,s)||se(n,e,i,a)||se(n,e,a,s)},ai=function(n,e,t,r){var o=[];return n.forEach(function(i){i!==e&&(i.x===e.x||i.y===e.y)&&!dn(i,e,t)&&!dn(i,e,r)&&o.push(i)}),Pr(o)},si=function(n,e,t,r,o,i,a){var s=[],l=[e],d={},u={},f={};e.id&&(u[e.id]=0,f[e.id]=ln(e,t,e));var c={};n.forEach(function(p){p.id&&(c[p.id]=p)});for(var h=function(){var p,g=1/0;if(l.forEach(function(_){_.id&&f[_.id]<g&&(g=f[_.id],p=_)}),p===t&&t.id){var y=[];return io(y,c,d,t.id),{value:y}}if(!p)return{value:[e,t]};ii(l,p),s.push(p),ai(n,p,r,o).forEach(function(_){if(s.indexOf(_)===-1&&(l.indexOf(_)===-1&&l.push(_),p!=null&&p.id&&(_!=null&&_.id))){var O=f[p.id]+Tr(p,_);if(u[_.id]&&O>=u[_.id])return;d[_.id]=p.id,u[_.id]=O,f[_.id]=u[_.id]+ln(_,t,e,i,a)}})};l.length;){var v=h();if(typeof v=="object")return v.value}return[e,t]},un=function(n){return it(n)},ao=function(n){for(var e=1;e<n.length-1;){var t=n[e-1],r=n[e],o=n[e+1];t.x===r.x&&r.x===o.x||t.y===r.y&&r.y===o.y?n.splice(e,1):e++}return n},fn=function(n,e,t,r,o){var i=un(t),a=un(r),s=qe(i,o),l=qe(a,o),d=Je(s,i,n),u=Je(l,a,e);if(Qo(s,l)){var f=di(n,e,d,u);return bt(bt([n,d],ut(f),!1),[u,e],!1)}var c=Oe([d,u]),h=sn(s,c),v=sn(l,c),p=[];p=p.concat(Qe(h)),p=p.concat(Qe(v));var g={x:(n.x+e.x)/2,y:(n.y+e.y)/2};[c,h,v].forEach(function(_){p=p.concat(ni(_,g).filter(function(O){return Be(O,s)&&Be(O,l)}))}),[{x:d.x,y:u.y},{x:u.x,y:d.y}].forEach(function(_){Be(_,s)&&Be(_,l)&&p.push(_)}),p.unshift(d),p.push(u),p=Pr(p);var y=si(p,d,u,i,a,n,e);return y.unshift(n),y.push(e),y.length>2&&(y=ao(y)),Pr(y)},li=function(n){if(n.length===1){var e=ut(n,1),t=e[0];return[t,t]}else{for(var r=n[0],o=n[1],i=gt(r.x,r.y,o.x,o.y),a=1;a<n.length-1;a++){var s=n[a],l=n[a+1],d=gt(s.x,s.y,l.x,l.y);d>i&&(i=d,r=s,o=l)}return[r,o]}},cn=function(n,e,t){var r=At(n,t),o=At(e,t);return r&&o},pn=function(n,e,t){var r=At(n,t),o=At(e,t),i=r&&o,a=r||o;return!i&&a},hn=function(n,e,t){for(var r=void 0,o=it(t),i=Qe(o),a=0;a<i.length;a++){var s=se(n,e,i[a],i[(a+1)%i.length]);s&&(r=[i[a],i[(a+1)%i.length]])}if(r)return Jo(n,e,r[0],r[1])},tr=function(n,e){var t=void 0;return n.x===e.x?t=z.VERTICAL:n.y===e.y&&(t=z.HORIZONTAL),t},Gt=function(n){var e=n.split(" "),t=[];return e&&e.forEach(function(r){var o=ut(r.split(","),2),i=o[0],a=o[1];t.push({x:Number(i),y:Number(a)})}),t},di=function(n,e,t,r){var o=[],i=tr(n,t),a=tr(e,r);if(i===a)n.y===t.y?(o.push({x:t.x,y:(t.y+r.y)/2}),o.push({x:r.x,y:(t.y+r.y)/2})):(o.push({x:(t.x+r.x)/2,y:t.y}),o.push({x:(t.x+r.x)/2,y:r.y}));else{var s={x:t.x,y:r.y},l=Ee(s,n,t),d=Ee(s,e,r);if(l||d)s={x:r.x,y:t.y};else{var u=vn(s,n,t),f=vn(s,e,r);u&&f&&(s={x:r.x,y:t.y})}o.push(s)}return o},vn=function(n,e,t){return n.x===e.x&&n.x===t.x||n.y===e.y&&n.y===t.y},so=function(n){if(!n)return 0;for(var e=0,t=0;t<n.length;t++){var r=n.charCodeAt(t);n.match(/[A-Z]/)?e+=1.5:r>=1&&r<=126||r>=65376&&r<=65439?e+=1:e+=2}return e},ui=function(n){var e=n.start,t=n.end,r;if(e.x===t.x&&e.y===t.y)r="";else{var o={start:e,end:t,offset:10,verticalLength:5},i=Me(Jt(Jt({},o),{type:"start"})),a=Me(Jt(Jt({},o),{type:"end"}));r="M".concat(i.leftX," ").concat(i.leftY,`
    L`).concat(i.rightX," ").concat(i.rightY,`
    L`).concat(a.rightX," ").concat(a.rightY,`
    L`).concat(a.leftX," ").concat(a.leftY," z")}return{d:r,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},yn=function(n){var e=n.start,t=n.end,r=n.sourceNode,o=n.targetNode,i=n.offset,a=it(r),s=it(o),l=qe(a,i),d=qe(s,i),u=Je(l,a,e),f=Je(d,s,t);return{sNext:u,ePre:f}},Qr=function(n){var e=n.replace(/M/g,"").replace(/C/g,",").split(","),t=ke(e[0]),r=ke(e[1]),o=ke(e[2]),i=ke(e[3]);return[t,r,o,i]},ke=function(n){var e=ut(n.replace(/(^\s*)/g,"").split(" "),2),t=e[0],r=e[1];return{x:+t,y:+r}},gn=function(n,e){var t=ut(n,4),r=t[0],o=t[1],i=t[2],a=t[3],s=Vi(r,o,i,a,e);return[s,n[3]]},lo=function(n,e){for(var t=n.x,r=n.y,o=Gt(e),i=Number.MAX_SAFE_INTEGER,a,s=[],l=0;l<o.length;l++)s.push({start:o[l],end:o[(l+1)%o.length]});if(s.forEach(function(c){var h=c.start,v=c.end;if(h.x===v.x){var p={x:h.x,y:r},g=Ee(p,h,v);if(g){var y=Math.abs(h.x-t);y<i&&(i=y,a=p)}}else if(h.y===v.y){var p={x:t,y:h.y},g=Ee(p,h,v);if(g){var y=Math.abs(h.y-r);y<i&&(i=y,a=p)}}}),!a){var d=s[0],u=d.start,f=d.end;a={x:u.x+(f.x-u.x)/2,y:u.y+(f.y-u.y)/2}}return a},fi=function(n){return qt(n,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},_n=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};function ci(n,e){return typeof e!="function"?function(t,r,o){return Object.assign({type:n.edgeType},o)}:function(t,r,o){var i=e(t,r,o);return i?typeof i=="string"?Object.assign({},o,{type:i}):Object.assign({type:i},o):{type:n.edgeType}}}var pi=function(n){var e=n.rows,t=n.rowsLength,r=n.fontSize,o=0;return W(e,function(i){var a=so(i);o=a>o?a:o}),{width:Math.ceil(o/2)*r+r/4,height:t*(r+2)+r/4}},Ut=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Xe=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))};function re(n,e,t){return t&&e*Math.round(n/e)||n}function hi(n,e,t){if(!n)return[];var r=Math.min.apply(Math,Xe([],Ut(n.map(function(p){return p[0]})),!1)),o=Math.max.apply(Math,Xe([],Ut(n.map(function(p){return p[0]})),!1)),i=Math.min.apply(Math,Xe([],Ut(n.map(function(p){return p[1]})),!1)),a=Math.max.apply(Math,Xe([],Ut(n.map(function(p){return p[1]})),!1)),s=-r,l=-i,d=n.map(function(p){var g=Ut(p,2),y=g[0],_=g[1];return[y+s,_+l]}),u=o-r,f=a-i,c=e?e/u:1,h=t?t/f:1,v=Math.min(c,h);return d.map(function(p){var g=Ut(p,2),y=g[0],_=g[1];return[y*v,_*v]})}var yr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},gr=function(n,e,t){var r=yr(n,2),o=r[0],i=r[1],a=yr(e,2),s=a[0],l=a[1],d=yr(t,2),u=d[0],f=d[1];return o>s&&o<u&&i>l&&i<f},uo=function(n,e){var t=e.multipleSelectKey,r=!1;switch(t){case"meta":r=n.metaKey;break;case"alt":r=n.altKey;break;case"shift":r=n.shiftKey;break;case"ctrl":r=n.ctrlKey;break;default:r=!1;break}return r},tn=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function mn(n,e){return n instanceof tt&&e instanceof tt}var fo=function(n){tn(e,n);function e(t,r,o){var i=n.call(this,3)||this;return i[0]=t,i[1]=r,i[2]=o,i.x=t,i.y=r,i.z=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.add=function(t){if(mn(this,t))return new tt(this.x+t.x,this.y+t.y);var r=this.z+t.z;return new Dr((this.x+t.x)/r,(this.y+t.y)/r)},e.prototype.subtract=function(t){if(mn(this,t))return new tt(this.x-t.x,this.y-t.y);var r=this.z-t.z;return r===0?new tt(this.x-t.x,this.y-t.y):new Dr((this.x-t.x)/r,(this.y-t.y)/r)},e}(Array),tt=function(n){tn(e,n);function e(t,r,o){var i=n.call(this,t,r,o??0)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var r=this;return t.reduce(function(o,i,a){return o+i*r[a]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var r=this.crossZ(t),o=Math.acos(this.normalize().dot(t.normalize()));return r>=0?o:-o},e}(fo),Dr=function(n){tn(e,n);function e(t,r){var o=n.call(this,t,r,1)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Point"},e}(fo),ur=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wt=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},_r=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},be=function(n){ur(e,n);function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=n.call(this,t.length)||this;return o.fill(new Array(3)),t.forEach(function(i,a){o[a]=i}),o.columns=t[0].length,o.rows=t.length,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return _r([],Wt(this.map(function(r){return r[t]})),!1)},e.prototype.transpose=function(){for(var t=[],r=0;r<this.columns;r++)t.push(this.getColumn(r));return new(e.bind.apply(e,_r([void 0],Wt(t),!1)))},e.prototype.cross=function(t){var r=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var o=0;o<this.rows;o++)for(var i=this.getRow(o),a=function(l){var d=t.getColumn(l);r[o][l]=i.reduce(function(u,f,c){return u+f*d[c]},0)},s=0;s<t.columns;s++)a(s);return new(e.bind.apply(e,_r([void 0],Wt(r),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new Dr(t[0],t[1])})},e.prototype.toString=function(){var t=Wt(this[0],2),r=t[0],o=t[1],i=Wt(this[1],2),a=i[0],s=i[1],l=Wt(this[2],2),d=l[0],u=l[1];return"matrix(".concat(r," ").concat(o," ").concat(a," ").concat(s," ").concat(d," ").concat(u,")")},e.prototype.translate=function(t,r){return this.cross(new er(t,r))},e.prototype.rotate=function(t){return this.cross(new vi(t))},e.prototype.scale=function(t,r){return this.cross(new yi(t,r))},e}(Array),vi=function(n){ur(e,n);function e(t){var r=n.call(this,new tt(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new tt(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new tt(0,0,1))||this;return Object.setPrototypeOf(r,e.prototype),r}return e.prototype.inverse=function(){return this.transpose()},e}(be),yi=function(n){ur(e,n);function e(t,r){var o=n.call(this,new tt(t,0,0),new tt(0,r,0),new tt(0,0,1))||this;return o.sx=t,o.sy=r,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(be),er=function(n){ur(e,n);function e(t,r){var o=n.call(this,new tt(1,0,0),new tt(0,1,0),new tt(t,r,1))||this;return o.tx=t,o.ty=r,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(be);Lo({});var rr=function(){return rr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},rr.apply(this,arguments)},gi=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Nr=function(n){var e=n.anchors;return e},nr=function(n,e){for(var t=e.nodes,r,o=t.length-1;o>=0;o--){var i=t[o],a=xi(n,i);if(a){var s=i.getTargetAnchor(n);if(s){var l={node:i,anchorIndex:s.index,anchor:s.anchor};(!r||_i(i,r.node,e))&&(r=l)}}}return r},_i=function(n,e,t){return n.zIndex>e.zIndex?!0:t.nodesMap[n.id].index>t.nodesMap[e.id].index},mi=function(n,e){for(var t=Nr(e),r,o=Number.MAX_SAFE_INTEGER,i=0;i<t.length;i++){var a=gt(n.x,n.y,t[i].x,t[i].y);a<o&&(o=a,r={index:i,anchor:rr(rr({},t[i]),{x:t[i].x,y:t[i].y,id:t[i].id})})}return r},gt=function(n,e,t,r){return Math.hypot(n-t,e-r)},At=function(n,e,t){t===void 0&&(t=0);var r=!1,o=it(e),i=gi(new be([n.x,n.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),a=i[0],s=i[1],l={x:a,y:s};return l.x>=o.minX-t&&l.x<=o.maxX+t&&l.y>=o.minY-t&&l.y<=o.maxY+t&&(r=!0),r},xi=function(n,e){return At(n,e,5)},it=function(n){var e=n.x,t=n.y,r=n.width,o=n.height;return{minX:e-r/2,minY:t-o/2,maxX:e+r/2,maxY:t+o/2,x:e,y:t,width:r,height:o,centerX:e,centerY:t}},Ei=function(n){var e=n,t=e.x,r=e.y,o=e.width,i=e.height,a=e.radius;return[{x:t-o/2+a,y:r-i/2+a,r:a},{x:t+o/2-a,y:r-i/2+a,r:a},{x:t-o/2+a,y:r+i/2-a,r:a},{x:t+o/2-a,y:r+i/2-a,r:a}]},xn=function(n,e,t){var r=Ei(t),o,i=Number.MAX_SAFE_INTEGER;return r.forEach(function(a){var s=gt(n.x,n.y,a.x,a.y);s<i&&(i=s,o=a)}),br(n,e,o)},br=function(n,e,t){var r,o=t.x,i=t.y,a=t.r;if(e===z.HORIZONTAL){var s=o-Math.sqrt(a*a-(n.y-i)*(n.y-i)),l=o+Math.sqrt(a*a-(n.y-i)*(n.y-i)),d=Math.abs(s-n.x)<Math.abs(l-n.x)?s:l;r={x:d,y:n.y}}else if(e===z.VERTICAL){var u=i-Math.sqrt(a*a-(n.x-o)*(n.x-o)),f=i+Math.sqrt(a*a-(n.x-o)*(n.x-o)),c=Math.abs(u-n.y)<Math.abs(f-n.y)?u:f;r={x:n.x,y:c}}return r},En=function(n,e){var t=e,r=!1,o=t.x,i=t.y,a=t.width,s=t.height,l=t.radius,d={minX:o-a/2+l,maxX:o+a/2-l,minY:i-s/2+l,maxY:i+s/2-l};return n.y===i+s/2||n.y===i-s/2?r=n.x>d.minX&&n.x<d.maxX:(n.x===o+a/2||n.x===o-a/2)&&(r=n.y>d.minY&&n.y<d.maxY),r},Mn=function(n,e,t){var r,o=t,i=o.x,a=o.y,s=o.rx,l=o.ry;if(e===z.HORIZONTAL){var d=i-Math.sqrt(s*s-(n.y-a)*(n.y-a)*s*s/(l*l)),u=i+Math.sqrt(s*s-(n.y-a)*(n.y-a)*s*s/(l*l)),f=Math.abs(d-n.x)<Math.abs(u-n.x)?d:u;r={x:f,y:n.y}}else if(e===z.VERTICAL){var c=a-Math.sqrt(l*l-(n.x-i)*(n.x-i)*l*l/(s*s)),h=a+Math.sqrt(l*l-(n.x-i)*(n.x-i)*l*l/(s*s)),v=Math.abs(c-n.y)<Math.abs(h-n.y)?c:h;r={x:n.x,y:v}}return r},Ye=function(n,e,t){for(var r=t.pointsPosition,o=Number.MAX_SAFE_INTEGER,i,a=[],s=0;s<r.length;s++)a.push({start:r[s],end:r[(s+1)%r.length]});return a.forEach(function(l){var d=l.start,u=l.end,f=d,c=u;d.x>u.x&&(f=u,c=d);var h={x:n.x,y:n.y};if(f.x===c.x&&e===z.HORIZONTAL&&(h={x:f.x,y:n.y}),f.y===c.y&&e===z.VERTICAL&&(h={x:n.x,y:f.y}),f.x!==c.x&&f.y!==c.y){var v=(c.y-f.y)/(c.x-f.x),p=(f.x*c.y-c.x*f.y)/(f.x-c.x);e===z.HORIZONTAL?h={x:(n.y-p)/v,y:n.y}:e===z.VERTICAL&&(h={x:n.x,y:v*n.x+p})}var g=Ee(h,d,u);if(g){var y=gt(h.x,h.y,n.x,n.y);y<o&&(o=y,i=h)}}),i},Mi=function(n){var e=qt(n,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},On=function(n,e,t,r){var o=n.x,i=n.y;return e.x>n.x?o=n.x+t/2:e.x<n.x&&(o=n.x-t/2),e.y>n.y?i=n.y+r/2:e.y<n.y&&(i=n.y-r/2),{x:o,y:i}},co=function(n){var e=n.rows,t=n.style,r=n.rowsLength,o=n.className,i=document.createElement("div");i.className=o,i.style.fontSize="".concat(t.fontSize),i.style.width="".concat(t.width),i.style.lineHeight="".concat(t.lineHeight),i.style.padding="".concat(t.padding),t.fontFamily&&(i.style.fontFamily="".concat(t.fontFamily)),r>1?e.forEach(function(s){var l=document.createElement("div");l.textContent=s,i.appendChild(l)}):i.textContent=e[0],document.body.appendChild(i);var a=i.clientHeight;return document.body.removeChild(i),a},Sn=function(n){var e=n.rows,t=n.rowsLength,r=n.fontSize,o=0;return e&&e.forEach(function(i){var a=so(i);o=a>o?a:o}),{width:Math.ceil(o/2)*r+r/4,height:t*(r+2)+r/4}},or=function(n){return typeof n!="object"?{isAllPass:!!n,msg:n?"":"不允许连接"}:n},Yt=function(){return Io()},de=new Map,po=function(n){var e=Yt();function t(){n();var o=de.get(e);if(o){var i=window.requestAnimationFrame(t);de.set(e,i)}}var r=window.requestAnimationFrame(t);return de.set(e,r),e},ir=function(n){var e=de.get(n);e&&(window.cancelAnimationFrame(e),de.delete(n))},Se=function(){return Se=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Se.apply(this,arguments)},Oi=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function ho(n){var e=n.x,t=e===void 0?0:e,r=n.y,o=r===void 0?0:r,i=n.value,a=n.fontSize,s=a===void 0?12:a,l=n.fill,d=l===void 0?"currentColor":l,u=n.overflowMode,f=u===void 0?"default":u,c=n.textWidth,h=c===void 0?void 0:c,v=n.model,p={x:t,y:o,fill:d,fontSize:s,textAnchor:"middle",dominantBaseline:"central"};if(W(Ct(n),function(M){var w=Oi(M,2),A=w[0],D=w[1];typeof D!="object"&&(p[A]=D)}),i){var g=String(i).split(/[\r\n]/g),y=g.length;if(f!=="default"){var _=v.BaseType,O=v.modelType;if(_===U.NODE&&O!==R.TEXT_NODE||_===U.EDGE&&h)return Si(n)}if(y>1){var S=g.map(function(M,w){var A=s+2,D=(w-(y-1)/2)*A;return x("tspan",{className:"lf-text-tspan",x:t,y:o+D,children:M})});return x("text",Se({},p,{children:S}))}return x("text",Se({},p,{children:i}))}return null}function Si(n){var e=n.x,t=n.y,r=n.value,o=n.model,i=n.textWidth,a=n.fontSize,s=a===void 0?12:a,l=n.lineHeight,d=n.fontFamily,u=d===void 0?"":d,f=n.wrapPadding,c=f===void 0?"0, 0":f,h=n.overflowMode,v=o.width,p=o.height,g=o.textHeight,y=i||v,_=String(r).split(/[\r\n]/g),O=_.length,S=co({rows:_,style:{fontSize:"".concat(s,"px"),width:"".concat(y,"px"),fontFamily:u,lineHeight:l,padding:c},rowsLength:O,className:"lf-get-text-height"}),M=p>S?p:S;g&&(M=g);var w=h==="ellipsis";return w&&(M=s+2),x("g",{children:x("foreignObject",{width:y,height:M,x:e-y/2,y:t-M/2,style:{overflow:"visible",textAlign:"left"},children:x("div",{className:"lf-node-text-auto-wrap",style:{minHeight:M,width:y,padding:c},children:x("div",{className:w?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:w?_.join(""):"",style:Se({},n),children:_.map(function(A){return x("div",{className:"lf-node-text--auto-wrap-inner",children:A})})})})})})}var Cr=function(){return Cr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Cr.apply(this,arguments)},wi=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function ne(n){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return W(Ct(n),function(t){var r=wi(t,2),o=r[0],i=r[1];(o==="style"||typeof i!="object")&&(e[o]=i)}),x("line",Cr({},e))}var Lr=function(){return Lr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Lr.apply(this,arguments)},Ai=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function Ot(n){var e=n.x,t=n.y,r=n.width,o=n.height,i=n.className,a=n.strokeWidth,s=n.radius,l=s===void 0?0:s,d=e-r/2,u=t-o/2,f={};return f["stroke-width"]=a,W(Ct(n),function(c){var h=Ai(c,2),v=h[0],p=h[1];typeof p!="object"&&(f[v]=p)}),i?f.className="lf-basic-shape ".concat(i):f.className="lf-basic-shape",l&&(f.rx=l,f.ry=l),f.x=d,f.y=u,x("rect",Lr({},f))}var jr=function(){return jr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},jr.apply(this,arguments)},Pi=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function we(n){var e={d:""};return W(Ct(n),function(t){var r=Pi(t,2),o=r[0],i=r[1];(o==="style"||typeof i!="object")&&(e[o]=i)}),x("path",jr({},e))}var Rr=function(){return Rr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Rr.apply(this,arguments)},Ti=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function oe(n){var e=n.x,t=e===void 0?0:e,r=n.y,o=r===void 0?0:r,i=n.r,a=i===void 0?4:i,s=n.className,l={cx:t,cy:o,r:a,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return W(Ct(n),function(d){var u=Ti(d,2),f=u[0],c=u[1];typeof c!="object"&&(l[f]=c)}),s?l.className="lf-basic-shape ".concat(s):l.className="lf-basic-shape",x("circle",Rr({},l))}var Ir=function(){return Ir=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Ir.apply(this,arguments)},Di=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function Ni(n){var e=n.x,t=e===void 0?0:e,r=n.y,o=r===void 0?0:r,i=n.rx,a=i===void 0?4:i,s=n.ry,l=s===void 0?4:s,d=n.className,u={cx:t,cy:o,rx:a,ry:l,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return W(Ct(n),function(f){var c=Di(f,2),h=c[0],v=c[1];typeof v!="object"&&(u[h]=v)}),d?u.className="lf-basic-shape ".concat(d):u.className="lf-basic-shape",x("ellipse",Ir({},u))}var ar=function(){return ar=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ar.apply(this,arguments)},bi=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function Ci(n,e){var t=n.map(function(_){return{x:_[0],y:_[1]}}),r=t.length;if(r<3)return"";for(var o=Math.abs(e),i="",a=0;a<r;a++){var s=t[(a-1+r)%r],l=t[a],d=t[(a+1)%r],u={x:l.x-s.x,y:l.y-s.y},f={x:d.x-l.x,y:d.y-l.y},c=Math.hypot(u.x,u.y),h=Math.hypot(f.x,f.y),v={x:u.x/c,y:u.y/c},p={x:f.x/h,y:f.y/h},g={x:l.x-v.x*o,y:l.y-v.y*o},y={x:l.x+p.x*o,y:l.y+p.y*o};a===0?i+="M ".concat(g.x," ").concat(g.y," "):i+="L ".concat(g.x," ").concat(g.y," "),i+="Q ".concat(l.x," ").concat(l.y," ").concat(y.x," ").concat(y.y," ")}return i+="Z",i}function vo(n){var e=n.points,t=e===void 0?[]:e,r=n.className,o=n.radius,i={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(W(Ct(n),function(s){var l=bi(s,2),d=l[0],u=l[1];typeof u!="object"&&(i[d]=u)}),r?i.classNmae="lf-basic-shape ".concat(r):i.className="lf-basic-shape",o){var a=Ci(t,o);return i.d=a,x("path",ar({},i))}else return i.points=t.map(function(s){return s.join(",")}).join(" "),x("polygon",ar({},i))}var Br=function(){return Br=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Br.apply(this,arguments)},Li=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i};function ji(n){var e=n.className,t={points:"",fill:"none"};return W(Ct(n),function(r){var o=Li(r,2),i=o[0],a=o[1];(i==="style"||typeof a!="object")&&(t[i]=a)}),e&&(t.className="".concat(e)),x("polyline",Br({},t))}var yo=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ae=function(){return Ae=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Ae.apply(this,arguments)},Ri=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t},Ii=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},B;(function(n){n[n.LEFT_TOP=0]="LEFT_TOP",n[n.RIGHT_TOP=1]="RIGHT_TOP",n[n.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(B||(B={}));var Bi=function(n){yo(e,n);function e(t){var r=n.call(this)||this;r.isShiftPressed=!1,r.bindKeyboardEvents=function(){document.addEventListener("keydown",r.handleKeyDown),document.addEventListener("keyup",r.handleKeyUp)},r.handleKeyDown=function(s){s.key==="Shift"&&(r.isShiftPressed=!0)},r.handleKeyUp=function(s){s.key==="Shift"&&(r.isShiftPressed=!1)},r.updateEdgePointByAnchors=function(){var s=r.nodeModel,l=s.id,d=s.anchors,u=r.graphModel.getNodeEdges(l);W(u,function(f){if(f.sourceNodeId===l){var c=Ht(d,function(h){return h.id===f.sourceAnchorId});c&&f.updateStartPoint({x:c.x,y:c.y})}else if(f.targetNodeId===l){var c=Ht(d,function(v){return v.id===f.targetAnchorId});c&&f.updateEndPoint({x:c.x,y:c.y})}})},r.triggerResizeEvent=function(s,l,d,u,f,c){r.graphModel.eventCenter.emit(T.NODE_RESIZE,{preData:s,data:l,deltaX:d,deltaY:u,index:f,model:c})},r.recalcResizeInfo=function(s,l,d,u,f){d===void 0&&(d=1),u===void 0&&(u=!1),f===void 0&&(f=!1);var c=L(l),h=c.deltaX,v=c.deltaY,p=c.width,g=c.height,y=c.PCTResizeInfo;if(y){var _=4,O=0,S=0;switch(s){case B.LEFT_TOP:S=(h*-1-v)/_;break;case B.RIGHT_TOP:S=(h-v)/_;break;case B.RIGHT_BOTTOM:S=(h+v)/_;break;case B.LEFT_BOTTOM:S=(h*-1+v)/_;break}S!==0&&(O=Math.round(S/y.ResizeBasis.basisHeight*1e5)/1e3),y.ResizePCT.widthPCT=Math.max(Math.min(y.ResizePCT.widthPCT+O,y.ScaleLimit.maxScaleLimit),y.ScaleLimit.minScaleLimit),y.ResizePCT.heightPCT=Math.max(Math.min(y.ResizePCT.heightPCT+O,y.ScaleLimit.maxScaleLimit),y.ScaleLimit.minScaleLimit);var M=Math.round(y.ResizePCT.widthPCT*y.ResizeBasis.basisWidth/100),w=Math.round(y.ResizePCT.heightPCT*y.ResizeBasis.basisHeight/100);switch(s){case B.LEFT_TOP:h=p-M,v=g-w;break;case B.RIGHT_TOP:h=M-p,v=g-w;break;case B.RIGHT_BOTTOM:h=M-p,v=w-g;break;case B.LEFT_BOTTOM:h=p-M,v=w-g;break}return c}switch(s){case B.LEFT_TOP:c.width=u?p:p-h*d,c.height=f?g:g-v*d;break;case B.RIGHT_TOP:c.width=u?p:p+h*d,c.height=f?g:g-v*d;break;case B.RIGHT_BOTTOM:c.width=u?p:p+h*d,c.height=f?g:g+v*d;break;case B.LEFT_BOTTOM:c.width=u?p:p-h*d,c.height=f?g:g+v*d;break}return c},r.resizeNode=function(s){var l=s.deltaX,d=s.deltaY,u=r.index,f=r.props,c=f.model,h=f.graphModel,v=f.x,p=f.y;Wi({x:v,y:p,deltaX:l,deltaY:d,index:u,nodeModel:c,graphModel:h,forceProportional:r.isShiftPressed,cancelCallback:function(){r.dragHandler.cancelDrag()}})},r.onDragStart=function(){r.graphModel.selectNodeById(r.nodeModel.id)},r.onDragging=function(s){var l=s.deltaX,d=s.deltaY,u=r.graphModel.transformModel,f=Ii(u.fixDeltaXY(l,d),2),c=f[0],h=f[1];r.resizeNode({deltaX:c,deltaY:h})},r.onDragEnd=function(){var s=r.nodeModel.x,l=r.nodeModel.y;r.nodeModel.moveTo(s,l),r.updateEdgePointByAnchors()};var o=t.index,i=t.model,a=t.graphModel;return r.index=o,r.nodeModel=i,r.graphModel=a,r.dragHandler=new St({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:a.gridSize}),r.bindKeyboardEvents(),r}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,r=t.x,o=t.y,i=t.direction,a=t.model,s=a.getResizeControlStyle(),l=s.width,d=s.height,u=Ri(s,["width","height"]);return x("g",{className:"lf-resize-control lf-resize-control-".concat(i),children:[x(Ot,Ae({className:"lf-resize-control-content",x:r,y:o,width:l??7,height:d??7},u)),x(Ot,{className:"lf-resize-control-content",x:r,y:o,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(V),ki=function(n){yo(e,n);function e(){return n.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,r=t.model,o=t.graphModel,i=it(r),a=i.minX,s=i.minY,l=i.maxX,d=i.maxY,u=[{index:B.LEFT_TOP,direction:"nw",x:a,y:s},{index:B.RIGHT_TOP,direction:"ne",x:l,y:s},{index:B.RIGHT_BOTTOM,direction:"se",x:l,y:d},{index:B.LEFT_BOTTOM,direction:"sw",x:a,y:d}];return Pt(u,function(f){return x(Bi,Ae({},f,{model:r,graphModel:o}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,r=t.x,o=t.y,i=t.width,a=t.height,s=t.getResizeOutlineStyle();return x(Ot,Ae({},s,{x:r,y:o,width:i,height:a}))},e.prototype.render=function(){return x("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(V);function Xi(n,e){var t=n.x,r=n.y,o=e.x,i=e.y,a={x:t+(o-t)/2,y:r+(i-r)/2};return a}function le(n,e,t){var r=Yi(t),o=n.x-e.x,i=n.y-e.y,a=o*Math.cos(r)-i*Math.sin(r)+e.x,s=o*Math.sin(r)+i*Math.cos(r)+e.y;return{x:a,y:s}}function Yi(n){return n*Math.PI/180}function Hi(n){return n/Math.PI*180}function Gi(n,e,t,r,o,i,a,s){o===void 0&&(o=!1),i===void 0&&(i=!1);var l={x:t.x-(n.x-t.x),y:t.y-(n.y-t.y)},d=Xi(l,e),u=le(e,d,-r),f=le(l,d,-r);if(o){var c=Math.abs(u.x-f.x),h=c-a;d.x>u.x?d.x=d.x+h/2:d.x=d.x-h/2}if(i){var v=Math.abs(u.y-f.y),p=v-s;d.y>u.y?d.y=d.y+p/2:d.y=d.y-p/2}if(o||i){var g=le(f,d,r),y=g.x-l.x,_=g.y-l.y;d.x=d.x-y,d.y=d.y-_,f=le(l,d,-r),u={x:d.x-(f.x-d.x),y:d.y-(f.y-d.y)}}var O=Math.abs(u.x-f.x),S=Math.abs(u.y-f.y);return o&&(O=a),i&&(S=s),{width:O,height:S,center:d}}function zi(n,e,t,r,o,i,a,s,l){s===void 0&&(s=!1),l===void 0&&(l=!1);var d=e.deltaX,u=e.deltaY,f=e.width,c=e.height,h=Hi(t),v={x:r,y:o},p={x:i,y:a},g=le(v,p,h),y={x:g.x+d,y:g.y+u},_=Gi(g,y,p,h,s,l,f,c),O=_.width,S=_.height,M=_.center;return e.width=O*n,e.height=S*n,e.deltaX=(M.x-p.x)*2,e.deltaY=(M.y-p.y)*2,e}var Fi=function(n,e,t,r,o,i,a,s,l,d,u){t===void 0&&(t=1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=0),u===void 0&&(u=!1);var f=L(e),c=f.deltaX,h=f.deltaY,v=f.width,p=f.height,g=f.PCTResizeInfo;if(g){var y=4,_=0,O=0;switch(n){case B.LEFT_TOP:O=(c*-1-h)/y;break;case B.RIGHT_TOP:O=(c-h)/y;break;case B.RIGHT_BOTTOM:O=(c+h)/y;break;case B.LEFT_BOTTOM:O=(c*-1+h)/y;break}O!==0&&(_=Math.round(O/g.ResizeBasis.basisHeight*1e5)/1e3),g.ResizePCT.widthPCT=Math.max(Math.min(g.ResizePCT.widthPCT+_,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit),g.ResizePCT.heightPCT=Math.max(Math.min(g.ResizePCT.heightPCT+_,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit);var S=Math.round(g.ResizePCT.widthPCT*g.ResizeBasis.basisWidth/100),M=Math.round(g.ResizePCT.heightPCT*g.ResizeBasis.basisHeight/100);switch(n){case B.LEFT_TOP:c=v-S,h=p-M;break;case B.RIGHT_TOP:c=S-v,h=p-M;break;case B.RIGHT_BOTTOM:c=S-v,h=M-p;break;case B.LEFT_BOTTOM:c=v-S,h=M-p;break}return f}if(i%(2*Math.PI)!==0&&a!==void 0&&s!==void 0)return zi(t,f,i,a,s,l,d,r,o);if(u){var w=v/p,A=0,D=v,N=p;switch(n){case B.LEFT_TOP:A=Math.abs(c)>Math.abs(h)?-c:-h,w>=1?(D=v+A,N=D/w):(N=p+A,D=N*w),f.width=D,f.height=N,f.deltaX=v-D,f.deltaY=p-N;break;case B.RIGHT_TOP:A=Math.abs(c)>Math.abs(h)?c:-h,w>=1?(D=v+A,N=D/w):(N=p-A,D=N*w),f.width=D,f.height=N,f.deltaX=D-v,f.deltaY=p-N;break;case B.RIGHT_BOTTOM:A=Math.abs(c)>Math.abs(h)?c:h,w>=1?(D=v+A,N=D/w):(N=p+A,D=N*w),f.width=D,f.height=N,f.deltaX=D-v,f.deltaY=N-p;break;case B.LEFT_BOTTOM:A=Math.abs(c)>Math.abs(h)?-c:h,w>=1?(D=v-A,N=D/w):(N=p+A,D=N*w),f.width=D,f.height=N,f.deltaX=v-D,f.deltaY=N-p;break}return f}switch(n){case B.LEFT_TOP:f.width=r?v:v-c*t,f.height=o?p:p-h*t;break;case B.RIGHT_TOP:f.width=r?v:v+c*t,f.height=o?p:p-h*t;break;case B.RIGHT_BOTTOM:f.width=r?v:v+c*t,f.height=o?p:p+h*t;break;case B.LEFT_BOTTOM:f.width=r?v:v-c*t,f.height=o?p:p+h*t;break}return f},$i=function(n,e){var t=n.id,r=n.anchors,o=e.getNodeEdges(t);W(o,function(i){if(i.sourceNodeId===t){var a=Ht(r,function(s){return s.id===i.sourceAnchorId});a&&i.updateStartPoint({x:a.x,y:a.y})}else if(i.targetNodeId===t){var a=Ht(r,function(l){return l.id===i.targetAnchorId});a&&i.updateEndPoint({x:a.x,y:a.y})}})},Ui=function(n,e,t,r,o,i,a){a.eventCenter.emit(T.NODE_RESIZE,{preData:n,data:e,deltaX:t,deltaY:r,index:o,model:i})},Wi=function(n){var e=n.x,t=n.y,r=n.deltaX,o=n.deltaY,i=n.index,a=n.nodeModel,s=n.graphModel,l=n.cancelCallback,d=n.forceProportional,u=d===void 0?!1:d,f=a.r,c=a.rx,h=a.ry,v=a.width,p=a.height,g=a.PCTResizeInfo,y=a.minWidth,_=a.minHeight,O=a.maxWidth,S=a.maxHeight,M=a.rotate,w=a.x,A=a.y,D=y===O,N=_===S,j={width:f||c||v,height:f||h||p,deltaX:r,deltaY:o,PCTResizeInfo:g},G=f||c&&h?1/2:1,H=e,Z=t,I=Fi(i,j,G,D,N,M,H,Z,w,A,u);if(I.width<y||I.width>O||I.height<_||I.height>S){l==null||l();return}(M%(2*Math.PI)==0||g||H===void 0||Z===void 0)&&(I.deltaX=D?0:I.deltaX,I.deltaY=N?0:I.deltaY);var $=a.getData(),nt=a.resize(I);$.x===nt.x&&$.y===nt.y||($i(a,s),Ui($,nt,r,o,i,a,s))},Zi=100,Ki={x:1,y:0};function Vi(n,e,t,r,o){for(var i=function(h){if(h<0||h>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:n.x*Math.pow(1-h,3)+3*e.x*h*Math.pow(1-h,2)+3*t.x*Math.pow(h,2)*(1-h)+r.x*Math.pow(h,3),y:n.y*Math.pow(1-h,3)+3*e.y*h*Math.pow(1-h,2)+3*t.y*Math.pow(h,2)*(1-h)+r.y*Math.pow(h,3)}},a=0,s=2,l=r.x,d=r.y,u=r;a<o&&s<50;){u=i(1-s/Zi);var f=u.x,c=u.y;a=gt(l,d,f,c),s++}return u}function qi(n,e){return n.x*e.y-n.y*e.x}function Ji(n,e){var t=[n.x,n.y,n.z],r=[e.x,e.y,e.z];return r.reduce(function(o,i,a){return o+i*t[a]})}function Qi(n,e){var t=qi(n,e),r=Math.acos(Ji(wn(n),wn(e)));return t>=0?r:-r}function wn(n){var e=Math.hypot(n.x,n.y);return{x:n.x/e,y:n.y/e,z:0}}function ta(n){return Qi(Ki,n)}function ea(n){return n*(180/Math.PI)}var go={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},ra={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},na={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},oa={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Pe={colorful:oa,dark:na,radius:ra,default:go},ia={background:"#23272e"},aa={background:"#fefeff"},kr={background:"#ffffff"},Te={colorful:aa,dark:ia,radius:kr,default:kr},sa={color:"#66676a",thickness:1},la={color:"#dadada",thickness:1},Xr={color:"#acacac",thickness:1},De={colorful:la,dark:sa,radius:Xr,default:Xr},_o=function(n,e){var t=L(go);return e&&(t=Ve(t,Pe[e])),n&&(t=Ve(t,n)),t},da=function(n,e){if(Pe[n]){console.warn("theme mode ".concat(n," already exists"));return}Pe[n]=e,Te[n]=e.background||kr,De[n]=e.grid||Xr},ua=function(n){delete Pe[n],delete Te[n],delete De[n]},An=function(){var n={colorful:{},dark:{},radius:{},default:{}};Y(Pe,n),Y(Te,n),Y(De,n)},fa=_o,ca=1e3,pa=999,en=function(){return++ca},ha=function(){return--pa},K=function(){return K=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},K.apply(this,arguments)},b=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},fr=function(){function n(e,t){var r;this.BaseType=U.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ft.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=X.DEFAULT,this.modelType=R.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(r=e.properties)!==null&&r!==void 0?r:{},this.initEdgeData(e),this.setAttributes()}return n.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,r=t&&t(e.type),o=this.createId();e.id=o||r||Yt()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var i=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=i,Y(this,fi(e));var a=this.graphModel.overlapMode;a===yt.INCREASE&&(this.zIndex=e.zIndex||en()),this.setAnchors(),this.initPoints(),this.formatText(e)},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.getEdgeStyle=function(){return K(K({},this.graphModel.theme.baseEdge),this.style)},n.prototype.getAdjustPointStyle=function(){return K({},this.graphModel.theme.edgeAdjust)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return L(e)},n.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return L(e)},n.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),r=this.graphModel.theme.arrow,o=this.isAnimation?t.stroke:e.stroke;return K(K(K({},e),{fill:o,stroke:o}),r)},n.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return L(t)},n.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(n.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),n.prototype.getBeginAnchor=function(e,t,r){var o,i,a=Nr(e);if(r){if(o=Ht(a,function(s){return s.id===r}),o)return o;console.warn("未在节点上找到指定的起点锚点".concat(r,"，已使用默认锚点作为起点"))}return a.forEach(function(s){var l=_n(s,t);(i===void 0||l<i)&&(i=l,o=s)}),o},n.prototype.getEndAnchor=function(e,t){var r=this,o,i,a=Nr(e);if(t){if(o=Ht(a,function(s){return s.id===t}),o)return o;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return a.forEach(function(s){if(r.startPoint){var l=_n(s,r.startPoint);(i===void 0||l<i)&&(i=l,o=s)}}),o},n.prototype.getProperties=function(){return Et(this.properties)},n.prototype.getData=function(){var e=this.properties;oo(e)&&(e=Et(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:Y({},this.startPoint),endPoint:Y({},this.endPoint)};this.graphModel.overlapMode===yt.INCREASE&&(t.zIndex=this.zIndex);var r=this.text,o=r.x,i=r.y,a=r.value;return a&&(t.text={x:o,y:i,value:a}),t},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.setProperty=function(e,t){jo(this.properties,e,rt(t)),this.setAttributes()},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setProperties=function(e){this.properties=K(K({},Et(this.properties)),rt(e)),this.setAttributes()},n.prototype.changeEdgeId=function(e){var t=this.arrowConfig,r=t.markerEnd,o=t.markerStart;o&&o==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),r&&r==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},n.prototype.setStyle=function(e,t){var r;this.style=K(K({},this.style),(r={},r[e]=rt(t),r))},n.prototype.setStyles=function(e){this.style=K(K({},this.style),rt(e))},n.prototype.updateStyles=function(e){this.style=K({},rt(e))},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,r,o,i=this.graphModel.editConfigModel,a=i.edgeTextDraggable,s=i.edgeTextEdit,l=this.textPosition,d=l.x,u=l.y,f=e.text,c={value:"",x:d,y:u,draggable:a,editable:s};f&&(typeof f=="string"?c=K(K({},c),{value:f}):(c=K(K({},c),{x:(t=f.x)!==null&&t!==void 0?t:d,y:(r=f.y)!==null&&r!==void 0?r:u,value:(o=f.value)!==null&&o!==void 0?o:""}),ee(f.draggable)||(c.draggable=f.draggable),ee(f.editable)||(c.editable=f.editable))),this.text=c},n.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,r=e.y;this.text.x=t,this.text.y=r},n.prototype.moveText=function(e,t){var r=this.text,o=r.x,i=r.y,a=r.value,s=r.draggable,l=r.editable;this.text={value:a,editable:l,draggable:s,x:o+e,y:i+t}},n.prototype.setText=function(e){e&&Y(this.text,e)},n.prototype.updateText=function(e){this.text=K(K({},Et(this.text)),{value:e})},n.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.openEdgeAnimation=function(){this.isAnimation=!0},n.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateStartPoint=function(e){this.startPoint=e},n.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},n.prototype.updateEndPoint=function(e){this.endPoint=e},n.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},n.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},n.prototype.initPoints=function(){},n.prototype.updateAttributes=function(e){Y(this,e)},n.prototype.getAdjustStart=function(){return this.startPoint},n.prototype.getAdjustEnd=function(){return this.endPoint},n.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,r=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:r.x,y:r.y})},n.BaseType=U.EDGE,b([E],n.prototype,"type",void 0),b([E],n.prototype,"sourceNodeId",void 0),b([E],n.prototype,"targetNodeId",void 0),b([E],n.prototype,"startPoint",void 0),b([E],n.prototype,"endPoint",void 0),b([E],n.prototype,"textMode",void 0),b([E],n.prototype,"text",void 0),b([E],n.prototype,"properties",void 0),b([E],n.prototype,"points",void 0),b([E],n.prototype,"pointsList",void 0),b([E],n.prototype,"isSelected",void 0),b([E],n.prototype,"isHovered",void 0),b([E],n.prototype,"isHitable",void 0),b([E],n.prototype,"isHittable",void 0),b([E],n.prototype,"draggable",void 0),b([E],n.prototype,"visible",void 0),b([E],n.prototype,"isAnimation",void 0),b([E],n.prototype,"isShowAdjustPoint",void 0),b([E],n.prototype,"zIndex",void 0),b([E],n.prototype,"state",void 0),b([E],n.prototype,"style",void 0),b([E],n.prototype,"arrowConfig",void 0),b([F],n.prototype,"sourceNode",null),b([F],n.prototype,"targetNode",null),b([F],n.prototype,"textPosition",null),b([m],n.prototype,"setProperty",null),b([m],n.prototype,"deleteProperty",null),b([m],n.prototype,"setProperties",null),b([m],n.prototype,"changeEdgeId",null),b([m],n.prototype,"setStyle",null),b([m],n.prototype,"setStyles",null),b([m],n.prototype,"updateStyles",null),b([m],n.prototype,"setTextMode",null),b([m],n.prototype,"formatText",null),b([m],n.prototype,"resetTextPosition",null),b([m],n.prototype,"moveText",null),b([m],n.prototype,"setText",null),b([m],n.prototype,"updateText",null),b([m],n.prototype,"setAnchors",null),b([m],n.prototype,"setSelected",null),b([m],n.prototype,"setHovered",null),b([m],n.prototype,"setHitable",null),b([m],n.prototype,"setHittable",null),b([m],n.prototype,"openEdgeAnimation",null),b([m],n.prototype,"closeEdgeAnimation",null),b([m],n.prototype,"setElementState",null),b([m],n.prototype,"updateStartPoint",null),b([m],n.prototype,"moveStartPoint",null),b([m],n.prototype,"updateEndPoint",null),b([m],n.prototype,"moveEndPoint",null),b([m],n.prototype,"setZIndex",null),b([m],n.prototype,"initPoints",null),b([m],n.prototype,"updateAttributes",null),b([m],n.prototype,"getAdjustStart",null),b([m],n.prototype,"getAdjustEnd",null),b([m],n.prototype,"updateAfterAdjustStartAndEnd",null),n}(),va=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Bt=function(){return Bt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Bt.apply(this,arguments)},st=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},mr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Pn=function(n){va(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.BEZIER_EDGE,o.path="",o.initEdgeData(t),o.setAttributes(),o}return e.prototype.initEdgeData=function(t){this.offset=dr(t,"properties.offset",100),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,r=n.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return Bt(Bt(Bt({},r),L(t)),L(i))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,r=0;return this.pointsList.forEach(function(o){var i=o.x,a=o.y;t+=i,r+=a}),{x:t/this.pointsList.length,y:r/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=n.prototype.getData.call(this),r=this.pointsList.map(function(o){var i=o.x,a=o.y;return{x:i,y:a}});return Bt(Bt({},t),{pointsList:r})},e.prototype.getControls=function(){var t=this.startPoint,r=this.endPoint,o=yn({start:t,end:r,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return o},e.prototype.getPath=function(t){var r=mr(t,4),o=r[0],i=r[1],a=r[2],s=r[3];return"M ".concat(o.x," ").concat(o.y,`
    C `).concat(i.x," ").concat(i.y,`,
    `).concat(a.x," ").concat(a.y,`,
    `).concat(s.x," ").concat(s.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),r=t.sNext,o=t.ePre;this.updatePath(r,o)},e.prototype.updatePath=function(t,r){t=L(t),r=L(r);var o={x:this.startPoint.x,y:this.startPoint.y},i={x:this.endPoint.x,y:this.endPoint.y};if(!t||!r){var a=this.getControls();t=a.sNext,r=a.ePre}this.pointsList=[o,t,r,i],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,r){this.startPoint.x+=t,this.startPoint.y+=r;var o=mr(this.pointsList,3),i=o[1],a=o[2];i.x+=t,i.y+=r,this.updatePath(i,a)},e.prototype.moveEndPoint=function(t,r){this.endPoint.x+=t,this.endPoint.y+=r;var o=mr(this.pointsList,3),i=o[1],a=o[2];a.x+=t,a.y+=r,this.updatePath(i,a)},e.prototype.updateAdjustAnchor=function(t,r){var o;r==="sNext"?this.pointsList[1]=t:r==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((o=this.text)===null||o===void 0)&&o.value&&this.setText(Y({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var r=t.startPoint,o=t.endPoint,i=t.sourceNode,a=t.targetNode,s=yn({start:r,end:o,sourceNode:i,targetNode:a,offset:this.offset}),l=s.sNext,d=s.ePre;this.pointsList=[r,l,d,o],this.initPoints()},st([E],e.prototype,"offset",void 0),st([E],e.prototype,"path",void 0),st([m],e.prototype,"initPoints",null),st([m],e.prototype,"updatePoints",null),st([m],e.prototype,"updateStartPoint",null),st([m],e.prototype,"updateEndPoint",null),st([m],e.prototype,"moveStartPoint",null),st([m],e.prototype,"moveEndPoint",null),st([m],e.prototype,"updateAdjustAnchor",null),st([m],e.prototype,"getAdjustStart",null),st([m],e.prototype,"getAdjustEnd",null),st([m],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(fr),ya=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ue=function(){return ue=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ue.apply(this,arguments)},Tn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},ga=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},Dn=function(n){ya(e,n);function e(){var t=n.apply(this,ga([],Tn(arguments),!1))||this;return t.modelType=R.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,r=n.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return ue(ue(ue({},r),L(t)),L(i))},e.prototype.initEdgeData=function(t){n.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var r=Tn(t,2),o=r[0],i=r[1];return"".concat(o.x,",").concat(o.y," ").concat(i.x,",").concat(i.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(fr),_a=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),fe=function(){return fe=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},fe.apply(this,arguments)},Q=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Nn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},ma=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},bn=function(n){_a(e,n);function e(){var t=n.apply(this,ma([],Nn(arguments),!1))||this;return t.modelType=R.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=dr(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,r=n.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return fe(fe(fe({},r),L(t)),L(i))},e.prototype.getTextPosition=function(){var t,r=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!r){var o=this.dbClickPosition,i=o.x,a=o.y;return{x:i,y:a}}var s=Gt(this.points),l=Nn(li(s),2),d=l[0],u=l[1];return{x:(d.x+u.x)/2,y:(d.y+u.y)/2}},e.prototype.getAfterAnchor=function(t,r,o){var i,a;return o.forEach(function(s){var l;t===z.HORIZONTAL?l=Math.abs(r.y-s.y):t===z.VERTICAL&&(l=Math.abs(r.x-s.x)),(!a||a>l)&&(a=l,i=s)}),i},e.prototype.getCrossPoint=function(t,r,o){var i;return t===z.HORIZONTAL?i={x:o.x,y:r.y}:t===z.VERTICAL&&(i={x:r.x,y:o.y}),i},e.prototype.removeCrossPoints=function(t,r,o){var i=o.map(function(y){return y});if(t===1){var a=i[t],s=i[r],l=i[t-1],d=cn(l,a,this.sourceNode);if(d){var u=pn(a,s,this.sourceNode);if(u){var f=hn(a,s,this.sourceNode);f&&(i[t]=f,i.splice(t-1,1),t--,r--)}}else{var c=this.sourceNode.anchors;c.forEach(function(y){if(y.x===l.x&&y.x===a.x||y.y===l.y&&y.y===a.y){var _=gt(y.x,y.y,a.x,a.y),O=gt(l.x,l.y,a.x,a.y);_<O&&(i[t-1]=y)}})}}if(r===o.length-2){var h=i[t],v=i[r],p=i[r+1],g=cn(v,p,this.targetNode);if(g){var u=pn(h,v,this.targetNode);if(u){var f=hn(h,v,this.targetNode);f&&(i[r]=f,i.splice(r+1,1))}}else{var c=this.targetNode.anchors;c.forEach(function(_){if(_.x===p.x&&_.x===v.x||_.y===p.y&&_.y===v.y){var O=gt(_.x,_.y,v.x,v.y),S=gt(p.x,p.y,v.x,v.y);O<S&&(i[r+1]=_)}})}}return i},e.prototype.getDraggingPoints=function(t,r,o,i,a){var s=a.map(function(u){return u}),l=this.getAfterAnchor(t,o,i),d=this.getCrossPoint(t,o,l);return r==="start"?(s.unshift(d),s.unshift(l)):(s.push(d),s.push(l)),s},e.prototype.updateCrossPoints=function(t){var r=t.map(function(_){return _}),o=t[0],i=t[1],a=t[r.length-2],s=t[r.length-1],l=this,d=l.sourceNode,u=l.targetNode,f=d.modelType,c=u.modelType,h=tr(o,i),v=r[0];switch(f){case R.RECT_NODE:if(d.radius!==0){var p=En(o,d);p||(v=xn(o,h,d))}break;case R.CIRCLE_NODE:v=br(o,h,d);break;case R.ELLIPSE_NODE:v=Mn(o,h,d);break;case R.DIAMOND_NODE:v=Ye(o,h,d);break;case R.POLYGON_NODE:v=Ye(o,h,d);break}v&&(r[0]=v);var g=tr(a,s),y=r[r.length-1];switch(c){case R.RECT_NODE:if(u.radius!==0){var p=En(s,u);p||(y=xn(s,g,u))}break;case R.CIRCLE_NODE:y=br(s,g,u);break;case R.ELLIPSE_NODE:y=Mn(s,g,u);break;case R.DIAMOND_NODE:y=Ye(s,g,u);break;case R.POLYGON_NODE:y=Ye(s,g,u);break}return y&&(r[r.length-1]=y),r},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=n.prototype.getData.call(this),r=this.pointsList.map(function(o){var i=o.x,a=o.y;return{x:i,y:a}});return Object.assign({},t,{pointsList:r})},e.prototype.getPath=function(t){return t.map(function(r){return"".concat(r.x,",").concat(r.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=fn({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(r){return"".concat(r.x,",").concat(r.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,r){this.startPoint.x+=t,this.startPoint.y+=r,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,r){this.endPoint.x+=t,this.endPoint.y+=r,this.updatePoints()},e.prototype.updatePointsList=function(t,r){this.pointsList.forEach(function(a){a.x+=t,a.y+=r});var o=this.pointsList[0];this.startPoint=Object.assign({},o);var i=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},i),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,r){var o;this.isDragging=!0;var i=t.start,a=t.end,s=t.startIndex,l=t.endIndex,d=t.direction,u=this.pointsList,f=u;return d===z.HORIZONTAL?(u[s]={x:i.x,y:i.y+r.y},u[l]={x:a.x,y:a.y+r.y},f=this.pointsList.map(function(c){return c})):d===z.VERTICAL&&(u[s]={x:i.x+r.x,y:i.y},u[l]={x:a.x+r.x,y:a.y},f=this.pointsList.map(function(c){return c})),this.updatePointsAfterDrag(f),this.draggingPointList=f,!((o=this.text)===null||o===void 0)&&o.value&&this.setText(Y({},this.text,this.textPosition)),{start:Y({},u[s]),end:Y({},u[l]),startIndex:s,endIndex:l,direction:d}},e.prototype.dragAppend=function(t,r){var o;this.isDragging=!0;var i=t.start,a=t.end,s=t.startIndex,l=t.endIndex,d=t.direction,u=this.pointsList;if(d===z.HORIZONTAL){u[s]={x:i.x,y:i.y+r.y},u[l]={x:a.x,y:a.y+r.y};var f=this.pointsList.map(function(g){return g});if(s!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(s,l,f)),s===0){var c={x:i.x,y:i.y+r.y},h=At(c,this.sourceNode);if(!h){var v=this.sourceNode.anchors;f=this.getDraggingPoints(d,"start",c,v,f)}}if(l===this.pointsList.length-1){var p={x:a.x,y:a.y+r.y},h=At(p,this.targetNode);if(!h){var v=this.targetNode.anchors;f=this.getDraggingPoints(d,"end",p,v,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}else if(d===z.VERTICAL){u[s]={x:i.x+r.x,y:i.y},u[l]={x:a.x+r.x,y:a.y};var f=this.pointsList.map(function(y){return y});if(s!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(s,l,f)),s===0){var c={x:i.x+r.x,y:i.y},h=At(c,this.sourceNode);if(!h){var v=this.sourceNode.anchors;f=this.getDraggingPoints(d,"start",c,v,f)}}if(l===this.pointsList.length-1){var p={x:a.x+r.x,y:a.y},h=At(p,this.targetNode);if(!h){var v=this.targetNode.anchors;f=this.getDraggingPoints(d,"end",p,v,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}return!((o=this.text)===null||o===void 0)&&o.value&&this.setText(Y({},this.text,this.textPosition)),{start:Y({},u[s]),end:Y({},u[l]),startIndex:s,endIndex:l,direction:d}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=ao(Gt(this.points));this.pointsList=t.map(function(i){return i}),this.draggingPointList=[];var r=t[0];this.startPoint=Y({},r);var o=t[t.length-1];this.endPoint=Y({},o)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var r=this.updateCrossPoints(t);this.points=r.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var r=t.startPoint,o=t.endPoint,i=t.sourceNode,a=t.targetNode;this.pointsList=fn({x:r.x,y:r.y},{x:o.x,y:o.y},i,a,this.offset||0),this.initPoints()},Q([E],e.prototype,"offset",void 0),Q([E],e.prototype,"dbClickPosition",void 0),Q([m],e.prototype,"initPoints",null),Q([m],e.prototype,"updatePoints",null),Q([m],e.prototype,"updateStartPoint",null),Q([m],e.prototype,"moveStartPoint",null),Q([m],e.prototype,"updateEndPoint",null),Q([m],e.prototype,"moveEndPoint",null),Q([m],e.prototype,"updatePointsList",null),Q([m],e.prototype,"dragAppendStart",null),Q([m],e.prototype,"dragAppendSimple",null),Q([m],e.prototype,"dragAppend",null),Q([m],e.prototype,"dragAppendEnd",null),Q([m],e.prototype,"updatePointsAfterDrag",null),Q([m],e.prototype,"getAdjustStart",null),Q([m],e.prototype,"getAdjustEnd",null),Q([m],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(fr),q=function(){return q=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},q.apply(this,arguments)},C=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Cn=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},xa=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Lt=function(){function n(e,t){var r;this.BaseType=U.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ft.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=X.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=R.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(r=e.properties)!==null&&r!==void 0?r:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,r=t.x,o=r===void 0?0:r,i=t.y,a=i===void 0?0:i;this.transform=new er(-o,-a).rotate(e).translate(o,a).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),n.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,r=t&&t(e.type),o=this.createId();e.id=o||r||Yt()}this.formatText(e),Y(this,Mi(e));var i=this.graphModel.overlapMode;i===yt.INCREASE&&(this.zIndex=e.zIndex||en())},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,r,o,i=this.graphModel.editConfigModel,a=i.nodeTextDraggable,s=i.nodeTextEdit,l=e.x,d=e.y,u=e.text,f={value:"",x:l,y:d,draggable:a,editable:s};u&&(typeof u=="string"?f.value=u:(f=q(q({},f),{x:(t=u.x)!==null&&t!==void 0?t:l,y:(r=u.y)!==null&&r!==void 0?r:d,value:(o=u.value)!==null&&o!==void 0?o:""}),ee(u.draggable)||(f.draggable=u.draggable),ee(u.editable)||(f.editable=u.editable))),e.text=f},n.prototype.resize=function(e){var t=e.width,r=e.height,o=e.deltaX,i=e.deltaY,a=this.isAllowResizeNode(o,i,t,r);return a?(this.move(o/2,i/2),this.width=t,this.height=r,this.setProperties({width:t,height:r}),this.getData()):this.getData()},n.prototype.proportionalResize=function(){},n.prototype.getData=function(){var e=this.text,t=e.x,r=e.y,o=e.value,i=this.properties;oo(i)&&(i=Et(i)),dt(i.width)&&(i.width=this.width),dt(i.height)&&(i.height=this.height);var a={id:this.id,type:this.type,x:this.x,y:this.y,properties:i};return this.rotate&&(a.rotate=this.rotate),this.graphModel.overlapMode===yt.INCREASE&&(a.zIndex=this.zIndex),o&&(a.text={x:t,y:r,value:o}),a},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.getProperties=function(){return Et(this.properties)},n.prototype.getOuterGAttributes=function(){return{className:""}},n.prototype.getNodeStyle=function(){return q(q({},this.graphModel.theme.baseNode),this.style)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,r=t===void 0?{}:t;return q(q({},L(e)),L(r))},n.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return L(e)},n.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return L(e)},n.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return L(e)},n.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return L(t)},n.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return L(t)},n.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return L(e)},n.prototype.isAllowConnectedAsSource=function(e,t,r,o){var i=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var a=!0,s="",l=0;l<i.length;l++){var d=i[l];if(!d.validate.call(this,this,e,t,r,o)){a=!1,s=d.message;break}}return{isAllPass:a,msg:s}},n.prototype.getConnectedSourceRules=function(){return this.sourceRules},n.prototype.isAllowConnectedAsTarget=function(e,t,r,o){var i=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var a=!0,s="",l=0;l<i.length;l++){var d=i[l];if(!d.validate.call(this,e,this,t,r,o)){a=!1,s=d.message;break}}return{isAllPass:a,msg:s}},n.prototype.isAllowMoveNode=function(e,t){var r,o,i=!0,a=!0,s=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var l=Cn(s),d=l.next();!d.done;d=l.next()){var u=d.value,f=u(this,e,t);if(!f)return!1;if(typeof f=="object"){var c=f;if(!c.x&&!c.y)return!1;i=i&&c.x,a=a&&c.y}}}catch(h){r={error:h}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return{x:i,y:a}},n.prototype.getConnectedTargetRules=function(){return this.targetRules},n.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,r=e.id,o=e.x,i=e.y;return t&&t.length>0?t.map(function(a,s){return a.length?(a=a,{id:"".concat(r,"_").concat(s),x:o+a[0],y:i+a[1]}):(a=a,q(q({},a),{x:o+a.x,y:i+a.y,id:a.id||"".concat(r,"_").concat(s)}))}):this.getDefaultAnchor()},n.prototype.getDefaultAnchor=function(){return[]},n.prototype.getTargetAnchor=function(e){return mi(e,this)},n.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(n.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,r=t.x,o=t.y,i=t.rotate;return e.forEach(function(a){var s=a.x,l=a.y,d=xa(new be([s,l,1]).translate(-r,-o).rotate(i).translate(r,o)[0],2),u=d[0],f=d[1];a.x=u,a.y=f}),e},enumerable:!1,configurable:!0}),n.prototype.getAnchorInfo=function(e){if(!dt(e))for(var t=0;t<this.anchors.length;t++){var r=this.anchors[t];if(r.id===e)return r}},n.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},n.prototype.isAllowMoveByXORY=function(e,t,r){var o,i;if(r)o=!0,i=!0;else{var a=this.isAllowMoveNode(e,t);typeof a=="boolean"?(o=a,i=a):(o=a.x,i=a.y)}return{isAllowMoveX:o,isAllowMoveY:i}},n.prototype.move=function(e,t,r){r===void 0&&(r=!1);var o=this.isAllowMoveByXORY(e,t,r),i=o.isAllowMoveX,a=o.isAllowMoveY;return i&&(this.x=this.x+e,this.text&&this.moveText(e,0)),a&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(i||a)&&(this.rotate=this._rotate),i||a},n.prototype.getMoveDistance=function(e,t,r){r===void 0&&(r=!1);var o=this.isAllowMoveByXORY(e,t,r),i=o.isAllowMoveX,a=o.isAllowMoveY,s=0,l=0;return i&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),s=e),a&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),l=t),this.transform=new er(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[s,l]},n.prototype.moveTo=function(e,t,r){r===void 0&&(r=!1);var o=e-this.x,i=t-this.y;return!r&&!this.isAllowMoveNode(o,i)?!1:(this.text&&this.moveText(o,i),this.x=e,this.y=t,!0)},n.prototype.moveText=function(e,t){var r=this.text,o=r.x,i=r.y,a=r.value,s=r.draggable,l=r.editable;this.text={value:a,editable:l,draggable:s,x:o+e,y:i+t}},n.prototype.updateText=function(e){this.text=q(q({},Et(this.text)),{value:e})},n.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},n.prototype.isAllowResizeNode=function(e,t,r,o){var i,a,s=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var l=Cn(s),d=l.next();!d.done;d=l.next()){var u=d.value,f=u(this,e,t,r,o);if(!f)return!1}}catch(c){i={error:c}}finally{try{d&&!d.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}return!0},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},n.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},n.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},n.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateProperties=function(e,t){var r=Et(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(T.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:r,properties:e})},n.prototype.setProperty=function(e,t){var r=Et(this.properties),o=L(r);wo(o,e,rt(t)),this.updateProperties(o,[e])},n.prototype.setProperties=function(e){var t=Et(this.properties),r=q(q({},t),rt(e)),o=[];Ao(e,function(i,a){(nn(t,a)&&t[a]!==i||!nn(t,a))&&o.push(a)}),this.updateProperties(r,o)},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setStyle=function(e,t){var r;this.style=q(q({},this.style),(r={},r[e]=rt(t),r))},n.prototype.setStyles=function(e){this.style=q(q({},this.style),rt(e))},n.prototype.updateStyles=function(e){this.style=q({},rt(e))},n.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},n.prototype.updateAttributes=function(e){Y(this,e)},n.BaseType=U.NODE,C([E],n.prototype,"type",void 0),C([E],n.prototype,"x",void 0),C([E],n.prototype,"y",void 0),C([E],n.prototype,"textMode",void 0),C([E],n.prototype,"text",void 0),C([E],n.prototype,"properties",void 0),C([E],n.prototype,"_width",void 0),C([E],n.prototype,"_height",void 0),C([E],n.prototype,"anchorsOffset",void 0),C([E],n.prototype,"isSelected",void 0),C([E],n.prototype,"isHovered",void 0),C([E],n.prototype,"isShowAnchor",void 0),C([E],n.prototype,"isDragging",void 0),C([E],n.prototype,"isHitable",void 0),C([E],n.prototype,"isHittable",void 0),C([E],n.prototype,"draggable",void 0),C([E],n.prototype,"visible",void 0),C([E],n.prototype,"rotatable",void 0),C([E],n.prototype,"resizable",void 0),C([E],n.prototype,"zIndex",void 0),C([E],n.prototype,"state",void 0),C([E],n.prototype,"autoToFront",void 0),C([E],n.prototype,"style",void 0),C([E],n.prototype,"transform",void 0),C([E],n.prototype,"_rotate",void 0),C([F],n.prototype,"incoming",null),C([F],n.prototype,"outgoing",null),C([m],n.prototype,"setTextMode",null),C([m],n.prototype,"addNodeMoveRules",null),C([m],n.prototype,"move",null),C([m],n.prototype,"getMoveDistance",null),C([m],n.prototype,"moveTo",null),C([m],n.prototype,"moveText",null),C([m],n.prototype,"updateText",null),C([m],n.prototype,"addNodeResizeRules",null),C([m],n.prototype,"setSelected",null),C([m],n.prototype,"setHovered",null),C([m],n.prototype,"setIsShowAnchor",null),C([m],n.prototype,"setRotatable",null),C([m],n.prototype,"setResizable",null),C([m],n.prototype,"setHitable",null),C([m],n.prototype,"setHittable",null),C([m],n.prototype,"setElementState",null),C([m],n.prototype,"setProperty",null),C([m],n.prototype,"setProperties",null),C([m],n.prototype,"deleteProperty",null),C([m],n.prototype,"setStyle",null),C([m],n.prototype,"setStyles",null),C([m],n.prototype,"updateStyles",null),C([m],n.prototype,"setZIndex",null),C([m],n.prototype,"updateAttributes",null),n}(),Ea=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ce=function(){return ce=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ce.apply(this,arguments)},xr=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ln=function(n){Ea(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.CIRCLE_NODE,o.r=50,o.initNodeData(t),o.setAttributes(),o}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.circle,o=this.properties.style,i=o===void 0?{}:o;return ce(ce(ce({},t),L(r)),L(i))},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,o=t.y,i=t.r;return[{x:r,y:o-i,id:"".concat(this.id,"_0")},{x:r+i,y:o,id:"".concat(this.id,"_1")},{x:r,y:o+i,id:"".concat(this.id,"_2")},{x:r-i,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var r=t.width,o=t.deltaX,i=t.deltaY;return this.move(o/2,i/2),this.r=r,this.setProperties({r}),this.getData()},xr([E],e.prototype,"r",void 0),xr([F],e.prototype,"width",null),xr([F],e.prototype,"height",null),e}(Lt),Ma=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pe=function(){return pe=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},pe.apply(this,arguments)},Zt=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},He=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},jn=function(n){Ma(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.DIAMOND_NODE,o.rx=30,o.ry=50,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.rx,o=t.ry;r&&(this.rx=r),o&&(this.ry=o)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.diamond,o=this.properties.style,i=o===void 0?{}:o;return pe(pe(pe({},t),L(r)),L(i))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,r=t.x,o=t.y,i=t.rx,a=t.ry;return[[r,o-a],[r+i,o],[r,o+a],[r-i,o]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return Pt(this.points,function(t){var r=He(t,2),o=r[0],i=r[1];return{x:o,y:i}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return W(this.points,function(o){var i=He(o,1),a=i[0];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return W(this.points,function(o){var i=He(o,2),a=i[1];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return Pt(this.points,function(r,o){var i=He(r,2),a=i[0],s=i[1];return{x:a,y:s,id:"".concat(t.id,"_").concat(o)}})},e.prototype.resize=function(t){var r=t.width,o=t.height,i=t.deltaX,a=t.deltaY;return this.move(i/2,a/2),this.rx=r,this.ry=o,this.setProperties({rx:r,ry:o}),this.getData()},Zt([E],e.prototype,"rx",void 0),Zt([E],e.prototype,"ry",void 0),Zt([F],e.prototype,"points",null),Zt([F],e.prototype,"pointsPosition",null),Zt([F],e.prototype,"width",null),Zt([F],e.prototype,"height",null),e}(Lt),Oa=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),he=function(){return he=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},he.apply(this,arguments)},Ge=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Rn=function(n){Oa(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.ELLIPSE_NODE,o.rx=30,o.ry=45,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.rx,o=t.ry;r&&(this.rx=r),o&&(this.ry=o)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.ellipse,o=this.properties.style,i=o===void 0?{}:o;return he(he(he({},t),L(r)),L(i))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,o=t.y,i=t.rx,a=t.ry;return[{x:r,y:o-a,id:"".concat(this.id,"_0")},{x:r+i,y:o,id:"".concat(this.id,"_1")},{x:r,y:o+a,id:"".concat(this.id,"_2")},{x:r-i,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var r=t.width,o=t.height,i=t.deltaX,a=t.deltaY;return this.move(i/2,a/2),this.rx=r,this.ry=o,this.setProperties({rx:r,ry:o}),this.getData()},Ge([E],e.prototype,"rx",void 0),Ge([E],e.prototype,"ry",void 0),Ge([F],e.prototype,"width",null),Ge([F],e.prototype,"height",null),e}(Lt),Sa=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ve=function(){return ve=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ve.apply(this,arguments)},ze=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Fe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},In=function(n){Sa(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.POLYGON_NODE,o.points=[[50,0],[100,50],[50,100],[0,50]],o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.points,o=t.width,i=t.height,a=r||this.points;this.points=hi(a,o,i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.polygon,o=this.properties.style,i=o===void 0?{}:o;return ve(ve(ve({},t),L(r)),L(i))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,r=t.x,o=t.y,i=t.width,a=t.height;return this.points.map(function(s){return{x:s[0]+r-i/2,y:s[1]+o-a/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var i=Fe(o,1),a=i[0];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var i=Fe(o,2),a=i[1];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,r=this,o=r.x,i=r.y,a=r.width,s=r.height,l=r.points;return l.map(function(d,u){var f=Fe(d,2),c=f[0],h=f[1];return{x:o+c-a/2,y:i+h-s/2,id:"".concat(t.id,"_").concat(u)}})},e.prototype.resize=function(t){var r=this,o=t.width,i=t.height,a=t.deltaX,s=t.deltaY;this.move(a/2,s/2);var l=Pt(this.points,function(d){var u=Fe(d,2),f=u[0],c=u[1];return[f*o/r.width,c*i/r.height]});return this.points=l,this.properties.points=l,this.getData()},ze([E],e.prototype,"points",void 0),ze([F],e.prototype,"pointsPosition",null),ze([F],e.prototype,"width",null),ze([F],e.prototype,"height",null),e}(Lt),wa=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ye=function(){return ye=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ye.apply(this,arguments)},Aa=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Bn=function(n){wa(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.RECT_NODE,o.radius=0,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.width,o=t.height,i=t.radius,a=this.getNodeStyle().radius;dt(r)||(this.width=r),dt(o)||(this.height=o),dt(i)||(this.radius=i),dt(a)||(this.radius=a)},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,o=t.y,i=t.width,a=t.height;return[{x:r,y:o-a/2,id:"".concat(this.id,"_0")},{x:r+i/2,y:o,id:"".concat(this.id,"_1")},{x:r,y:o+a/2,id:"".concat(this.id,"_2")},{x:r-i/2,y:o,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.rect,o=this.properties.style,i=o===void 0?{}:o;return ye(ye(ye({},t),L(r)),L(i))},Aa([E],e.prototype,"radius",void 0),e}(Lt),Pa=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ge=function(){return ge=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ge.apply(this,arguments)},kn=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ta=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Da=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},Xn=function(n){Pa(e,n);function e(){var t=n.apply(this,Da([],Ta(arguments),!1))||this;return t.modelType=R.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=n.prototype.getTextStyle.call(this),r=this.graphModel.theme.text,o=this.properties.textStyle;return ge(ge(ge({},t),L(r)),L(o))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),r=this.getTextStyle().fontSize,o=Sn({rows:t,fontSize:r,rowsLength:t.length}).width;return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),r=this.getTextStyle().fontSize,o=Sn({rows:t,fontSize:r,rowsLength:t.length}).height;return o},enumerable:!1,configurable:!0}),kn([F],e.prototype,"width",null),kn([F],e.prototype,"height",null),e}(Lt),Na=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yn=function(n){Na(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.modelType=R.HTML_NODE,o.setAttributes(),o}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.width,o=t.height;r&&(this.width=r),o&&(this.height=o)},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,o=t.y,i=t.width,a=t.height;return[{x:r,y:o-a/2,id:"".concat(this.id,"_0")},{x:r+i/2,y:o,id:"".concat(this.id,"_1")},{x:r,y:o+a/2,id:"".concat(this.id,"_2")},{x:r-i/2,y:o,id:"".concat(this.id,"_3")}]},e}(Lt),k=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},ba={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},$e=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],Ca=function(){function n(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=ft.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ft.TEXT,this.edgeTextMode=ft.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",Y(this,this.computeConfig(e))}return n.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);Y(this,t)},n.prototype.computeConfig=function(e){var t=e.isSilentMode,r=e.textDraggable,o=e.textMode,i=e.textEdit,a=e.adjustEdgeStartAndEnd,s={};if(t===!1&&Y(s,this.stagedConfig),t===!0&&t!==this.isSilentMode){var l=qt(ba,$e);this.stagedConfig=qt(this,$e),Y(s,l)}ee(i)||Y(s,{nodeTextEdit:i,edgeTextEdit:i}),ee(r)||Y(s,{nodeTextDraggable:r,edgeTextDraggable:r}),o&&Y(s,{nodeTextMode:o,edgeTextMode:o}),wr(a)&&Y(s,{adjustEdgeStart:a,adjustEdgeEnd:a});var d=qt(e,$e);return Y(s,d)},n.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},n.prototype.getConfig=function(){return qt(this,$e)},k([E],n.prototype,"isSilentMode",void 0),k([E],n.prototype,"stopZoomGraph",void 0),k([E],n.prototype,"stopMoveGraph",void 0),k([E],n.prototype,"stopScrollGraph",void 0),k([E],n.prototype,"snapGrid",void 0),k([E],n.prototype,"textMode",void 0),k([E],n.prototype,"textEdit",void 0),k([E],n.prototype,"textDraggable",void 0),k([E],n.prototype,"nodeTextEdit",void 0),k([E],n.prototype,"nodeTextDraggable",void 0),k([E],n.prototype,"nodeTextMultiple",void 0),k([E],n.prototype,"nodeTextVertical",void 0),k([E],n.prototype,"nodeTextMode",void 0),k([E],n.prototype,"edgeTextMode",void 0),k([E],n.prototype,"edgeTextEdit",void 0),k([E],n.prototype,"edgeTextDraggable",void 0),k([E],n.prototype,"edgeTextMultiple",void 0),k([E],n.prototype,"edgeTextVertical",void 0),k([E],n.prototype,"hideAnchors",void 0),k([E],n.prototype,"allowRotate",void 0),k([E],n.prototype,"allowResize",void 0),k([E],n.prototype,"hoverOutline",void 0),k([E],n.prototype,"nodeSelectedOutline",void 0),k([E],n.prototype,"adjustNodePosition",void 0),k([E],n.prototype,"autoExpand",void 0),k([E],n.prototype,"adjustEdge",void 0),k([E],n.prototype,"adjustEdgeMiddle",void 0),k([E],n.prototype,"adjustEdgeStartAndEnd",void 0),k([E],n.prototype,"adjustEdgeStart",void 0),k([E],n.prototype,"adjustEdgeEnd",void 0),k([E],n.prototype,"edgeSelectedOutline",void 0),k([m],n.prototype,"updateEditConfig",null),k([m],n.prototype,"updateTextMode",null),n}(),La="*",ja=function(){function n(){this._events={}}return n.prototype.on=function(e,t,r){var o=this;e==null||e.split(",").forEach(function(i){i=i.trim(),o._events[i]||(o._events[i]=[]),o._events[i].push({callback:t,once:!!r})})},n.prototype.once=function(e,t){var r=this;e==null||e.split(",").forEach(function(o){o=o.trim(),r.on(o,t,!0)})},n.prototype.emit=function(e,t){var r=this;e==null||e.split(",").forEach(function(o){var i=r._events[o]||[],a=r._events[La]||[],s=function(l){for(var d=l.length,u=0;u<d;u++)if(l[u]){var f=l[u],c=f.callback,h=f.once;h&&(l.splice(u,1),l.length===0&&delete r._events[o],d--,u--),c.apply(r,[t])}};s(i),s(a)})},n.prototype.off=function(e,t){var r=this;e||(this._events={}),e.split(",").forEach(function(o){if(!t)delete r._events[o];else{for(var i=r._events[o]||[],a=i.length,s=0;s<a;s++)i[s].callback===t&&(i.splice(s,1),a--,s--);i.length===0&&delete r._events[o]}})},n.prototype.getEvents=function(){return this._events},n.prototype.destroy=function(){this._events={}},n}(),Ra=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yr=function(){return Yr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Yr.apply(this,arguments)},Ia=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ba=function(n){Ra(e,n);function e(t){var r=n.call(this)||this;r.stepScrollX=0,r.stepScrollY=0,r.onDragging=function(s){var l=s.deltaX,d=s.deltaY;r.setState({isDragging:!0});var u=r.props.graphModel,f=u.transformModel,c=u.editConfigModel;c.stopMoveGraph!==!0&&f.translate(l,d)},r.onDragEnd=function(){r.setState({isDragging:!1})},r.zoomHandler=function(s){var l=r.props,d=l.graphModel,u=d.editConfigModel,f=d.transformModel,c=d.gridSize,h=l.graphModel,v=s.deltaX,p=s.deltaY,g=u.stopScrollGraph,y=u.stopZoomGraph;if(!g&&!s.ctrlKey&&!s.metaKey){if(s.preventDefault(),r.stepScrollX+=v,r.stepScrollY+=p,Math.abs(r.stepScrollX)>=c){var _=r.stepScrollX%c,O=r.stepScrollX-_;f.translate(-O*f.SCALE_X,0),r.stepScrollX=_}if(Math.abs(r.stepScrollY)>=c){var S=r.stepScrollY%c,M=r.stepScrollY-S;f.translate(0,-M*f.SCALE_Y),r.stepScrollY=S}return}if(!y){s.preventDefault();var w=h.getPointByClient({x:s.clientX,y:s.clientY}),A=w.canvasOverlayPosition,D=A.x,N=A.y;f.zoom(s.deltaY<0,[D,N])}},r.clickHandler=function(s){var l=s.target;if(l.getAttribute("name")==="canvas-overlay"){var d=r.props.graphModel,u=d.selectElements;u.size>0&&d.clearSelectElements(),d.eventCenter.emit(T.BLANK_CLICK,{e:s})}},r.handleContextMenu=function(s){var l=s.target;if(l.getAttribute("name")==="canvas-overlay"){s.preventDefault();var d=r.props.graphModel,u=d.getPointByClient({x:s.clientX,y:s.clientY});d.eventCenter.emit(T.BLANK_CONTEXTMENU,{e:s,position:u})}},r.mouseDownHandler=function(s){var l=r.props.graphModel,d=l.eventCenter,u=l.editConfigModel,f=l.transformModel.SCALE_X,c=l.gridSize,h=u.adjustEdge,v=u.adjustNodePosition,p=u.stopMoveGraph,g=s.target,y=!h&&!v;(g.getAttribute("name")==="canvas-overlay"||y)&&(p!==!0?(r.stepDrag.setStep(c*f),r.stepDrag.handleMouseDown(s)):d.emit(T.BLANK_MOUSEDOWN,{e:s}),r.clickHandler(s))};var o=t.graphModel,i=o.gridSize,a=o.eventCenter;return r.stepDrag=new St({onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:i,eventType:"BLANK",isStopPropagation:!1,eventCenter:a,model:void 0}),r.state={isDragging:!1},r}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,r=t.getTransformStyle().transform,o=this.props,i=o.children,a=o.dnd,s=this.state.isDragging;return x("svg",Yr({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:s?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},a.eventMap(),{children:x("g",{transform:r,children:i})}))},e=Ia([at],e),e}(V),mo=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ne=function(){return Ne=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Ne.apply(this,arguments)},ka=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Xa=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Hn=function(n){mo(e,n);function e(){var t=n.call(this)||this;return t.onDragging=function(r){var o=r.event,i=t.props,a=i.graphModel,s=i.bezierModel,l=i.type,d=a.getPointByClient({x:o.clientX,y:o.clientY}).canvasOverlayPosition,u=d.x,f=d.y;s.updateAdjustAnchor({x:u,y:f},l),a.eventCenter.emit(T.EDGE_ADJUST,{data:s.getData()})},t.onDragEnd=function(){var r=t.props.bezierModel;r.isDragging=!1},t.dragHandler=new St({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,r=this.props.position,o=r.x,i=r.y,a=this.props.bezierModel,s=a.getEdgeStyle().adjustAnchor;return x(oe,Ne({className:"lf-bezier-adjust-anchor",x:o,y:i},s,{onMouseDown:function(l){t.dragHandler.handleMouseDown(l)}}))},e}(V),Ya=function(n){mo(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,r){var o=t.path,i=t.id,a=Qr(o),s=Xa(a,4),l=s[0],d=s[1],u=s[2],f=s[3],c=t.getEdgeStyle().adjustLine,h=[];return h.push(x(ne,Ne({x1:l.x,y1:l.y,x2:d.x,y2:d.y},c))),h.push(x(Hn,{position:d,bezierModel:t,graphModel:r,type:"sNext"},"".concat(i,"_ePre"))),h.push(x(ne,Ne({x1:f.x,y1:f.y,x2:u.x,y2:u.y},c))),h.push(x(Hn,{position:u,bezierModel:t,graphModel:r,type:"ePre"},"".concat(i,"_sNext"))),h},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,r=t.edges,o=[],i=0;i<r.length;i++){var a=r[i];a.isSelected&&a.modelType===R.BEZIER_EDGE&&a.draggable&&o.push(this.getBezierAdjust(a,t))}return o},e.prototype.render=function(){return x("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=ka([at],e),e}(V),Ha=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ga=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},za=function(n){Ha(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return x("div",{className:"lf-background",children:x("div",{style:Po(t)?t:{},className:"lf-background-area"})})},e=Ga([at],e),e}(V),Fa=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$a=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},te=function(n){Fa(e,n);function e(t){var r=n.call(this,t)||this;return r.id=Yt(),r.gridOptions=r.props.graphModel.grid,r}return e.prototype.renderDot=function(){var t=this.gridOptions,r=t.config,o=t.size,i=o===void 0?1:o,a=t.visible,s=r??{},l=s.color,d=s.thickness,u=d===void 0?2:d,f=Math.min(Math.max(2,u),i/4),c=a?1:0;return x("g",{fill:l,opacity:c,children:[x("circle",{cx:0,cy:0,r:f/2}),x("circle",{cx:0,cy:i,r:f/2}),x("circle",{cx:i,cy:0,r:f/2}),x("circle",{cx:i,cy:i,r:f/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,r=t.config,o=t.size,i=o===void 0?1:o,a=t.visible,s=r??{},l=s.color,d=s.thickness,u=d===void 0?1:d,f=Math.min(Math.max(1,u),i/2),c="M 0 0 H ".concat(i," V ").concat(i," H 0 Z"),h=a?1:0;return x("path",{d:c,stroke:l,strokeWidth:f/2,opacity:h,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,r=t.transformModel,o=t.grid;this.gridOptions=o;var i=this.gridOptions,a=i.type,s=i.size,l=s===void 0?1:s,d=r.SCALE_X,u=r.SKEW_Y,f=r.SKEW_X,c=r.SCALE_Y,h=r.TRANSLATE_X,v=r.TRANSLATE_Y,p=[d,u,f,c,h,v].join(","),g="matrix(".concat(p,")");return x("div",{className:"lf-grid",children:x("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[x("defs",{children:x("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:g,x:"0",y:"0",width:l,height:l,children:[a==="dot"&&this.renderDot(),a==="mesh"&&this.renderMesh()]})}),x("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=$a([at],e),e}(V);(function(n){n.defaultProps={size:$o,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var r=L(n.defaultProps);return typeof t=="number"?Y(r,{size:t}):typeof t=="boolean"?Y(r,{visible:t}):Y(r,t)}n.getGridOptions=e})(te||(te={}));var Ua=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wa=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Za=function(n){Ua(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,r=t.getTransformStyle().transform,o=this.props.children;return x("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:x("g",{transform:r,children:o})})},e=Wa([at],e),e}(V),Ka=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Tt=function(){return Tt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Tt.apply(this,arguments)},Va=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},qa=function(n){Ka(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,r=t.nodes,o=t.editConfigModel,i=o.hoverOutline,a=o.nodeSelectedOutline,s=[];return r.forEach(function(l){if(l.isHovered||l.isSelected){var d=l.isHovered,u=l.isSelected,f=l.x,c=l.y,h=l.width,v=l.height;if(a&&u||i&&d){var p=l.getOutlineStyle(),g={};if(Object.keys(p).forEach(function(_){_!=="hover"&&(g[_]=p[_])}),d){var y=p.hover;g=Tt(Tt({},g),y)}s.push(x(Ot,Tt({transform:l.transform,className:"lf-outline-node",x:f,y:c,width:h+10,height:v+10},g)))}}}),s},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,r=t.edges,o=t.editConfigModel,i=o.edgeSelectedOutline,a=o.hoverOutline,s=[],l=0;l<r.length;l++){var d=r[l];(i&&d.isSelected||a&&d.isHovered)&&(d.modelType===R.LINE_EDGE?s.push(this.getLineOutline(d)):d.modelType===R.POLYLINE_EDGE?s.push(this.getPolylineOutline(d)):d.modelType===R.BEZIER_EDGE&&s.push(this.getBezierOutline(d)))}return s},e.prototype.getLineOutline=function(t){var r=t.startPoint,o=t.endPoint,i=(r.x+o.x)/2,a=(r.y+o.y)/2,s=Math.abs(r.x-o.x)+10,l=Math.abs(r.y-o.y)+10,d=t.getOutlineStyle();return x(Ot,Tt({className:"lf-outline-edge",x:i,y:a,width:s,height:l},d))},e.prototype.getPolylineOutline=function(t){var r=t.points,o=Gt(r),i=Oe(o,8),a=i.x,s=i.y,l=i.width,d=i.height,u=t.getOutlineStyle();return x(Ot,Tt({className:"lf-outline",x:a,y:s,width:l,height:d},u))},e.prototype.getBezierOutline=function(t){var r=t.path,o=Qr(r),i=Oe(o,8),a=i.x,s=i.y,l=i.width,d=i.height,u=t.getOutlineStyle();return x(Ot,Tt({className:"lf-outline",x:a,y:s,width:l,height:d},u))},e.prototype.render=function(){return x("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=Va([at],e),e}(V),Ja=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Dt=function(){return Dt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Dt.apply(this,arguments)},Qa=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},ts=function(n){Ja(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,r=t??{},o=r.position,i=r.isShowHorizontal,a=r.isShowVertical,s=t==null?void 0:t.getStyle(),l=o??{},d=l.x,u=d===void 0?0:d,f=l.y,c=f===void 0?0:f,h=Dt(Dt({x1:-1e5,y1:c,x2:1e5,y2:c},s),{stroke:i?s==null?void 0:s.stroke:"none"}),v=Dt(Dt({x1:u,y1:-1e5,x2:u,y2:1e5},s),{stroke:a?s==null?void 0:s.stroke:"none"});return x("g",{className:"lf-snapline",children:[x(ne,Dt({},h)),x(ne,Dt({},v))]})},e=Qa([at],e),e}(V),es=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),rs=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},ns=function(n){es(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,r=t.tool,o=t.graphModel,i=o.textEditElement,a=r.getTools(),s=a.map(function(l){return ro(l,{textEditElement:i,graphModel:o,lf:r.instance})});return r.components=s,s},e.prototype.triggerToolRender=function(){var t=this.props,r=t.tool,o=t.graphModel,i=document.querySelector("#ToolOverlay_".concat(o.flowId)),a=r.getInstance();a.components.forEach(function(s){return s(a,i)}),a.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return x("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=rs([at],e),e}(V),et=function(){return et=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},et.apply(this,arguments)},P=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},os=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},J=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},lt=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},is=function(){function n(e){var t=this,r,o;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=yt.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var i=e.container,a=e.partial,s=e.background,l=s===void 0?{}:s,d=e.grid,u=e.idGenerator,f=e.edgeGenerator,c=e.animation,h=e.customTrajectory;this.rootEl=i,this.partial=!!a,this.background=l,typeof d=="object"&&e.snapGrid&&(this.gridSize=d.size||1),this.customStyles=e.style||{},this.grid=te.getGridOptions(d??!1),this.theme=_o(e.style,e.themeMode),this.theme.grid=L(this.grid),this.theme.background=L(this.background),this.edgeType=e.edgeType||"polyline",this.animation=Go(c),this.overlapMode=e.overlapMode||yt.DEFAULT,this.width=(r=e.width)!==null&&r!==void 0?r:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=dt(e.width),this.height=(o=e.height)!==null&&o!==void 0?o:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=dt(e.height);var v=new ResizeObserver(no(function(p){var g,y;try{for(var _=os(p),O=_.next();!O.done;O=_.next()){var S=O.value;S.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:S.contentRect}))}}catch(M){g={error:M}}finally{try{O&&!O.done&&(y=_.return)&&y.call(_)}finally{if(g)throw g.error}}},16));v.observe(this.rootEl),this.waitCleanEffects.push(function(){v.disconnect()}),this.eventCenter=new ja,this.editConfigModel=new Ca(e),this.transformModel=new ls(this.eventCenter,e),this.flowId=Yt(),this.idGenerator=u,this.edgeGenerator=ci(this,f),this.customTrajectory=h}return Object.defineProperty(n.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,r){return e[t.id]={index:r,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,r){return e[t.id]={index:r,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelsMap",{get:function(){return lt(lt([],J(this.nodes),!1),J(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortElements",{get:function(){for(var e=lt(lt([],J(this.nodes),!1),J(this.edges),!1).sort(function(s,l){return s.zIndex-l.zIndex}),t=[],r=[-Ie,-Ie],o=[this.width+Ie,this.height+Ie],i=0;i<e.length;i++){var a=e[i];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,r,o,!1,!1))&&t.push(a)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(r){return r.state===X.TEXT_EDIT}),t=this.edges.find(function(r){return r.state===X.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),n.prototype.getAreaElement=function(e,t,r,o,i){var a=this;r===void 0&&(r=!0),o===void 0&&(o=!0),i===void 0&&(i=!1);var s=[];return W(lt(lt([],J(this.nodes),!1),J(this.edges),!1),function(l){var d=a.isElementInArea(l,e,t,r,o);(!i||l.visible)&&d&&s.push(l)}),s},n.prototype.getModel=function(e){return this.modelMap.get(e)},n.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getPointByClient=function(e){var t=e.x,r=e.y,o=this.rootEl.getBoundingClientRect(),i={x:t-o.left,y:r-o.top},a=J(this.transformModel.HtmlPointToCanvasPoint([i.x,i.y]),2),s=a[0],l=a[1],d={x:s,y:l};return{domOverlayPosition:i,canvasOverlayPosition:d}},n.prototype.isElementInArea=function(e,t,r,o,i){var a;if(o===void 0&&(o=!0),i===void 0&&(i=!0),e.BaseType===U.NODE){e=e;for(var s=it(e),l=s.minX,d=s.minY,u=s.maxX,f=s.maxY,c=[{x:l,y:d},{x:u,y:d},{x:u,y:f},{x:l,y:f}],h=i,v=0;v<c.length;v++){var p=c[v],g=p.x,y=p.y;if(a=J(this.transformModel.CanvasPointToHtmlPoint([g,y]),2),g=a[0],y=a[1],gr([g,y],t,r)!==i){h=!i;break}}return h}if(e.BaseType===U.EDGE){e=e;var _=e.startPoint,O=e.endPoint,S=this.transformModel.CanvasPointToHtmlPoint([_.x,_.y]),M=this.transformModel.CanvasPointToHtmlPoint([O.x,O.y]),w=gr(S,t,r),A=gr(M,t,r);return o?w&&A:w||A}return!1},n.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=Pt(e.nodes,function(o){var i=t.getModelAfterSnapToGrid(o);return t.elementsModelMap.set(i.id,i),t.nodeModelMap.set(i.id,i),i}):this.nodes=[],e.edges){var r=this.edgeType;this.edges=Pt(e.edges,function(o){var i,a=t.getModel((i=o.type)!==null&&i!==void 0?i:r);if(!a)throw new Error("找不到".concat(o.type,"对应的边。"));var s=new a(o,t);return t.edgeModelMap.set(s.id,s),t.elementsModelMap.set(s.id,s),s})}else this.edges=[]},n.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(r){var o=r.getData();o&&!r.virtual&&e.push(o)});var t=[];return this.nodes.forEach(function(r){var o=r.getData();o&&!r.virtual&&t.push(o)}),{nodes:t,edges:e}},n.prototype.modelToHistoryData=function(){for(var e=!1,t=[],r=0;r<this.nodes.length;r++){var o=this.nodes[r];if(o.isDragging){e=!0;break}else t.push(o.getHistoryData())}if(e)return!1;for(var i=!1,a=[],s=0;s<this.edges.length;s++){var l=this.edges[s];if(l.isDragging){i=!0;break}else a.push(l.getHistoryData())}return i?!1:{nodes:t,edges:a}},n.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getElement=function(e){return this.modelsMap[e]},n.prototype.getNodeEdges=function(e){for(var t=[],r=0;r<this.edges.length;r++){var o=this.edges[r],i=o.sourceNodeId===e,a=o.targetNodeId===e;(i||a)&&t.push(o)}return t},n.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,r={nodes:[],edges:[]};return t.forEach(function(o){if(o.BaseType===U.NODE&&r.nodes.push(o.getData()),o.BaseType===U.EDGE){var i=o.getData(),a=t.get(i.sourceNodeId)&&t.get(i.targetNodeId);(e||a)&&r.edges.push(i)}}),r},n.prototype.updateAttributes=function(e,t){var r=this.getElement(e);r==null||r.updateAttributes(t)},n.prototype.changeNodeId=function(e,t){return t||(t=Yt()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(r){r.sourceNodeId===e&&(r.sourceNodeId=t),r.targetNodeId===e&&(r.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},n.prototype.changeEdgeId=function(e,t){return t||(t=Yt()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(r){r.id===e&&r.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},n.prototype.getTextModel=function(e){var t=this.editConfigModel,r=t.textMode,o=t.nodeTextMode,i=t.edgeTextMode;if(e.BaseType===U.NODE)return e.textMode||o||r||ft.TEXT;if(e.BaseType===U.EDGE)return e.textMode||i||r||ft.TEXT},n.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},n.prototype.setFakeNode=function(e){this.fakeNode=e},n.prototype.removeFakeNode=function(){this.fakeNode=null},n.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},n.prototype.toFront=function(e){var t,r,o,i=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((r=this.edgesMap[e])===null||r===void 0?void 0:r.model);i&&(this.overlapMode===yt.DEFAULT&&((o=this.topElement)===null||o===void 0||o.setZIndex(),i.setZIndex(Fo),this.topElement=i),this.overlapMode===yt.INCREASE&&this.setElementZIndex(e,"top"))},n.prototype.setElementZIndex=function(e,t){var r,o,i=((r=this.nodesMap[e])===null||r===void 0?void 0:r.model)||((o=this.edgesMap[e])===null||o===void 0?void 0:o.model);if(i){var a=void 0;typeof t=="number"?a=t:(t==="top"&&(a=en()),t==="bottom"&&(a=ha())),i.setZIndex(a)}},n.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,r=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(T.NODE_DELETE,{data:r,model:t})},n.prototype.addNode=function(e,t,r){t===void 0&&(t=T.NODE_ADD);var o=rt(e),i=o.id;i&&this.nodesMap[i]&&delete o.id;var a=this.getModelAfterSnapToGrid(o);this.nodes.push(a);var s=a.getData(),l={data:s};return r&&(l.e=r),this.eventCenter.emit(t,l),a},n.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),r=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var o=e.x,i=e.y;o&&i&&(e.x=re(o,this.gridSize,r),e.y=re(i,this.gridSize,r),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-o,e.text.y+=e.y-i));var a=new t(e,this);return this.nodeModelMap.set(a.id,a),this.elementsModelMap.set(a.id,a),a},n.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),r=t==null?void 0:t.getData();if(r){r.x+=30,r.y+=30,r.id="",typeof r.text=="object"&&r.text!==null&&(r.text.x+=30,r.text.y+=30);var o=this.addNode(r);return o.setSelected(!0),t==null||t.setSelected(!1),o.getData()}},n.prototype.moveNode=function(e,t,r,o){var i;o===void 0&&(o=!1);var a=this.nodesMap[e];if(!a){console.warn("不存在id为".concat(e,"的节点"));return}var s=a.model;i=J(s.getMoveDistance(t,r,o),2),t=i[0],r=i[1],this.moveEdge(e,t,r)},n.prototype.moveNode2Coordinate=function(e,t,r,o){o===void 0&&(o=!1);var i=this.nodesMap[e];if(!i){console.warn("不存在id为".concat(e,"的节点"));return}var a=i.model,s=a.x,l=a.y,d=t-s,u=r-l;this.moveNode(e,d,u,o)},n.prototype.editText=function(e){this.setElementStateById(e,X.TEXT_EDIT)},n.prototype.addEdge=function(e){var t=rt(e),r=t.type;r||(r=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var o=this.getModel(r);if(!o)throw new Error("找不到".concat(r,"对应的边，请确认是否已注册此类型边。"));var i=new o(et(et({},t),{type:r}),this);this.edgeModelMap.set(i.id,i),this.elementsModelMap.set(i.id,i);var a=i.getData();return this.edges.push(i),this.eventCenter.emit(T.EDGE_ADD,{data:a}),i},n.prototype.moveEdge=function(e,t,r){for(var o=0;o<this.edges.length;o++){var i=this.edges[o],a=i.textPosition,s=a.x,l=a.y,d=this.edges[o].sourceNodeId===e,u=this.edges[o].targetNodeId===e;d&&i.moveStartPoint(t,r),u&&i.moveEndPoint(t,r),(d||u)&&this.handleEdgeTextMove(i,s,l)}},n.prototype.handleEdgeTextMove=function(e,t,r){var o;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===R.POLYLINE_EDGE&&(!((o=e.text)===null||o===void 0)&&o.value)){var i=e.text,a=lo(i,e.points);e.moveText(a.x-i.x,a.y-i.y)}var s=e.textPosition,l=s.x,d=s.y;e.moveText(l-t,d-r)},n.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var r=0;r<this.edges.length;r++)if(this.edges[r].sourceNodeId===e&&this.edges[r].targetNodeId===t){var o=this.edges[r].getData();this.edges.splice(r,1),r--,this.eventCenter.emit(T.EDGE_DELETE,{data:o})}},n.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var r=this.edgesMap[e].index,o=this.edgesMap[e].model.getData();this.edges.splice(r,1),this.eventCenter.emit(T.EDGE_DELETE,{data:o})}},n.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var r=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(T.EDGE_DELETE,{data:r})}},n.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var r=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(T.EDGE_DELETE,{data:r})}},n.prototype.setElementStateById=function(e,t,r){this.nodes.forEach(function(o){o.id===e?o.setElementState(t,r):o.setElementState(X.DEFAULT)}),this.edges.forEach(function(o){o.id===e?o.setElementState(t,r):o.setElementState(X.DEFAULT)})},n.prototype.updateText=function(e,t){var r=Ht(lt(lt([],J(this.nodes),!1),J(this.edges),!1),function(o){return o.id===e});r==null||r.updateText(t)},n.prototype.selectNodeById=function(e,t){var r;t===void 0&&(t=!1),t||this.clearSelectElements();var o=(r=this.nodesMap[e])===null||r===void 0?void 0:r.model;o==null||o.setSelected(!0)},n.prototype.selectEdgeById=function(e,t){var r;t===void 0&&(t=!1),t||this.clearSelectElements();var o=(r=this.edgesMap[e])===null||r===void 0?void 0:r.model;o==null||o.setSelected(!0)},n.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var r=this.getElement(e);r==null||r.setSelected(!0)},n.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},n.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===yt.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},n.prototype.moveNodes=function(e,t,r,o){var i,a,s,l=this;o===void 0&&(o=!1);for(var d=e.reduce(function(O,S){var M,w=(M=l.nodesMap[S])===null||M===void 0?void 0:M.model;return w&&(O[S]=w.getMoveDistance(t,r,o)),O},{}),u=0;u<this.edges.length;u++){var f=this.edges[u],c=f.textPosition,h=c.x,v=c.y,p=d[f.sourceNodeId],g=d[f.targetNodeId],y=void 0,_=void 0;p&&g&&f.modelType===R.POLYLINE_EDGE?(i=J(p,2),y=i[0],_=i[1],f.updatePointsList(y,_)):(p&&(a=J(p,2),y=a[0],_=a[1],f.moveStartPoint(y,_)),g&&(s=J(g,2),y=s[0],_=s[1],f.moveEndPoint(y,_))),(p||g)&&this.handleEdgeTextMove(f,h,v)}},n.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},n.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},n.prototype.setDefaultEdgeType=function(e){this.edgeType=e},n.prototype.changeNodeType=function(e,t){var r=this.getNodeModelById(e);if(!r){console.warn("找不到id为".concat(e,"的节点"));return}var o=r.getData();o.type=t;var i=this.getModel(t);if(!i)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var a=new i(o,this);this.nodes.splice(this.nodesMap[e].index,1,a);var s=this.getNodeEdges(e);s.forEach(function(l){if(l.sourceNodeId===e){var d=On(a,l.startPoint,a.width,a.height);l.updateStartPoint(d)}if(l.targetNodeId===e){var d=On(a,l.endPoint,a.width,a.height);l.updateEndPoint(d)}})},n.prototype.changeEdgeType=function(e,t){var r=this.getEdgeModelById(e);if(!r){console.warn("找不到id为".concat(e,"的边"));return}if(r.type!==t){var o=r.getData();o.type=t;var i=this.getModel(t);if(!i)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete o.pointsList;var a=new i(o,this);this.edges.splice(this.edgesMap[e].index,1,a)}},n.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.targetNodeId===e&&t.push(r)}),t},n.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.sourceNodeId===e&&t.push(r)}),t},n.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.targetAnchorId===e&&t.push(r)}),t},n.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.sourceAnchorId===e&&t.push(r)}),t},n.prototype.getNodeIncomingNode=function(e){var t=this,r=[];return this.edges.forEach(function(o){var i;o.targetNodeId===e&&r.push((i=t.nodesMap[o.sourceNodeId])===null||i===void 0?void 0:i.model)}),r},n.prototype.getNodeOutgoingNode=function(e){var t=this,r=[];return this.edges.forEach(function(o){o.sourceNodeId===e&&r.push(t.nodesMap[o.targetNodeId].model)}),r},n.prototype.setTheme=function(e,t){var r;if(t&&(Te[t]&&this.updateBackgroundOptions(et(et({},typeof this.background=="object"?this.background:{}),Te[t])),De[t]&&this.updateGridOptions(te.getGridOptions(et(et({},this.grid),De[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var o=te.getGridOptions((r=e.grid)!==null&&r!==void 0?r:!1);this.updateGridOptions(o)}this.theme=fa(et(et({},this.customStyles),e),t),this.customStyles=et(et({},this.customStyles),e)},n.prototype.getTheme=function(){var e=this,t=e.background,r=e.grid,o=et(et({},L(this.theme)),{background:t,grid:r});return o},n.prototype.updateGridOptions=function(e){Ve(this.grid,e)},n.prototype.updateGridSize=function(e){this.gridSize=e},n.prototype.updateBackgroundOptions=function(e){wr(e)||wr(this.background)?this.background=e:this.background=et(et({},this.background),e)},n.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=dt(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=dt(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},n.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},n.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],r=[];e.forEach(function(c){var h=c.x,v=c.y,p=c.width,g=c.height,y=c.getNodeStyle().strokeWidth,_=y===void 0?0:y,O=h+p/2+_,S=h-p/2-_,M=v+g/2+_,w=v-g/2-_;t=t.concat([O,S].filter(function(A){return!Number.isNaN(A)})),r=r.concat([M,w].filter(function(A){return!Number.isNaN(A)}))});var o=Math.min.apply(Math,lt([],J(t),!1)),i=Math.max.apply(Math,lt([],J(t),!1)),a=Math.min.apply(Math,lt([],J(r),!1)),s=Math.max.apply(Math,lt([],J(r),!1)),l=i-o||0,d=s-a||0,u=o+l/2,f=a+d/2;return{width:l,height:d,x:u,y:f}},n.prototype.translateCenter=function(){var e=this,t=e.nodes,r=e.width,o=e.height,i=e.rootEl,a=e.transformModel;if(t.length){var s=r||i.clientWidth,l=o||i.clientHeight,d=this.getVirtualRectSize(),u=d.x,f=d.y;a.focusOn(u,f,s,l)}},n.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var r=this,o=r.nodes,i=r.width,a=r.height,s=r.rootEl,l=r.transformModel;if(o.length){var d=i||s.clientWidth,u=a||s.clientHeight,f=this.getVirtualRectSize(),c=f.width,h=f.height,v=f.x,p=f.y,g=(c+t)/d,y=(h+e)/u,_=1/Math.max(g,y),O=[d/2,u/2];l.zoom(_,O),l.focusOn(v,p,d,u)}},n.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},n.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},n.prototype.getPartial=function(){return this.partial},n.prototype.setPartial=function(e){this.partial=e},n.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},P([E],n.prototype,"width",void 0),P([E],n.prototype,"height",void 0),P([E],n.prototype,"theme",void 0),P([E],n.prototype,"grid",void 0),P([E],n.prototype,"edgeType",void 0),P([E],n.prototype,"nodes",void 0),P([E],n.prototype,"edges",void 0),P([E],n.prototype,"fakeNode",void 0),P([E],n.prototype,"overlapMode",void 0),P([E],n.prototype,"background",void 0),P([E],n.prototype,"gridSize",void 0),P([E],n.prototype,"transformModel",void 0),P([E],n.prototype,"editConfigModel",void 0),P([E],n.prototype,"partial",void 0),P([F],n.prototype,"nodesMap",null),P([F],n.prototype,"edgesMap",null),P([F],n.prototype,"modelsMap",null),P([F],n.prototype,"sortElements",null),P([F],n.prototype,"textEditElement",null),P([F],n.prototype,"selectElements",null),P([F],n.prototype,"selectNodes",null),P([m],n.prototype,"setTextMode",null),P([m],n.prototype,"setFakeNode",null),P([m],n.prototype,"removeFakeNode",null),P([m],n.prototype,"setModel",null),P([m],n.prototype,"toFront",null),P([m],n.prototype,"setElementZIndex",null),P([m],n.prototype,"deleteNode",null),P([m],n.prototype,"addNode",null),P([m],n.prototype,"cloneNode",null),P([m],n.prototype,"moveNode",null),P([m],n.prototype,"moveNode2Coordinate",null),P([m],n.prototype,"editText",null),P([m],n.prototype,"addEdge",null),P([m],n.prototype,"moveEdge",null),P([m],n.prototype,"deleteEdgeBySourceAndTarget",null),P([m],n.prototype,"deleteEdgeById",null),P([m],n.prototype,"deleteEdgeBySource",null),P([m],n.prototype,"deleteEdgeByTarget",null),P([m],n.prototype,"setElementStateById",null),P([m],n.prototype,"updateText",null),P([m],n.prototype,"selectNodeById",null),P([m],n.prototype,"selectEdgeById",null),P([m],n.prototype,"selectElementById",null),P([m],n.prototype,"deselectElementById",null),P([m],n.prototype,"clearSelectElements",null),P([m],n.prototype,"moveNodes",null),P([m],n.prototype,"setDefaultEdgeType",null),P([m],n.prototype,"changeNodeType",null),P([m],n.prototype,"changeEdgeType",null),P([m],n.prototype,"getNodeIncomingEdge",null),P([m],n.prototype,"getNodeOutgoingEdge",null),P([m],n.prototype,"getAnchorIncomingEdge",null),P([m],n.prototype,"getAnchorOutgoingEdge",null),P([m],n.prototype,"getNodeIncomingNode",null),P([m],n.prototype,"getNodeOutgoingNode",null),P([m],n.prototype,"setTheme",null),P([m],n.prototype,"getTheme",null),P([m],n.prototype,"resize",null),P([m],n.prototype,"clearData",null),P([m],n.prototype,"translateCenter",null),P([m],n.prototype,"fitView",null),P([m],n.prototype,"openEdgeAnimation",null),P([m],n.prototype,"closeEdgeAnimation",null),P([m],n.prototype,"setPartial",null),n}(),kt=function(){return kt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},kt.apply(this,arguments)},ae=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},as=function(){function n(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return n.prototype.getStyle=function(){return kt({},this.graphModel.theme.snapline)},n.prototype.getCenterSnapLine=function(e,t){for(var r=e.x,o=e.y,i=!1,a=!1,s=0;s<t.length;s++){var l=t[s];if(l.id!==e.id&&(ct(r,l.x,this.epsilon)&&(i=!0),ct(o,l.y,this.epsilon)&&(a=!0),i&&a))break}return{isShowVertical:i,isShowHorizontal:a,position:{x:r,y:o}}},n.prototype.getHorizontalSnapline=function(e,t){var r=!1,o=0,i=e.id,a;if(i){var s=this.graphModel.fakeNode;if(s&&s.id===i)a=it(s);else{var l=this.graphModel.getNodeModelById(i);l&&(a=it(l))}}for(var d=0;d<t.length;d++){var u=t[d];if(u.id!==e.id){var f=it(u);if(ct(f.minY,a==null?void 0:a.minY,this.epsilon)||ct(f.maxY,a==null?void 0:a.minY,this.epsilon)){r=!0,o=a.minY;break}if(ct(f.minY,a==null?void 0:a.maxY,this.epsilon)||ct(f.maxY,a==null?void 0:a.maxY,this.epsilon)){r=!0,o=a.maxY;break}}}return{isShowHorizontal:r,isShowVertical:this.isShowVertical,position:kt(kt({},this.position),{y:o})}},n.prototype.getVerticalSnapline=function(e,t){var r=!1,o=0,i=e.id,a;if(i){var s=this.graphModel.fakeNode;if(s&&s.id===i)a=it(s);else{var l=this.graphModel.getNodeModelById(i);l&&(a=it(l))}}for(var d=0;d<t.length;d++){var u=t[d];if(u.id!==e.id){var f=it(u);if(ct(f.minX,a==null?void 0:a.minX,this.epsilon)){r=!0,o=a.minX;break}if(ct(f.minX,a==null?void 0:a.minX,this.epsilon)||ct(f.maxX,a==null?void 0:a.minX,this.epsilon)){r=!0,o=a.minX;break}if(ct(f.minX,a==null?void 0:a.maxX,this.epsilon)||ct(f.maxX,a==null?void 0:a.maxX,this.epsilon)){r=!0,o=a.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:r,position:kt(kt({},this.position),{x:o})}},n.prototype.getSnapLinePosition=function(e,t){var r=this.getCenterSnapLine(e,t),o=r.isShowHorizontal,i=r.isShowVertical;if(!o){var a=this.getHorizontalSnapline(e,t);a.isShowHorizontal&&(r.isShowHorizontal=a.isShowHorizontal,r.position.y=a.position.y)}if(!i){var s=this.getVerticalSnapline(e,t);s.isShowVertical&&(r.isShowVertical=s.isShowVertical,r.position.x=s.position.x)}return r},n.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,r=e.isShowVertical,o=e.position;this.position=o,this.isShowHorizontal=t,this.isShowVertical=r},n.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},n.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,r=this.getSnapLinePosition(e,t);this.setSnaplineInfo(r)},ae([E],n.prototype,"isShowHorizontal",void 0),ae([E],n.prototype,"isShowVertical",void 0),ae([E],n.prototype,"position",void 0),ae([m],n.prototype,"clearSnapline",null),ae([m],n.prototype,"setNodeSnapLine",null),n}();function ct(n,e,t){return Math.abs(n-e)<=t}var pt=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Kt=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},ss={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},ls=function(){function n(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var r=t.stopMoveGraph,o=r===void 0?!1:r;this.updateTranslateLimits(o)}return n.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},n.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},n.prototype.HtmlPointToCanvasPoint=function(e){var t=Kt(e,2),r=t[0],o=t[1];return[(r-this.TRANSLATE_X)/this.SCALE_X,(o-this.TRANSLATE_Y)/this.SCALE_Y]},n.prototype.CanvasPointToHtmlPoint=function(e){var t=Kt(e,2),r=t[0],o=t[1];return[r*this.SCALE_X+this.TRANSLATE_X,o*this.SCALE_Y+this.TRANSLATE_Y]},n.prototype.moveCanvasPointByHtml=function(e,t,r){var o=Kt(e,2),i=o[0],a=o[1];return[i+t/this.SCALE_X,a+r/this.SCALE_Y]},n.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},n.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},n.prototype.zoom=function(e,t){e===void 0&&(e=!1);var r=this.SCALE_X,o=this.SCALE_Y;return typeof e=="number"?(r=e,o=e):e?(r+=this.ZOOM_SIZE,o+=this.ZOOM_SIZE):(r-=this.ZOOM_SIZE,o-=this.ZOOM_SIZE),r<this.MINI_SCALE_SIZE||r>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(r-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(o-this.SCALE_Y)*t[1]),this.SCALE_X=r,this.SCALE_Y=o,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},n.prototype.emitGraphTransform=function(e){this.eventCenter.emit(T.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},n.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},n.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},n.prototype.focusOn=function(e,t,r,o){var i=Kt(this.CanvasPointToHtmlPoint([e,t]),2),a=i[0],s=i[1],l=Kt([r/2-a,o/2-s],2),d=l[0],u=l[1];this.TRANSLATE_X+=d,this.TRANSLATE_Y+=u,this.emitGraphTransform("focusOn")},n.prototype.updateTranslateLimits=function(e){var t;t=Kt(Array.isArray(e)&&e.length===4?e:ss[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},pt([E],n.prototype,"SCALE_X",void 0),pt([E],n.prototype,"SKEW_Y",void 0),pt([E],n.prototype,"SKEW_X",void 0),pt([E],n.prototype,"SCALE_Y",void 0),pt([E],n.prototype,"TRANSLATE_X",void 0),pt([E],n.prototype,"TRANSLATE_Y",void 0),pt([E],n.prototype,"ZOOM_SIZE",void 0),pt([m],n.prototype,"zoom",null),pt([m],n.prototype,"resetZoom",null),pt([m],n.prototype,"translate",null),pt([m],n.prototype,"focusOn",null),n}(),ds=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),us=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},fs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},cs=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},ps=function(n){ds(e,n);function e(){var t=n.apply(this,cs([],fs(arguments),!1))||this;return t.handleResize=function(){var r=t.props,o=r.graphModel,i=r.options,a=o.width,s=o.height,l=o.isContainerWidth,d=o.isContainerHeight,u=a,f=s,c=!1;l&&(u=void 0,c=!0),d&&(f=void 0,c=!0),c&&o.resize(u,f),i.width=a,i.height=s},t.throttleResize=To(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(T.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,r,o){o===void 0&&(o="canvas-overlay");var i=this.props.getView,a=i(t.type);return a?x(a,{model:t,graphModel:r,overlay:o},t.id):null},e.prototype.render=function(){var t=this,r=this.props,o=r.graphModel,i=r.tool,a=r.options,s=r.dnd,l=r.snaplineModel,d={};a.width&&(d.width="".concat(o.width,"px")),a.height&&(d.height="".concat(o.height,"px"));var u=o.fakeNode,f=o.editConfigModel,c=o.background,h=f.adjustEdge;return x("div",{className:"lf-graph","flow-id":o.flowId,style:d,children:[x(Ba,{graphModel:o,dnd:s,children:[x("g",{className:"lf-base",children:Pt(o.sortElements,function(v){return t.getComponent(v,o)})}),u?this.getComponent(u,o):""]}),x(Za,{graphModel:o,children:[x(qa,{graphModel:o}),h?x(Ya,{graphModel:o}):"",a.snapline!==!1?x(ts,{snaplineModel:l}):""]}),x(ns,{graphModel:o,tool:i}),c&&x(za,{background:c}),x(te,{graphModel:o})]})},e=us([at],e),e}(V),hs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xt=function(){return xt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},xt.apply(this,arguments)},vs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},ys=function(n){hs(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(r){var o=r.event,i=t.props,a=i.anchorData,s=i.nodeModel,l=i.graphModel;l.selectNodeById(s.id),s.autoToFront&&l.toFront(s.id),l.eventCenter.emit(T.ANCHOR_DRAGSTART,{data:a,e:o,nodeModel:s}),t.setState({startX:a.x,startY:a.y,endX:a.x,endY:a.y})},t.onDragging=function(r){var o=r.event,i=t.props,a=i.graphModel,s=i.nodeModel,l=i.anchorData,d=a.transformModel,u=a.eventCenter,f=a.width,c=a.height,h=a.editConfigModel,v=h.autoExpand,p=h.stopMoveGraph;if(o){var g=o.clientX,y=o.clientY,_=a.getPointByClient({x:g,y}),O=_.domOverlayPosition,S=O.x,M=O.y,w=_.canvasOverlayPosition,A=w.x,D=w.y;t.t&&ir(t.t);var N=[],j=10;S<10?N=[j,0]:S+10>f?N=[-j,0]:M<10?N=[0,j]:M+10>c&&(N=[0,-j]),t.setState({endX:A,endY:D,dragging:!0}),t.moveAnchorEnd(A,D),N.length>0&&!p&&v&&(t.t=po(function(){var G=vs(N,2),H=G[0],Z=G[1];d.translate(H,Z);var I=t.state,$=I.endX,nt=I.endY;t.setState({endX:$-H,endY:nt-Z}),t.moveAnchorEnd($-H,nt-Z)})),u.emit(T.ANCHOR_DRAG,{data:l,e:o,nodeModel:s})}},t.onDragEnd=function(r){var o=r.event;t.t&&ir(t.t);var i=t.checkEnd(o);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var a=t.props,s=a.graphModel,l=a.nodeModel,d=a.anchorData;s.eventCenter.emit(T.ANCHOR_DRAGEND,{data:d,e:o,nodeModel:l,edgeModel:i??void 0})},t.checkEnd=function(r){var o,i=t.props,a=i.graphModel,s=i.nodeModel,l=i.anchorData,d=l.x,u=l.y,f=l.id,c=t.state,h=c.endX,v=c.endY,p=c.dragging,g=nr({x:h,y:v},a);if(t.preTargetNode&&t.preTargetNode.state!==X.DEFAULT&&t.preTargetNode.setElementState(X.DEFAULT),!!p&&g&&g.node){var y=g.node,_=g.anchor.id,O="".concat(s.id,"_").concat(y.id,"_").concat(_,"_").concat(f),S=t.sourceRuleResults.get(O)||{},M=S.isAllPass,w=S.msg,A=t.targetRuleResults.get(O)||{},D=A.isAllPass,N=A.msg;if(M&&D){y.setElementState(X.DEFAULT);var j=a.getNodeModelById(g.node.id),G=(o=a.edgeGenerator)===null||o===void 0?void 0:o.call(a,s.getData(),j==null?void 0:j.getData()),H=a.addEdge(xt(xt({},G),{sourceNodeId:s.id,sourceAnchorId:f,startPoint:{x:d,y:u},targetNodeId:g.node.id,targetAnchorId:g.anchor.id,endPoint:{x:g.anchor.x,y:g.anchor.y}})),Z=t.props.anchorData;return a.eventCenter.emit(T.ANCHOR_DROP,{data:Z,e:r,nodeModel:s,edgeModel:H}),H}var I=y.getData();return a.eventCenter.emit(T.CONNECTION_NOT_ALLOWED,{data:I,msg:N||w||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new St({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,r=t.anchorData,o=t.style,i=t.node,a=i.getAnchorShape(r);if(a)return a;var s=r.x,l=r.y,d=xt(xt({},o),o==null?void 0:o.hover);return x("g",{children:[x(oe,xt({className:"lf-node-anchor-hover"},d,{x:s,y:l})),x(oe,xt({className:"lf-node-anchor"},o,{x:s,y:l}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,r=t.graphModel,o=r.getAnchorIncomingEdge,i=r.getAnchorOutgoingEdge,a=t.anchorData.id;return{incomingEdgeList:o(a),outgoingEdgeList:i(a)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,r){var o,i,a=this.props,s=a.graphModel,l=a.nodeModel,d=a.anchorData,u=nr({x:t,y:r},s);if(u){var f=u.node,c=u.anchor.id;if(this.preTargetNode&&this.preTargetNode!==u.node&&this.preTargetNode.setElementState(X.DEFAULT),d.id===c)return;this.preTargetNode=f;var h="".concat(l.id,"_").concat(f.id,"_").concat(c,"_").concat(d.id);if(!this.targetRuleResults.has(h)){var v=u.anchor,p=l.isAllowConnectedAsSource(f,d,v),g=f.isAllowConnectedAsTarget(l,d,v);this.sourceRuleResults.set(h,or(p)),this.targetRuleResults.set(h,or(g))}var y=((o=this.sourceRuleResults.get(h))!==null&&o!==void 0?o:{}).isAllPass,_=((i=this.targetRuleResults.get(h))!==null&&i!==void 0?i:{}).isAllPass;y&&_?f.setElementState(X.ALLOW_CONNECT):f.setElementState(X.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==X.DEFAULT&&this.preTargetNode.setElementState(X.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,r=t.startX,o=t.startY,i=t.endX,a=t.endY,s=gt(r,o,i,a);return s>10},e.prototype.render=function(){var t=this,r=this.state,o=r.startX,i=r.startY,a=r.endX,s=r.endY,l=this.props,d=l.anchorData,u=l.edgeStyle,f=l.nodeModel,c=l.graphModel,h=d.edgeAddable;return x("g",{className:"lf-anchor",children:[x("g",{onClick:function(v){v.stopPropagation(),c.eventCenter.emit(T.ANCHOR_CLICK,{data:d,e:v,nodeModel:f})},onMouseDown:function(v){c.eventCenter.emit(T.ANCHOR_MOUSEDOWN,{data:d,e:v,nodeModel:f}),h!==!1&&t.dragHandler.handleMouseDown(v)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(xt({sourcePoint:{x:o,y:i},targetPoint:{x:a,y:s}},u)):x(ne,xt({x1:o,y1:i,x2:a,y2:s},u,{"pointer-events":"none"})))]})},e}(V),gs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Hr=function(){return Hr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Hr.apply(this,arguments)},_s=function(n){gs(e,n);function e(t){var r=n.call(this,t)||this;return r.style={},r.onDragging=function(o){var i,a=o.event,s=r.props,l=s.graphModel,d=s.nodeModel,u=s.eventCenter,f=l.selectNodes,c=d.x,h=d.y,v=a.clientX,p=a.clientY,g=l.getPointByClient({x:v,y:p}).canvasOverlayPosition,y=g.x,_=g.y,O=new tt(y-c,_-h),S=((i=r.normal)===null||i===void 0?void 0:i.angle(O))-r.defaultAngle,M=new er(-c,-h).rotate(S).translate(c,h).toString();d.transform=M,d.rotate=S;var w=Pt(f,function(D){return D.id});w.indexOf(d.id)===-1&&(w=[d.id]);var A=Do(w,function(D,N){var j=l.getNodeModelById(N);return D[N]=j==null?void 0:j.getMoveDistance(0,0,!1),D},{});w.forEach(function(D){var N=l.getNodeEdges(D);N.forEach(function(j){if(A[j.sourceNodeId]){var G=l.getNodeModelById(j.sourceNodeId),H=G.anchors.find(function(Z){return Z.id===j.sourceAnchorId});j.updateStartPoint(H)}if(A[j.targetNodeId]){var G=l.getNodeModelById(j.targetNodeId),H=G.anchors.find(function($){return $.id===j.targetAnchorId});j.updateEndPoint(H)}})}),u.emit(T.NODE_ROTATE,{e:a,model:d,data:d.getData()})},r.style=t.style,r.stepperDrag=new St({onDragging:r.onDragging}),r}return e.prototype.render=function(){var t=this,r=this.props.nodeModel,o=r.x,i=r.y,a=r.width,s=r.height,l=o+a/2+20,d=i-s/2-20;return this.normal=new tt(1,0),this.defaultAngle=this.normal.angle(new tt(l-o,d-i)),r.defaultAngle=this.defaultAngle,x("g",{className:"lf-rotate-control",children:x("g",{onMouseDown:function(u){t.stepperDrag.handleMouseDown(u)},children:x(oe,Hr({},this.style,{cx:l,cy:d}))})})},e}(V),ms=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gr=function(){return Gr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Gr.apply(this,arguments)},xs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},xo=function(n){ms(e,n);function e(t){var r=n.call(this)||this;r.mouseDownHandler=function(i){var a=r.props,s=a.draggable,l=a.model,d=a.graphModel,u=d.editConfigModel.nodeTextDraggable;(s??u)&&(i.stopPropagation(),r.stepperDrag.model=l,r.stepperDrag.handleMouseDown(i))},r.onDragging=function(i){var a=i.deltaX,s=i.deltaY,l=r.props,d=l.model,u=l.graphModel.transformModel;if(a||s){var f=xs(u.fixDeltaXY(a,s),2),c=f[0],h=f[1];d.moveText(c,h)}},r.dbClickHandler=function(){var i=r.props,a=i.editable,s=i.graphModel.eventCenter,l=i.model;a&&l.setElementState(X.TEXT_EDIT),s.emit(T.TEXT_DBCLICK,{data:l.text,model:l})};var o=t.draggable;return r.stepperDrag=new St({onDragging:r.onDragging,step:1,eventType:"TEXT",isStopPropagation:o}),r}return e.prototype.getShape=function(){var t=this.props,r=t.model,o=t.graphModel,i=o.editConfigModel,a=r.text,s=a.value,l=a.x,d=a.y,u=a.editable,f=a.draggable,c={x:l,y:d,className:"",value:s},h=r.getTextStyle(),v=i.nodeTextDraggable||f;return x(ho,Gr({},c,h,{className:Bo({"lf-element-text":u,"lf-text-draggable":!u&&v,"lf-text-disabled":!u&&!v}),model:r}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return x("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(V),Es=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ht=function(){return ht=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},ht.apply(this,arguments)},Ue=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Ms=function(n){Es(e,n);function e(t){var r=n.call(this,t)||this;return r.setHoverOn=function(){r.setState({isHovered:!0})},r.setHoverOff=function(){r.setState({isHovered:!1})},r.state={isHovered:!1},r}return e.prototype.getBackground=function(){var t=this.state.isHovered,r=this.props.model,o=r.text,i=r.getTextStyle(),a=i.background||{};if(t&&i.hover&&i.hover.background&&(a=ht(ht({},a),i.hover.background)),o!=null&&o.value&&(a==null?void 0:a.fill)!=="transparent"){var s=i.fontSize,l=i.textWidth,d=i.lineHeight,u=i.overflowMode,f=a.wrapPadding,c=o==null?void 0:o.value.split(/[\r\n]/g),h=c.length,v=o.x,p=o.y,g={};if(u==="autoWrap"&&l){var y=co({rows:c,style:{fontSize:"".concat(s,"px"),width:"".concat(l,"px"),lineHeight:d,padding:f},rowsLength:h,className:"lf-get-text-height"});g=ht(ht({},a),{x:v,y:p,width:l,height:y})}else{var _=pi({rows:c,rowsLength:h,fontSize:s}),O=_.width,S=_.height;if(u==="ellipsis"&&(O=l,S=s+2),typeof a.wrapPadding=="string"){var M=a.wrapPadding.split(",").filter(function(ot){return ot.trim()}).map(function(ot){return parseFloat(ot.trim())});if(M.length>0&&M.length<=4){if(M.length===1){var w=Ue(M,1),A=w[0];M=[A,A,A,A]}else if(M.length===2){var D=Ue(M,2),N=D[0],j=D[1];M=[N,j,N,j]}else if(M.length===3){var G=Ue(M,3),H=G[0],j=G[1],Z=G[2];M=[H,j,Z,j]}var I=Ue(M,4),$=I[0],nt=I[1],Rt=I[2],It=I[3];O+=nt+It,S+=$+Rt,v=v+(nt-It)/2,p=p+(Rt-$)/2}}g=ht(ht({},a),{x:v-1,y:p-1,width:O,height:S})}return x(Ot,ht({},g))}return null},e.prototype.getShape=function(){var t=this.props.model,r=t.text,o=r.x,i=r.y,a=r.value;if(!a)return null;var s=t.getTextStyle(),l=ht({x:o,y:i,value:a,model:t,className:"lf-element-text"},s);return x("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),x(ho,ht({},l))]})},e}(xo),Os=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),sr=function(){return sr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},sr.apply(this,arguments)},Ss=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t},We=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},jt=function(n){Os(e,n);function e(t){var r=n.call(this)||this;r.onDragStart=function(l){var d=l.event,u=r.props,f=u.model,c=u.graphModel;if(d){var h=c.getPointByClient({x:d.clientX,y:d.clientY}).canvasOverlayPosition,v=h.x,p=h.y;r.moveOffset={dx:f.x-v,dy:f.y-p}}},r.onDragging=function(l){var d,u,f,c,h=l.event,v=r.props,p=v.model,g=v.graphModel,y=g.editConfigModel,_=y.stopMoveGraph,O=y.autoExpand,S=y.snapGrid,M=g.transformModel,w=g.selectNodes,A=g.width,D=g.height,N=g.gridSize;p.isDragging=!0;var j=h,G=j.clientX,H=j.clientY,Z=g.getPointByClient({x:G,y:H}).canvasOverlayPosition,I=Z.x,$=Z.y,nt=We(M.CanvasPointToHtmlPoint([I,$]),2),Rt=nt[0],It=nt[1];if(I=I+((u=(d=r.moveOffset)===null||d===void 0?void 0:d.dx)!==null&&u!==void 0?u:0),$=$+((c=(f=r.moveOffset)===null||f===void 0?void 0:f.dy)!==null&&c!==void 0?c:0),I=re(I,N,S),$=re($,N,S),!A||!D){g.moveNode2Coordinate(p.id,I,$);return}var ot=Rt<0||It<0||Rt>A||It>D;if(!(O&&!_&&ot)){var _t=We(M.CanvasPointToHtmlPoint([I-p.width/2,$-p.height/2]),2),ie=_t[0],pr=_t[1],Ce=We(M.CanvasPointToHtmlPoint([I+p.width/2,$+p.height/2]),2),hr=Ce[0],Eo=Ce[1],Le=Math.max(N,20),zt=[];ie<0?zt=[Le,0]:hr>g.width?zt=[-Le,0]:pr<0?zt=[0,Le]:Eo>g.height&&(zt=[0,-Le]),r.t&&ir(r.t);var je=w.map(function(Re){return Re.id});je.indexOf(p.id)===-1&&(je=[p.id]),zt.length>0&&!_&&O?r.t=po(function(){var Re=We(zt,2),Ft=Re[0],$t=Re[1];M.translate(Ft??0,$t??0);var Mo=-(Ft??0)/M.SCALE_X,Oo=-($t??0)/M.SCALE_X;g.moveNodes(je,Mo,Oo)}):g.moveNodes(je,I-p.x,$-p.y)}},r.onDragEnd=function(){r.t&&ir(r.t);var l=r.props.model;l.isDragging=!1},r.onMouseOut=function(l){zo()&&r.setHoverOff(l)},r.handleMouseUp=function(){var l=r.props.model;r.mouseUpDrag=l.isDragging},r.handleClick=function(l){var d=r.mouseUpDrag===!1;if(r.startTime){var u=r.props,f=u.model,c=u.graphModel;if(d){var h=f.getData(),v=c.getPointByClient({x:l.clientX,y:l.clientY}),p={data:h,e:l,position:v,isSelected:!1,isMultiple:!1},g=l.button===2,y=l.detail===2;if(!g){var _=c.editConfigModel,O=uo(l,_);p.isMultiple=O,f.isSelected&&!y&&O?(p.isSelected=!1,f.setSelected(!1)):(c.selectNodeById(f.id,O),p.isSelected=!0,_.isSilentMode||r.toFront()),y?(_.nodeTextEdit&&f.text.editable&&_.textMode===ft.TEXT&&(f.setSelected(!1),c.setElementStateById(f.id,X.TEXT_EDIT)),c.eventCenter.emit(T.NODE_DBCLICK,p)):(c.eventCenter.emit(T.ELEMENT_CLICK,p),c.eventCenter.emit(T.NODE_CLICK,p))}}}},r.handleContextMenu=function(l){l.preventDefault();var d=r.props,u=d.model,f=d.graphModel,c=f.editConfigModel,h=u.getData(),v=f.getPointByClient({x:l.clientX,y:l.clientY});f.setElementStateById(u.id,X.SHOW_MENU,v.domOverlayPosition),u.isSelected||f.selectNodeById(u.id),f.eventCenter.emit(T.NODE_CONTEXTMENU,{data:h,e:l,position:v}),c.isSilentMode||r.toFront()},r.handleMouseDown=function(l){var d=r.props,u=d.model,f=d.graphModel;r.startTime=new Date().getTime();var c=f.editConfigModel;c.adjustNodePosition&&u.draggable&&r.stepDrag&&r.stepDrag.handleMouseDown(l)},r.handleFocus=function(){var l=r.props,d=l.model,u=l.graphModel;u.eventCenter.emit(T.NODE_FOCUS,{data:d.getData()})},r.handleBlur=function(){var l=r.props,d=l.model,u=l.graphModel;u.eventCenter.emit(T.NODE_BLUR,{data:d.getData()})},r.setHoverOn=function(l){var d=r.props,u=d.model,f=d.graphModel;if(!u.isHovered){var c=u.getData();u.setHovered(!0),f.eventCenter.emit(T.NODE_MOUSEENTER,{data:c,e:l})}},r.setHoverOff=function(l){var d=r.props,u=d.model,f=d.graphModel,c=u.getData();u.isHovered&&(u.setHovered(!1),f.eventCenter.emit(T.NODE_MOUSELEAVE,{data:c,e:l}))};var o=t.graphModel,i=o.gridSize,a=o.eventCenter,s=t.model;return r.stepDrag=new St({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:i,eventType:"NODE",isStopPropagation:!1,eventCenter:a,model:s}),r.modelDisposer=Ro(function(){return r.props},function(l){l&&l.model&&r.stepDrag.setModel(l.model)}),r}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,r=this.props,o=r.model,i=r.graphModel,a=o.isSelected,s=o.isHitable,l=o.isDragging,d=o.isShowAnchor;return s&&(a||d)&&!l?Pt(o.anchors,function(u,f){var c=o.getAnchorLineStyle(u),h=o.getAnchorStyle(u);return x(ys,{anchorData:u,node:t,style:h,edgeStyle:c,anchorIndex:f,nodeModel:o,graphModel:i,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,r=t.model,o=t.graphModel,i=o.editConfigModel,a=i.isSilentMode,s=i.allowRotate,l=r.isSelected,d=r.isHitable,u=r.rotatable,f=r.isHovered,c=s&&u,h=r.getRotateControlStyle();if(!a&&d&&(l||f)&&c)return x(_s,{graphModel:o,nodeModel:r,eventCenter:o.eventCenter,style:h})},e.prototype.getResizeControl=function(){var t=this.props,r=t.model,o=t.graphModel,i=o.editConfigModel,a=i.isSilentMode,s=i.allowResize,l=r.isSelected,d=r.isHitable,u=r.resizable,f=r.isHovered,c=s&&u,h=r.getResizeControlStyle();return!a&&d&&(l||f)&&c?x(ki,{style:h,model:r,graphModel:o}):null},e.prototype.getText=function(){var t,r=this.props,o=r.model,i=r.graphModel,a=i.editConfigModel;if(a.nodeTextMode!==ft.TEXT||o.state===X.TEXT_EDIT)return null;if(o.text){var s=!1;return a.nodeTextDraggable&&o.text.draggable&&(s=!0),x(xo,{editable:a.nodeTextEdit&&((t=o.text.editable)!==null&&t!==void 0?t:!0),model:o,graphModel:i,draggable:s})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,r=t.state,o=t.isDragging,i=t.isSelected,a="lf-node";switch(r){case X.ALLOW_CONNECT:a+=" lf-node-allow";break;case X.NOT_ALLOW_CONNECT:a+=" lf-node-not-allow";break;default:a+=" lf-node-default";break}return o&&(a+=" lf-dragging"),i&&(a+=" lf-node-selected"),a},e.prototype.toFront=function(){var t=this.props,r=t.model,o=t.graphModel;r.autoToFront&&o.toFront(r.id)},e.prototype.render=function(){var t=this.props,r=t.model,o=t.graphModel,i=o.editConfigModel,a=i.hideAnchors,s=i.adjustNodePosition,l=i.allowRotate,d=i.allowResize,u=o.gridSize,f=o.transformModel.SCALE_X,c=r.isHitable,h=r.draggable,v=r.transform,p=r.getOuterGAttributes(),g=p.className,y=g===void 0?"":g,_=Ss(p,["className"]),O=x("g",{className:"lf-node-content",children:[x("g",{transform:v,children:[this.getShape(),this.getText(),l&&this.getRotateControl(),d&&this.getResizeControl()]}),!a&&this.getAnchors()]}),S;return c?(s&&h&&this.stepDrag.setStep(u*f),S=x("g",sr({className:"".concat(this.getStateClassName()," ").concat(y),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},_,{children:O}))):S=x("g",sr({className:"".concat(this.getStateClassName()," ").concat(y)},_,{children:O})),S},e.isObserved=!1,e}(V),ws=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),zr=function(){return zr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},zr.apply(this,arguments)},Gn=function(n){ws(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return x(Ot,zr({},r,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(jt),As=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Fr=function(){return Fr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Fr.apply(this,arguments)},zn=function(n){As(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.x,o=t.y,i=t.r,a=t.getNodeStyle();return x(oe,Fr({},a,{x:r,y:o,r:i}))},e}(jt),Ps=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),lr=function(){return lr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},lr.apply(this,arguments)},Fn=function(n){Ps(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t,o=r.x,i=r.y,a=r.width,s=r.height,l=r.points,d=t.getNodeStyle(),u={transform:"matrix(1 0 0 1 ".concat(o-a/2," ").concat(i-s/2,")")};return x("g",lr({},u,{children:x(vo,lr({},d,{points:l,x:o,y:i}))}))},e}(jt),Ts=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$r=function(){return $r=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},$r.apply(this,arguments)},$n=function(n){Ts(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return x("g",{children:x(vo,$r({},r,{points:t.points,x:t.x,y:t.y}))})},e}(jt),Ds=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ur=function(){return Ur=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Ur.apply(this,arguments)},Un=function(n){Ds(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return x(Ni,Ur({},r,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(jt),Ns=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_e=function(){return _e=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},_e.apply(this,arguments)},Wn=function(n){Ns(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,r=t.getTextStyle(),o=t.width,i=t.height,a=t.x,s=t.y,l=_e(_e({},r.background),{x:a,y:s,width:o,height:i});return x(Ot,_e({},l))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return x("g",{children:this.getBackground()})},e}(jt),bs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wr=function(){return Wr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Wr.apply(this,arguments)},Cs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Ls=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},Zn=function(n){bs(e,n);function e(){var t=n.apply(this,Ls([],Cs(arguments),!1))||this;return t.ref=Jr(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,r=t.x,o=t.y,i=t.height,a=t.width,s=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),x("foreignObject",Wr({},s,{x:r-a/2,y:o-i/2,width:a,height:i,ref:this.ref}))},e}(jt),js=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),vt=function(){return vt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},vt.apply(this,arguments)},Rs=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t},Is=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Mt;(function(n){n.SOURCE="SOURCE",n.TARGET="TARGET"})(Mt||(Mt={}));var Kn=function(n){js(e,n);function e(t){var r=n.call(this)||this;r.handleMouseDown=function(l){r.stepDrag&&r.stepDrag.handleMouseDown(l)},r.onDragStart=function(){var l=r.props,d=l.x,u=l.y,f=l.edgeModel,c=f.startPoint,h=f.endPoint,v=f.pointsList;r.oldEdge={startPoint:c,endPoint:h,pointsList:v},r.setState({endX:d,endY:u,dragging:!0})},r.onDragging=function(l){var d=l.deltaX,u=l.deltaY,f=r.state,c=f.endX,h=f.endY,v=r.props,p=v.graphModel,g=v.type,y=p.transformModel,_=p.editConfigModel,O=Is(y.moveCanvasPointByHtml([c,h],d,u),2),S=O[0],M=O[1];r.setState({endX:S,endY:M,dragging:!0});var w=r.props.edgeModel,A=nr({x:c,y:h},p);if(A&&A.node&&r.isAllowAdjust(A).pass){var D=w.startPoint,N=w.endPoint,j=w.sourceNode,G=w.targetNode,H=g===Mt.SOURCE?{startPoint:{x:A.anchor.x,y:A.anchor.y},endPoint:{x:N.x,y:N.y},sourceNode:A.node,targetNode:G}:{startPoint:{x:D.x,y:D.y},endPoint:{x:A.anchor.x,y:A.anchor.y},sourceNode:j,targetNode:A.node};w.updateAfterAdjustStartAndEnd(H)}else g===Mt.SOURCE?w.updateStartPoint({x:S,y:M}):w.updateEndPoint({x:S,y:M});w.text.value&&_.adjustEdge&&w.setText(Object.assign({},w.text,w.textPosition))},r.onDragEnd=function(l){var d,u,f,c=l.event;try{r.setState({dragging:!1});var h=r.props,v=h.graphModel,p=h.edgeModel,g=h.type,y=r.state,_=y.endX,O=y.endY,S=y.dragging,M=nr({x:_,y:O},v);if(!S)return;var w=!1,A=void 0;if(M&&M.node){var D=r.isAllowAdjust(M),N=D.pass,j=D.msg,G=D.newTargetNode;if(N){var H=p.getData(),Z=H.text,I=H.sourceAnchorId,$=I===void 0?"":I,nt=H.targetAnchorId,Rt=nt===void 0?"":nt,It=Rs(H,["text","sourceAnchorId","targetAnchorId"]);if(A=vt(vt({sourceAnchorId:$,targetAnchorId:Rt},It),{text:(Z==null?void 0:Z.value)||""}),g===Mt.SOURCE){var ot=v.getNodeModelById(M.node.id),_t=v.getNodeModelById(p.targetNodeId),ie=(d=v.edgeGenerator)===null||d===void 0?void 0:d.call(v,ot==null?void 0:ot.getData(),_t==null?void 0:_t.getData(),A);A=vt(vt({},ie),{sourceNodeId:M.node.id,sourceAnchorId:M.anchor.id,startPoint:{x:M.anchor.x,y:M.anchor.y},targetNodeId:p.targetNodeId,endPoint:vt({},p.endPoint)}),p.sourceNodeId===M.node.id&&p.sourceAnchorId===M.anchor.id&&(w=!0)}else if(g===Mt.TARGET){var ot=v.getNodeModelById(p.sourceNodeId),_t=v.getNodeModelById(M.node.id),ie=(u=v.edgeGenerator)===null||u===void 0?void 0:u.call(v,ot==null?void 0:ot.getData(),_t==null?void 0:_t.getData(),A);A=vt(vt({},ie),{sourceNodeId:p.sourceNodeId,startPoint:vt({},p.startPoint),targetNodeId:M.node.id,targetAnchorId:M.anchor.id,endPoint:{x:M.anchor.x,y:M.anchor.y}}),p.targetNodeId===M.node.id&&p.targetAnchorId===M.anchor.id&&(w=!0)}}else{w=!0;var pr=G.getData();v.eventCenter.emit(T.CONNECTION_NOT_ALLOWED,{data:pr,msg:j})}}else w=!0;if(w)r.recoveryEdge();else{var Ce=p.getData();v.deleteEdgeById(p.id);var hr=v.addEdge(vt({},A));v.eventCenter.emit(T.EDGE_EXCHANGE_NODE,{data:{newEdge:hr.getData(),oldEdge:Ce}})}(f=r.preTargetNode)===null||f===void 0||f.setElementState(X.DEFAULT)}finally{var v=r.props.graphModel;v.eventCenter.emit(T.ADJUST_POINT_DRAGEND,{e:c,data:r.stepDragData})}},r.recoveryEdge=function(){var l=r.props.edgeModel,d=r.oldEdge,u=d.startPoint,f=d.endPoint,c=d.pointsList;l.updateStartPoint(u),l.updateEndPoint(f),l.modelType!==R.LINE_EDGE&&(l.pointsList=c??[],l.initPoints())},r.getAdjustPointStyle=function(){var l=r.props.graphModel.theme,d=l.edgeAdjust;return d},r.state={dragging:!1,endX:0,endY:0},r.targetRuleResults=new Map,r.sourceRuleResults=new Map;var o=t.type,i=t.edgeModel,a=t.graphModel,s=a.eventCenter;return r.stepDragData={type:o,edgeData:i.getData()},r.stepDrag=new St({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:s,data:r.stepDragData}),r}return e.prototype.isAllowAdjust=function(t){var r=this.props,o=r.edgeModel,i=o.id,a=o.sourceNode,s=o.targetNode,l=o.sourceAnchorId,d=o.targetAnchorId,u=r.type,f,c,h,v;if(u===Mt.SOURCE?(f=t.node,c=s,h=t.anchor,v=s.getAnchorInfo(d)):(f=a,c=t.node,v=t.anchor,h=a.getAnchorInfo(l)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(X.DEFAULT),this.preTargetNode=t.node,v.id===h.id)return{pass:!1,msg:"",newTargetNode:c};var p="".concat(f.id,"_").concat(c.id,"_").concat(h.id,"_").concat(v.id);if(!this.targetRuleResults.has(p)){var g=f.isAllowConnectedAsSource(c,h,v,i),y=c.isAllowConnectedAsTarget(f,h,v,i);this.sourceRuleResults.set(p,or(g)),this.targetRuleResults.set(p,or(y))}var _=this.sourceRuleResults.get(p),O=_.isAllPass,S=_.msg,M=this.targetRuleResults.get(p),w=M.isAllPass,A=M.msg,D=O&&w?X.ALLOW_CONNECT:X.NOT_ALLOW_CONNECT;return u===Mt.SOURCE?f.setElementState(D):c.setElementState(D),{pass:O&&w,msg:A||S,newTargetNode:c}},e.prototype.render=function(){var t=this.props,r=t.x,o=t.y,i=t.getAdjustPointShape,a=t.edgeModel,s=this.state.dragging;return x("g",{pointerEvents:s?"none":"",onMouseDown:this.handleMouseDown,children:s?"":i(r,o,a)})},e}(V),Bs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zr=function(){return Zr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Zr.apply(this,arguments)};(function(n){Bs(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,r=t.arrowInfo,o=t.style,i=r.start,a=r.end,s={start:i,end:a,offset:o.offset,verticalLength:o.verticalLength,type:"end"},l=Me(s),d=l.leftX,u=l.leftY,f=l.rightX,c=l.rightY;return Zr({d:"M".concat(d," ").concat(u," L").concat(a.x," ").concat(a.y," L").concat(f," ").concat(c," z")},o)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),r=t.d,o=t.strokeWidth,i=t.stroke,a=t.fill;return x(we,{d:r,fill:a,strokeWidth:o,stroke:i})},e.prototype.render=function(){return x("g",{className:"lf-arrow",children:this.getShape()})},e})(V);var ks=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),me=function(){return me=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},me.apply(this,arguments)},Xs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},cr=function(n){ks(e,n);function e(){var t=n.call(this)||this;return t.textRef=Jr(),t.handleHover=function(r,o){var i=t.props,a=i.model,s=i.graphModel.eventCenter;a.setHovered(r);var l=r?T.EDGE_MOUSEENTER:T.EDGE_MOUSELEAVE,d=a.getData();s.emit(l,{data:d,e:o})},t.setHoverOn=function(r){var o=t.props.model.isHovered;o||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,r))},t.setHoverOff=function(r){var o=t.props.model.isHovered;o&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,r))},t.handleContextMenu=function(r){r.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var o=t.props,i=o.model,a=o.graphModel,s=a.editConfigModel,l=a.getPointByClient({x:r.clientX,y:r.clientY});a.setElementStateById(i.id,X.SHOW_MENU,l.domOverlayPosition),s.isSilentMode||t.toFront(),i.isSelected||a.selectEdgeById(i.id);var d=i==null?void 0:i.getData();a.eventCenter.emit(T.EDGE_CONTEXTMENU,{data:d,e:r,position:l})},t.handleMouseDown=function(r){r.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(){var r=t.props.model;t.mouseUpDrag=r.isDragging},t.handleClick=function(r){if(t.startTime&&!t.mouseUpDrag){var o=r.button===2;if(!o){var i=r.detail===2,a=t.props,s=a.model,l=a.graphModel,d=s==null?void 0:s.getData(),u=l.getPointByClient({x:r.clientX,y:r.clientY});if(i){var f=l.editConfigModel,c=l.textEditElement,h=s.id,v=s.text,p=s.modelType;if(c&&c.id===h&&l.setElementStateById(h,X.DEFAULT),f.edgeTextEdit&&v.editable&&(s.setSelected(!1),l.setElementStateById(h,X.TEXT_EDIT)),p===R.POLYLINE_EDGE){var g=s,y=l.getPointByClient({x:r.x,y:r.y}).canvasOverlayPosition,_=y.x,O=y.y;g.dbClickPosition=lo({x:_,y:O},g.points)}l.eventCenter.emit(T.EDGE_DBCLICK,{data:d,e:r,position:u})}else l.eventCenter.emit(T.ELEMENT_CLICK,{data:d,e:r,position:u}),l.eventCenter.emit(T.EDGE_CLICK,{data:d,e:r,position:u});var S=l.editConfigModel;l.selectEdgeById(s.id,uo(r,S)),S.isSilentMode||t.toFront()}}},t.handleFocus=function(){var r=t.props,o=r.model,i=r.graphModel;i.eventCenter.emit(T.EDGE_FOCUS,{data:o.getData()})},t.handleBlur=function(){var r=t.props,o=r.model,i=r.graphModel;i.eventCenter.emit(T.EDGE_BLUR,{data:o.getData()})},t}return e.prototype.getShape=function(){return x("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,r=this.props,o=r.model,i=r.graphModel,a=i.editConfigModel;if(a.edgeTextMode!==ft.TEXT||o.state===X.TEXT_EDIT)return null;if(o.text){var s=!1;return a.edgeTextDraggable&&o.text.draggable&&(s=!0),x(Ms,{ref:this.textRef,editable:a.edgeTextEdit&&((t=o.text.editable)!==null&&t!==void 0?t:!0),model:o,graphModel:i,draggable:s})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,r=t.startPoint,o=t.endPoint,i=t.isSelected,a=this.state.hover;return{start:r,end:o,hover:a,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.startPoint,o=t.endPoint;return[r,o]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,r=t.id,o=t.getArrowStyle(),i=o.refY,a=i===void 0?0:i,s=o.refX,l=s===void 0?2:s,d=Xs(this.getLastTwoPoints(),2),u=d[0],f=d[1],c="auto";return u!==null&&f!==null&&(c=ea(ta({x:f.x-u.x,y:f.y-u.y}))),x("g",{children:x("defs",{children:[x("marker",{id:"marker-start-".concat(r),refX:-l,refY:a,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),x("marker",{id:"marker-end-".concat(r),refX:l,refY:a,overflow:"visible",orient:c,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,r){var o=r.stroke,i=r.fill,a=i===void 0?o:i,s=r.strokeWidth,l=r.offset,d=l===void 0?10:l,u=r.verticalLength,f=r.strokeLinecap,c=r.strokeLinejoin,h=r.transform,v="";switch(t){case"solid":v="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(u," L").concat(3*d/4,",-").concat(u," Z");break;case"hollow":v="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(u," L").concat(-d/4,",0 L").concat(3*d/4,",-").concat(u," L").concat(-d/4,",0 Z");break;case"diamond":v="M".concat(-d/2,",0 L0,").concat(u," L").concat(d/2,",0 L0,-").concat(u," L").concat(-d/2,",0 Z");break;case"circle":v="M".concat(-d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(-d/2,",0 Z");break;default:v="";break}return x("path",{d:v,stroke:o,fill:a,strokeWidth:s,strokeLinecap:f,strokeLinejoin:c,transform:h})},e.prototype.getStartArrow=function(){var t=this.props.model,r=t.getArrowStyle(),o=r.stroke,i=r.strokeWidth,a=r.offset,s=r.verticalLength,l=r.startArrowType,d=l===void 0?"none":l,u=r.strokeLinecap,f=r.strokeLinejoin;return this.getArrowPath(d,{stroke:o,strokeWidth:i,offset:a,verticalLength:s,strokeLinecap:u,strokeLinejoin:f})},e.prototype.getEndArrow=function(){var t=this.props.model,r=t.getArrowStyle(),o=r.stroke,i=r.strokeWidth,a=r.offset,s=r.verticalLength,l=r.endArrowType,d=l===void 0?"solid":l,u=r.strokeLinecap,f=r.strokeLinejoin;return this.getArrowPath(d,{stroke:o,strokeWidth:i,offset:a,verticalLength:s,strokeLinecap:u,strokeLinejoin:f,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,r,o){var i=o.getAdjustPointStyle();return x(oe,me({className:"lf-edge-adjust-point"},i,{x:t,y:r}))},e.prototype.getAdjustPoints=function(){var t=this.props,r=t.model,o=t.graphModel,i=o.editConfigModel,a=i.adjustEdgeStartAndEnd,s=i.adjustEdgeStart,l=i.adjustEdgeEnd,d=r.getAdjustStart(),u=r.getAdjustEnd();return x("g",{children:[a&&s&&x(Kn,me({type:Mt.SOURCE},d,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:r,graphModel:o})),a&&l&&x(Kn,me({type:Mt.TARGET},u,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:r,graphModel:o}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return x("g",{})},e.prototype.getAppend=function(){return x("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,r=t.graphModel,o=t.model;r.toFront(o.id)},e.prototype.render=function(){var t=this.props.model,r=t.isSelected,o=t.isHitable,i=t.isShowAdjustPoint;return x("g",{children:[x("g",{className:["lf-edge",!o&&"pointer-none",r&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),i&&r?this.getAdjustPoints():""]})},e.isObserved=!1,e}(V),Ys=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Kr=function(){return Kr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Kr.apply(this,arguments)},Hs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Vn=function(n){Ys(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,r=t.getEdgeStyle(),o=t,i=o.path,a=o.isAnimation,s=o.arrowConfig,l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,u=l.stroke,f=l.strokeDashoffset,c=l.animationName,h=l.animationDuration,v=l.animationIterationCount,p=l.animationTimingFunction,g=l.animationDirection;return x(we,Kr({d:i},r,s,a?{strokeDasharray:d,stroke:u,style:{strokeDashoffset:f,animationName:c,animationDuration:h,animationIterationCount:v,animationTimingFunction:p,animationDirection:g}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return x(we,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,r=this.state.hover,o=t.isSelected,i=t.getArrowStyle().offset,a=t.pointsList.map(function(f){return{x:f.x,y:f.y}}),s=Hs(gn(a,i),2),l=s[0],d=s[1],u={start:l,end:d,hover:r,isSelected:o};return u},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.getArrowStyle().offset,o=t.pointsList.map(function(i){return{x:i.x,y:i.y}});return gn(o,r)},e}(cr),Gs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vr=function(){return Vr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Vr.apply(this,arguments)},qn=function(n){Gs(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,r=t.startPoint,o=t.endPoint,i=t.isAnimation,a=t.arrowConfig,s=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,u=l.stroke,f=l.strokeDashoffset,c=l.animationName,h=l.animationDuration,v=l.animationIterationCount,p=l.animationTimingFunction,g=l.animationDirection;return x(ne,Vr({},s,{x1:r.x,y1:r.y,x2:o.x,y2:o.y},a,i?{strokeDasharray:d,stroke:u,style:{strokeDashoffset:f,animationName:c,animationDuration:h,animationIterationCount:v,animationTimingFunction:p,animationDirection:g}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,r=t.startPoint,o=t.endPoint,i={start:r,end:o},a=ui(i),s=a.d,l=a.strokeWidth,d=a.fill,u=a.strokeDasharray,f=a.stroke;return x(we,{d:s,fill:d,strokeWidth:l,stroke:f,strokeDasharray:u})},e}(cr),zs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xt=function(){return Xt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Xt.apply(this,arguments)},Fs=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Jn=function(n){zs(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(){var r=t.props.model;r.dragAppendStart(),t.isShowAdjustPointTemp=r.isShowAdjustPoint,r.isShowAdjustPoint=!1},t.onDragging=function(r){var o=r.deltaX,i=r.deltaY,a=t.props,s=a.model,l=a.graphModel;t.isDragging=!0;var d=l.transformModel,u=l.editConfigModel,f=Fs(d.fixDeltaXY(o,i),2),c=f[0],h=f[1],v=s,p=u.adjustEdgeMiddle;p?t.appendInfo=v.dragAppendSimple(t.appendInfo,{x:c,y:h}):t.appendInfo=v.dragAppend(t.appendInfo,{x:c,y:h})},t.onDragEnd=function(){var r,o=t.props,i=o.model,a=o.graphModel.eventCenter,s=i;s.dragAppendEnd(),t.isDragging=!1,s.isShowAdjustPoint=(r=t.isShowAdjustPointTemp)!==null&&r!==void 0?r:!1,t.appendInfo=void 0,a.emit(T.EDGE_ADJUST,{data:s.getData()})},t.beforeDragStart=function(r,o){o.draggable&&t.drag.handleMouseDown(r),t.appendInfo=o},t.drag=new St({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,r=t.points,o=t.isAnimation,i=t.arrowConfig,a=t.getEdgeStyle(),s=t.getEdgeAnimationStyle(),l=s.strokeDasharray,d=s.stroke,u=s.strokeDashoffset,f=s.animationName,c=s.animationDuration,h=s.animationIterationCount,v=s.animationTimingFunction,p=s.animationDirection;return x(ji,Xt({points:r},a,i,o?{strokeDasharray:l,stroke:d,style:{strokeDashoffset:u,animationName:f,animationDuration:c,animationIterationCount:h,animationTimingFunction:v,animationDirection:p}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,r=t.points,o=t.isSelected,i=this.state.hover,a=Gt(r),s=a[0],l=a[0];return a.length>=2&&(s=a[a.length-2],l=a[a.length-1]),{start:s,end:l,hover:i,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.points,o=Gt(r),i=o[0],a=o[0];return o.length>=2&&(i=o[o.length-2],a=o[o.length-1]),[i,a]},e.prototype.getAppendAttributes=function(t){var r=t.start,o=t.end,i;if(r.x===o.x&&r.y===o.y)i="";else{var a={start:r,end:o,offset:10,verticalLength:5},s=Me(Xt(Xt({},a),{type:"start"})),l=Me(Xt(Xt({},a),{type:"end"}));i="M".concat(s.leftX," ").concat(s.leftY,`
      L`).concat(s.rightX," ").concat(s.rightY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(l.leftX," ").concat(l.leftY," z")}return{d:i,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var r=this.getAppendAttributes(t),o=r.d,i=r.strokeWidth,a=r.fill,s=r.strokeDasharray,l=r.stroke;return x(we,{d:o,fill:a,strokeWidth:i,stroke:l,strokeDasharray:s})},e.prototype.getAppendWidth=function(){for(var t=this,r=this.props,o=r.model,i=r.graphModel,a=o.pointsList,s=o.draggable,l=[],d=a.length,u=function(h){var v="lf-polyline-append",p={start:{x:a[h].x,y:a[h].y},end:{x:a[h+1].x,y:a[h+1].y},startIndex:h,endIndex:h+1,direction:z.HORIZONTAL,draggable:!0},g=x("g",{className:v,children:f.getAppendShape(p)}),y=i.editConfigModel,_=y.adjustEdge,O=y.adjustEdgeMiddle;if(_&&s){var S=p.startIndex,M=p.endIndex,w=O&&(S===0||M===d-1);p.draggable=!w,p.start.x===p.end.x?(p.draggable&&(v+="-ew-resize"),p.direction=z.VERTICAL):p.start.y===p.end.y&&(p.draggable&&(v+="-ns-resize"),p.direction=z.HORIZONTAL),g=x("g",{className:f.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(A){return t.beforeDragStart(A,p)},children:x("g",{className:v,children:f.getAppendShape(p)})})}l.push(g)},f=this,c=0;c<d-1;c++)u(c);return x("g",{children:l})},e}(cr),Qt=function(){return Qt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Qt.apply(this,arguments)},$s=function(){function n(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(o){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(Qt(Qt({},t.nodeConfig),t.clientToLocalPoint({x:o.clientX,y:o.clientY}))))},this.onDragOver=function(o){if(t.lf.graphModel.eventCenter.emit(T.BLANK_CANVAS_MOUSEMOVE,{e:o}),o.preventDefault(),t.fakeNode){var i=t.clientToLocalPoint({x:o.clientX,y:o.clientY}),a=i.x,s=i.y;t.fakeNode.moveTo(a,s);var l=t.fakeNode.getData();t.lf.setNodeSnapLine(l),t.lf.graphModel.eventCenter.emit(T.NODE_DND_DRAG,{data:l,e:o})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(o){!t.lf.graphModel||!o||!t.nodeConfig||(t.lf.addNode(Qt(Qt({},t.nodeConfig),t.clientToLocalPoint({x:o.clientX,y:o.clientY})),T.NODE_DND_ADD,o),o.preventDefault(),o.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var r=e.lf;this.lf=r}return n.prototype.clientToLocalPoint=function(e){var t=e.x,r=e.y,o=dr(this.lf.options,["grid","size"]),i=this.lf.graphModel.getPointByClient({x:t,y:r}),a=i.canvasOverlayPosition,s=a.x,l=a.y,d=this.lf.graphModel.editConfigModel.snapGrid;return{x:re(s,o,d),y:re(l,o,d)}},n.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},n.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},n}();function Us(n,e){n.on("node:mousemove",function(t){var r=t.data;e.setNodeSnapLine(r)}),n.on("node:mouseup",function(){e.clearSnapline()})}var Ws=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),wt=function(){return wt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},wt.apply(this,arguments)},Zs=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ks=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Vs=function(n){Ws(e,n);function e(t){var r=n.call(this,t)||this;return r.ref=Jr(),r.__prevText={type:"",text:"",id:""},r.keyupHandler=function(o){var i=r.props.graphModel.textEditElement;o.key==="Enter"&&o.altKey&&(i==null||i.setElementState(X.DEFAULT))},r.inputHandler=function(o){var i=o.target.innerText,a=r.props.graphModel.textEditElement;a&&(r.__prevText={type:a.type,text:i.replace(/(\r\n)+$|(\n)+$/,""),id:a.id})},r.keydownHandler=function(o){o.stopPropagation()},r.state={style:{left:0,top:0}},r}return e.getDerivedStateFromProps=function(t){var r,o=t.textEditElement,i=t.graphModel,a=i.transformModel,s=i.theme,l=s.inputText,d;if(o){if(!(!((r=o.text)===null||r===void 0)&&r.value)&&o.BaseType===U.EDGE){var u=o.text,f=o.textPosition,c=f.x,h=f.y;u.x=c,u.y=h,o.setText(u)}var v={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(o.BaseType===U.EDGE){var p=s.edgeText,g=p.overflowMode,y=p.lineHeight,_=p.wrapPadding,O=p.textWidth;O&&g==="autoWrap"&&(d=wt(wt({},v),{width:O,minWidth:O,lineHeight:y,padding:_}))}else if(o.BaseType===U.NODE){var S=s.nodeText,g=S.overflowMode,y=S.lineHeight,_=S.wrapPadding,O=S.textWidth,M=o.width,w=o.modelType,A=o.textWidth,D=A||O||M;(w!==R.TEXT_NODE&&g==="autoWrap"||w===R.TEXT_NODE&&O)&&(d=wt(wt({},v),{width:D,minWidth:D,lineHeight:y,padding:_}))}var N=o.text,j=N.x,G=N.y,H=Ks(a.CanvasPointToHtmlPoint([j,G]),2),Z=H[0],I=H[1];return{style:wt(wt({left:Z,top:I},d),l)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var r=this.__prevText,o=r.text,i=r.id;t.updateText(i,o),t.eventCenter.emit(T.TEXT_UPDATE,{data:wt({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var r=document.createRange();r.selectNodeContents(t),r.collapse(!1);var o=window.getSelection();o==null||o.removeAllRanges(),o==null||o.addRange(r)}},e.prototype.render=function(){var t,r=this.props.graphModel.textEditElement,o=this.state.style;return r?x("div",{contentEditable:!0,className:"lf-text-input",style:o,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=r.text)===null||t===void 0?void 0:t.value},r.id):null},e.toolName="text-edit-tool",e=Zs([at],e),e}(V),qs=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Js=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Er=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Qs=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},tl=function(n){qs(e,n);function e(t){var r=n.call(this,t)||this;r.handleMouseDown=function(s){r.stepDrag.handleMouseDown(s)},r.handleWheelEvent=function(s){var l,d;s.preventDefault();var u=s.deltaX,f=s.deltaY,c=s.clientX,h=s.clientY,v=s.ctrlKey,p=new WheelEvent("wheel",{deltaX:u,deltaY:f,clientX:c,clientY:h,ctrlKey:v});(d=(l=r.props.lf.container)===null||l===void 0?void 0:l.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||d===void 0||d.dispatchEvent(p)},r.onDragging=function(s){var l=s.deltaX,d=s.deltaY,u=r.props,f=u.graphModel,c=u.lf,h=c.getTransform(),v=h.SCALE_X,p=h.SCALE_Y,g=f.getSelectElements(!0);f.moveNodes(g.nodes.map(function(y){return y.id}),l/v,d/p)},r.handleContextMenu=function(s){s.preventDefault();var l=r.props,d=l.graphModel,u=l.graphModel,f=u.eventCenter,c=u.selectElements,h=d.getPointByClient({x:s.clientX,y:s.clientY}),v={nodes:[],edges:[]},p=Qs([],Er(c.values()),!1);p.forEach(function(g){g.BaseType===U.NODE&&v.nodes.push(g.getData()),g.BaseType===U.EDGE&&v.edges.push(g.getData())}),f.emit(T.SELECTION_CONTEXTMENU,{data:v,e:s,position:h})};var o=t.graphModel,i=o.gridSize,a=o.eventCenter;return r.stepDrag=new St({onDragging:r.onDragging,step:i,eventType:"SELECTION",eventCenter:a}),r}return e.prototype.render=function(){var t,r,o=this.props.graphModel,i=o.selectElements,a=o.transformModel,s=this.props.lf.getTransform(),l=s.SCALE_X,d=s.SCALE_Y;if(!(i.size<=1)){var u=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;i.forEach(function(p){var g;p.BaseType===U.NODE&&(g=Wo(p)),p.BaseType===U.EDGE&&(g=qo(p)),g!==void 0&&(u=Math.min(u,g.x),f=Math.min(f,g.y),c=Math.max(c,g.x1),h=Math.max(h,g.y1))}),t=Er(a.CanvasPointToHtmlPoint([u,f]),2),u=t[0],f=t[1],r=Er(a.CanvasPointToHtmlPoint([c,h]),2),c=r[0],h=r[1];var v={left:"".concat(u-20*l/2,"px"),top:"".concat(f-20*d/2,"px"),width:"".concat(c-u+20*l,"px"),height:"".concat(h-f+20*d,"px"),"border-width":"".concat(2*l,"px")};return x("div",{className:"lf-multiple-select",style:v,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=Js([at],e),e}(V),Mr=function(n,e,t,r){var o=arguments.length,i=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var s=n.length-1;s>=0;s--)(a=n[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},el=[Vs,tl],rl=function(){function n(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,W(el,function(i){t.isDisabled(i.toolName)||t.registerTool(i.toolName,i)});var r=e.graphModel,o=r.eventCenter;o.on("".concat(T.GRAPH_TRANSFORM,",").concat(T.NODE_CLICK,",").concat(T.BLANK_CLICK," "),function(){var i,a=r.textEditElement,s=r.editConfigModel,l=s.edgeTextEdit,d=s.nodeTextEdit;(l||d)&&a&&((i=r.textEditElement)===null||i===void 0||i.setElementState(X.DEFAULT))})}return n.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},n.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},n.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},n.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},n.prototype.getTools=function(){return Array.from(this.toolMap.values())},n.prototype.getInstance=function(){return this.instance},n.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},Mr([E],n.prototype,"toolMap",void 0),Mr([m],n.prototype,"disableTool",null),Mr([m],n.prototype,"enableTool",null),n}(),qr=function(){return qr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},qr.apply(this,arguments)},nl=function(){function n(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return n.prototype.add=function(e){on(No(this.undos),e)||(this.undos.push(e),on(this.curData,e)||(this.redos=[]),this.eventCenter.emit(T.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},n.prototype.undoAble=function(){return this.undos.length>1},n.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=L(t),t}},n.prototype.redoAble=function(){return this.redos.length>0},n.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=L(e),e}},n.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=Xo(e,no(function(){var r=e.modelToHistoryData();r&&t.add(qr({},r))},this.waitTime))},n.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},n}();var mt=null;function Qn(n,e){var t,r;return n.x+=e,n.y+=e,Ar(n.text)||(n.text.x+=e,n.text.y+=e),Ar((t=n.properties)===null||t===void 0?void 0:t._label)||(r=n.properties)===null||r===void 0||r._label.forEach(function(o){o.x+=e,o.y+=e}),n}function to(n,e){return n.startPoint&&(n.startPoint.x+=e,n.startPoint.y+=e),n.endPoint&&(n.endPoint.x+=e,n.endPoint.y+=e),n.pointsList&&n.pointsList.length>0&&n.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Ar(n.text)||(n.text.x+=e,n.text.y+=e),n}var Vt=40,Ze=40;function ol(n,e){var t=n.keyboard,r=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Ze=Vt,!(r!=null&&r.enabled)||e.textEditElement)return!0;var o=n.options.guards,i=e.getSelectElements(!1),a=o&&o.beforeClone?o.beforeClone(i):!0;return!a||i.nodes.length===0&&i.edges.length===0?(mt=null,!0):(mt=i,mt.nodes.forEach(function(s){return Qn(s,Vt)}),mt.edges.forEach(function(s){return to(s,Vt)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(r!=null&&r.enabled)||e.textEditElement)return!0;if(mt&&(mt.nodes||mt.edges)){n.clearSelectElements();var o=n.addElements(mt,Ze);if(!o)return!0;o.nodes.forEach(function(i){return n.selectElementById(i.id,!0)}),o.edges.forEach(function(i){return n.selectElementById(i.id,!0)}),mt.nodes.forEach(function(i){return Qn(i,Vt)}),mt.edges.forEach(function(i){return to(i,Vt)}),Ze=Ze+Vt}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(r!=null&&r.enabled)||e.textEditElement?!0:(n.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(r!=null&&r.enabled)||e.textEditElement?!0:(n.redo(),!1)}),t.on(["backspace"],function(){if(!(r!=null&&r.enabled)||e.textEditElement)return!0;var o=e.getSelectElements(!0);return n.clearSelectElements(),o.edges.forEach(function(i){return i.id&&n.deleteEdge(i.id)}),o.nodes.forEach(function(i){return i.id&&n.deleteNode(i.id)}),!1})}var il=function(){function n(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new ko(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return n.prototype.initShortcuts=function(){var e=this,t,r=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(r)if(bo(r))r.forEach(function(s){var l=s.keys,d=s.callback,u=s.action;return e.on(l,d,u)});else{var o=r.keys,i=r.callback,a=r.action;this.on(o,i,a)}},n.prototype.on=function(e,t,r){this.mousetrap.bind(this.getKeys(e),t,r)},Object.defineProperty(n.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),n.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},n.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},n.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},n.prototype.destroy=function(){this.mousetrap.reset()},n.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(r){return t.formatKey(r)})},n.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},n}(),Nt=function(){return Nt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},Nt.apply(this,arguments)},Ke=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},Or=function(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))},Sr=Symbol("plugin registered by Logicflow.use"),eo=function(){function n(e){var t=this,r;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(d,u){return t.viewMap.set(d,u)},this.getView=function(d){return t.viewMap.get(d)};var o=xe.get(e),i=o.container,a=o.width,s=o.height;this.options=o,this.container=this.initContainer(i,a,s),this.graphModel=new is(Nt(Nt({},o),{container:this.container})),this.plugins=(r=o.plugins)!==null&&r!==void 0?r:[];var l=this.graphModel.eventCenter;this.tool=new rl(this),this.dnd=new $s({lf:this}),this.history=new nl(l),this.keyboard=new il({lf:this,keyboard:o.keyboard}),o.snapline!==!1&&(this.snaplineModel=new as(this.graphModel,o.snaplineEpsilon),Us(l,this.snaplineModel)),o.isSilentMode||(ol(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(o.disabledPlugins)}return n.prototype.initContainer=function(e,t,r){var o=document.createElement("div");return o.style.position="relative",o.style.width=t?"".concat(t,"px"):"100%",o.style.height=r?"".concat(r,"px"):"100%",e.innerHTML="",e.appendChild(o),o},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return n.toStringTag},enumerable:!1,configurable:!0}),n.prototype.register=function(e,t,r){if(r===void 0&&(r=!0),typeof e!="string"){this.registerElement(e);return}var o={BaseEdge:cr,BaseEdgeModel:fr,BaseNode:jt,BaseNodeModel:Lt,RectNode:Gn,RectNodeModel:Bn,CircleNode:zn,CircleNodeModel:Ln,PolygonNode:Fn,PolygonNodeModel:In,TextNode:Wn,TextNodeModel:Xn,LineEdge:qn,LineEdgeModel:Dn,DiamondNode:$n,DiamondNodeModel:jn,PolylineEdge:Jn,PolylineEdgeModel:bn,BezierEdge:Vn,BezierEdgeModel:Pn,EllipseNode:Un,EllipseNodeModel:Rn,HtmlNode:Zn,HtmlNodeModel:Yn,h:ro,type:e};if(this.viewMap.forEach(function(d){var u=d.extendKey;u&&(o[u]=d)}),this.graphModel.modelMap.forEach(function(d){var u=d.extendKey;u&&(o[u]=d)}),t){var i=t(o),a=i.view,s=i.model,l=a;r&&!l.isObserved&&(l.isObserved=!0,l=at(l)),this.setView(e,l),this.graphModel.setModel(e,s)}},n.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=at(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},n.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),W(e,function(r){t.registerElement(r)})},n.prototype.defaultRegister=function(){var e=[{type:"rect",view:Gn,model:Bn},{type:"circle",view:zn,model:Ln},{type:"polygon",view:Fn,model:In},{type:"text",view:Wn,model:Xn},{type:"ellipse",view:Un,model:Rn},{type:"diamond",view:$n,model:jn},{type:"html",view:Zn,model:Yn},{type:"line",view:qn,model:Dn},{type:"polyline",view:Jn,model:bn},{type:"bezier",view:Vn,model:Pn}];this.batchRegister(e)},n.prototype.addNode=function(e,t,r){return t===void 0&&(t=T.NODE_ADD),this.graphModel.addNode(e,t,r)},n.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var r=t.getData(),o=this.options.guards,i=o!=null&&o.beforeDelete?o.beforeDelete(r):!0;return i&&this.graphModel.deleteNode(e),i},n.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),r=t==null?void 0:t.getData();if(r){var o=this.options.guards,i=o!=null&&o.beforeClone?o.beforeClone(r):!0;if(i)return this.graphModel.cloneNode(e)}},n.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},n.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},n.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},n.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},n.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},n.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},n.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},n.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},n.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var r=new t(Nt(Nt({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(r),r},n.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},n.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},n.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},n.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},n.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},n.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},n.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},n.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,r=e.targetNodeId,o=[],i=this.graphModel.edges;return t&&r?W(i,function(a){a.sourceNodeId===t&&a.targetNodeId===r&&o.push(a)}):t?W(i,function(a){a.sourceNodeId===t&&o.push(a)}):r&&W(i,function(a){a.targetNodeId===r&&o.push(a)}),o},n.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},n.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},n.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var r=t.getData(),o=this.options.guards,i=o!=null&&o.beforeDelete?o.beforeDelete(r):!0;return i&&this.graphModel.deleteEdgeById(e),i},n.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,r=e.targetNodeId;t&&r?this.graphModel.deleteEdgeBySourceAndTarget(t,r):t?this.graphModel.deleteEdgeBySource(t):r&&this.graphModel.deleteEdgeByTarget(r)},n.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},n.prototype.addElements=function(e,t){var r=this,o=e.nodes,i=e.edges;t===void 0&&(t=40),console.log("distance",t);var a={},s={nodes:[],edges:[]};return W(o,function(l){var d=l.id,u=r.addNode(l);d&&(a[d]=u.id),s.nodes.push(u)}),W(i,function(l){var d=l.sourceNodeId,u=l.targetNodeId;a[d]&&(d=a[d]),a[u]&&(u=a[u]);var f=r.graphModel.addEdge(Nt(Nt({},l),{sourceNodeId:d,targetNodeId:u}));s.edges.push(f)}),s},n.prototype.selectElementById=function(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),this.graphModel.selectElementById(e,t),!t&&r&&this.graphModel.toFront(e)},n.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},n.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},n.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},n.prototype.getModelById=function(e){return this.graphModel.getElement(e)},n.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},n.prototype.deleteElement=function(e){var t,r,o,i=this.getModelById(e);if(!i)return!1;var a=(t={},t[U.NODE]=this.deleteNode,t[U.EDGE]=this.deleteEdge,t);return(o=(r=a[i.BaseType])===null||r===void 0?void 0:r.call(this,e))!==null&&o!==void 0?o:!1},n.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},n.prototype.getAreaElement=function(e,t,r,o,i){return r===void 0&&(r=!0),o===void 0&&(o=!0),i===void 0&&(i=!1),this.graphModel.getAreaElement(e,t,r,o,i).map(function(a){return a.getData()})},n.prototype.setProperties=function(e,t){var r;(r=this.graphModel.getElement(e))===null||r===void 0||r.setProperties(rt(t))},n.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},n.prototype.deleteProperty=function(e,t){var r;(r=this.graphModel.getElement(e))===null||r===void 0||r.deleteProperty(t)},n.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},n.prototype.editText=function(e){this.graphModel.editText(e)},n.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},n.prototype.updateEditConfig=function(e){var t=this.graphModel,r=t.editConfigModel,o=t.transformModel,i=r.snapGrid;if(r.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&o.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!dt(e==null?void 0:e.snapGrid)&&e.snapGrid!==i){var a=this.graphModel.grid.size,s=a===void 0?1:a;this.graphModel.updateGridSize(e.snapGrid?s:1)}this.emit(T.EDIT_CONFIG_CHANGED,{data:r.getConfig()})},n.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},n.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},n.prototype.getTheme=function(){return this.graphModel.getTheme()},n.prototype.focusByElement=function(e){var t=void 0,r=this.getNodeModelById(e);if(r){var o=r.getData(),i=o.x,a=o.y;t={x:i,y:a}}var s=this.getEdgeModelById(e);if(s){var l=s.textPosition,i=l.x,a=l.y;t={x:i,y:a}}t&&this.focusByCoordinate(t)},n.prototype.focusByCoordinate=function(e){var t=this.graphModel,r=t.transformModel,o=t.width,i=t.height,a=e.x,s=e.y;r.focusOn(a,s,o,i)},n.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,r=e.coordinate;t&&this.focusByElement(t),r&&this.focusByCoordinate(r)}},n.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},n.prototype.toFront=function(e){this.graphModel.toFront(e)},n.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},n.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Or([r],Ke(e),!1)):r},n.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},n.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},n.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(rt(e)),this.options.history!==!1&&this.history.watch(this.graphModel),rn(x(ps,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(T.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},n.prototype.render=function(e){var t=L(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},n.prototype.undo=function(){if(this.history.undoAble()){var e=rt(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.redo=function(){if(this.history.redoAble()){var e=rt(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.zoom=function(e,t){var r=this.graphModel.transformModel;return r.zoom(e,t)},n.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},n.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},n.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},n.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,r=e.SCALE_Y,o=e.TRANSLATE_X,i=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:r,TRANSLATE_X:o,TRANSLATE_Y:i}},n.prototype.translate=function(e,t){var r=this.graphModel.transformModel;r.translate(e,t)},n.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,r=e.TRANSLATE_Y;this.translate(-t,-r)},n.prototype.translateCenter=function(){this.graphModel.translateCenter()},n.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},n.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},n.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},n.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},n.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},n.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},n.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},n.use=function(e,t){var r,o=e.pluginName;if(!o)throw new Error("请给插件指定 pluginName!");this.extensions.set(o,(r={},r[Sr]=Sr,r.extension=e,r.props=t,r))},n.addThemeMode=function(e,t){da(e,t)},n.removeThemeMode=function(e){ua(e)},n.clearThemeMode=function(){An()},n.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var r=Array.from(n.extensions,function(i){var a=Ke(i,2),s=a[1];return s}),o=Or(Or([],Ke(this.plugins),!1),Ke(r),!1);W(o,function(i){var a,s;Sr in i?(a=i.extension,s=i.props):a=i;var l=a==null?void 0:a.pluginName;Co(e,l)===-1&&t.installPlugin(a,s)})},n.prototype.installPlugin=function(e,t){var r,o;if("pluginName"in e&&"install"in e){var i=e.pluginName,a=e.install,s=e.render;i&&(a&&a.call(e,this,n),s&&this.components.push(s.bind(e)),this.extension[i]=e);return}var l=e,d=l.pluginName,u=new l({lf:this,LogicFlow:n,props:t,options:(o=(r=this.options.pluginsOptions)===null||r===void 0?void 0:r[d])!==null&&o!==void 0?o:{}});u.render&&this.components.push(u.render.bind(u)),this.extension[d]=u},n.prototype.destroy=function(){var e;this.clearData(),rn(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),An();for(var t in this.extension){var r=this.extension[t];"destroy"in r&&((e=r.destroy)===null||e===void 0||e.call(r))}},n.extensions=new Map,n}();(function(n){n.toStringTag="LF.".concat(n.name)})(eo||(eo={}));function at(n){return So(n)}export{Ln as C,eo as L,Jn as P,Bn as R,zn as a,Gn as b,bn as c};
