var G=Object.defineProperty;var W=(t,o,e)=>o in t?G(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var f=(t,o,e)=>(W(t,typeof o!="symbol"?o+"":o,e),e);import{x as j,b as N}from"./element-plus-9-QK-U0O.js";import{d as T,o as b,P as A,Q as h,a as c,T as v,c as w,S as q,M as L,r as C,s as O,e as Q,ai as H,V as _,U as M,ad as J,ac as K,n as X}from"./@vue-1pEateLc.js";import{_ as k}from"./plugin-vueexport-helper-x3n3nnut.js";import{M as I,D as $,W as P,V as B,z as E,A as Y,E as Z}from"./@codemirror-lq3ilx3k.js";import{b as ee}from"./codemirror-QByZyPV8.js";import"./lodash-es-88S84ShG.js";import"./@vueuse-sS3gTgD0.js";import"./@element-plus-GFHZwatb.js";import"./@sxzz--N-3kK7X.js";import"./@ctrl-ZggoHSuR.js";import"./dayjs-0oS7_Iqn.js";import"./@turf-VZU31W4K.js";import"./async-validator-BHjhHa7C.js";import"./memoize-one-JaOscZgY.js";import"./normalize-wheel-es-1urBKM79.js";import"./@floating-ui-_1sru3kO.js";import"./@lezer-eqgAWrhG.js";import"./style-mod-S7zvAXGh.js";import"./crelt-9OWz1RP4.js";import"./@marijn-SOylZkLX.js";import"./w3c-keyname-KjuS0gPF.js";const te=["onMouseenter"],oe={key:0,class:"desc"},se={name:"Tree"},ne=T({...se,props:{data:{default:()=>[]}},emits:["mouseenter"],setup(t,{emit:o}){const e=t,r=o,l=d=>{r("mouseenter",d)};return(d,y)=>{const i=j;return b(),A(i,L({style:{"max-width":"600px"},data:e.data},d.$attrs),{default:h(({node:u,data:s})=>[c("div",{class:"tree-node",onMouseenter:m=>l(s)},[c("span",null,v(s.label),1),s.desc?(b(),w("span",oe,v(s.desc),1)):q("",!0)],40,te)]),_:1},16,["data"])}}}),V=k(ne,[["__scopeId","data-v-9ecb9895"]]),ae={class:"desc"},re={class:"title"},ie={class:"example"},ce={class:"description"},le={name:"Desc"},de=T({...le,props:{title:{type:String,default:""},example:{type:String,default:""},description:{type:String,default:""}},setup(t){const o=t;return(e,r)=>(b(),w("div",ae,[c("h4",re,v(o.title),1),c("p",ie,v(o.example),1),c("p",ce,v(o.description),1)]))}}),pe=k(de,[["__scopeId","data-v-59c8cf75"]]),S=new I({regexp:/\[\[(.+?)\]\]/g,decoration:t=>$.replace({widget:new ue(t[1])})});class ue extends P{constructor(e){super();f(this,"id","");f(this,"text","");if(e){const[r,...l]=e.split(".");r&&l.length&&(this.text=l.join("."),this.id=r,console.log(this.text,"id:",this.id))}}eq(e){return this.text==e.text}toDOM(){let e=document.createElement("span");return this.text&&(e.className="cm-tag",e.textContent=this.text),e}ignoreEvent(){return!0}}const me=B.fromClass(class{constructor(t){f(this,"placeholders");this.placeholders=S.createDeco(t)}update(t){this.placeholders=S.updateDeco(t,this.placeholders)}},{decorations:t=>t.placeholders,provide:t=>E.atomicRanges.of(o=>{var e;return((e=o.plugin(t))==null?void 0:e.placeholders)||$.none})}),F=new I({regexp:/\{\{(.+?)\}\}/g,decoration:t=>$.replace({widget:new _e(t[1])})});class _e extends P{constructor(e){super();f(this,"text","");e&&(this.text=e)}eq(e){return this.text==e.text}toDOM(){let e=document.createElement("span");return this.text&&(e.className="cm-fn",e.textContent=this.text),e}ignoreEvent(){return!0}}const fe=B.fromClass(class{constructor(t){f(this,"placeholders");this.placeholders=F.createDeco(t)}update(t){this.placeholders=F.updateDeco(t,this.placeholders)}},{decorations:t=>t.placeholders,provide:t=>E.atomicRanges.of(o=>{var e;return((e=o.plugin(t))==null?void 0:e.placeholders)||$.none})}),he=E.baseTheme({".cm-tag":{paddingLeft:"6px",paddingRight:"6px",paddingTop:"3px",paddingBottom:"3px",marginLeft:"3px",marginRight:"3px",backgroundColor:"#ffcdcc",borderRadius:"4px"},".cm-fn":{color:"#01a252"}}),ge=()=>{const t=C(""),o=O(),e=C(),r=[me,fe,he,E.lineWrapping,ee,Y()];return{code:t,view:o,editorRef:e,init:()=>{e.value&&(o.value=new E({parent:e.value,state:Z.create({doc:t.value,extensions:r})}),setTimeout(()=>{var i;(i=o.value)==null||i.focus()},0))},destroyed:()=>{var i;(i=o.value)==null||i.destroy(),o.value=void 0},insertText:(i,u="tag")=>{if(o.value){let s=u==="tag"?`[[${i}]]`:`{{${i}}}()`;const m=o.value.state.selection;if(m.main.empty){const n=m.main.head,g=u==="tag"?n+s.length:n+s.length-1,x=o.value.state.update({changes:{from:n,to:n,insert:s},selection:{anchor:g}});o.value.dispatch(x)}else{const n=m.main.from,g=m.main.to,x=u==="tag"?n+s.length:n+s.length-1,D=o.value.state.update({changes:{from:n,to:g,insert:s},selection:{anchor:x}});o.value.dispatch(D)}setTimeout(()=>{var n;(n=o.value)==null||n.focus()},0)}}}},xe=t=>({SUM:{title:"求和",example:"SUM(数值1,数值2,...)",description:"SUM(数学成绩,语文成绩,英语成绩,...) = 各科总成绩"},AVERAGE:{title:"平均数",example:"AVERAGE(数值1,数值2,...)",description:"AVERAGE(数学成绩,语文成绩,英语成绩,...) = 平均成绩"},IF:{title:"条件判断",example:"IF(条件,真值,假值)",description:"IF(数学成绩>90,优秀,良好)"}})[t],ve={class:"editor-container"},be={class:"editor-content"},Ee={class:"fn"},De={class:"fn-list"},Te={class:"fn-desc"},$e={name:"Editor"},ye=T({...$e,setup(t,{expose:o}){const e=Q({visible:!1,paramsData:[{label:"参数1",id:"1"},{label:"参数2",id:"2"},{label:"参数3",id:"3"}],fnData:[{label:"常用函数",id:"1",children:[{label:"SUM",desc:"求和",id:"1-1"},{label:"IF",desc:"条件判断",id:"1-2"}]}],info:{}}),{code:r,view:l,editorRef:d,init:y,destroyed:i,insertText:u}=ge(),s=a=>{a.children||u(`${a.id}.${a.label}`)},m=a=>{a.children||u(`${a.label}`,"fn")},n=a=>{const p=xe(a.label);p&&(e.info=p)},g=()=>{var p;const a=(p=l.value)==null?void 0:p.state.doc;console.log(a)},x=()=>{e.visible=!0,X(()=>{y()})},D=a=>{i(),a()};return o({open:x}),(a,p)=>{const R=N,U=H("MyDialog");return b(),A(U,{modelValue:e.visible,"onUpdate:modelValue":p[0]||(p[0]=z=>e.visible=z),title:"Editor",width:800,center:"","close-on-click-modal":!1,"before-close":D},{footer:h(()=>[c("div",null,[_(R,{onClick:D},{default:h(()=>[M("取消")]),_:1}),_(R,{type:"primary",onClick:g},{default:h(()=>[M("确认")]),_:1})])]),default:h(()=>[c("div",ve,[_(V,{class:"editor-tree",data:e.paramsData,onNodeClick:s},null,8,["data"]),c("div",be,[c("div",{class:"editor-main",ref_key:"editorRef",ref:d},null,512),c("div",Ee,[c("div",De,[_(V,{"default-expand-all":!0,data:e.fnData,onNodeClick:m,onMouseenter:n},null,8,["data"])]),c("div",Te,[_(pe,J(K(e.info)),null,16)])])])])]),_:1},8,["modelValue"])}}}),Ce=k(ye,[["__scopeId","data-v-38115ab0"]]),Me={name:"RulesEditor"},Ke=T({...Me,setup(t){const o=C(),e=()=>{var r;(r=o.value)==null||r.open()};return(r,l)=>{const d=N;return b(),w("div",null,[_(d,{type:"primary",size:"default",onClick:e},{default:h(()=>[M("编辑")]),_:1}),_(Ce,{ref_key:"editor",ref:o},null,512)])}}});export{Ke as default};
